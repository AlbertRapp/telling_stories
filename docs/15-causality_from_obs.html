<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Telling Stories with Data - 15&nbsp; Causality from observational data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./16-mrp.html" rel="next">
<link href="./14-ijalm.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="site_libs/viz-1.8.2/viz.js"></script>
<link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="site_libs/grViz-binding-1.0.9/grViz.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Causality from observational data</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Telling Stories with Data</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/RohanAlexander/telling_stories/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-author.html" class="sidebar-item-text sidebar-link">About the author</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Foundations</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Telling stories with data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-drinking_from_a_fire_hose.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Drinking from a fire hose</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-r_essentials.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">R essentials</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-workflow.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reproducible workflows</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Communication</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-writing_research.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Writing research</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-static_communication.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Static communication</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-interactive_communication.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Interactive communication</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Acquisition</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-farm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Farm data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-gather.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Gather data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-hunt.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Hunt data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Preparation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-clean_and_prepare.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Clean and prepare</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-store_and_share.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Store and share</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Modelling</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-eda.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-ijalm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">It’s Just A Linear Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-causality_from_obs.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Causality from observational data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-mrp.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Multilevel regression with post-stratification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-text.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Text as data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-concluding.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Concluding remarks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-rmarkdown.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">R Markdown</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-assessment.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Papers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-datasheet.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Datasheet</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./98-cocktails.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Cocktails</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"> <span class="header-section-number">15.1</span> Introduction</a></li>
  <li><a href="#directed-acyclic-graphs" id="toc-directed-acyclic-graphs" class="nav-link" data-scroll-target="#directed-acyclic-graphs"> <span class="header-section-number">15.2</span> Directed acyclic graphs</a></li>
  <li><a href="#two-common-paradoxes" id="toc-two-common-paradoxes" class="nav-link" data-scroll-target="#two-common-paradoxes"> <span class="header-section-number">15.3</span> Two common paradoxes</a>
  <ul class="collapse">
  <li><a href="#simpsons-paradox" id="toc-simpsons-paradox" class="nav-link" data-scroll-target="#simpsons-paradox"> <span class="header-section-number">15.3.1</span> Simpson’s paradox</a></li>
  <li><a href="#berksons-paradox" id="toc-berksons-paradox" class="nav-link" data-scroll-target="#berksons-paradox"> <span class="header-section-number">15.3.2</span> Berkson’s paradox</a></li>
  </ul></li>
  <li><a href="#difference-in-differences" id="toc-difference-in-differences" class="nav-link" data-scroll-target="#difference-in-differences"> <span class="header-section-number">15.4</span> Difference in differences</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview"> <span class="header-section-number">15.4.1</span> Overview</a></li>
  <li><a href="#simulated-example" id="toc-simulated-example" class="nav-link" data-scroll-target="#simulated-example"> <span class="header-section-number">15.4.2</span> Simulated example</a></li>
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions"> <span class="header-section-number">15.4.3</span> Assumptions</a></li>
  <li><a href="#case-study-french-newspaper-prices-between-1960-and-1974" id="toc-case-study-french-newspaper-prices-between-1960-and-1974" class="nav-link" data-scroll-target="#case-study-french-newspaper-prices-between-1960-and-1974"> <span class="header-section-number">15.4.4</span> Case study: French newspaper prices between 1960 and 1974</a></li>
  </ul></li>
  <li><a href="#propensity-score-matching" id="toc-propensity-score-matching" class="nav-link" data-scroll-target="#propensity-score-matching"> <span class="header-section-number">15.5</span> Propensity score matching</a></li>
  <li><a href="#regression-discontinuity-design" id="toc-regression-discontinuity-design" class="nav-link" data-scroll-target="#regression-discontinuity-design"> <span class="header-section-number">15.6</span> Regression discontinuity design</a>
  <ul class="collapse">
  <li><a href="#overview-1" id="toc-overview-1" class="nav-link" data-scroll-target="#overview-1"> <span class="header-section-number">15.6.1</span> Overview</a></li>
  <li><a href="#simulated-example-1" id="toc-simulated-example-1" class="nav-link" data-scroll-target="#simulated-example-1"> <span class="header-section-number">15.6.2</span> Simulated example</a></li>
  <li><a href="#assumptions-1" id="toc-assumptions-1" class="nav-link" data-scroll-target="#assumptions-1"> <span class="header-section-number">15.6.3</span> Assumptions</a></li>
  </ul></li>
  <li><a href="#instrumental-variables" id="toc-instrumental-variables" class="nav-link" data-scroll-target="#instrumental-variables"> <span class="header-section-number">15.7</span> Instrumental variables</a>
  <ul class="collapse">
  <li><a href="#overview-2" id="toc-overview-2" class="nav-link" data-scroll-target="#overview-2"> <span class="header-section-number">15.7.1</span> Overview</a></li>
  <li><a href="#simulated-example-2" id="toc-simulated-example-2" class="nav-link" data-scroll-target="#simulated-example-2"> <span class="header-section-number">15.7.2</span> Simulated example</a></li>
  <li><a href="#assumptions-2" id="toc-assumptions-2" class="nav-link" data-scroll-target="#assumptions-2"> <span class="header-section-number">15.7.3</span> Assumptions</a></li>
  </ul></li>
  <li><a href="#exercises-and-tutorial" id="toc-exercises-and-tutorial" class="nav-link" data-scroll-target="#exercises-and-tutorial"> <span class="header-section-number">15.8</span> Exercises and tutorial</a>
  <ul class="collapse">
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  <li><a href="#tutorial" id="toc-tutorial" class="nav-link" data-scroll-target="#tutorial">Tutorial</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/RohanAlexander/telling_stories/edit/main/15-causality_from_obs.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-causality-from-observational-data" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Causality from observational data</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p><strong>Required material</strong></p>
<ul>
<li>Read <em>BNT162b2 mRNA Covid-19 Vaccine in a Nationwide Mass Vaccination Setting</em>, <span class="citation" data-cites="dagan2021bnt162b2">(<a href="99-references.html#ref-dagan2021bnt162b2" role="doc-biblioref">Dagan et al. 2021</a>)</span></li>
<li>Read <em>The Effect: An Introduction to Research Design and Causality</em>, Chapters 18 ‘Difference-in-Differences’, 19 ‘Instrumental Variables’, and 20 ‘Regression Discontinuity’, <span class="citation" data-cites="theeffect">(<a href="99-references.html#ref-theeffect" role="doc-biblioref">Huntington-Klein 2021</a>)</span></li>
<li>Read <em>Understanding regression discontinuity designs as observational studies</em>, <span class="citation" data-cites="sekhon2017understanding">(<a href="99-references.html#ref-sekhon2017understanding" role="doc-biblioref">Sekhon and Titiunik 2017</a>)</span></li>
</ul>
<p><strong>Key concepts and skills</strong></p>
<ul>
<li>Being able to put together DAGs.</li>
<li>Essential matching methods and the weaknesses of matching.</li>
<li>Implementing difference in differences.</li>
<li>Identifying opportunities for instrumental variables and implementing it.</li>
<li>Challenges to the validity of instrumental variables.</li>
<li>Reading in foreign data.</li>
<li>Understanding regression discontinuity and implementing it both manually and using packages.</li>
<li>Appreciating the threats to the validity of regression discontinuity.</li>
</ul>
<p><strong>Key packages and functions</strong></p>
<ul>
<li><code>broom</code> <span class="citation" data-cites="broom">(<a href="99-references.html#ref-broom" role="doc-biblioref">Robinson, Hayes, and Couch 2021</a>)</span></li>
<li><code>DiagrammeR</code> <span class="citation" data-cites="citeDiagrammeR">(<a href="99-references.html#ref-citeDiagrammeR" role="doc-biblioref">Iannone 2020</a>)</span></li>
<li><code>estimatr</code> <span class="citation" data-cites="estimatr">(<a href="99-references.html#ref-estimatr" role="doc-biblioref">Blair et al. 2021</a>)</span></li>
<li><code>haven</code> <span class="citation" data-cites="citehaven">(<a href="99-references.html#ref-citehaven" role="doc-biblioref">Wickham and Miller 2020</a>)</span></li>
<li><code>MatchIt</code> <span class="citation" data-cites="MatchIt">(<a href="99-references.html#ref-MatchIt" role="doc-biblioref">Ho et al. 2011</a>)</span></li>
<li><code>modelsummary</code> <span class="citation" data-cites="citemodelsummary">(<a href="99-references.html#ref-citemodelsummary" role="doc-biblioref">Arel-Bundock 2021</a>)</span></li>
<li><code>rdrobust</code> <span class="citation" data-cites="rdrobust">(<a href="99-references.html#ref-rdrobust" role="doc-biblioref">Calonico et al. 2021</a>)</span></li>
<li><code>scales</code> <span class="citation" data-cites="scales">(<a href="99-references.html#ref-scales" role="doc-biblioref">Wickham and Seidel 2020</a>)</span></li>
<li><code>tidyverse</code> <span class="citation" data-cites="Wickham2017">(<a href="99-references.html#ref-Wickham2017" role="doc-biblioref">Wickham 2017</a>)</span></li>
</ul>
<p><strong>Key functions</strong></p>
<ul>
<li><code>DiagrammeR::grViz()</code></li>
<li><code>estimatr::iv_robust()</code></li>
<li><code>haven::read_dta()</code></li>
<li><code>MatchIt::matchit()</code></li>
<li><code>modelsummary::datasummary_skim()</code></li>
<li><code>modelsummary::modelsummary()</code></li>
<li><code>poly()</code></li>
<li><code>rdrobust::rdrobust()</code></li>
<li><code>scales::dollar_format()</code></li>
</ul>
<!-- https://declaredesign.org/blog/2019-02-05-instrumental-variables.html -->
<!-- https://raw.githack.com/edrubin/EC421W19/master/LectureNotes/11InstrumentalVariables/11_instrumental_variables.html#41 -->
<!-- https://www.cambridge.org/core/journals/political-science-research-and-methods/article/estimating-slimmajority-effects-in-us-state-legislatures-with-a-regression-discontinuity-design-under-local-randomization-assumptions/33581FB74160166FF29E49DE64497F3C#fndtn-information -->
<!-- **Required reading** -->
<!-- - Better Evaluation, 'Regression Discontinuity', https://www.betterevaluation.org/en/evaluation-options/regressiondiscontinuity -->
<!-- - Eggers, Andrew C., Anthony Fowler, Jens Hainmueller, Andrew B. Hall, and James M. Snyder Jr, 2015, ‘On the validity of the regression discontinuity design for estimating electoral effects: New evidence from over 40,000 close races’, American Journal of Political Science, 59 (1), pp. 259-274 -->
<!-- - Gelman, Andrew, 2019, 'Another Regression Discontinuity Disaster and what can we learn from it', 25 June, https://statmodeling.stat.columbia.edu/2019/06/25/another-regression-discontinuity-disaster-and-what-can-we-learn-from-it/.  -->
<!-- - Gelman, Andrew, Jennifer Hill and Aki Vehtari, 2020, Regression and Other Stories, Cambridge University Press, Chs 18 - 21. -->
<!-- - Gertler, Paul, Sebastian Martinez, Patrick Premand, Laura Rawlings, and Christel Vermeersch, 'Impact Evaluation in Practice', Chapter 5 - 8. -->
<!-- - McElreath, Richard, 2020, Statistical Rethinking, 2nd Edition, CRC Press, Ch 14. -->
<!-- - Meng, Xiao-Li, 2021, 'What Are the Values of Data, Data Science, or Data Scientists?', *Harvard Data Science Review*, https://doi.org/10.1162/99608f92.ee717cf7, https://hdsr.mitpress.mit.edu/pub/bj2dfcwg/release/2. -->
<!-- - Riederer, Emily, 2021, 'Causal design patterns for data analysts', 30 January, https://emilyriederer.netlify.app/post/causal-design-patterns/ -->
<!-- - Wong, Jeffrey, and Colin McFarland, 2020, ‘Computational Causal Inference at Netflix’, Netflix Technology Blog, 11 Aug, https://netflixtechblog.com/computational-causal-inference-at-netflix-293591691c62. -->
<!-- **Required viewing** -->
<!-- - Gelman, Andrew, 2020 '100 Stories of Causal Inference', 4 August, https://www.youtube.com/watch?v=jnI5KI843Lk. -->
<!-- - King, Gary, 2020, ‘Research Designs’, Lectures on Quantitative Social Science Methods 1, https://youtu.be/SBwPLwVOb7s.  -->
<!-- - Kuriwaki, Shiro, 2020, 'Difference-in-Differences Estimation in R (parts 1 and 2)', 18 April, https://vimeo.com/409267138 and https://vimeo.com/409267190. -->
<!-- - Kuriwaki, Shiro, 2020, 'Instrumental variables in R', 11 April, https://vimeo.com/406629459. -->
<!-- - Kuriwaki, Shiro, 2020, 'Regression Discontinuity in R (parts 1 and 2)', 25 March, https://vimeo.com/400826628 and https://vimeo.com/400826660. -->
<!-- - Oostrom, Tamar, 2021, 'Funding of Clinical Trials and Reported Drug Efficacy', 2 March, https://youtu.be/DdnpWS9Km5U. -->
<!-- - Riederer, Emily, 2021, 'Observational Causal Inference', Toronto Data Workshop, 15 February, https://youtu.be/VP3BBZ7poc0. -->
<!-- **Recommended reading** -->
<!-- - Alexander, Monica, Polimis, Kivan, and Zagheni, Emilio, 2019,' The impact of Hurricane Maria on out-migration from Puerto Rico: Evidence from Facebook data', *Population and Development Review*. (Example of using diff-in-diff to measure the effect of Hurricane Maria.) -->
<!-- - Alexander, Rohan, and Zachary Ward, 2018, 'Age at arrival and assimilation during the age of mass migration', *The Journal of Economic History*, 78, no. 3, 904-937. (Example where I used differences between brothers to estimate the effect of education.) -->
<!-- - Angrist, Joshua D., and Jörn-Steffen Pischke, 2008, *Mostly harmless econometrics: An empiricist's companion*, Princeton University Press, Chapter 4.  -->
<!-- - Angrist, Joshua D., and Jörn-Steffen Pischke, 2008, *Mostly harmless econometrics: An empiricist's companion*, Princeton University Press, Chapter 6. -->
<!-- - Angrist, Joshua D., and Jörn-Steffen Pischke, 2008, *Mostly harmless econometrics: An empiricist's companion*, Princeton University Press, Chapters 3.3.2 and 5. -->
<!-- - Austin, Peter C., 2011, 'An Introduction to Propensity Score Methods for Reducing the Effects of Confounding in Observational Studies', *Multivariate Behavioral Research*, vol. 46, no. 3, pp.399-424. (Broad overview of propensity score matching, with a nice discussion of the comparison to randomized controlled trials.) -->
<!-- - Baker, Andrew, 2019, 'Difference-in-Differences Methodology', 25 September, https://andrewcbaker.netlify.app/2019/09/25/difference-in-differences-methodology/.  -->
<!-- - Coppock, Alenxader, and Donald P. Green, 2016, 'Is Voting Habit Forming? New Evidence from Experiments and Regression Discontinuities', *American Journal of Political Science*, Volume 60, Issue 4, pp. 1044-1062, available at: https://onlinelibrary.wiley.com/doi/abs/10.1111/ajps.12210. (Has code and data.) -->
<!-- - Cunningham, Scott, 'Causal Inference: The Mixtape', Chapter 'Instrumental variables', http://www.scunning.com/causalinference_norap.pdf. -->
<!-- - Cunningham, Scott, 'Causal Inference: The Mixtape', chapter 'Regression discontinuity', http://www.scunning.com/causalinference_norap.pdf. -->
<!-- - Cunningham, Scott, *Causal Inference: The Mixtape*, chapters 'Matching and subclassifications' and 'Differences-in-differences', http://www.scunning.com/causalinference_norap.pdf. (Very well-written notes on diff-in-diff.) -->
<!-- - Dell, Melissa, Pablo Querubin, 2018, 'Nation Building Through Foreign Intervention: Evidence from Discontinuities in Military Strategies', *The Quarterly Journal of Economics*, Volume 133, Issue 2, pp. 701–764, https://doi.org/10.1093/qje/qjx037. -->
<!-- - Evans, David, 2013, 'Regression Discontinuity Porn', *World Bank Blogs*, 16 November, https://blogs.worldbank.org/impactevaluations/regression-discontinuity-porn. -->
<!-- - Gelman, Andrew, 2019, 'Another Regression Discontinuity Disaster and what can we learn from it', *Statistical Modeling, Causal Inference, and Social Science*, 25 June, https://statmodeling.stat.columbia.edu/2019/06/25/another-regression-discontinuity-disaster-and-what-can-we-learn-from-it/. -->
<!-- - Gelman, Andrew, and Guido Imbens, 2019, "Why high-order polynomials should not be used in regression discontinuity designs", *Journal of Business & Economic Statistics*, 37, pp. 447-456. -->
<!-- - Gelman, Andrew, and Jennifer Hill, 2007, *Data Analysis Using Regression and Muiltilevel/Hierarchical Models*, Chapter 10, pp. 207-215. -->
<!-- - Grogger, Jeffrey, Andreas Steinmayr, Joachim Winter, 2020, 'The Wage Penalty of Regional Accents', NBER Working Paper No. 26719. -->
<!-- - Harris, Rich, Mlacki Migliozzi and Niraj Chokshi, '13,000 Missing Flights: The Global Consequences of the Coronavirus', *New York Times*, 21 February 2020. freely available here (if you make an account): https://www.nytimes.com/interactive/2020/02/21/business/coronavirus-airline-travel.html. -->
<!-- - Imai, Kosuke, 2017, Quantitative Social Science: An Introduction, Princeton University Press, Ch 2.5. -->
<!-- - Imbens, Guido W., and Thomas Lemieux, 2008, 'Regression discontinuity designs: A guide to practice', *Journal of Econometrics*, vol. 142, no. 2, pp. 615-635. -->
<!-- - Myllyvirta, Lauri, 2020, 'Analysis: Coronavirus has temporarily reduced China's CO2 emissions by a quarter', *Carbon Brief*, 19 February, https://www.carbonbrief.org/analysis-coronavirus-has-temporarily-reduced-chinas-co2-emissions-by-a-quarter. -->
<!-- - Saeed, Sahar, Erica E. M. Moodie, Erin C. Strumpf, Marina B. Klein, 2019, 'Evaluating the impact of health policies: using a difference-in-differences approach', *International Journal of Public Health*, 64, pp. 637–642, https://doi.org/10.1007/s00038-018-1195-2. -->
<!-- - Taddy, Matt, 2019, *Business Data Science*, Chapter 5, pp. 146-162. -->
<!-- - Tang, John, 2015, 'Pollution havens and the trade in toxic chemicals: evidence from U.S. trade flows', *Ecological Economics*, vol. 112, pp. 150-160. (Example of using diff-in-diff to estimate pollution.) -->
<!-- - Travis, D.J., Carleton, A.M. and Lauritsen, R.G., 2004. 'Regional variations in US diurnal temperature range for the 11–14 September 2001 aircraft groundings: Evidence of jet contrail influence on climate', Journal of climate, 17(5), pp.1123-1134. -->
<!-- - Travis, David J., Andrew M. Carleton, and Ryan G. Lauritsen. "Contrails reduce daily temperature range." Nature, 418, no. 6898 (2002): 601-601. -->
<!-- - Valencia Caicedo, Felipe. 'The mission: Human capital transmission, economic persistence, and culture in South America.' The Quarterly Journal of Economics 134.1 (2019): 507-556. (Data available at: Valencia Caicedo, Felipe, 2018, "Replication Data for: 'The Mission: Human Capital Transmission, Economic Persistence, and Culture in South America'", https://doi.org/10.7910/DVN/ML1155, Harvard Dataverse, V1.). -->
<!-- - Zinovyeva, Natalia and Maryna Tverdostup, 2019, 'Why are women who earn slightly more than their husbands hard to find?', 10 June, https://blogs.lse.ac.uk/businessreview/2019/06/10/why-are-women-who-earn-slightly-more-than-their-husbands-hard-to-find/. -->
<section id="introduction" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">15.1</span> Introduction</h2>
<p>Life is grand when we can conduct experiments to be able to speak to causality. But there are circumstances in which we cannot run an experiment, but nonetheless want to be able to make causal claims. And data from outside experiments have value that experiments do not have. In this chapter we discuss the circumstances and methods that allow us to speak to causality using observational data. We use relatively simple methods, in sophisticated ways, drawing from statistics, but also a variety of social sciences, including economics, and political science, as well as epidemiology.</p>
<p>For instance, <span class="citation" data-cites="dagan2021bnt162b2">Dagan et al. (<a href="99-references.html#ref-dagan2021bnt162b2" role="doc-biblioref">2021</a>)</span> use observational data to confirm the effectiveness of the Pfizer-BioNTech vaccine. They discuss how one concern with using observational data in this way is confounding, which is where we are concerned that there is some variable that affects both the explanatory and dependent variables and can lead to spurious relationships. <span class="citation" data-cites="dagan2021bnt162b2">Dagan et al. (<a href="99-references.html#ref-dagan2021bnt162b2" role="doc-biblioref">2021</a>)</span> adjust for this by first making a list of potential confounders, such as age, sex, geographic location, healthcare usage and then adjusting for each of them, by matching, one-to-one between people that were vaccinated and those that were not. The experimental data guided the use of observational data, and the larger size of the later enabled a focus on specific age-groups and extent of disease.</p>
<p>Using observational data in sophisticated ways is what this chapter is about. How we can nonetheless be comfortable making causal statements, even when we cannot run A/B tests or RCTs. Indeed, in what circumstances may we prefer to not run those or to run observational-based approaches in addition to them. We cover three of the major methods: difference in differences; regression discontinuity; and instrumental variables.</p>
</section>
<section id="directed-acyclic-graphs" class="level2" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="directed-acyclic-graphs"><span class="header-section-number">15.2</span> Directed acyclic graphs</h2>
<p>When we are discussing causality, it can help to be very specific about what we mean. It is easy to get caught up in observational data and trick ourselves. It is important to think hard, and to use all the tools available to us. For instance, in that earlier example, <span class="citation" data-cites="dagan2021bnt162b2">Dagan et al. (<a href="99-references.html#ref-dagan2021bnt162b2" role="doc-biblioref">2021</a>)</span> were able to use experimental data as a guide. Most of the time, we will not be so lucky as to have both experimental data and observational data available to us. But one framework that can help with thinking hard about our data is the use of directed acyclic graph (DAG). DAGs are a fancy name for a flow diagram and involves drawing arrows and lines between the variables to indicate the relationship between them. Following <span class="citation" data-cites="citeerik">Igelström (<a href="99-references.html#ref-citeerik" role="doc-biblioref">2020</a>)</span> we use <code>DiagrammeR</code> <span class="citation" data-cites="citeDiagrammeR">(<a href="99-references.html#ref-citeDiagrammeR" role="doc-biblioref">Iannone 2020</a>)</span> to build them here, because we can use the same skills outside of just DAGs and <code>DiagrammeR</code> provides quite a lot of control (<a href="#fig-firstdag">Figure&nbsp;<span>15.1</span></a>)). But <code>ggdag</code> is also useful <span class="citation" data-cites="citeggdag">(<a href="99-references.html#ref-citeggdag" role="doc-biblioref">Barrett 2021</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DiagrammeR)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>DiagrammeR<span class="sc">::</span><span class="fu">grViz</span>(<span class="st">"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="st">digraph {</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="st">  graph [ranksep = 0.2]</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="st">  node [shape = plaintext, fontsize = 10, fontname = Helvetica]</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="st">    x</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="st">    y</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="st">  edge [minlen = 2, arrowhead = vee]</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="st">    x-&gt;y</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="st">  { rank = same; x; y }</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>, <span class="at">height =</span> <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-firstdag" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="htmlwidget-a3e7f77a21f8cbde7806" style="width:75%;height:200px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-a3e7f77a21f8cbde7806">{"x":{"diagram":"\ndigraph {\n  graph [ranksep = 0.2]\n  node [shape = plaintext, fontsize = 10, fontname = Helvetica]\n    x\n    y\n  edge [minlen = 2, arrowhead = vee]\n    x->y\n  { rank = same; x; y }\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p></p><figcaption class="figure-caption">Figure 15.1: Using a DAG to illustrate perceived relationships</figcaption><p></p>
</figure>
</div>
</div>
<p>In <a href="#fig-firstdag">Figure&nbsp;<span>15.1</span></a>, we think that <em>x</em> causes <em>y</em>. We could build another DAG where the situation is less clear. To make the examples a little easier to follow, we will switch to fruits (<a href="#fig-carrotasconfounder">Figure&nbsp;<span>15.2</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>DiagrammeR<span class="sc">::</span><span class="fu">grViz</span>(<span class="st">"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="st">digraph {</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="st">  graph [ranksep = 0.2]</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">  node [shape = plaintext, fontsize = 10, fontname = Helvetica]</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">    Apple</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="st">    Banana</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="st">    Carrot</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="st">  edge [minlen = 2, arrowhead = vee]</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="st">    Apple-&gt;Banana</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="st">    Carrot-&gt;Apple</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="st">    Carrot-&gt;Banana</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="st">  { rank = same; Apple; Banana }</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>, <span class="at">height =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-carrotasconfounder" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="htmlwidget-7d3cd02bfcdc64ff4e6d" style="width:75%;height:300px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-7d3cd02bfcdc64ff4e6d">{"x":{"diagram":"\ndigraph {\n  graph [ranksep = 0.2]\n  node [shape = plaintext, fontsize = 10, fontname = Helvetica]\n    Apple\n    Banana\n    Carrot\n  edge [minlen = 2, arrowhead = vee]\n    Apple->Banana\n    Carrot->Apple\n    Carrot->Banana\n  { rank = same; Apple; Banana }\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p></p><figcaption class="figure-caption">Figure 15.2: A DAG showing Carrot as a confounder</figcaption><p></p>
</figure>
</div>
</div>
<p>In <a href="#fig-carrotasconfounder">Figure&nbsp;<span>15.2</span></a>, we think <em>Apple</em> causes <em>Banana</em>. But we also think that <em>Carrot</em> causes <em>Banana</em>, and that <em>Carrot</em> also causes <em>Apple</em>. That relationship is a ‘backdoor path’, and would create spurious correlation in our analysis. We may think that changes in <em>Apple</em> are causing changes in <em>Banana</em>, but it could be that <em>Carrot</em> is changing them both. That variable, in this case, <em>Carrot</em>, is called a ‘confounder’.</p>
<p><span class="citation" data-cites="hernanrobins2020">Hernan and Robins (<a href="99-references.html#ref-hernanrobins2020" role="doc-biblioref">2020, 83</a>)</span> discuss an interesting case where a researcher was interested in whether one person looking up at the sky makes others look up at the sky also. There was a clear relationship between the responses of both people. But it was also the case that there was noise in the sky. So, it was unclear whether the second person looked up because the first person looked up, or they both looked up because of the noise. When using experimental data, randomization allows us to avoid this concern, but with observational data we cannot rely on that. It is also not the case that bigger data necessarily get around this problem for us. Instead, it is important to think carefully about the situation.</p>
<p>If there are confounders, but we are still interested in causal effects, then we need to adjust for them. One way is to include them in the regression. But the validity of this requires several assumptions. In particular, <span class="citation" data-cites="gelmanandhill">Gelman and Hill (<a href="99-references.html#ref-gelmanandhill" role="doc-biblioref">2007, 169</a>)</span> warn that our estimate will only correspond to the average causal effect in the sample if we include all of the confounders and have the right model. Putting the second requirement to one side, and focusing only on the first, if we do not think about and observe a confounder, then it can be difficult to adjust for it. And this is an area where both domain expertise and theory can bring a lot to an analysis.</p>
<p>In <a href="#fig-carrotasmediator">Figure&nbsp;<span>15.3</span></a> we have a similar situation where again, we may think that <em>Apple</em> causes <em>Banana</em>. But in <a href="#fig-carrotasmediator">Figure&nbsp;<span>15.3</span></a> <em>Apple</em> also causes <em>Carrot</em>, which itself causes <em>Banana</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>DiagrammeR<span class="sc">::</span><span class="fu">grViz</span>(<span class="st">"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="st">digraph {</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="st">  graph [ranksep = 0.2]</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="st">  node [shape = plaintext, fontsize = 10, fontname = Helvetica]</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="st">    Apple</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="st">    Banana</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="st">    Carrot</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="st">  edge [minlen = 2, arrowhead = vee]</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="st">    Apple-&gt;Banana</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="st">    Apple-&gt;Carrot</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="st">    Carrot-&gt;Banana</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="st">  { rank = same; Apple; Banana }</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>, <span class="at">height =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-carrotasmediator" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="htmlwidget-ae9b6f2cdab88981a955" style="width:75%;height:300px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-ae9b6f2cdab88981a955">{"x":{"diagram":"\ndigraph {\n  graph [ranksep = 0.2]\n  node [shape = plaintext, fontsize = 10, fontname = Helvetica]\n    Apple\n    Banana\n    Carrot\n  edge [minlen = 2, arrowhead = vee]\n    Apple->Banana\n    Apple->Carrot\n    Carrot->Banana\n  { rank = same; Apple; Banana }\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p></p><figcaption class="figure-caption">Figure 15.3: A DAG showing Carrot as a mediator</figcaption><p></p>
</figure>
</div>
</div>
<p>In <a href="#fig-carrotasmediator">Figure&nbsp;<span>15.3</span></a>, <em>Carrot</em> is called a ‘mediator’ and we would not adjust for it if we were interested in the effect of <em>Apple</em> on <em>Banana</em>. If we were to adjust for it, then some of what we are attributing to <em>Apple</em>, would be due to <em>Carrot</em>.</p>
<p>Finally, in <a href="#fig-carrotascollider">Figure&nbsp;<span>15.4</span></a> we have yet another similar situation, where we again, think that <em>Apple</em> causes <em>Banana</em>. But this time both <em>Apple</em> and <em>Banana</em> also cause <em>Carrot</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>DiagrammeR<span class="sc">::</span><span class="fu">grViz</span>(<span class="st">"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="st">digraph {</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="st">  graph [ranksep = 0.2]</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="st">  node [shape = plaintext, fontsize = 10, fontname = Helvetica]</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="st">    Apple</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="st">    Banana</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="st">    Carrot</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="st">  edge [minlen = 2, arrowhead = vee]</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="st">    Apple-&gt;Banana</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="st">    Apple-&gt;Carrot</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="st">    Banana-&gt;Carrot</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="st">  { rank = same; Apple; Banana }</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>, <span class="at">height =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-carrotascollider" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<div id="htmlwidget-1df5d1e86d4d63f52a3a" style="width:75%;height:300px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-1df5d1e86d4d63f52a3a">{"x":{"diagram":"\ndigraph {\n  graph [ranksep = 0.2]\n  node [shape = plaintext, fontsize = 10, fontname = Helvetica]\n    Apple\n    Banana\n    Carrot\n  edge [minlen = 2, arrowhead = vee]\n    Apple->Banana\n    Apple->Carrot\n    Banana->Carrot\n  { rank = same; Apple; Banana }\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p></p><figcaption class="figure-caption">Figure 15.4: A DAG showing Carrot as a collider</figcaption><p></p>
</figure>
</div>
</div>
<p>In this case, <em>Carrot</em> is called a ‘collider’ and if we were to condition on it, then we would create a misleading relationship.</p>
<p>It is important to be clear about this: we must create the DAG ourselves, in the same way that we must put together the model ourselves. There is nothing that will create it for us. This means that we need to think carefully about the situation. Because it is one thing to see something in the DAG and then do something about it. But it is another to not even know that it is there. <span class="citation" data-cites="citemcelreath">McElreath (<a href="99-references.html#ref-citemcelreath" role="doc-biblioref">2020, 180</a>)</span> describes these as haunted DAGs. DAGs are helpful, but they are just a tool to help us think deeply about our situation.</p>
</section>
<section id="two-common-paradoxes" class="level2" data-number="15.3">
<h2 data-number="15.3" class="anchored" data-anchor-id="two-common-paradoxes"><span class="header-section-number">15.3</span> Two common paradoxes</h2>
<section id="simpsons-paradox" class="level3" data-number="15.3.1">
<h3 data-number="15.3.1" class="anchored" data-anchor-id="simpsons-paradox"><span class="header-section-number">15.3.1</span> Simpson’s paradox</h3>
<p>There are two situations where data can trick us that are so common that we will explicitly go through them. These are: 1) Simpson’s paradox, and 2) Berkson’s paradox. It is important to keep these situations in mind, and the use of DAGs can help identify them.</p>
<p>Simpson’s paradox occurs when we estimate some relationship for subsets of our data, but a different relationship when we consider the entire dataset <span class="citation" data-cites="simpson1951interpretation">(<a href="99-references.html#ref-simpson1951interpretation" role="doc-biblioref">Simpson 1951</a>)</span>. It is a particular case of the ecological fallacy, which is when we try to make claims about individuals, based on their group. For instance, it may be that there is a positive relationship between undergraduate grades and performance in graduate school in two departments when considering each department individually. But if undergraduate grades tended to be higher in one department than another while graduate school performance tended to be opposite, we may find a negative relationship between undergraduate grades and performance in graduate school. We can simulate some data to show this more clearly (<a href="#fig-simpsonsparadox">Figure&nbsp;<span>15.5</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>number_in_each <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>department_one <span class="ot">&lt;-</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">undergrad =</span> <span class="fu">runif</span>(<span class="at">n =</span> number_in_each, <span class="at">min =</span> <span class="fl">0.7</span>, <span class="at">max =</span> <span class="fl">0.9</span>),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">noise =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> number_in_each, <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.1</span>),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">grad =</span> undergrad <span class="sc">+</span> noise,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"Department 1"</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>department_two <span class="ot">&lt;-</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">undergrad =</span> <span class="fu">runif</span>(<span class="at">n =</span> number_in_each, <span class="at">min =</span> <span class="fl">0.6</span>, <span class="at">max =</span> <span class="fl">0.8</span>),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">noise =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> number_in_each, <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.1</span>),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">grad =</span> undergrad <span class="sc">+</span> noise <span class="sc">+</span> <span class="fl">0.3</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"Department 2"</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>both_departments <span class="ot">&lt;-</span> <span class="fu">rbind</span>(department_one, department_two)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>both_departments</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,000 × 4
   undergrad   noise  grad type        
       &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       
 1     0.772 -0.0566 0.715 Department 1
 2     0.724 -0.0312 0.693 Department 1
 3     0.797  0.0770 0.874 Department 1
 4     0.763 -0.0664 0.697 Department 1
 5     0.707  0.0717 0.779 Department 1
 6     0.781 -0.0165 0.764 Department 1
 7     0.726 -0.104  0.623 Department 1
 8     0.749  0.0527 0.801 Department 1
 9     0.732 -0.0471 0.684 Department 1
10     0.738  0.0552 0.793 Department 1
# … with 1,990 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>both_departments <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> undergrad, <span class="at">y =</span> grad)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> type), <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> type), <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="st">"y ~ x"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Undergraduate results"</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Graduate results"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Department"</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-simpsonsparadox" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="15-causality_from_obs_files/figure-html/fig-simpsonsparadox-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 15.5: Illustration of simulated data that shows Simpson’s paradox</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Simpson’s paradox is often illustrated using real-world data from University of California, Berkeley, on graduate admissions <span class="citation" data-cites="bickel1975sex">(<a href="99-references.html#ref-bickel1975sex" role="doc-biblioref">Bickel, Hammel, and O’Connell 1975</a>)</span>. <span class="citation" data-cites="bickel1975sex">Bickel, Hammel, and O’Connell (<a href="99-references.html#ref-bickel1975sex" role="doc-biblioref">1975</a>)</span> include what might be one of the greatest sub-titles ever published: ‘Measuring bias is harder than is usually assumed, and the evidence is sometimes contrary to expectation’. More recently, as shown in its documentation, the ‘penguins’ dataset from <code>parlmerpenguins</code> <span class="citation" data-cites="palmerpenguins">(<a href="99-references.html#ref-palmerpenguins" role="doc-biblioref">Horst, Presmanes Hill, and Gorman 2020</a>)</span> provides an example of Simpson’s paradox, using real-world data (<a href="#fig-simpsonsparadoxinpenguins">Figure&nbsp;<span>15.6</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> bill_depth_mm)) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> species), <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> species), <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="st">"y ~ x"</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Body mass (grams)"</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Bill depth (millimeters)"</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Species"</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-simpsonsparadoxinpenguins" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="15-causality_from_obs_files/figure-html/fig-simpsonsparadoxinpenguins-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 15.6: Illustration of Simpson’s paradox in a dataset of penguin bill depth compared with their body mass</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="berksons-paradox" class="level3" data-number="15.3.2">
<h3 data-number="15.3.2" class="anchored" data-anchor-id="berksons-paradox"><span class="header-section-number">15.3.2</span> Berkson’s paradox</h3>
<p>Berkson’s paradox occurs when we estimate some relationship based on the dataset that we have. But because the dataset is so selected, the relationship is different in a more general dataset <span class="citation" data-cites="citeberkson">(<a href="99-references.html#ref-citeberkson" role="doc-biblioref">Berkson 1946</a>)</span>. For instance, if we have a dataset of professional cyclists then we might find there is no relationship between their VO2 max and their chance of winning a bike race. But if we had a dataset of the general population then we might find a relationship between these two variables. The professional dataset has just been so selected that the relationship disappears; one cannot become a professional cyclist unless one has a good-enough VO2 max. Again, we can simulate some data to show this more clearly (<a href="#fig-berksonsparadox">Figure&nbsp;<span>15.7</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>number_of_pros <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>number_of_public <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>professionals <span class="ot">&lt;-</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">VO2 =</span> <span class="fu">runif</span>(<span class="at">n =</span> number_of_pros, <span class="at">min =</span> <span class="fl">0.7</span>, <span class="at">max =</span> <span class="fl">0.9</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">chance_of_winning =</span> <span class="fu">runif</span>(<span class="at">n =</span> number_of_pros, <span class="at">min =</span> <span class="fl">0.7</span>, <span class="at">max =</span> <span class="fl">0.9</span>),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"Professionals"</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>general_public <span class="ot">&lt;-</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">VO2 =</span> <span class="fu">runif</span>(<span class="at">n =</span> number_of_public, <span class="at">min =</span> <span class="fl">0.6</span>, <span class="at">max =</span> <span class="fl">0.8</span>),</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">noise =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> number_of_public, <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.03</span>),</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">chance_of_winning =</span> VO2 <span class="sc">+</span> noise <span class="sc">+</span> <span class="fl">0.1</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"Public"</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>noise)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>professionals_and_public <span class="ot">&lt;-</span> <span class="fu">rbind</span>(professionals, general_public)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>professionals_and_public</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,100 × 3
     VO2 chance_of_winning type         
   &lt;dbl&gt;             &lt;dbl&gt; &lt;chr&gt;        
 1 0.772             0.734 Professionals
 2 0.724             0.773 Professionals
 3 0.797             0.772 Professionals
 4 0.763             0.754 Professionals
 5 0.707             0.843 Professionals
 6 0.781             0.740 Professionals
 7 0.726             0.803 Professionals
 8 0.749             0.750 Professionals
 9 0.732             0.890 Professionals
10 0.738             0.821 Professionals
# … with 1,090 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>professionals_and_public <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> VO2, <span class="at">y =</span> chance_of_winning)) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> type), <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> type), <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y ~ x"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"VO2 max"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Chance of winning a bike race"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Type"</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-berksonsparadox" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="15-causality_from_obs_files/figure-html/fig-berksonsparadox-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 15.7: Illustration of simulated data that shows Berkson’s paradox</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Shoulders of giants
</div>
</div>
<div class="callout-body-container callout-body">
<p>Evelyn Kitagawa</p>
</div>
</div>
</section>
</section>
<section id="difference-in-differences" class="level2" data-number="15.4">
<h2 data-number="15.4" class="anchored" data-anchor-id="difference-in-differences"><span class="header-section-number">15.4</span> Difference in differences</h2>
<section id="overview" class="level3" data-number="15.4.1">
<h3 data-number="15.4.1" class="anchored" data-anchor-id="overview"><span class="header-section-number">15.4.1</span> Overview</h3>
<p>The ideal situation of being able to conduct an experiment is rarely possible. Can we reasonably expect that Netflix would allow us to change prices? And even if they did once, would they let us do it again, and again, and again? Further, rarely can we explicitly create treatment and control groups. Finally, experiments can be expensive or unethical. Instead, we need to make do with what we have. Rather than our counterfactual coming to us through randomization, and hence us knowing that the two are the same but for the treatment, we try to identify groups that were similar but for the treatment, and hence any differences can be attributed to the treatment.</p>
<p>With observational data, sometimes there are differences between our two groups before we treat. Provided those pre-treatment differences satisfy assumptions that essentially amount to the differences being both consistent, and that we expect that consistency to continue in the absence of the treatment—the ‘parallel trends’ assumption—then we can look to any difference in the differences as the effect of the treatment. One of the aspects of difference in differences analysis is that we can do it using relatively straight-forward methods. Linear regression with a binary variable is enough to get started and do a convincing job.</p>
<p>Consider wanting to know the effect of a new tennis racket on serve speed. One way to test this would be to measure the difference between, say, Roger Federer’s serve speed without the tennis racket and the serve speed of an enthusiastic amateur, let us call them Ville, with the tennis racket. Yes, we would find a difference, but would we know how much to attribute to the tennis racket? Another way would be to consider the difference between Ville’s serve speed without the new tennis racket and Ville’s serve speed with the new tennis racket. But what if serves were just getting faster naturally over time? Instead, we combine the two approaches to look at the difference in the differences.</p>
<p>We begin by measuring Federer’s serve speed and compare it to Ville’s serve speed, both without the new racket. We then measure Federer’s serve speed again, and measure Ville’s serve speed with the new racket. That difference in the differences would then be the estimate of the effect of the new racket. There are a few key assumptions that we need to make for this analysis to be appropriate:</p>
<ol type="1">
<li>Is there something else that may have affected only Ville, and not Federer that could affect Ville’s serve speed?</li>
<li>Is it likely that Federer and Ville have the same trajectory of serve speed improvement? This is the ‘parallel trends’ assumption, and it dominates many discussions of difference in differences analysis.</li>
<li>Finally, is it likely that the variance of our serve speeds of Federer and Ville are the same?</li>
</ol>
<p>Despite these requirements, difference in differences is a powerful approach because we do not need the treatment and control group to be the same before the treatment. We just need to have a good idea of how they differed.</p>
</section>
<section id="simulated-example" class="level3" data-number="15.4.2">
<h3 data-number="15.4.2" class="anchored" data-anchor-id="simulated-example"><span class="header-section-number">15.4.2</span> Simulated example</h3>
<p>To be more specific about the situation, we simulate data. We will simulate a situation in which there is initially a difference of one between the serve speeds of the different people, and then after a new tennis racket, there is a difference of six. We can use a graph to illustrate the situation (<a href="#fig-diffindifftennisracket">Figure&nbsp;<span>15.8</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>simulated_difference_in_differences <span class="ot">&lt;-</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">person =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>), <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> <span class="dv">1000</span>), <span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">times =</span> <span class="dv">1000</span>)),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_group =</span> <span class="fu">rep</span>(</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sample</span>(</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">1000</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">times =</span> <span class="dv">2</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment_group =</span> <span class="fu">as.factor</span>(treatment_group),</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> <span class="fu">as.factor</span>(time)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>simulated_difference_in_differences <span class="ot">&lt;-</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  simulated_difference_in_differences <span class="sc">|&gt;</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">serve_speed =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>      time <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> treatment_group <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>      time <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> treatment_group <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">6</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>      time <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> treatment_group <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>      time <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> treatment_group <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">14</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>simulated_difference_in_differences</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,000 × 4
# Rowwise: 
   person time  treatment_group serve_speed
    &lt;int&gt; &lt;fct&gt; &lt;fct&gt;                 &lt;dbl&gt;
 1      1 0     0                      4.43
 2      2 0     1                      6.96
 3      3 0     1                      7.77
 4      4 0     0                      5.31
 5      5 0     0                      4.09
 6      6 0     0                      4.85
 7      7 0     0                      6.43
 8      8 0     0                      5.77
 9      9 0     1                      6.13
10     10 0     1                      7.32
# … with 1,990 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>simulated_difference_in_differences <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> time,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> serve_speed,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> treatment_group</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> person), <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time period"</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Serve speed"</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Person got a new racket"</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-diffindifftennisracket" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="15-causality_from_obs_files/figure-html/fig-diffindifftennisracket-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 15.8: Illustration of simulated data that shows a difference before and after getting a new tennis racket</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>As it is a straight-forward example, we can obtain our estimate manually, by looking at the average difference of the differences. When we do that, we find that we estimate the effect of the new tennis racket to be 5.06, which is similar to what we simulated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>average_differences <span class="ot">&lt;-</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  simulated_difference_in_differences <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> time,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> serve_speed,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"time_"</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">difference =</span> time_1 <span class="sc">-</span> time_0) <span class="sc">|&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment_group) <span class="sc">|&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">average_difference =</span> <span class="fu">mean</span>(difference))</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>average_differences<span class="sc">$</span>average_difference[<span class="dv">2</span>] <span class="sc">-</span> average_differences<span class="sc">$</span>average_difference[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.058414</code></pre>
</div>
</div>
<p>And we can use linear regression to get the same result. The equation that we are interested in is:</p>
<p><span class="math display">\[Y_{i,t} = \beta_0 + \beta_1\mbox{Treatment binary}_i + \beta_2\mbox{Time binary}_t + \beta_3(\mbox{Treatment binary} \times\mbox{Time binary})_{i,t} + \epsilon_{i,t}\]</span></p>
<p>While we should include the separate aspects as well, it is the estimate of the interaction that we are interested in. In this case it is <span class="math inline">\(\beta_3\)</span>. And we find that our estimated effect is 5.06.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>diff_in_diff_example_regression <span class="ot">&lt;-</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    serve_speed <span class="sc">~</span> treatment_group <span class="sc">*</span> time,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> simulated_difference_in_differences</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(diff_in_diff_example_regression)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = serve_speed ~ treatment_group * time, data = simulated_difference_in_differences)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.1415 -0.6638 -0.0039  0.6708  3.2664 

Coefficients:
                       Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             4.97131    0.04281  116.12   &lt;2e-16 ***
treatment_group1        3.03350    0.06225   48.73   &lt;2e-16 ***
time1                   1.00680    0.06055   16.63   &lt;2e-16 ***
treatment_group1:time1  5.05841    0.08803   57.46   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9828 on 1996 degrees of freedom
Multiple R-squared:  0.9268,    Adjusted R-squared:  0.9266 
F-statistic:  8418 on 3 and 1996 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="assumptions" class="level3" data-number="15.4.3">
<h3 data-number="15.4.3" class="anchored" data-anchor-id="assumptions"><span class="header-section-number">15.4.3</span> Assumptions</h3>
<p>If we want to use difference in differences, then we need to satisfy the assumptions. There were three that were touched on earlier, but here we will focus on one: the ‘parallel trends’ assumption. The parallel trends assumption haunts everything to do with difference in differences analysis because we can never prove it, we can just be convinced of it, and try to convince others.</p>
<p>To see why we can never prove it, consider an example in which we want to know the effect of a new stadium on a professional sports team’s wins/loses. To do this we consider two teams: the Golden State Warriors and the Toronto Raptors. The Warriors changed stadiums at the start of the 2019-20 season, while the Raptors did not, so we will consider four time periods: the 2016-17 season, 2017-18 season, 2018-19 season, and finally we will compare the performance with the one after they moved, so the 2019-20 season. The Raptors here act as our counterfactual. This means that we assume the relationship between the Warriors and the Raptors, in the absence of a new stadium, would have continued to change in a consistent way. But the fundamental problem of causal inference means that we can never know that for certain. We must present sufficient evidence to assuage any concerns that a reader may have.</p>
<p>There are four main threats to validity when we use difference in differences, and we need to address all of them <span class="citation" data-cites="Cunningham2021">(<a href="99-references.html#ref-Cunningham2021" role="doc-biblioref">Cunningham 2021, 272–77</a>)</span>:</p>
<ol type="1">
<li>Non-parallel trends. The treatment and control groups may be based on differences. As such it can be difficult to convincingly argue for parallel trends. In this case, maybe try to find another factor to consider in your model that may adjust for some of that. This may require difference in difference in differences (in the earlier example, we could perhaps add the San Francisco 49ers as they are in the same broad geographic area as the Warriors). Or maybe re-think the analysis to see if we can make a different control group. Adding additional earlier time periods may help but may introduce more issues, which we touch on in the third point.</li>
<li>Compositional differences. This is a concern when working with repeated cross-sections. What if the composition of those cross-sections change? For instance, if we are working at an app that is rapidly growing, and we want to look at the effect of some change. In our initial cross-section, we may have mostly young people, but in a subsequent cross-section, we may have more older people as the demographics of the app usage change. Hence our results may just be an age-effect, not an effect of the change that we are interested in.</li>
<li>Long-term effects compared with reliability. As we discussed in <a href="10-hunt.html"><span>Chapter&nbsp;10</span></a>, there is a trade-off between the length of the analysis that we run. As we run the analysis for longer there is more opportunity for other factors to affect the results. There is also increased chance for someone who was not treated to be treated. But, on the other hand, it can be difficult to convincingly argue that short-term results will continue in the long-term.</li>
<li>Functional form dependence. This is less of an issue when the outcomes are similar, but if they are different then functional form may be responsible for some aspects of the results.</li>
</ol>
</section>
<section id="case-study-french-newspaper-prices-between-1960-and-1974" class="level3" data-number="15.4.4">
<h3 data-number="15.4.4" class="anchored" data-anchor-id="case-study-french-newspaper-prices-between-1960-and-1974"><span class="header-section-number">15.4.4</span> Case study: French newspaper prices between 1960 and 1974</h3>
<p>In this case study we introduce <span class="citation" data-cites="angelucci2019newspapers">Angelucci and Cagé (<a href="99-references.html#ref-angelucci2019newspapers" role="doc-biblioref">2019</a>)</span>, and replicate its main findings.</p>
<p>The business model of newspapers was challenged by the internet and many local newspapers have closed. And this issue is not new. When television was introduced, there were similar concerns. <span class="citation" data-cites="angelucci2019newspapers">Angelucci and Cagé (<a href="99-references.html#ref-angelucci2019newspapers" role="doc-biblioref">2019</a>)</span> use the introduction of television advertising in France, announced in 1967, to examine the effect of decreased advertising revenue on newspapers. They create a dataset of French newspapers from 1960 to 1974 and then use difference in differences to examine the effect of the reduction in advertising revenues on newspapers’ content and prices. The change that they focus on is the introduction of television advertising, which they argue affected national newspapers more than local newspapers. They find that this change results in both less journalism-content in the newspapers and lower newspaper prices. Focusing on this change, and analyzing it using difference in differences, is important because it allows us to disentangle a few competing effects. For instance, did newspapers become redundant because they could no longer charge high prices for their advertisements, or because consumers preferred to get their news from the television?</p>
<p>We can get free access to the <a href="https://www.openicpsr.org/openicpsr/project/116438/version/V1/view">data</a> that underpins <span class="citation" data-cites="angelucci2019newspapers">Angelucci and Cagé (<a href="99-references.html#ref-angelucci2019newspapers" role="doc-biblioref">2019</a>)</span> after registration. The dataset is in the Stata data format, ‘dta’, which we can read with <code>read_dta()</code> from <code>haven</code> <span class="citation" data-cites="citehaven">(<a href="99-references.html#ref-citehaven" role="doc-biblioref">Wickham and Miller 2020</a>)</span>. The file that we are interested in is ‘Angelucci_Cage_AEJMicro_dataset.dta’, which is the ‘dta’ folder.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>newspapers <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"Angelucci_Cage_AEJMicro_dataset.dta"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>newspapers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,196 × 52
    year id_news local national after…¹   Had po_cst ps_cst etota…² ra_cst  ra_s
   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1  1960       1     1        0       0     0   2.60   2.29  1.09e8 5.29e7  45.9
 2  1961       1     1        0       0     0   2.51   2.20  1.18e8 5.66e7  47.9
 3  1962       1     1        0       0     0   2.39   2.13  1.09e8 6.48e7  52.4
 4  1963       1     1        0       0     0   2.74   2.43  1.61e8 7.06e7  50.2
 5  1964       1     1        0       0     0   2.65   2.35  1.74e8 7.50e7  52.5
 6  1965       1     1        0       0     0   2.59   2.29  1.77e8 7.44e7  52.2
 7  1966       1     1        0       0     0   2.52   2.31  2.11e8 8.14e7  49.6
 8  1967       1     1        0       0     0   3.27   2.88  2.13e8 8.03e7  43.2
 9  1968       1     1        0       0     0   3.91   3.45  2.10e8 8.72e7  40.2
10  1969       1     1        0       0     0   3.67   3.28  2.39e8 1.03e8  45.7
# … with 1,186 more rows, 41 more variables: rs_cst &lt;dbl&gt;, rtotal_cst &lt;dbl&gt;,
#   profit_cst &lt;dbl&gt;, nb_journ &lt;dbl&gt;, qs_s &lt;dbl&gt;, qtotal &lt;dbl&gt;, pages &lt;dbl&gt;,
#   ads_q &lt;dbl&gt;, ads_s &lt;dbl&gt;, news_hole &lt;dbl&gt;, share_Hard &lt;dbl&gt;,
#   ads_p4_cst &lt;dbl&gt;, R_sh_edu_primaire_ipo &lt;dbl&gt;,
#   R_sh_edu_secondaire_ipo &lt;dbl&gt;, R_sh_edu_no_ipo &lt;dbl&gt;,
#   R_sh_pcs_agri_ipo &lt;dbl&gt;, R_sh_pcs_patron_ipo &lt;dbl&gt;,
#   R_sh_pcs_cadre_ipo &lt;dbl&gt;, R_sh_pcs_employes_ipo &lt;dbl&gt;, …
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
<p>There are 1,196 observations in the dataset and 52 variables. <span class="citation" data-cites="angelucci2019newspapers">Angelucci and Cagé (<a href="99-references.html#ref-angelucci2019newspapers" role="doc-biblioref">2019</a>)</span> are interested in the 1960-1974 time-period which has around 100 newspapers. There are 14 national newspapers at the beginning of the period and 12 at the end. The key period is 1967, when the French government announced it would allow advertising on television. <span class="citation" data-cites="angelucci2019newspapers">Angelucci and Cagé (<a href="99-references.html#ref-angelucci2019newspapers" role="doc-biblioref">2019</a>)</span> argue that national newspapers were affected by this chance, but local newspapers were not. So, the national newspapers are the treatment group and the local newspapers are the control group.</p>
<p>We focus just on the headline difference in differences result and construct summary statistics (<a href="#tbl-frenchnewspaperssummarystatistics">Table&nbsp;<span>15.1</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>newspapers <span class="ot">&lt;-</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  newspapers <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    id_news,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    after_national,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    local,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    national, <span class="co"># Diff in diff variables</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    ra_cst,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    ads_p4_cst,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    ads_s, <span class="co"># Advertising side dependents</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    ps_cst,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    po_cst,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    qtotal,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    qs_s,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    rs_cst</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="co"># Reader side dependents</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ra_cst_div_qtotal =</span> ra_cst <span class="sc">/</span> qtotal) <span class="sc">|&gt;</span> <span class="co"># An advertising side dependent needs to be built</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(id_news, after_national, local, national), as.factor)) <span class="sc">|&gt;</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(year))</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>newspapers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,196 × 14
    year id_news after…¹ local natio…² ra_cst ads_p…³ ads_s ps_cst po_cst qtotal
   &lt;int&gt; &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt; &lt;fct&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1  1960 1       0       1     0       5.29e7    NA    30.6   2.29   2.60 9.45e4
 2  1961 1       0       1     0       5.66e7    NA    38.4   2.20   2.51 9.63e4
 3  1962 1       0       1     0       6.48e7    24.0  31.6   2.13   2.39 9.73e4
 4  1963 1       0       1     0       7.06e7    50.3  27.2   2.43   2.74 1.01e5
 5  1964 1       0       1     0       7.50e7    48.6  31.1   2.35   2.65 1.02e5
 6  1965 1       0       1     0       7.44e7    47.5  47.8   2.29   2.59 1.05e5
 7  1966 1       0       1     0       8.14e7    46.2  29.7   2.31   2.52 1.26e5
 8  1967 1       0       1     0       8.03e7    87.9  49.4   2.88   3.27 1.29e5
 9  1968 1       0       1     0       8.72e7    84.1  26.9   3.45   3.91 1.32e5
10  1969 1       0       1     0       1.03e8    79.0  31.7   3.28   3.67 1.32e5
# … with 1,186 more rows, 3 more variables: qs_s &lt;dbl&gt;, rs_cst &lt;dbl&gt;,
#   ra_cst_div_qtotal &lt;dbl&gt;, and abbreviated variable names ¹​after_national,
#   ²​national, ³​ads_p4_cst
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">datasummary_skim</span>(newspapers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-frenchnewspaperssummarystatistics" class="anchored">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"><caption>Table 15.1:  Summary statistics for French newspapers dataset (1960-1974) </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Unique (#) </th>
   <th style="text-align:right;"> Missing (%) </th>
   <th style="text-align:right;"> Mean </th>
   <th style="text-align:right;"> SD </th>
   <th style="text-align:right;"> Min </th>
   <th style="text-align:right;"> Median </th>
   <th style="text-align:right;"> Max </th>
   <th style="text-align:right;">    </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> year </td>
   <td style="text-align:right;"> 15 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1967.0 </td>
   <td style="text-align:right;"> 4.3 </td>
   <td style="text-align:right;"> 1960.0 </td>
   <td style="text-align:right;"> 1967.0 </td>
   <td style="text-align:right;"> 1974.0 </td>
   <td style="text-align:right;">  <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.78" y="3.22" width="3.17" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="4.95" y="7.44" width="3.17" height="4.22" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="8.13" y="7.44" width="3.17" height="4.22" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="11.30" y="7.39" width="3.17" height="4.28" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="14.48" y="7.39" width="3.17" height="4.28" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="17.65" y="7.39" width="3.17" height="4.28" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="20.83" y="7.39" width="3.17" height="4.28" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.00" y="7.39" width="3.17" height="4.28" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="27.17" y="7.39" width="3.17" height="4.28" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="30.35" y="7.39" width="3.17" height="4.28" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="33.52" y="7.39" width="3.17" height="4.28" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="36.70" y="7.39" width="3.17" height="4.28" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="39.87" y="7.39" width="3.17" height="4.28" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="43.05" y="7.39" width="3.17" height="4.28" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg>
</td>
  </tr>
  <tr>
   <td style="text-align:left;"> ra_cst </td>
   <td style="text-align:right;"> 1053 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 91531796.9 </td>
   <td style="text-align:right;"> 137207312.4 </td>
   <td style="text-align:right;"> 549717.2 </td>
   <td style="text-align:right;"> 35994710.0 </td>
   <td style="text-align:right;"> 864369088.0 </td>
   <td style="text-align:right;">  <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.75" y="3.22" width="5.15" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.89" y="9.89" width="5.15" height="1.77" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="12.04" y="10.76" width="5.15" height="0.91" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="17.18" y="11.38" width="5.15" height="0.28" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="22.33" y="11.61" width="5.15" height="0.056" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="27.48" y="11.61" width="5.15" height="0.056" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.62" y="11.58" width="5.15" height="0.078" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="37.77" y="11.57" width="5.15" height="0.090" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="42.91" y="11.56" width="5.15" height="0.10" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg>
</td>
  </tr>
  <tr>
   <td style="text-align:left;"> ads_p4_cst </td>
   <td style="text-align:right;"> 558 </td>
   <td style="text-align:right;"> 32 </td>
   <td style="text-align:right;"> 86.4 </td>
   <td style="text-align:right;"> 75.3 </td>
   <td style="text-align:right;"> 3.8 </td>
   <td style="text-align:right;"> 69.0 </td>
   <td style="text-align:right;"> 327.2 </td>
   <td style="text-align:right;">  <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.26" y="3.22" width="6.87" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="8.13" y="7.36" width="6.87" height="4.31" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="15.00" y="8.67" width="6.87" height="2.99" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="21.87" y="10.16" width="6.87" height="1.51" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.74" y="10.59" width="6.87" height="1.08" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="35.61" y="10.94" width="6.87" height="0.72" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="42.48" y="11.35" width="6.87" height="0.31" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg>
</td>
  </tr>
  <tr>
   <td style="text-align:left;"> ads_s </td>
   <td style="text-align:right;"> 988 </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 18.7 </td>
   <td style="text-align:right;"> 9.7 </td>
   <td style="text-align:right;"> 1.6 </td>
   <td style="text-align:right;"> 16.9 </td>
   <td style="text-align:right;"> 59.6 </td>
   <td style="text-align:right;">  <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="0.53" y="10.81" width="3.84" height="0.85" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="4.37" y="6.85" width="3.84" height="4.81" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="8.20" y="3.22" width="3.84" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="12.04" y="4.33" width="3.84" height="7.33" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="15.88" y="5.08" width="3.84" height="6.58" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.71" y="9.44" width="3.84" height="2.23" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="23.55" y="9.89" width="3.84" height="1.77" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="27.38" y="11.04" width="3.84" height="0.62" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="31.22" y="11.14" width="3.84" height="0.52" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="35.06" y="10.97" width="3.84" height="0.69" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="38.89" y="11.37" width="3.84" height="0.29" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="42.73" y="11.56" width="3.84" height="0.098" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg>
</td>
  </tr>
  <tr>
   <td style="text-align:left;"> ps_cst </td>
   <td style="text-align:right;"> 665 </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 2.8 </td>
   <td style="text-align:right;"> 0.7 </td>
   <td style="text-align:right;"> 0.7 </td>
   <td style="text-align:right;"> 2.8 </td>
   <td style="text-align:right;"> 5.6 </td>
   <td style="text-align:right;">  <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="0.15" y="11.36" width="4.49" height="0.30" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="4.64" y="11.10" width="4.49" height="0.57" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="9.13" y="10.94" width="4.49" height="0.72" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="13.62" y="3.22" width="4.49" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="18.11" y="7.85" width="4.49" height="3.81" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="22.60" y="6.44" width="4.49" height="5.22" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="27.09" y="8.90" width="4.49" height="2.76" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="31.58" y="11.01" width="4.49" height="0.65" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="36.07" y="11.55" width="4.49" height="0.11" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="40.56" y="11.55" width="4.49" height="0.11" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="45.05" y="11.64" width="4.49" height="0.022" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg>
</td>
  </tr>
  <tr>
   <td style="text-align:left;"> po_cst </td>
   <td style="text-align:right;"> 146 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 3.2 </td>
   <td style="text-align:right;"> 0.9 </td>
   <td style="text-align:right;"> 0.8 </td>
   <td style="text-align:right;"> 3.3 </td>
   <td style="text-align:right;"> 9.3 </td>
   <td style="text-align:right;">  <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="-2.49" y="11.55" width="5.21" height="0.11" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="2.73" y="11.14" width="5.21" height="0.52" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="7.94" y="3.22" width="5.21" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="13.15" y="3.91" width="5.21" height="7.76" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="18.36" y="9.08" width="5.21" height="2.59" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="23.58" y="11.46" width="5.21" height="0.20" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.79" y="11.61" width="5.21" height="0.056" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="34.00" y="11.63" width="5.21" height="0.037" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="39.21" y="11.64" width="5.21" height="0.019" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="44.42" y="11.63" width="5.21" height="0.037" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg>
</td>
  </tr>
  <tr>
   <td style="text-align:left;"> qtotal </td>
   <td style="text-align:right;"> 1052 </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 130817.5 </td>
   <td style="text-align:right;"> 172954.3 </td>
   <td style="text-align:right;"> 1480.0 </td>
   <td style="text-align:right;"> 56775.2 </td>
   <td style="text-align:right;"> 1143676.0 </td>
   <td style="text-align:right;">  <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.72" y="3.22" width="3.89" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="5.61" y="9.63" width="3.89" height="2.03" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="9.50" y="10.53" width="3.89" height="1.13" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="13.39" y="10.82" width="3.89" height="0.84" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="17.28" y="11.40" width="3.89" height="0.26" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="21.18" y="11.60" width="3.89" height="0.062" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="25.07" y="11.54" width="3.89" height="0.12" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.96" y="11.43" width="3.89" height="0.24" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.85" y="11.63" width="3.89" height="0.037" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="36.74" y="11.65" width="3.89" height="0.012" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="40.63" y="11.59" width="3.89" height="0.074" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="44.52" y="11.65" width="3.89" height="0.012" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg>
</td>
  </tr>
  <tr>
   <td style="text-align:left;"> qs_s </td>
   <td style="text-align:right;"> 914 </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 27.2 </td>
   <td style="text-align:right;"> 22.7 </td>
   <td style="text-align:right;"> 0.7 </td>
   <td style="text-align:right;"> 22.5 </td>
   <td style="text-align:right;"> 100.1 </td>
   <td style="text-align:right;">  <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.47" y="3.22" width="4.47" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="5.94" y="6.42" width="4.47" height="5.24" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="10.41" y="5.36" width="4.47" height="6.30" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="14.88" y="8.20" width="4.47" height="3.46" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.35" y="9.11" width="4.47" height="2.55" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="23.82" y="9.46" width="4.47" height="2.20" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.29" y="11.20" width="4.47" height="0.46" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="32.76" y="11.29" width="4.47" height="0.37" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="37.23" y="10.60" width="4.47" height="1.06" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="41.70" y="11.12" width="4.47" height="0.54" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="46.17" y="11.60" width="4.47" height="0.057" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg>
</td>
  </tr>
  <tr>
   <td style="text-align:left;"> rs_cst </td>
   <td style="text-align:right;"> 1047 </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;"> 97666503.6 </td>
   <td style="text-align:right;"> 125257120.3 </td>
   <td style="text-align:right;"> 255760.1 </td>
   <td style="text-align:right;"> 40736368.0 </td>
   <td style="text-align:right;"> 750715008.0 </td>
   <td style="text-align:right;">  <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="1.76" y="3.22" width="2.96" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="4.72" y="9.75" width="2.96" height="1.92" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="7.68" y="10.29" width="2.96" height="1.38" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="10.65" y="10.49" width="2.96" height="1.17" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="13.61" y="10.83" width="2.96" height="0.83" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="16.57" y="11.27" width="2.96" height="0.40" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="19.53" y="11.30" width="2.96" height="0.37" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="22.49" y="11.38" width="2.96" height="0.28" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="25.45" y="11.56" width="2.96" height="0.10" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="28.41" y="11.65" width="2.96" height="0.015" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="31.37" y="11.60" width="2.96" height="0.059" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="34.34" y="11.47" width="2.96" height="0.19" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="37.30" y="11.56" width="2.96" height="0.10" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="40.26" y="11.62" width="2.96" height="0.044" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="43.22" y="11.66" width="2.96" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="46.18" y="11.65" width="2.96" height="0.015" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg>
</td>
  </tr>
  <tr>
   <td style="text-align:left;"> ra_cst_div_qtotal </td>
   <td style="text-align:right;"> 1049 </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 661.2 </td>
   <td style="text-align:right;"> 352.7 </td>
   <td style="text-align:right;"> 61.3 </td>
   <td style="text-align:right;"> 596.6 </td>
   <td style="text-align:right;"> 3048.4 </td>
   <td style="text-align:right;">  <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" class="svglite" width="48.00pt" height="12.00pt" viewbox="0 0 48.00 12.00"><defs><style type="text/css">
    .svglite line, .svglite polyline, .svglite polygon, .svglite path, .svglite rect, .svglite circle {
      fill: none;
      stroke: #000000;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-miterlimit: 10.00;
    }
    .svglite text {
      white-space: pre;
    }
  </style></defs><rect width="100%" height="100%" style="stroke: none; fill: none;"></rect><defs><clippath id="cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw"><rect x="0.00" y="0.00" width="48.00" height="12.00"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwwLjAwfDEyLjAw)">
</g><defs><clippath id="cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw"><rect x="0.00" y="2.88" width="48.00" height="9.12"></rect></clippath></defs><g clip-path="url(#cpMC4wMHw0OC4wMHwyLjg4fDEyLjAw)"><rect x="0.87" y="10.99" width="2.98" height="0.67" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="3.84" y="8.03" width="2.98" height="3.63" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="6.82" y="3.22" width="2.98" height="8.44" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="9.79" y="4.83" width="2.98" height="6.83" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="12.77" y="8.63" width="2.98" height="3.03" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="15.74" y="10.44" width="2.98" height="1.23" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="18.72" y="11.35" width="2.98" height="0.31" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="21.70" y="11.42" width="2.98" height="0.24" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="24.67" y="11.54" width="2.98" height="0.12" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="27.65" y="11.30" width="2.98" height="0.36" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="30.62" y="11.45" width="2.98" height="0.22" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="33.60" y="11.61" width="2.98" height="0.048" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="36.57" y="11.64" width="2.98" height="0.024" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="39.55" y="11.66" width="2.98" height="0.00" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="42.53" y="11.64" width="2.98" height="0.024" style="stroke-width: 0.38; fill: #000000;"></rect><rect x="45.50" y="11.64" width="2.98" height="0.024" style="stroke-width: 0.38; fill: #000000;"></rect></g></svg>
</td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We are interested in what happened from 1967 onward, especially in terms of advertising revenue, and whether that was different for national, compared with local newspapers (<a href="#fig-frenchnewspapersrevenue">Figure&nbsp;<span>15.9</span></a>). We use <code>scales</code> to adjust the y axis <span class="citation" data-cites="scales">(<a href="99-references.html#ref-scales" role="doc-biblioref">Wickham and Seidel 2020</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>newspapers <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">if_else</span>(local <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Local"</span>, <span class="st">"National"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> ra_cst)) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>(<span class="at">prefix =</span> <span class="st">"$"</span>, <span class="at">suffix =</span> <span class="st">"M"</span>, <span class="at">scale =</span> <span class="fl">0.000001</span>)) <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Advertising revenue"</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vars</span>(type),</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">1966.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-frenchnewspapersrevenue" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="15-causality_from_obs_files/figure-html/fig-frenchnewspapersrevenue-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 15.9: Revenue of French newspapers (1960-1974), by whether they were local or national</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The model that we are interested in estimating is:</p>
<p><span class="math display">\[\mbox{ln}(y_{n,t}) = \beta_0 + \beta_1(\mbox{National binary}\times\mbox{1967 onward binary}) + \lambda_n + \gamma_y + \epsilon.\]</span></p>
<p>It is the <span class="math inline">\(\beta_1\)</span> coefficient that we are especially interested in. We use <span class="math inline">\(\lambda_n\)</span> as fixed effect for each newspaper, and the <span class="math inline">\(\gamma_y\)</span> as a fixed effect for each year. We estimate the models using <code>lm()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Advertising side</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>ad_revenue <span class="ot">&lt;-</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">log</span>(ra_cst) <span class="sc">~</span> after_national <span class="sc">+</span> id_news <span class="sc">+</span> year, <span class="at">data =</span> newspapers)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>ad_revenue_div_circulation <span class="ot">&lt;-</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">log</span>(ra_cst_div_qtotal) <span class="sc">~</span> after_national <span class="sc">+</span> id_news <span class="sc">+</span> year, <span class="at">data =</span> newspapers)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>ad_price <span class="ot">&lt;-</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">log</span>(ads_p4_cst) <span class="sc">~</span> after_national <span class="sc">+</span> id_news <span class="sc">+</span> year, <span class="at">data =</span> newspapers)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>ad_space <span class="ot">&lt;-</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">log</span>(ads_s) <span class="sc">~</span> after_national <span class="sc">+</span> id_news <span class="sc">+</span> year, <span class="at">data =</span> newspapers)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Consumer side</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>subscription_price <span class="ot">&lt;-</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">log</span>(ps_cst) <span class="sc">~</span> after_national <span class="sc">+</span> id_news <span class="sc">+</span> year, <span class="at">data =</span> newspapers)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>unit_price <span class="ot">&lt;-</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">log</span>(po_cst) <span class="sc">~</span> after_national <span class="sc">+</span> id_news <span class="sc">+</span> year, <span class="at">data =</span> newspapers)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>circulation <span class="ot">&lt;-</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">log</span>(qtotal) <span class="sc">~</span> after_national <span class="sc">+</span> id_news <span class="sc">+</span> year, <span class="at">data =</span> newspapers)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>share_of_sub <span class="ot">&lt;-</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">log</span>(qs_s) <span class="sc">~</span> after_national <span class="sc">+</span> id_news <span class="sc">+</span> year, <span class="at">data =</span> newspapers)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>revenue_from_sales <span class="ot">&lt;-</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="fu">log</span>(rs_cst) <span class="sc">~</span> after_national <span class="sc">+</span> id_news <span class="sc">+</span> year, <span class="at">data =</span> newspapers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looking at the advertising-side variables (<a href="#tbl-frenchnewspapersadvertising">Table&nbsp;<span>15.2</span></a>) we find consistently negative coefficients for everything apart from advertising space.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>selected_variables <span class="ot">&lt;-</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"year"</span> <span class="ot">=</span> <span class="st">"Year"</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"after_national1"</span> <span class="ot">=</span> <span class="st">"Is after advertising change"</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>advertising_models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ad revenue"</span> <span class="ot">=</span> ad_revenue,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ad revenue over circulation"</span> <span class="ot">=</span> ad_revenue_div_circulation,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ad prices"</span> <span class="ot">=</span> ad_price,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ad space"</span> <span class="ot">=</span> ad_space</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  advertising_models,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> selected_variables</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-frenchnewspapersadvertising" class="anchored">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"><caption>Table 15.2:  Effect of changed television advertising laws on revenue of French newspapers (1960-1974) </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Ad revenue </th>
   <th style="text-align:center;"> Ad revenue over circulation </th>
   <th style="text-align:center;"> Ad prices </th>
   <th style="text-align:center;"> Ad space </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Year </td>
   <td style="text-align:center;"> 0.05 </td>
   <td style="text-align:center;"> 0.04 </td>
   <td style="text-align:center;"> 0.04 </td>
   <td style="text-align:center;"> 0.02 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.00) </td>
   <td style="text-align:center;"> (0.00) </td>
   <td style="text-align:center;"> (0.00) </td>
   <td style="text-align:center;"> (0.00) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Is after advertising change </td>
   <td style="text-align:center;"> −0.23 </td>
   <td style="text-align:center;"> −0.15 </td>
   <td style="text-align:center;"> −0.31 </td>
   <td style="text-align:center;"> 0.01 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.03) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.03) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.07) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.05) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 1052 </td>
   <td style="text-align:center;"> 1048 </td>
   <td style="text-align:center;"> 809 </td>
   <td style="text-align:center;"> 1046 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:center;"> 0.985 </td>
   <td style="text-align:center;"> 0.903 </td>
   <td style="text-align:center;"> 0.892 </td>
   <td style="text-align:center;"> 0.720 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 Adj. </td>
   <td style="text-align:center;"> 0.984 </td>
   <td style="text-align:center;"> 0.895 </td>
   <td style="text-align:center;"> 0.882 </td>
   <td style="text-align:center;"> 0.699 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 36167.6 </td>
   <td style="text-align:center;"> 12622.4 </td>
   <td style="text-align:center;"> 7189.7 </td>
   <td style="text-align:center;"> 6321.2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 36574.2 </td>
   <td style="text-align:center;"> 13028.7 </td>
   <td style="text-align:center;"> 7541.9 </td>
   <td style="text-align:center;"> 6692.6 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> 345.341 </td>
   <td style="text-align:center;"> 449.524 </td>
   <td style="text-align:center;"> −277.714 </td>
   <td style="text-align:center;"> −164.012 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> F </td>
   <td style="text-align:center;"> 814.664 </td>
   <td style="text-align:center;"> 112.259 </td>
   <td style="text-align:center;"> 83.464 </td>
   <td style="text-align:center;"> 34.285 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 0.17 </td>
   <td style="text-align:center;"> 0.16 </td>
   <td style="text-align:center;"> 0.34 </td>
   <td style="text-align:center;"> 0.28 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>And looking at the advertising-side variables (<a href="#tbl-frenchnewspapersconsumers">Table&nbsp;<span>15.3</span></a>) we again, find consistently negative coefficients for everything apart from the share of subscriptions and unit price.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>consumer_models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Subscription price"</span> <span class="ot">=</span> subscription_price,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Circulation"</span> <span class="ot">=</span> circulation,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Share of subscriptions"</span> <span class="ot">=</span> share_of_sub,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Revenue from sales"</span> <span class="ot">=</span> revenue_from_sales,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Unit price"</span> <span class="ot">=</span> unit_price</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  consumer_models,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">coef_map =</span> selected_variables</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-frenchnewspapersconsumers" class="anchored">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"><caption>Table 15.3:  Effect of changed television advertising laws on consumers of French newspapers (1960-1974) </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Subscription price </th>
   <th style="text-align:center;"> Circulation </th>
   <th style="text-align:center;"> Share of subscriptions </th>
   <th style="text-align:center;"> Revenue from sales </th>
   <th style="text-align:center;"> Unit price </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Year </td>
   <td style="text-align:center;"> 0.05 </td>
   <td style="text-align:center;"> 0.01 </td>
   <td style="text-align:center;"> −0.01 </td>
   <td style="text-align:center;"> 0.05 </td>
   <td style="text-align:center;"> 0.05 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.00) </td>
   <td style="text-align:center;"> (0.00) </td>
   <td style="text-align:center;"> (0.00) </td>
   <td style="text-align:center;"> (0.00) </td>
   <td style="text-align:center;"> (0.00) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Is after advertising change </td>
   <td style="text-align:center;"> −0.04 </td>
   <td style="text-align:center;"> −0.06 </td>
   <td style="text-align:center;"> 0.19 </td>
   <td style="text-align:center;"> −0.06 </td>
   <td style="text-align:center;"> 0.06 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.02) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.02) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.03) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.03) </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.02) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 1044 </td>
   <td style="text-align:center;"> 1070 </td>
   <td style="text-align:center;"> 1072 </td>
   <td style="text-align:center;"> 1046 </td>
   <td style="text-align:center;"> 1063 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:center;"> 0.876 </td>
   <td style="text-align:center;"> 0.991 </td>
   <td style="text-align:center;"> 0.972 </td>
   <td style="text-align:center;"> 0.988 </td>
   <td style="text-align:center;"> 0.867 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 Adj. </td>
   <td style="text-align:center;"> 0.865 </td>
   <td style="text-align:center;"> 0.990 </td>
   <td style="text-align:center;"> 0.970 </td>
   <td style="text-align:center;"> 0.987 </td>
   <td style="text-align:center;"> 0.856 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 448.8 </td>
   <td style="text-align:center;"> 22306.7 </td>
   <td style="text-align:center;"> 5661.4 </td>
   <td style="text-align:center;"> 36036.0 </td>
   <td style="text-align:center;"> 764.9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 854.8 </td>
   <td style="text-align:center;"> 22714.6 </td>
   <td style="text-align:center;"> 6074.5 </td>
   <td style="text-align:center;"> 36442.2 </td>
   <td style="text-align:center;"> 1172.3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> 882.140 </td>
   <td style="text-align:center;"> 759.573 </td>
   <td style="text-align:center;"> 321.907 </td>
   <td style="text-align:center;"> 451.112 </td>
   <td style="text-align:center;"> 907.285 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> F </td>
   <td style="text-align:center;"> 84.659 </td>
   <td style="text-align:center;"> 1392.863 </td>
   <td style="text-align:center;"> 421.297 </td>
   <td style="text-align:center;"> 1030.303 </td>
   <td style="text-align:center;"> 79.888 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 0.10 </td>
   <td style="text-align:center;"> 0.12 </td>
   <td style="text-align:center;"> 0.18 </td>
   <td style="text-align:center;"> 0.16 </td>
   <td style="text-align:center;"> 0.10 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In general, we are able to replicate the main results of <span class="citation" data-cites="angelucci2019newspapers">Angelucci and Cagé (<a href="99-references.html#ref-angelucci2019newspapers" role="doc-biblioref">2019</a>)</span> and find that in many cases there appears to be a difference from 1967 onward. Our results are similar to <span class="citation" data-cites="angelucci2019newspapers">Angelucci and Cagé (<a href="99-references.html#ref-angelucci2019newspapers" role="doc-biblioref">2019</a>)</span>.</p>
<!-- - Parallel trends: Notice the wonderful way in which they test the 'parallel trends' assumption on pp. 350-351. -->
<!-- - Discussion: Look at their wonderful discussion (pp. 353-358) of interpretation, external validity, and robustness. -->
<!-- ## Case study - Lalonde -->
<!-- <!-- Need to add the student who identified this. -->
<!-- http://sekhon.berkeley.edu/matching/lalonde.html -->
<!-- ## Case study: Funding of Clinical Trials and Reported Drug Efficacy -->
<!-- @oostrom2021 looks at clinical trials of drugs. These days, of course, we all know a lot more than we may have ever wished to, about clinical trials. But the one thing that we (think) we know is that they are, well, clinical. By that I mean, that it doesn't matter who does the actual trial, the outcome would be the same. @oostrom2021 says this isn't true. -->
<!-- By way of background, clinical trials are needed before a drug can be approved. @oostrom2021 finds that when pharmaceutical firms sponsor a clinical trial, 'a drug appears 0.15 standard deviations more effective when the trial is sponsored by that drug's manufacturer, compared with the same drug in the same trial without the drug manufacturer's involvement.' She does this by exploiting the fact that often 'the exact same sets of drugs are often compared in different randomized control trials conducted by parties with different financial interests.'. -->
<!-- The main finding is [@oostrom2021, p. 2]:  -->
<!-- > Utilizing dozens of drug combinations across hundreds of clinical trials, I estimate that a drug appears 36 percent more effective (0.15 standard deviations off of a base of 0.42) when the trial is sponsored by that drug's manufacturing or marketing firm, compared with the same drug, evaluated against the same comparators, but without the drug manufacturer's involvement. As in the medical literature, I measure efficacy, in the case of antidepressants, as the share of patients that respond to medication or, in the case of schizophrenia, as the average decline in symptoms. -->
<!-- Why might this happen? @oostrom2021 looks at a variety of different options, grouped into those that happen before the trial and those that happen after the trial 'publication bias'. She finds that 'publication bias can explain as much as half of  this sponsorship effect. Incorporating data on unpublished clinical trials, I find sponsored trials are less likely to publish non-positive results for their drugs.' -->
<!-- @oostrom2021 focuses on antidepressant and antipsychotic drugs and this allows her to obtain a dataset of trials. An 'arm' of a trial refers to 'the unit at which randomization occurs. Arms are often unique drugs but occasionally refer to unique drug and dosage combinations.' [@oostrom2021 p. 9]. -->

<!-- Summary statistics are provided in a summary table (@fig-oostromsummary)) (this approach is common in economics, but not a great idea because it hides the distribution of the data - better to plot the raw data.) -->
<!-- ```{r}fig.cap="Summary statistics from Ooostrom", out-width: '100%'} -->
<!-- #| echo: false -->
<!-- #| label: oostromsummary -->
<!-- ![](figures/oostrom_1.png")) --{#fig- width=95% fig-align="center"}

<!-- The model is: -->
<!-- $$y_{ij} = \alpha + \beta \mbox{ Sponsor}_{ij} + X_{ij}\gamma + G_{d(i),s(j)} +\epsilon_{ij}$$ -->
<!-- where $y_{ij}$ is the efficacy for arm $i$ in trial $j$. The main coefficient of interest is $\beta$ which is based on whether $\mbox{Sponsor}_{ij}$. The outcome is relative to the placebo arm in that trial, or the least effective arm. -->

<!-- 'Table 3.3' from the paper is actually the reason that I included this as a case student. If this sounds odd to you then you've not had to read millions of papers that are unclear about their results. 'Table 3.3' (republished here as @fig-oostromtable)) is beautiful and I'll allow it to speak for itself. -->
<!-- ```{r}fig.cap="Results", out-width: '100%'} -->
<!-- ![](figures/oostrom_2.png")) --{#fig- width=95% fig-align="center"}


<!-- The paper is available here: https://www.tamaroostrom.com/research and I'd recommend a brief read. -->
</section>
</section>
<section id="propensity-score-matching" class="level2" data-number="15.5">
<h2 data-number="15.5" class="anchored" data-anchor-id="propensity-score-matching"><span class="header-section-number">15.5</span> Propensity score matching</h2>
<p>Difference in differences is a powerful analysis framework. But it can be tough to identify appropriate treatment and control groups. <span class="citation" data-cites="alexander2018age">Alexander and Ward (<a href="99-references.html#ref-alexander2018age" role="doc-biblioref">2018</a>)</span> compare migrant brothers, where one brother had most of their education in a different country, and the other brother had most of their education in the US. Given the data that are available, this match provides a reasonable treatment and control group. But other matches could have given different results, for instance friends or cousins.</p>
<p>We can match based on observable variables. For instance, age-group or education. At two different times we compare smoking rates in 18-year-olds in one city with smoking rates in 18-year-olds in another city. This would be a coarse match because we know that there are many differences between 18-year-olds, even in terms of the variables that we commonly observe, say gender and education. One way to deal with this would be to create sub-groups: 18-year-old males with a high school education, etc. But then the sample sizes quickly become small. We also have the issue of how to deal with continuous variables. And, are an 18-year-old and a 19-year-old really so different? Why not also compare with them?</p>
<p>One way to proceed is to consider a nearest neighbor approach. But there can be limited concern for uncertainty with this approach. There can also be an issue with having many variables because we end up with a high-dimension graph. This leads to propensity score matching. Here we will explain the process of propensity score matching, but it is not something that should be widely used <span class="citation" data-cites="king2019propensity">(<a href="99-references.html#ref-king2019propensity" role="doc-biblioref">King and Nielsen 2019</a>)</span>, and we will then go through why that is the case.</p>
<p>Propensity score matching involves assigning some probability to each observation. We construct that probability based on the observation’s values for the independent variables, at their values before the treatment. That probability is our best guess at the probability of the observation being treated, regardless of whether it was treated or not. For instance, if 18-year-old males were treated but 19-year-old males were not, then as there is not much difference between 18-year-old males and 19-year-old males our assigned probability would be similar. We can then compare the outcomes of observations with similar propensity scores.</p>
<p>One advantage of propensity score matching is that is allows us to easily consider many independent variables at once, and it can be constructed using logistic regression.</p>
<p>To be more specific we can simulate some data. We will pretend that we work for a large online retailer. We are going to treat some individuals with free shipping to see what happens to their average purchase.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>purchase_data <span class="ot">&lt;-</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_person_id =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>sample_size),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">runif</span>(</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">n =</span> sample_size,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">min =</span> <span class="dv">18</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">max =</span> <span class="dv">100</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">city =</span> <span class="fu">sample</span>(</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">c</span>(<span class="st">"Toronto"</span>, <span class="st">"Montreal"</span>, <span class="st">"Calgary"</span>),</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> sample_size,</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender =</span> <span class="fu">sample</span>(</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>, <span class="st">"Other/decline"</span>),</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> sample_size,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.49</span>, <span class="fl">0.47</span>, <span class="fl">0.02</span>)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">income =</span> <span class="fu">rlnorm</span>(</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">n =</span> sample_size,</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">meanlog =</span> <span class="fl">0.5</span>,</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">sdlog =</span> <span class="dv">1</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we need to add some probability of being treated with free shipping. We will say that it depends on our variables and that younger, higher-income, male and Toronto-based individuals make this treatment slightly more likely.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>purchase_data <span class="ot">&lt;-</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  purchase_data <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_num =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;</span> <span class="dv">50</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">city_num =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>      city <span class="sc">==</span> <span class="st">"Toronto"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>      city <span class="sc">==</span> <span class="st">"Montreal"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>      city <span class="sc">==</span> <span class="st">"Calgary"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender_num =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>      gender <span class="sc">==</span> <span class="st">"Male"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>      gender <span class="sc">==</span> <span class="st">"Female"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>      gender <span class="sc">==</span> <span class="st">"Other/decline"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">income_num =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>      income <span class="sc">&gt;</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>      income <span class="sc">&gt;</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>      income <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_num =</span> <span class="fu">sum</span>(age_num, city_num, gender_num, income_num),</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">softmax_prob =</span> <span class="fu">exp</span>(sum_num) <span class="sc">/</span> <span class="fu">exp</span>(<span class="dv">12</span>),</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">free_shipping =</span> <span class="fu">sample</span>(</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>),</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">prob =</span> <span class="fu">c</span>(<span class="dv">1</span> <span class="sc">-</span> softmax_prob, softmax_prob)</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>purchase_data <span class="ot">&lt;-</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>  purchase_data <span class="sc">|&gt;</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>age_num, <span class="sc">-</span>city_num, <span class="sc">-</span>gender_num, <span class="sc">-</span>income_num, <span class="sc">-</span>sum_num, <span class="sc">-</span>softmax_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we need to have some measure of a person’s average spend. We want those with free shipping to be slightly higher than those without.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>purchase_data <span class="ot">&lt;-</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  purchase_data <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_spend =</span> <span class="fu">if_else</span>(free_shipping <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">60</span>, <span class="dv">50</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">average_spend =</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, mean_spend, <span class="at">sd =</span> <span class="dv">5</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>mean_spend) <span class="sc">|&gt;</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(city, gender, free_shipping), as.factor))</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>purchase_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 7
   unique_person_id   age city     gender income free_shipping average_spend
              &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;   &lt;dbl&gt; &lt;fct&gt;                 &lt;dbl&gt;
 1                1  47.5 Calgary  Female  1.72  0                      41.1
 2                2  27.8 Montreal Male    1.54  0                      55.7
 3                3  57.7 Toronto  Female  3.16  0                      56.5
 4                4  43.9 Toronto  Male    0.636 0                      50.5
 5                5  21.1 Toronto  Female  1.43  0                      44.7
 6                6  51.1 Calgary  Male    1.18  0                      48.8
 7                7  28.7 Toronto  Female  1.49  0                      52.8
 8                8  37.9 Toronto  Female  0.414 0                      52.4
 9                9  31.0 Calgary  Male    0.384 0                      47.6
10               10  33.5 Montreal Female  1.11  0                      49.2
# … with 9,990 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p>We use <code>matchit()</code> from <code>MatchIt</code> <span class="citation" data-cites="MatchIt">(<a href="99-references.html#ref-MatchIt" role="doc-biblioref">Ho et al. 2011</a>)</span> to implement logistic regression and create matched groups. We then use <code>match.data()</code> to get the data of matches containing both all 371 people who were actually treated with free shipping and the untreated person who is considered as similar to them, based on propensity score, as possible. The result is a dataset of 742 observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MatchIt)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>matched_groups <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  free_shipping <span class="sc">~</span> age <span class="sc">+</span> city <span class="sc">+</span> gender <span class="sc">+</span> income,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> purchase_data,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"nearest"</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance =</span> <span class="st">"glm"</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>matched_groups</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A matchit object
 - method: 1:1 nearest neighbor matching without replacement
 - distance: Propensity score
             - estimated with logistic regression
 - number of obs.: 10000 (original), 742 (matched)
 - target estimand: ATT
 - covariates: age, city, gender, income</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>matched_dataset <span class="ot">&lt;-</span> <span class="fu">match.data</span>(matched_groups)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>matched_dataset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 742 × 10
   unique_pe…¹   age city  gender income free_…² avera…³ dista…⁴ weights subcl…⁵
         &lt;int&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;   &lt;dbl&gt; &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;  
 1           5  21.1 Toro… Female  1.43  0          44.7  0.141        1 278    
 2          20  30.0 Mont… Male    8.65  0          49.0  0.129        1 162    
 3          22  22.8 Toro… Male    0.898 0          50.1  0.282        1 334    
 4          38  41.3 Toro… Female  6.01  1          61.5  0.0779       1 120    
 5          43  24.7 Toro… Male    1.59  1          59.6  0.274        1 142    
 6          76  56.4 Toro… Male   15.0   0          51.8  0.199        1 290    
 7         102  48.1 Toro… Male    3.48  1          59.8  0.111        1 1      
 8         105  76.7 Toro… Male    2.84  0          45.1  0.0231       1 200    
 9         118  26.7 Toro… Female  0.315 0          56.4  0.0971       1 98     
10         143  36.3 Toro… Male   10.6   0          49.4  0.331        1 286    
# … with 732 more rows, and abbreviated variable names ¹​unique_person_id,
#   ²​free_shipping, ³​average_spend, ⁴​distance, ⁵​subclass
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p>Finally, we can estimate the effect of being treated on average spend using linear regression. We are particularly interested in the coefficient associated with the treatment variable, in this case free shipping.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>propensity_score_regression <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  average_spend <span class="sc">~</span> age <span class="sc">+</span> city <span class="sc">+</span> gender <span class="sc">+</span> income <span class="sc">+</span> free_shipping,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> matched_dataset</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>propensity_score_regression</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = average_spend ~ age + city + gender + income + free_shipping, 
    data = matched_dataset)

Coefficients:
        (Intercept)                  age         cityMontreal  
           49.56747              0.00735              0.12787  
        cityToronto           genderMale  genderOther/decline  
            0.58628             -1.09978             -1.99861  
             income       free_shipping1  
            0.01903             10.60550  </code></pre>
</div>
</div>
<p>We cover propensity score matching because it is widely used. But there are many issues with propensity score matching that mean that propensity scores should not be used for matching <span class="citation" data-cites="king2019propensity">(<a href="99-references.html#ref-king2019propensity" role="doc-biblioref">King and Nielsen 2019</a>)</span>. These include:</p>
<ol type="1">
<li>Matching. Propensity score matching cannot match on unobserved variables. This may be fine in a classroom setting, but in more realistic settings it will likely cause issues.</li>
<li>Modelling. The results tend to be specific to the model that is used.</li>
<li>Statistically. We are using the data twice.</li>
</ol>
</section>
<section id="regression-discontinuity-design" class="level2" data-number="15.6">
<h2 data-number="15.6" class="anchored" data-anchor-id="regression-discontinuity-design"><span class="header-section-number">15.6</span> Regression discontinuity design</h2>
<section id="overview-1" class="level3" data-number="15.6.1">
<h3 data-number="15.6.1" class="anchored" data-anchor-id="overview-1"><span class="header-section-number">15.6.1</span> Overview</h3>
<p>Regression discontinuity design (RDD) was established by <span class="citation" data-cites="thistlethwaite1960regression">Thistlethwaite and Campbell (<a href="99-references.html#ref-thistlethwaite1960regression" role="doc-biblioref">1960</a>)</span> and is a popular way to get causality when there is a continuous variable with cut-offs that determine treatment. Is there a difference between a student who gets 79 per cent and a student who gets 80 per cent? Probably not much, but one may get an A-, while the other may get a B+, and seeing that on a transcript could affect who gets a job which could affect income. In this case the percentage is a ‘forcing variable’ and the cut-off for an A- is a ‘threshold’. As the treatment is determined by the forcing variable we need to control for that variable. And, these seemingly arbitrary cut-offs can be seen all the time. Hence, there has been a great deal of work using RDD.</p>
<p>There is sometimes slightly different terminology used when it comes to RDD. For instance, <span class="citation" data-cites="Cunningham2021">Cunningham (<a href="99-references.html#ref-Cunningham2021" role="doc-biblioref">2021</a>)</span> refers to the forcing function as a running variable. The exact terminology that is used does not matter provided we use it consistently.</p>
</section>
<section id="simulated-example-1" class="level3" data-number="15.6.2">
<h3 data-number="15.6.2" class="anchored" data-anchor-id="simulated-example-1"><span class="header-section-number">15.6.2</span> Simulated example</h3>
<p>To be more specific about the situation, we simulate data. We will consider the relationship between income and grades, and simulate there to be a change if a student gets at least 80 (<a href="#fig-rddmarks">Figure&nbsp;<span>15.10</span></a>).</p>
<div class="cell" data-warnings="false">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>number_of_observation <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>rdd_example_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">person =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>number_of_observation),</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">mark =</span> <span class="fu">runif</span>(number_of_observation, <span class="at">min =</span> <span class="dv">78</span>, <span class="at">max =</span> <span class="dv">82</span>),</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">income =</span> <span class="fu">rnorm</span>(number_of_observation, <span class="dv">10</span>, <span class="dv">1</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Make income more likely to be higher if they have a mark at least 80</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>rdd_example_data <span class="ot">&lt;-</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  rdd_example_data <span class="sc">|&gt;</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">noise =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> number_of_observation, <span class="at">mean =</span> <span class="dv">2</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">income =</span> <span class="fu">if_else</span>(mark <span class="sc">&gt;=</span> <span class="dv">80</span>, income <span class="sc">+</span> noise, income)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>rdd_example_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 4
   person  mark income noise
    &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1      1  79.4   9.43 1.87 
 2      2  78.5   9.69 2.26 
 3      3  79.9  10.8  1.14 
 4      4  79.3   9.34 2.50 
 5      5  78.1  10.7  2.21 
 6      6  79.6   9.83 2.47 
 7      7  78.5   8.96 4.22 
 8      8  79.0  10.5  3.11 
 9      9  78.6   9.53 0.671
10     10  78.8  10.6  2.46 
# … with 990 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>rdd_example_data <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> mark,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> income</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> rdd_example_data <span class="sc">|&gt;</span> <span class="fu">filter</span>(mark <span class="sc">&lt;</span> <span class="dv">80</span>),</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="st">"y ~ x"</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> rdd_example_data <span class="sc">|&gt;</span> <span class="fu">filter</span>(mark <span class="sc">&gt;=</span> <span class="dv">80</span>),</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="st">"y ~ x"</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Mark"</span>,</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Income ($)"</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-rddmarks" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="15-causality_from_obs_files/figure-html/fig-rddmarks-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 15.10: Illustration of simulated data that shows an effect on income from getting a mark that is 80, compared with 79</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We can use a binary variable with linear regression to estimate the effect. We expect the coefficient to be around two, which is what we simulated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>rdd_example_data <span class="ot">&lt;-</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  rdd_example_data <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mark_80_and_over =</span> <span class="fu">if_else</span>(mark <span class="sc">&lt;</span> <span class="dv">80</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(income <span class="sc">~</span> mark <span class="sc">+</span> mark_80_and_over, <span class="at">data =</span> rdd_example_data) <span class="sc">|&gt;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = income ~ mark + mark_80_and_over, data = rdd_example_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.3418 -0.8218 -0.0043  0.7740  6.1209 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       5.30130    5.16331   1.027    0.305    
mark              0.06025    0.06535   0.922    0.357    
mark_80_and_over  1.89221    0.14921  12.682   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.189 on 997 degrees of freedom
Multiple R-squared:  0.4178,    Adjusted R-squared:  0.4166 
F-statistic: 357.7 on 2 and 997 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>There are various caveats to this estimate that we will discuss, but the essentials of RDD are here. Given an appropriate set-up, and model, an RDD can compare favorably to randomized trials <span class="citation" data-cites="bloombellreiman2020">(<a href="99-references.html#ref-bloombellreiman2020" role="doc-biblioref">Bloom, Bell, and Reiman 2020</a>)</span>.</p>
<p>We could also implement RDD using <code>rdrobust</code> <span class="citation" data-cites="rdrobust">(<a href="99-references.html#ref-rdrobust" role="doc-biblioref">Calonico et al. 2021</a>)</span>. The advantage of this approach is that many extensions are easily available.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rdrobust)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rdrobust</span>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> rdd_example_data<span class="sc">$</span>income,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> rdd_example_data<span class="sc">$</span>mark,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> <span class="dv">80</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="dv">2</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">all =</span> <span class="cn">TRUE</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sharp RD estimates using local polynomial regression.

Number of Obs.                 1000
BW type                      Manual
Kernel                   Triangular
VCE method                       NN

Number of Obs.                  497          503
Eff. Number of Obs.             497          503
Order est. (p)                    1            1
Order bias  (q)                   2            2
BW est. (h)                   2.000        2.000
BW bias (b)                   2.000        2.000
rho (h/b)                     1.000        1.000
Unique Obs.                     497          503

=============================================================================
        Method     Coef. Std. Err.         z     P&gt;|z|      [ 95% C.I. ]       
=============================================================================
  Conventional     1.913     0.161    11.876     0.000     [1.597 , 2.229]     
Bias-Corrected     1.966     0.161    12.207     0.000     [1.650 , 2.282]     
        Robust     1.966     0.232     8.461     0.000     [1.511 , 2.422]     
=============================================================================</code></pre>
</div>
</div>
</section>
<section id="assumptions-1" class="level3" data-number="15.6.3">
<h3 data-number="15.6.3" class="anchored" data-anchor-id="assumptions-1"><span class="header-section-number">15.6.3</span> Assumptions</h3>
<p>The key assumptions of RDD are <span class="citation" data-cites="Cunningham2021">(<a href="99-references.html#ref-Cunningham2021" role="doc-biblioref">Cunningham 2021, 163</a>)</span>:</p>
<ol type="1">
<li>The cut-off is specific, fixed, and known to all.</li>
<li>The forcing function is continuous.</li>
</ol>
<p>The first assumption is largely about being unable to manipulate the cut-off, and ensures that the cut-off has meaning. The second assumption enables us to be confident that folks on either side of the threshold are similar, apart from just happening to just fall on either side of the threshold.</p>
<p>When we discussed randomized control trials and A/B testing in Chapter @ref(hunt-data) the randomized assignment of the treatment meant that the control and treatment groups were the same, but for the treatment. Then we moved to difference in differences, and we assumed that there was a common trend between the treated and control groups. We allowed that the groups could be different, but that we could ‘difference out’ their differences. Finally, we considered matching, and we said that even if we the control and treatment groups seemed quite different, we were able to match, to some extent, those who were treated with a group that were similar to them in all ways, apart from the fact that they were not treated.</p>
<p>In regression discontinuity we consider a slightly different setting. The two groups are completely different in terms of the forcing variable. They are on either side of the threshold. So there is no overlap at all. But we know the threshold and believe that those on either side are essentially matched. Let us consider the 2019 NBA Eastern Conference Semifinals - Toronto and the Philadelphia. Game 1: Raptors win 108-95; Game 2: 76ers win 94-89; Game 3: 76ers win 116-95; Game 4: Raptors win 101-96; Game 5: Raptors win 125-89; Game 6: 76ers win 112-101; and finally, Game 7: Raptors win 92-90, because of a ball that win in after bouncing on the rim four times. Was there really that much difference between the teams?</p>
<p>The continuity assumption is important, but we cannot test this as it is based on a counterfactual. Instead, we need to convince people of it. Ways to do this include:</p>
<ul>
<li>Using a test/train set-up.</li>
<li>Trying different specifications. We are especially concerned if results do not broadly persist with just linear or quadratic functions.</li>
<li>Considering different subsets of the data.</li>
<li>Considering different windows.</li>
<li>Be clear about uncertainty intervals, especially in graphs.</li>
<li>Discussing and assuage concerns about the possibility of omitted variables.</li>
</ul>
<p>The threshold is also important. For instance, is there an actual shift or is there a non-linear relationship?</p>
<p>There are a variety of weaknesses of RDD including:</p>
<ul>
<li>External validity may be difficult. For instance, when we think about the A-/B+ example, it is hard to see those generalizing to also B-/C+ students.</li>
<li>The important responses are those that are close to the cut-off. This means that even if we have many A and B students, they do not help much. Hence, we need a lot of data or we may have concerns about our ability to support our claims <span class="citation" data-cites="green2009testing">(<a href="99-references.html#ref-green2009testing" role="doc-biblioref">Green et al. 2009</a>)</span>.</li>
<li>As the researcher, we have a lot of freedom to implement different options. This means that open science best practice becomes vital.</li>
</ul>
<p>To this point we have considered ‘sharp’ RDD. That is, the threshold is strict. But, in reality, often the boundary is a little less strict. For instance, consider the drinking age. There is a legal drinking age, say 18. If we looked at the number of people who had drunk, then it is likely to increase in the few years leading up to that age.</p>
<p>In a sharp RDD setting, if we know the value of the forcing function then we know the outcome. For instance, if a student gets a mark of 80 then we know that they got an A-, but if they got a mark of 79 then we know that they got a B+. But with fuzzy RDD it is only known with some probability. We can say that a Canadian 19-year-old is more likely to have drunk alcohol than a Canadian 18-year-old, but the number of Canadian 18-year-olds who have drunk alcohol is not zero.</p>
<p>It may be possible to deal with fuzzy RDD settings with appropriate choice of model or data. It may also be possible to deal with them using instrumental variables.</p>
<p>We want as ‘sharp’ an effect as possible, but if the thresholds are known, then they will be gamed. For instance, there is a lot of evidence that people run for certain marathon times, and we know that people aim for certain grades. Similarly, from the other side, it is a lot easier for an instructor to just give out As than it is to have to justify Bs. One way to look at this is to consider how ‘balanced’ the sample is on either side of the threshold. We can do this using histograms with appropriate bins. For instance, think of the age-heaping that we found in the cleaned Kenyan census data in Chapter @ref(gather-data)</p>
<p>Another key factor for RDD is the possible effect of the decision around the choice of model. To see this, consider the difference between a linear and polynomial.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>some_data <span class="ot">&lt;-</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">running_variable =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"before"</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>some_more_data <span class="ot">&lt;-</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">2</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">running_variable =</span> <span class="fu">c</span>(<span class="dv">101</span><span class="sc">:</span><span class="dv">200</span>),</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">location =</span> <span class="st">"after"</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>both <span class="ot">&lt;-</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(some_data, some_more_data)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>both <span class="sc">|&gt;</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> running_variable, <span class="at">y =</span> outcome, <span class="at">color =</span> location)) <span class="sc">+</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="15-causality_from_obs_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>both <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> running_variable, <span class="at">y =</span> outcome, <span class="at">color =</span> location)) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">3</span>), <span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="15-causality_from_obs_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The result is that our estimate is dependent on the choice of model. We see this issue occur often in RDD <span class="citation" data-cites="gelmanonrdd">(<a href="99-references.html#ref-gelmanonrdd" role="doc-biblioref">Gelman 2019</a>)</span>.</p>
<!-- ### Case study: Voting in Ghent -->
<!-- As with difference in differences, after I learnt about it, I began to see opportunities to implement it everywhere. Frankly, I find it a lot easier to think of legitimate examples of using regression discontinuity than difference in differences. But, at the risk of mentioning yet another movie from the 1990s that none of you have seen, when I think of RDD, my first thought is often of Sliding Doors (@fig-slidingdoors)). -->
<!-- ```{r}fig.cap="Nobody expects the Spanish Inquisition."} -->
<!-- #| echo: false -->
<!-- #| label: slidingdoors -->
<!-- ![](figures/sliding_doors.png")) --{#fig- width=95% fig-align="center"}
# out-width: "90"

<!-- ``` -->
<!-- Source: Mlotek, Haley, 2018, 'The Almosts and What-ifs of 'Sliding Doors'', *The Ringer*, 24 April, freely available at: https://www.theringer.com/movies/2018/4/24/17261506/sliding-doors-20th-anniversary. -->
<!-- Not only did the movie have a great soundtrack and help propel Gwyneth Paltrow to super-stardom, but it features an iconic moment in which Paltrow's character, Helen, arrives at a tube station at which point the movie splits into two. In one version she just makes the train, and arrives home to find her boyfriend cheating on her; and in another she just misses the train and doesn't find out about the boyfriend.  -->
<!-- I'd say, spoiler alert, but the movie was released in 1998, so... Of course, that 'threshold' turns out to be important. In the world in which she gets the train she leaves the boyfriend, cuts her hair, and changes everything about her life. In the world in which she misses the train she doesn't. At least initially. But, and I cannot say this any better than Ashley Fetters: -->
<!-- > At the end of Sliding Doors, the "bad" version of Helen's life elides right into the "good" version; even in the "bad" version, the philandering !@#$%^& boyfriend eventually gets found out and dumped, the true love eventually gets met-cute, and the MVP friend comes through. According to the Sliding Doors philosophy, in other words, even when our lives take fluky, chaotic detours, ultimately good-hearted people find each other, and the bad boyfriends and home-wreckers of the world get their comeuppance. There's no freak turn of events that allows the cheating boyfriend to just keep cheating, or the well-meaning, morally upright soulmates to just keep floating around in the universe unacquainted. -->
<!-- > -->
<!-- > Fetters, Ashley, 2018, 'I Think About This a Lot: The Sliding Doors in Sliding Doors', *The Cut*, 9 April, freely available at: https://www.thecut.com/2018/04/i-think-about-this-a-lot-the-sliding-doors-in-sliding-doors.html. -->
<!-- I'm getting off-track here, but the point is, not only does it seem as though we have a 'threshold', but it seems as though there's continuity! -->
<!-- Paper: Stiers, D., Hooghe, M. and Dassonneville, R., 2020. Voting at 16: Does lowering the voting age lead to more political engagement? Evidence from a quasi-experiment in the city of Ghent (Belgium). Political Science Research and Methods, pp.1-8. Available at: https://www.cambridge.org/core/journals/political-science-research-and-methods/article/voting-at-16-does-lowering-the-voting-age-lead-to-more-political-engagement-evidence-from-a-quasiexperiment-in-the-city-of-ghent-belgium/172A2D9B75ECB66E98C9680787F302AD#fndtn-information -->
<!-- Data: https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/J1FQW9 -->
<!-- ### Case study: Caughey, and Sekhon., 2011 -->
<!-- Paper: Caughey, Devin, and Jasjeet S. Sekhon. "Elections and the regression discontinuity design: Lessons from close US house races, 1942–2008." Political Analysis 19.4 (2011): 385-408. Available at: https://www.cambridge.org/core/journals/political-analysis/article/elections-and-the-regression-discontinuity-design-lessons-from-close-us-house-races-19422008/E5A69927D29BE682E012CAE9BFD8AEB7 -->
<!-- Data: https://dataverse.harvard.edu/dataset.xhtml?persistentId=hdl:1902.1/16357&version=1.0 -->
<!-- Let us see some more legitimate implementations of regression discontinuity. (And thank you to [Ryan Edwards](http://www.ryanbedwards.com/) for pointing me to these.) -->
<!-- #### Elections -->
<!-- Elections are a common area of application for regression discontinuity because if the election is close then arguably there's not much difference between the candidates. There are plenty of examples of regression discontinuity in an elections setting, but one recent one is George, Siddharth Eapen, 2019, 'Like Father, Like Son? The Effect of Political Dynasties on Economic Development', freely available at: https://www.dropbox.com/s/orhvh3n03wd9ybl/sid_JMP_dynasties_latestdraft.pdf?dl=0. -->
<!-- In this paper George is interested in political dynasties. But is the child of a politician more likely to be elected because they are the child of a politician, or because they happen to also be similarly skilled at politics? Regression discontinuity can help because in a close election, we can look at differences between places where someone narrowly won with where a similar someone narrowly lost. -->
<!-- In the George, 2019, case he examines:  -->
<!-- > descendant effects using a close elections regression discontinuity (RD) design. We focus on close races between dynastic descendants (i.e. direct relatives of former officeholders) and non-dynasts, and we compare places where a descendant narrowly won to those where a descendant narrowly lost. In these elections, descendants and non-dynasts have similar demographic and political characteristics, and win in similar places and at similar rates. Nevertheless, we find negative economic effects when a descendant narrowly wins. Villages represented by a descendant have lower asset ownership and public good provision after an electoral term: households are less likely to live in a brick house and to own basic amenities like a refrigerator, mobile phone, or vehicle. Moreover, voters assess descendants to perform worse in office. An additional standard deviation of exposure to descendants lowers a village's wealth rank by 12pp. -->
<!-- The model that George, 2019, estimates is (p. 19: -->
<!-- $$y_i = \alpha_{\mbox{district}} + \beta \times \mbox{Years descendant rule}_i + f(\mbox{Descendant margin}) + \gamma X_i + \epsilon_{i,t}.$$ -->
<!-- In this model, $y_i$ is various development outcomes in village $i$; $\mbox{Years descendant rule}_i$ is the number of years a dynastic descendant has represented village $i$ in the national or state parliament; $\mbox{Descendant margin}$ is the vote share difference between the dynastic descendant and non-dynast; and $\gamma X_i$ is a vector of village-level adjustments. -->
<!-- George, 2019, then conducts a whole bunch of tests of the validity of the regression discontinuity design (p. 19). These are critical in order for the results to be believed. There are a lot of different results but one is shown in @fig-descendantsinindia). -->
<!-- 
#| fig-cap: "George, 2019, descendant effects identified using close elections RD design (p. 41)."} --
#| echo: false
#| label: descendantsinindia
<!-- ![](figures/descendantsinindia.png")) --{#fig- width=95% fig-align="center"}
# out-width: "90"

<!-- ``` -->
<!-- #### Economic development -->
<!-- One of the issues with considering economic development is that a place typically is either subject to some treatment or not. However, sometimes regression discontinuity allows us to compare areas that were just barely treated with those that were just barely not.  -->
<!-- One recent paper that does this Esteban Mendez-Chacon and Diana Van Patten, 2020, 'Multinationals, monopsony and local development: Evidence from the United Fruit Company' available here: https://www.dianavanpatten.com/. They are interested in the effect of the United Fruit Company (UFCo), which was given land in Costa Rica between 1889 and 1984. They were given roughly 4 per cent of the national territory or around 4500 acres. They key is that this land assignment was redrawn in 1904 based on a river and hence the re-assignment was essentially random with regard to determinants of growth to that point. They compare areas that were assigned to UFCo with those that were not. They find: -->
<!-- > We find that the firm had a positive and persistent effect on living standards. Regions within the UFCo were 26 per cent less likely to be poor in 1973 than nearby counterfactual locations, with only 63 per cent of the gap closing over the following three decades. Company documents explain that a key concern at the time was to attract and maintain a sizable workforce, which induced the firm to invest heavily in local amenities that likely account for our result.  -->
<!-- The model is: -->
<!-- $$y_{i,g,t} = \gamma\mbox{UFCo}_g + f(\mbox{geographic location}_g) + X_{i,g,t}\beta + X_g\Gamma + \alpha_t + \epsilon_{i,g,t}.$$ -->
<!-- In this model, $y_{i,g,t}$ is the development outcome for a household $i$ in census-block $g$ and year $t$; $\gamma\mbox{UFCo}_g$ is an indicator variable as to whether the census-block was in a UFCo area or not; $f(\mbox{geographic location}_g)$ is a function of the latitude and longitude to adjust for geographic area; $X_{i,g,t}$ is covariates for household $i$; $X_g$ is geographic characteristics for that census-block; and $\alpha_t$ is a year fixed effect. -->
<!-- Again, there are a lot of different results but one is shown in @fig-ufco). -->
<!-- 
#| fig-cap: "George, 2020, UFCo effect on the probability of being poor (p. 17)."} --
#| echo: false
#| label: ufco
<!-- ![](figures/ufco.png")) --{#fig- width=95% fig-align="center"}
# out-width: "90"

<!-- ``` -->
</section>
</section>
<section id="instrumental-variables" class="level2" data-number="15.7">
<h2 data-number="15.7" class="anchored" data-anchor-id="instrumental-variables"><span class="header-section-number">15.7</span> Instrumental variables</h2>
<section id="overview-2" class="level3" data-number="15.7.1">
<h3 data-number="15.7.1" class="anchored" data-anchor-id="overview-2"><span class="header-section-number">15.7.1</span> Overview</h3>
<p>Instrumental variables (IV) is an approach that can be handy when we have some type of treatment and control going on, but we have a lot of correlation with other variables and we possibly do not have a variable that actually measures what we are interested in. So adjusting for observables will not be enough to create a good estimate. Instead we find some variable—the eponymous instrumental variable—that is:</p>
<ol type="1">
<li>correlated with the treatment variable, but</li>
<li>not correlated with the outcome.</li>
</ol>
<p>This solves our problem because the only way the instrumental variable can have an effect is through the treatment variable, and so we can adjust our understanding of the effect of the treatment variable appropriately. The trade-off is that instrumental variables must satisfy a bunch of different assumptions, and that, frankly, they are difficult to identify <em>ex ante</em>. Nonetheless, when we are able to use them, they are a powerful tool for speaking about causality.</p>
<p>The canonical instrumental variables example is smoking. These days we know that smoking causes cancer. But because smoking is correlated with a lot of other variables, for instance, education, it could be that it was actually education that causes cancer. RCTs may be possible, but they are likely to be troublesome in terms of speed and ethics, and so instead we look for some other variable that is correlated with smoking, but not, in and of itself, with lung cancer. In this case, we look to tax rates, and other policy responses, on cigarettes. As the tax rates on cigarettes are correlated with the number of cigarettes that are smoked, but not correlated with lung cancer, other than through their impact on cigarette smoking, through them we can assess the effect of cigarettes smoked on lung cancer.</p>
<p>To implement instrumental variables we first regress tax rates on cigarette smoking to get some coefficient on the instrumental variable, and then (in a separate regression) regress tax rates on lung cancer to again, get some coefficient on the instrumental variable. Our estimate is then the ratio of these coefficients, which is described as a ‘Wald estimate’ <span class="citation" data-cites="gelmanandhill">(<a href="99-references.html#ref-gelmanandhill" role="doc-biblioref">Gelman and Hill 2007, 219</a>)</span>.</p>
<p>Following the language of <span class="citation" data-cites="gelmanandhill">(<a href="99-references.html#ref-gelmanandhill" role="doc-biblioref">Gelman and Hill 2007, 216</a>)</span> when we use instrumental variables we make a variety of assumptions including:</p>
<ul>
<li>Ignorability of the instrument.</li>
<li>Correlation between the instrumental variable and the treatment variable.</li>
<li>Monotonicity.</li>
<li>Exclusion restriction.</li>
</ul>
<!-- To summarize exactly what instrumental variables is about, I cannot do better than recommend the first few pages of the 'Instrumental Variables' chapter in @Cunningham2021, and this key paragraph in particular (by way of background, Cunningham has explained why it would have been impossible to randomly allocate 'clean' and 'dirty' water through a randomized controlled trial and then continues...): -->
<!-- > Snow would need a way to trick the data such that the allocation of clean and dirty water to people was not associated with the other determinants of cholera mortality, such as hygiene and poverty. He just would need for someone or something to be making this treatment assignment for him. -->
<!-- >  -->
<!-- > Fortunately for Snow, and the rest of London, that someone or something existed. In the London of the 1800s, there were many different water companies serving different areas of the city. Some were served by more than one company. Several took their water from the Thames, which was heavily polluted by sewage. The service areas of such companies had much higher rates of cholera. The Chelsea water company was an exception, but it had an exceptionally good filtration system. That’s when Snow had a major insight. In 1849, Lambeth water company moved the intake point upstream along the Thames, above the main sewage discharge point, giving its customers purer water. Southwark and Vauxhall water company, on the other hand, left their intake point downstream from where the sewage discharged. Insofar as the kinds of people that each company serviced were approximately the same, then comparing the cholera rates between the two houses could be the experiment that Snow so desperately needed to test his hypothesis. -->
<p>The history of instrumental variables is intriguing, and <span class="citation" data-cites="stock2003retrospectives">Stock and Trebbi (<a href="99-references.html#ref-stock2003retrospectives" role="doc-biblioref">2003</a>)</span> provide a brief overview. The method was first published in <span class="citation" data-cites="wright1928tariff">Wright (<a href="99-references.html#ref-wright1928tariff" role="doc-biblioref">1928</a>)</span>. This is a book about the effect of tariffs on animal and vegetable oil. So why might instrumental variables be important in a book about tariffs on animal and vegetable oil? The fundamental problem is that the effect of tariffs depends on both supply and demand. But we only know prices and quantities, so we do not know what is driving the effect. We can use instrumental variables to pin down causality. The intriguing aspect is that the instrumental variables discussion is only in Appendix B. It would seem odd to relegate a major statistical break-through to an appendix. Further, Philip G. Wright, the book’s author, had a son Sewall Wright, who had considerable expertise in statistics and the specific method used in Appendix B. Hence the mystery of Appendix B: did Philip or Sewall write it? Both <span class="citation" data-cites="Cunningham2021">Cunningham (<a href="99-references.html#ref-Cunningham2021" role="doc-biblioref">2021</a>)</span> and <span class="citation" data-cites="stock2003retrospectives">Stock and Trebbi (<a href="99-references.html#ref-stock2003retrospectives" role="doc-biblioref">2003</a>)</span> go into more detail, but on balance feel that it is likely that Philip did actually author the work.</p>
</section>
<section id="simulated-example-2" class="level3" data-number="15.7.2">
<h3 data-number="15.7.2" class="anchored" data-anchor-id="simulated-example-2"><span class="header-section-number">15.7.2</span> Simulated example</h3>
<p>Let us generate some data. We will explore a simulation related to the canonical example of health status, smoking, and tax rates. So we are looking to explain how healthy someone is based on the amount they smoke, via the tax rate on smoking. We are going to generate different tax rates by provinces. My understanding is that the tax rate on cigarettes is now pretty much the same in each of the provinces, but that this is fairly recent. So we will pretend that Alberta had a low tax, and Nova Scotia had a high tax.</p>
<!-- We first want a count for the number of cigarettes that a person smokes. The Poisson distribution can provide a distribution over the integers, so we will sample from that.  -->
<p>As a reminder, we are simulating data for illustrative purposes, so we need to impose the answer that we want. When you actually use instrumental variables you will be reversing the process.</p>
<div class="cell" data-warnings="false">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>number_of_observation <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>iv_example_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">person =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>number_of_observation),</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">smoker =</span> <span class="fu">sample</span>(</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>),</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> number_of_observation,</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we need to relate the number of cigarettes that someone smoked to their health. We will model health status as a draw from the normal distribution, with either a high or low mean depending on whether the person smokes.</p>
<div class="cell" data-warnings="false">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>iv_example_data <span class="ot">&lt;-</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  iv_example_data <span class="sc">|&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">health =</span> <span class="fu">if_else</span>(</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    smoker <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="do">## So health will be one standard deviation higher for people who do not or barely smoke.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we need a relationship between cigarettes and the province (because in this illustration, the provinces have different tax rates).</p>
<div class="cell" data-warnings="false">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>iv_example_data <span class="ot">&lt;-</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  iv_example_data <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">province =</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>        smoker <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">sample</span>(</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="fu">c</span>(<span class="st">"Nova Scotia"</span>, <span class="st">"Alberta"</span>),</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">prob =</span> <span class="fu">c</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>, <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>        smoker <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fu">sample</span>(</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">x =</span> <span class="fu">c</span>(<span class="st">"Nova Scotia"</span>, <span class="st">"Alberta"</span>),</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">prob =</span> <span class="fu">c</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">4</span>, <span class="dv">3</span> <span class="sc">/</span> <span class="dv">4</span>)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>iv_example_data <span class="ot">&lt;-</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>  iv_example_data <span class="sc">|&gt;</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax =</span> <span class="fu">case_when</span>(</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>    province <span class="sc">==</span> <span class="st">"Alberta"</span> <span class="sc">~</span> <span class="fl">0.3</span>,</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>    province <span class="sc">==</span> <span class="st">"Nova Scotia"</span> <span class="sc">~</span> <span class="fl">0.5</span>,</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">9999999</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>iv_example_data<span class="sc">$</span>tax <span class="sc">|&gt;</span> <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 0.3  0.5 
6206 3794 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iv_example_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  person smoker  health province      tax
   &lt;int&gt;  &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;
1      1      0  1.11   Alberta       0.3
2      2      1 -0.0831 Alberta       0.3
3      3      1 -0.0363 Alberta       0.3
4      4      0  2.48   Alberta       0.3
5      5      0  0.617  Alberta       0.3
6      6      0  0.748  Nova Scotia   0.5</code></pre>
</div>
</div>
<p>Now we can look at our data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>iv_example_data <span class="sc">|&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">smoker =</span> <span class="fu">as_factor</span>(smoker)) <span class="sc">|&gt;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> health, <span class="at">fill =</span> smoker)) <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">binwidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Health rating"</span>,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of people"</span>,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Smoker"</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(province))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="15-causality_from_obs_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finally, we can use the tax rate as an instrumental variable to estimate the effect of smoking on health.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>health_on_tax <span class="ot">&lt;-</span> <span class="fu">lm</span>(health <span class="sc">~</span> tax, <span class="at">data =</span> iv_example_data)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>smoker_on_tax <span class="ot">&lt;-</span> <span class="fu">lm</span>(smoker <span class="sc">~</span> tax, <span class="at">data =</span> iv_example_data)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(health_on_tax)[<span class="st">"tax"</span>] <span class="sc">/</span> <span class="fu">coef</span>(smoker_on_tax)[<span class="st">"tax"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       tax 
-0.8554502 </code></pre>
</div>
</div>
<p>So we find, luckily, that if you smoke then your health is likely to be worse than if you do not smoke.</p>
<p>Equivalently, we can think of instrumental variables in a two-stage regression context.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>first_stage <span class="ot">&lt;-</span> <span class="fu">lm</span>(smoker <span class="sc">~</span> tax, <span class="at">data =</span> iv_example_data)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>health_hat <span class="ot">&lt;-</span> first_stage<span class="sc">$</span>fitted.values</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>second_stage <span class="ot">&lt;-</span> <span class="fu">lm</span>(health <span class="sc">~</span> health_hat, <span class="at">data =</span> iv_example_data)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(second_stage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = health ~ health_hat, data = iv_example_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.9867 -0.7600  0.0068  0.7709  4.3293 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.91632    0.04479   20.46   &lt;2e-16 ***
health_hat  -0.85545    0.08911   -9.60   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.112 on 9998 degrees of freedom
Multiple R-squared:  0.009134,  Adjusted R-squared:  0.009034 
F-statistic: 92.16 on 1 and 9998 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>We can use <code>iv_robust()</code> from <code>estimatr</code> <span class="citation" data-cites="estimatr">(<a href="99-references.html#ref-estimatr" role="doc-biblioref">Blair et al. 2021</a>)</span> to estimate IV. One nice reason for doing this is that it can help to keep everything organised and adjust the standard errors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(estimatr)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">iv_robust</span>(health <span class="sc">~</span> smoker <span class="sc">|</span> tax, <span class="at">data =</span> iv_example_data) <span class="sc">|&gt;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
iv_robust(formula = health ~ smoker | tax, data = iv_example_data)

Standard error type:  HC2 

Coefficients:
            Estimate Std. Error t value   Pr(&gt;|t|) CI Lower CI Upper   DF
(Intercept)   0.9163    0.04057   22.59 3.163e-110   0.8368   0.9958 9998
smoker       -0.8555    0.08047  -10.63  2.981e-26  -1.0132  -0.6977 9998

Multiple R-squared:  0.1971 ,   Adjusted R-squared:  0.197 
F-statistic:   113 on 1 and 9998 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="assumptions-2" class="level3" data-number="15.7.3">
<h3 data-number="15.7.3" class="anchored" data-anchor-id="assumptions-2"><span class="header-section-number">15.7.3</span> Assumptions</h3>
<p>As discussed earlier, there are a variety of assumptions that are made when using instrumental variables. The two most important are:</p>
<ol type="1">
<li>Exclusion Restriction. This assumption is that the instrumental variable only affects the dependent variable through the independent variable of interest.</li>
<li>Relevance. There must actually be a relationship between the instrumental variable and the independent variable.</li>
</ol>
<p>There is typically a trade-off between these two. There are plenty of variables that satisfy one, precisely because they do not satisfy the other. <span class="citation" data-cites="Cunningham2021">Cunningham (<a href="99-references.html#ref-Cunningham2021" role="doc-biblioref">2021, 211</a>)</span> describes how one test of a good instrument is if people are initially confused before you explain it to them, only to think it obvious in hindsight.</p>
<p>Relevance can be tested using regression and other tests for correlation. The exclusion restriction cannot be tested. We need to present evidence and convincing arguments. The difficult aspect is that the instrument needs to seem irrelevant because that is the implication of the exclusion restriction <span class="citation" data-cites="Cunningham2021">(<a href="99-references.html#ref-Cunningham2021" role="doc-biblioref">Cunningham 2021, 225</a>)</span>.</p>
<p>Instrumental variables is a useful approach because one can obtain causal estimates even without explicit randomization. Finding instrumental variables used to be a bit of a white whale, especially in academia. But there has been increased use of IV approaches downstream of A/B tests <span class="citation" data-cites="taddy2019">(<a href="99-references.html#ref-taddy2019" role="doc-biblioref">Taddy 2019, 162</a>)</span>.</p>
<!-- ### Case study: Effect of Police on Crime -->
<!-- Here we will use an example of @levitt2002using that looks at the effect of police on crime. This is interesting because you might think, that more police is associated with lower crime. But, it could actually be the opposite, if more crime causes more police to be hired - how many police would a hypothetical country with no crime need? Hence there is a need to find some sort of instrumental variable that affects crime only through its relationship with the number of police (that is, not in and of itself, related to crime), and yet is also correlated with police numbers. @levitt2002using suggests the number of firefighters in a city. -->
<!-- @levitt2002using argues that firefighters are appropriate as an instrument, because '(f)actors such as the power of public sector unions, citizen tastes for government services, affirmative action initiatives, or a mayor's desire to provide spoils might all be expected to jointly influence the number of firefighters and police.'. @levitt2002using also argues that the relevance assumption is met by showing that 'changes in the number of police officers and firefighters within a city are highly correlated over time'. -->
<!-- In terms of satisfying the exclusion restriction, @levitt2002using argues that the number of firefighters should not have a 'direct impact on crime.' However, it may be that there are common factors, and so @levitt2002using adjusts for this in the regression. -->
<!-- The dataset is based on 122 US cities between 1975 and 1995. Summary statistics are provided in @fig-levittcrime). -->
<!-- ```{r}fig.cap="Summary statistics for Levitt 2002."} -->
<!-- #| echo: false-->
<!-- #| label: levittcrime-->
<!-- ![](figures/levitt_summary_stats{#fig- width=95% fig-align="center"}-->
<!-- # out-width: "90"-->
<!-- png")) -->
<!-- ``` -->
<!-- Source: @levitt2002using p. 1,246. -->
<!-- In the first stage @levitt2002using looks at police as a function of firefighters, and a bunch of adjustment variables: -->
<!-- $$\ln(\mbox{Police}_{ct}) = \gamma \ln(\mbox{Fire}_{ct}) + X'_{ct}\Gamma + \lambda_t + \phi_c + \epsilon_{ct}.$$ -->
<!-- The important part of this is the police and firefighters numbers which are on a per capita basis. There are a bunch of adjustment variables in $X$ which includes things like state prisoners per capita, the unemployment rate, etc, as well as year binary variables and fixed-effects for each city. -->
<!-- Having established the relationship between police and firefights, @levitt2002using can then use the estimates of the number of police, based on the number of firefighters, to explain crime rates: -->
<!-- $$\Delta\ln(\mbox{Crime}_{ct}) = \beta_1 \ln(\mbox{Police}_{ct-1}) + X'_{ct}\Gamma + \Theta_c + \mu_{ct}.$$ -->
<!-- The typical way to present instrumental variable results is to show both stages. @fig-levittcrimefirst) shows the relationship between police and firefighters. -->
<!-- ```{r}fig.cap="The relationship between firefighters, police and crime."} -->
<!-- #| echo: false -->
<!-- #| label: levittcrimefirst -->
<!-- ![](figures/levitt_first.png")) --{#fig- width=95% fig-align="center"}
# out-width: "90"

<!-- ``` -->
<!-- Source: @levitt2002using p. 1,247. -->
<!-- And then @fig-levittcrimesecond) shows the relationship between police and crime, where is it the IV results that are the ones of interest. -->
<!-- ```{r}fig.cap="The impact of police on crime."} -->
<!-- #| echo: false -->
<!-- #| label: levittcrimesecond -->
<!-- ![](figures/levitt_second.p{#fig- width=95% fig-align="center"}
# out-width: "90"
g")) -->
<!-- ``` -->
<!-- Source: @levitt2002using p. 1,248. -->
<!-- The key finding of @levitt2002using is that there is a negative effect of the number of police on the amount of crime. -->
<!-- There are a variety of points that I want to raise in regard to this paper. They will come across as a little negative, but this is mostly just because this a paper from 2002, that I am reading today, and so the standards have changed. -->
<!-- 1. It is fairly remarkable how reliant on various model specifications the results are. The results bounce around a fair bit and that's just the ones that are reported. Chances are there are a bunch of other results that were not reported, but it would be of interest to see their impact. -->
<!-- 2. On that note, there is fairly limited model validation. This is probably something that I am more aware of these days, but it seems likely that there is a fair degree of over-fitting here.  -->
<!-- 3. @levitt2002using is actually a response, after another researcher, @mccrary2002using, found some issues with the original paper: @levitt87using. While Levitt appears quite decent about it, it is jarring to see that Levitt was thanked by @mccrary2002using for providing 'both the data and computer code.' What if Levitt had not been decent about providing the data and code? Or what if the code was unintelligible? In some ways it is nice to see how far that we have come - the author of a similar paper these days would be forced to make their code and data available as part of the paper, we wouldn't have to ask them for it. But it reinforces the importance of open data and reproducible science. -->
</section>
</section>
<section id="exercises-and-tutorial" class="level2" data-number="15.8">
<h2 data-number="15.8" class="anchored" data-anchor-id="exercises-and-tutorial"><span class="header-section-number">15.8</span> Exercises and tutorial</h2>
<section id="exercises" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="exercises">Exercises</h3>
<ol type="1">
<li><em>(Plan)</em> Consider the following scenario: <strong>TBD</strong>. Please sketch out what that dataset could look like and then sketch a graph that you could build to show all observations.</li>
<li><em>(Simulate)</em> Please further consider the scenario described and simulate the situation with every variable independent of each other.</li>
<li><em>(Acquire)</em> Please describe three possible sources of such a dataset.</li>
<li><em>(Explore)</em> Please use <code>ggplot2</code> to build the graph that you sketched.</li>
<li><em>(Communicate)</em> Please write two paragraphs about what you did.</li>
<li>For three months Sharla Gelfand shared two functions each day: one that was new to them and another that they already knew and love. Please go the ‘Two Functions Most Days’ GitHub <a href="https://github.com/sharlagelfand/twofunctionsmostdays">repo</a>, and find a package that they mention that you have never used. Find the relevant website for the package, and then in a paragraph or two, describe what the package does and a context in which it could be useful to you.</li>
<li>Please again, go to Sharla’s ‘Two Functions Most Days’ GitHub <a href="https://github.com/sharlagelfand/twofunctionsmostdays">repo</a>, and find a function that they mention that you have never used. Please look at the help file for that function, and then detail the arguments of the function, and a context in which it could be useful to you.</li>
<li>What is propensity score matching? If you were matching people, then what are some of the features that you would like to match on? What sort of ethical questions does collecting and storing such information raise for you?</li>
<li>Putting the ethical issues to one side, following <span class="citation" data-cites="king2019propensity">King and Nielsen (<a href="99-references.html#ref-king2019propensity" role="doc-biblioref">2019</a>)</span>, in at least two paragraphs, please describe some of the statistical concerns with propensity score matching.</li>
<li>What is the key assumption when using difference in differences?</li>
<li>Please read the fascinating article in The Markup about car insurance algorithms: https://themarkup.org/allstates-algorithm/2020/02/25/car-insurance-suckers-list. Please read the article and tell me what you think. You may wish to focus on ethical, legal, social, statistical, or other, aspects.</li>
<li>Please go to the GitHub page related to the fascinating article in The Markup about car insurance algorithms: https://github.com/the-markup/investigation-allstates-algorithm. What is great about their work? What could be improved?</li>
<li>What are the fundamental features of regression discontinuity design?</li>
<li>What are the conditions that are needed in order for regression discontinuity design to be able to be used?</li>
<li>Can you think of a situation in your own life where regression discontinuity design may be useful?</li>
<li>What are some threats to the validity of regression discontinuity design estimates?</li>
<li>Please read and reproduce the main findings from Eggers, Fowler, Hainmueller, Hall, Snyder, 2015.</li>
<li>What is an instrumental variable?</li>
<li>What are some circumstances in which instrumental variables might be useful?</li>
<li>What conditions must instrumental variables satisfy?</li>
<li>Who were some of the early instrumental variable authors?</li>
<li>Can you please think of and explain an application of instrumental variables in your own life?</li>
<li>What is the key assumption in difference in differences
<ol type="a">
<li>Parallel trends.</li>
<li>Heteroscedasticity.</li>
</ol></li>
<li>If you are using regression discontinuity, whare are some aspects to be aware of and think hard about (select all that apply)?
<ol type="a">
<li>Is the cut-off free of manipulation?</li>
<li>Is the forcing function continuous?</li>
<li>To what extent is the functional form driving the estimate?</li>
<li>Would different fitted lines affect the results?</li>
</ol></li>
<li>What is the main reason that <span class="citation" data-cites="oostrom2021">Oostrom (<a href="99-references.html#ref-oostrom2021" role="doc-biblioref">2022</a>)</span> finds that the outcome of an RCT can depend on who is funding it (pick one)?
<ol type="a">
<li>Publication bias</li>
<li>Explicit manipulation</li>
<li>Specialisation</li>
<li>Larger number of arms</li>
</ol></li>
<li>What is the key coefficient of interest in Angelucci and Cagé, 2019 (pick one)?
<ol type="a">
<li><span class="math inline">\(\beta_0\)</span></li>
<li><span class="math inline">\(\beta_1\)</span></li>
<li><span class="math inline">\(\lambda\)</span></li>
<li><span class="math inline">\(\gamma\)</span></li>
</ol></li>
<li>The instrumental variable is (please pick all that apply):
<ol type="a">
<li>Correlated with the treatment variable.</li>
<li>Not correlated with the outcome.</li>
<li>Heteroskedastic.</li>
</ol></li>
<li>Who are the two candidates to have invented instrumental variables?
<ol type="a">
<li>Sewall Wright</li>
<li>Philip G. Wright</li>
<li>Sewall Cunningham</li>
<li>Philip G. Cunningham</li>
</ol></li>
<li>What are the two main assumptions of instrumental variables?
<ol type="a">
<li>Exclusion Restriction.</li>
<li>Relevance.</li>
<li>Ignorability.</li>
<li>Randomization.</li>
</ol></li>
<li>According to <span class="citation" data-cites="Meng2021What">Meng (<a href="99-references.html#ref-Meng2021What" role="doc-biblioref">2021</a>)</span> ‘Data science can persuade via…’ (pick all that apply):
<ol type="a">
<li>the careful establishment of evidence from fair-minded and high-quality data collection</li>
<li>processing and analysis</li>
<li>the honest interpretation and communication of findings</li>
<li>large sample sizes</li>
</ol></li>
<li>According to Reiderer, 2021, if I have ‘disjoint treated and untreated groups partitioned by a sharp cut-off’ then which method should I use to measure the local treatment effect at the juncture between groups (pick one)?
<ol type="a">
<li>regression discontinuity</li>
<li>matching</li>
<li>difference in differences</li>
<li>event study methods</li>
</ol></li>
<li>According to Reiderer, 2021, ‘Causal inference requires investment in’ (pick all that apply):
<ol type="a">
<li>data management</li>
<li>domain knowledge</li>
<li>probabilistic reasoning</li>
<li>data science</li>
</ol></li>
<li>I am an Australian 30-39 year old male living in Toronto with one child and a PhD. Which of the following do you think I would match most closely with and why (please explain in a paragraph or two)?
<ol type="a">
<li>An Australian 30-39 year old male living in Toronto with one child and a bachelors degree</li>
<li>A Canadian 30-39 year old male living in Toronto with one child and a PhD</li>
<li>An Australian 30-39 year old male living in Ottawa with one child and a PhD</li>
<li>A Canadian 18-29 year old male living in Toronto with one child and a PhD</li>
</ol></li>
<li>In your most disdainful tone (jokes, I love DAGs), what is a DAG (in your own words please)?</li>
<li>What is a confounder (please select one answer)?
<ol type="a">
<li>A variable, z, that causes both x and y, where x also causes y.</li>
<li>A variable, z, that is caused by both x and y, where x also causes y.</li>
<li>A variable, z, that causes y and is caused by x, where x also causes y.</li>
</ol></li>
<li>What is a mediator (please select one answer)?
<ol type="a">
<li>A variable, z, that causes y and is caused by x, where x also causes y.</li>
<li>A variable, z, that causes both x and y, where x also causes y.</li>
<li>A variable, z, that is caused by both x and y, where x also causes y.</li>
</ol></li>
<li>What is a collider (please select one answer)?
<ol type="a">
<li>A variable, z, that causes both x and y, where x also causes y.</li>
<li>A variable, z, that causes y and is caused by x, where x also causes y.</li>
<li>A variable, z, that is caused by both x and y, where x also causes y.</li>
</ol></li>
<li>Please talk through a brief example of when you may want to be very careful about checking for Simpson’s paradox.</li>
<li>Please talk through a brief example of when you may want to be very careful about checking for Berkson’s paradox.</li>
<li>In <span class="citation" data-cites="NoiseKahneman">Kahneman, Sibony, and Sunstein (<a href="99-references.html#ref-NoiseKahneman" role="doc-biblioref">2021</a>)</span> the authors, including the Nobel Prize winner Daniel Kahneman, say ‘… while correlation does not imply causation, causation does imply correlation. Where there is a causal link, we should find a correlation’. With reference to <span class="citation" data-cites="Cunningham2021">Cunningham (<a href="99-references.html#ref-Cunningham2021" role="doc-biblioref">2021, chap. 1</a>)</span>, are they right or wrong, and why?</li>
</ol>
</section>
<section id="tutorial" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="tutorial">Tutorial</h3>
<!-- ### Paper -->
<!-- At about this point, Paper Five (Appendix \@ref(paper-five)) would be appropriate. -->


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-alexander2018age" class="csl-entry" role="doc-biblioentry">
Alexander, Rohan, and Zachary Ward. 2018. <span>“Age at Arrival and Assimilation During the Age of Mass Migration.”</span> <em>The Journal of Economic History</em> 78 (3): 904–37. <a href="https://doi.org/10.1017/S0022050718000335">https://doi.org/10.1017/S0022050718000335</a>.
</div>
<div id="ref-angelucci2019newspapers" class="csl-entry" role="doc-biblioentry">
Angelucci, Charles, and Julia Cagé. 2019. <span>“Newspapers in Times of Low Advertising Revenues.”</span> <em>American Economic Journal: Microeconomics</em> 11 (3): 319–64. <a href="https://doi.org/10.1257/mic.20170306">https://doi.org/10.1257/mic.20170306</a>.
</div>
<div id="ref-citemodelsummary" class="csl-entry" role="doc-biblioentry">
Arel-Bundock, Vincent. 2021. <em><span class="nocase">modelsummary: Summary Tables and Plots for Statistical Models and Data: Beautiful, Customizable, and Publication-Ready</span></em>. <a href="https://CRAN.R-project.org/package=modelsummary">https://CRAN.R-project.org/package=modelsummary</a>.
</div>
<div id="ref-citeggdag" class="csl-entry" role="doc-biblioentry">
Barrett, Malcolm. 2021. <em><span class="nocase">ggdag: Analyze and Create Elegant Directed Acyclic Graphs</span></em>. <a href="https://CRAN.R-project.org/package=ggdag">https://CRAN.R-project.org/package=ggdag</a>.
</div>
<div id="ref-citeberkson" class="csl-entry" role="doc-biblioentry">
Berkson, Joseph. 1946. <span>“Limitations of the Application of Fourfold Table Analysis to Hospital Data.”</span> <em>Biometrics Bulletin</em> 2 (3): 47–53. <a href="https://doi.org/10.2307/3002000">https://doi.org/10.2307/3002000</a>.
</div>
<div id="ref-bickel1975sex" class="csl-entry" role="doc-biblioentry">
Bickel, Peter, Eugene Hammel, and William O’Connell. 1975. <span>“Sex Bias in Graduate Admissions: Data from Berkeley: Measuring Bias Is Harder Than Is Usually Assumed, and the Evidence Is Sometimes Contrary to Expectation.”</span> <em>Science</em> 187 (4175): 398–404. <a href="https://doi.org/10.1126/science.187.4175.398">https://doi.org/10.1126/science.187.4175.398</a>.
</div>
<div id="ref-estimatr" class="csl-entry" role="doc-biblioentry">
Blair, Graeme, Jasper Cooper, Alexander Coppock, Macartan Humphreys, and Luke Sonnet. 2021. <em><span class="nocase">estimatr: Fast Estimators for Design-Based Inference</span></em>. <a href="https://CRAN.R-project.org/package=estimatr">https://CRAN.R-project.org/package=estimatr</a>.
</div>
<div id="ref-bloombellreiman2020" class="csl-entry" role="doc-biblioentry">
Bloom, Howard, Andrew Bell, and Kayla Reiman. 2020. <span>“Using Data from Randomized Trials to Assess the Likely Generalizability of Educational Treatment-Effect Estimates from Regression Discontinuity Designs.”</span> <em>Journal of Research on Educational Effectiveness</em> 13 (3): 488–517. <a href="https://doi.org/10.1080/19345747.2019.1634169">https://doi.org/10.1080/19345747.2019.1634169</a>.
</div>
<div id="ref-rdrobust" class="csl-entry" role="doc-biblioentry">
Calonico, Sebastian, Matias Cattaneo, Max Farrell, and Rocio Titiunik. 2021. <em><span class="nocase">rdrobust: Robust Data-Driven Statistical Inference in Regression-Discontinuity Designs</span></em>. <a href="https://CRAN.R-project.org/package=rdrobust">https://CRAN.R-project.org/package=rdrobust</a>.
</div>
<div id="ref-Cunningham2021" class="csl-entry" role="doc-biblioentry">
Cunningham, Scott. 2021. <em>Causal Inference: The Mixtape</em>. New Haven: Yale Press.
</div>
<div id="ref-dagan2021bnt162b2" class="csl-entry" role="doc-biblioentry">
Dagan, Noa, Noam Barda, Eldad Kepten, Oren Miron, Shay Perchik, Mark Katz, Miguel Hernán, Marc Lipsitch, Ben Reis, and Ran Balicer. 2021. <span>“BNT162b2 mRNA Covid-19 Vaccine in a Nationwide Mass Vaccination Setting.”</span> <em>New England Journal of Medicine</em> 384 (15): 1412–23. <a href="https://doi.org/10.1056/NEJMoa2101765">https://doi.org/10.1056/NEJMoa2101765</a>.
</div>
<div id="ref-gelmanonrdd" class="csl-entry" role="doc-biblioentry">
Gelman, Andrew. 2019. <span>“Another Regression Discontinuity Disaster and What Can We Learn from It,”</span> June. <a href="https://statmodeling.stat.columbia.edu/2019/06/25/another-regression-discontinuity-disaster-and-what-can-we-learn-from-it/">https://statmodeling.stat.columbia.edu/2019/06/25/another-regression-discontinuity-disaster-and-what-can-we-learn-from-it/</a>.
</div>
<div id="ref-gelmanandhill" class="csl-entry" role="doc-biblioentry">
Gelman, Andrew, and Jennifer Hill. 2007. <em>Data Analysis Using Regression and Multilevel/Hierarchical Models</em>. Cambridge University Press.
</div>
<div id="ref-green2009testing" class="csl-entry" role="doc-biblioentry">
Green, Donald, Terence Leong, Holger Kern, Alan Gerber, and Christopher Larimer. 2009. <span>“Testing the Accuracy of Regression Discontinuity Analysis Using Experimental Benchmarks.”</span> <em>Political Analysis</em> 17 (4): 400–417. https://doi.org/<a href="https://doi.org/10.1093/pan/mpp018">https://doi.org/10.1093/pan/mpp018</a>.
</div>
<div id="ref-hernanrobins2020" class="csl-entry" role="doc-biblioentry">
Hernan, Miguel, and James Robins. 2020. <em>What If</em>. 1st ed. Boca Raton: Chapman &amp; Hall/CRC. <a href="https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/">https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/</a>.
</div>
<div id="ref-MatchIt" class="csl-entry" role="doc-biblioentry">
Ho, Daniel, Kosuke Imai, Gary King, and Elizabeth Stuart. 2011. <span>“<span>MatchIt</span>: Nonparametric Preprocessing for Parametric Causal Inference.”</span> <em>Journal of Statistical Software</em> 42 (8): 1–28. <a href="https://doi.org/10.18637/jss.v042.i08">https://doi.org/10.18637/jss.v042.i08</a>.
</div>
<div id="ref-palmerpenguins" class="csl-entry" role="doc-biblioentry">
Horst, Allison Marie, Alison Presmanes Hill, and Kristen Gorman. 2020. <em><span class="nocase">palmerpenguins: Palmer Archipelago (Antarctica) penguin data</span></em>. <a href="https://allisonhorst.github.io/palmerpenguins/">https://allisonhorst.github.io/palmerpenguins/</a>.
</div>
<div id="ref-theeffect" class="csl-entry" role="doc-biblioentry">
Huntington-Klein, Nick. 2021. <em>The Effect: An Introduction to Research Design and Causality</em>. 1st ed. Chapman &amp; Hall. <a href="https://theeffectbook.net">https://theeffectbook.net</a>.
</div>
<div id="ref-citeDiagrammeR" class="csl-entry" role="doc-biblioentry">
Iannone, Richard. 2020. <em><span>DiagrammeR: Graph/Network Visualization</span></em>. <a href="https://CRAN.R-project.org/package=DiagrammeR">https://CRAN.R-project.org/package=DiagrammeR</a>.
</div>
<div id="ref-citeerik" class="csl-entry" role="doc-biblioentry">
Igelström, Erik. 2020. <span>“<span class="nocase">Causal graphs in R with DiagrammeR</span>.”</span> <a href="https://www.erikigelstrom.com/articles/causal-graphs-in-r-with-diagrammer/">https://www.erikigelstrom.com/articles/causal-graphs-in-r-with-diagrammer/</a>.
</div>
<div id="ref-NoiseKahneman" class="csl-entry" role="doc-biblioentry">
Kahneman, Daniel, Olivier Sibony, and Cass Sunstein. 2021. <em>Noise: A Flaw in Human Judgment</em>. William Collins.
</div>
<div id="ref-king2019propensity" class="csl-entry" role="doc-biblioentry">
King, Gary, and Richard Nielsen. 2019. <span>“Why Propensity Scores Should Not Be Used for Matching.”</span> <em>Political Analysis</em> 27 (4): 435–54. <a href="https://doi.org/10.1017/pan.2019.11">https://doi.org/10.1017/pan.2019.11</a>.
</div>
<div id="ref-citemcelreath" class="csl-entry" role="doc-biblioentry">
McElreath, Richard. 2020. <em><span class="nocase">Statistical Rethinking: A Bayesian Course with Examples in R and Stan</span></em>. 2nd ed. Chapman; Hall/CRC.
</div>
<div id="ref-Meng2021What" class="csl-entry" role="doc-biblioentry">
Meng, Xiao-Li. 2021. <span>“What Are the Values of Data, Data Science, or Data Scientists?”</span> <em>Harvard Data Science Review</em> 3 (1). <a href="https://doi.org/10.1162/99608f92.ee717cf7">https://doi.org/10.1162/99608f92.ee717cf7</a>.
</div>
<div id="ref-oostrom2021" class="csl-entry" role="doc-biblioentry">
Oostrom, Tamar. 2022. <span>“Funding of Clinical Trials and Reported Drug Efficacy.”</span> <a href="https://drive.google.com/file/d/1EQLCH0ns99IxYBkxPNbagcZtGgE9a8MQ/view">https://drive.google.com/file/d/1EQLCH0ns99IxYBkxPNbagcZtGgE9a8MQ/view</a>.
</div>
<div id="ref-broom" class="csl-entry" role="doc-biblioentry">
Robinson, David, Alex Hayes, and Simon Couch. 2021. <em><span class="nocase">broom: Convert Statistical Objects into Tidy Tibbles</span></em>. <a href="https://CRAN.R-project.org/package=broom">https://CRAN.R-project.org/package=broom</a>.
</div>
<div id="ref-sekhon2017understanding" class="csl-entry" role="doc-biblioentry">
Sekhon, Jasjeet, and Rocío Titiunik. 2017. <span>“Understanding Regression Discontinuity Designs as Observational Studies.”</span> <em>Observational Studies</em> 3 (2): 174–82. <a href="https://doi.org/10.1353/obs.2017.0005">https://doi.org/10.1353/obs.2017.0005</a>.
</div>
<div id="ref-simpson1951interpretation" class="csl-entry" role="doc-biblioentry">
Simpson, Edward. 1951. <span>“The Interpretation of Interaction in Contingency Tables.”</span> <em>Journal of the Royal Statistical Society: Series B (Methodological)</em> 13 (2): 238–41.
</div>
<div id="ref-stock2003retrospectives" class="csl-entry" role="doc-biblioentry">
Stock, James, and Francesco Trebbi. 2003. <span>“Retrospectives: Who Invented Instrumental Variable Regression?”</span> <em>Journal of Economic Perspectives</em> 17 (3): 177–94. <a href="https://doi.org/10.1257/089533003769204416">https://doi.org/10.1257/089533003769204416</a>.
</div>
<div id="ref-taddy2019" class="csl-entry" role="doc-biblioentry">
Taddy, Matt. 2019. <em>Business Data Science</em>. McGraw Hill.
</div>
<div id="ref-thistlethwaite1960regression" class="csl-entry" role="doc-biblioentry">
Thistlethwaite, Donald, and Donald Campbell. 1960. <span>“Regression-Discontinuity Analysis: An Alternative to the Ex Post Facto Experiment.”</span> <em>Journal of Educational Psychology</em> 51 (6): 309. <a href="https://doi.org/10.1037/h0044319">https://doi.org/10.1037/h0044319</a>.
</div>
<div id="ref-Wickham2017" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley. 2017. <em><span class="nocase">tidyverse: Easily Install and Load the <span>“Tidyverse”</span></span></em>. <a href="https://CRAN.R-project.org/package=tidyverse">https://CRAN.R-project.org/package=tidyverse</a>.
</div>
<div id="ref-citehaven" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley, and Evan Miller. 2020. <em><span class="nocase">haven: Import and Export <span>“SPSS,”</span> <span>“Stata”</span> and <span>“SAS”</span> Files</span></em>. <a href="https://CRAN.R-project.org/package=haven">https://CRAN.R-project.org/package=haven</a>.
</div>
<div id="ref-scales" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley, and Dana Seidel. 2020. <em><span class="nocase">scales: Scale Functions for Visualization</span></em>. <a href="https://CRAN.R-project.org/package=scales">https://CRAN.R-project.org/package=scales</a>.
</div>
<div id="ref-wright1928tariff" class="csl-entry" role="doc-biblioentry">
Wright, Philip. 1928. <em>The Tariff on Animal and Vegetable Oils</em>. New York: Macmillan Company.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./14-ijalm.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">It’s Just A Linear Model</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./16-mrp.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Multilevel regression with post-stratification</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>