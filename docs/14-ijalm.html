<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Telling Stories with Data - 14&nbsp; Linear models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./15-causality_from_obs.html" rel="next">
<link href="./13-eda.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Linear models</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Telling Stories with Data</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/RohanAlexander/telling_stories/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-author.html" class="sidebar-item-text sidebar-link">About the author</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Foundations</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Telling stories with data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-drinking_from_a_fire_hose.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Drinking from a fire hose</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-r_essentials.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">R essentials</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-workflow.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reproducible workflows</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Communication</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-writing_research.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Writing research</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-static_communication.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Static communication</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-interactive_communication.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Interactive communication</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Acquisition</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-farm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Farm data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-gather.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Gather data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-hunt.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Hunt data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Preparation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-clean_and_prepare.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Clean and prepare</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-store_and_share.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Store and share</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Modelling</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-eda.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-ijalm.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Linear models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-causality_from_obs.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Causality from observational data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-mrp.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Multilevel regression with post-stratification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-text.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Text as data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-concluding.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Concluding remarks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-rmarkdown.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">R Markdown</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-assessment.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Papers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-datasheet.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Datasheet</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./98-cocktails.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Cocktails</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"> <span class="header-section-number">14.1</span> Introduction</a></li>
  <li><a href="#simple-linear-regression" id="toc-simple-linear-regression" class="nav-link" data-scroll-target="#simple-linear-regression"> <span class="header-section-number">14.2</span> Simple linear regression</a></li>
  <li><a href="#multiple-linear-regression" id="toc-multiple-linear-regression" class="nav-link" data-scroll-target="#multiple-linear-regression"> <span class="header-section-number">14.3</span> Multiple linear regression</a></li>
  <li><a href="#two-cultures" id="toc-two-cultures" class="nav-link" data-scroll-target="#two-cultures"> <span class="header-section-number">14.4</span> Two cultures</a>
  <ul class="collapse">
  <li><a href="#prediction" id="toc-prediction" class="nav-link" data-scroll-target="#prediction"> <span class="header-section-number">14.4.1</span> Prediction</a></li>
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference"> <span class="header-section-number">14.4.2</span> Inference</a></li>
  </ul></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression"> <span class="header-section-number">14.5</span> Logistic regression</a>
  <ul class="collapse">
  <li><a href="#us-political-support" id="toc-us-political-support" class="nav-link" data-scroll-target="#us-political-support"> <span class="header-section-number">14.5.1</span> US political support</a></li>
  </ul></li>
  <li><a href="#poisson-regression" id="toc-poisson-regression" class="nav-link" data-scroll-target="#poisson-regression"> <span class="header-section-number">14.6</span> Poisson regression</a>
  <ul class="collapse">
  <li><a href="#letters-used-in-jane-eyre" id="toc-letters-used-in-jane-eyre" class="nav-link" data-scroll-target="#letters-used-in-jane-eyre"> <span class="header-section-number">14.6.1</span> Letters used in <em>Jane Eyre</em></a></li>
  </ul></li>
  <li><a href="#negative-binomial-regression" id="toc-negative-binomial-regression" class="nav-link" data-scroll-target="#negative-binomial-regression"> <span class="header-section-number">14.7</span> Negative binomial regression</a>
  <ul class="collapse">
  <li><a href="#mortality-in-alberta" id="toc-mortality-in-alberta" class="nav-link" data-scroll-target="#mortality-in-alberta"> <span class="header-section-number">14.7.1</span> Mortality in Alberta</a></li>
  </ul></li>
  <li><a href="#deploying-models" id="toc-deploying-models" class="nav-link" data-scroll-target="#deploying-models"> <span class="header-section-number">14.8</span> Deploying models</a>
  <ul class="collapse">
  <li><a href="#amazon-web-services" id="toc-amazon-web-services" class="nav-link" data-scroll-target="#amazon-web-services"> <span class="header-section-number">14.8.1</span> Amazon Web Services</a></li>
  <li><a href="#plumber-and-model-apis" id="toc-plumber-and-model-apis" class="nav-link" data-scroll-target="#plumber-and-model-apis"> <span class="header-section-number">14.8.2</span> Plumber and model APIs</a></li>
  </ul></li>
  <li><a href="#exercises-and-tutorial" id="toc-exercises-and-tutorial" class="nav-link" data-scroll-target="#exercises-and-tutorial"> <span class="header-section-number">14.9</span> Exercises and tutorial</a>
  <ul class="collapse">
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  <li><a href="#tutorial" id="toc-tutorial" class="nav-link" data-scroll-target="#tutorial">Tutorial</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/RohanAlexander/telling_stories/edit/main/14-ijalm.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-its-just-a-linear-model" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Linear models</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p><strong>Required material</strong></p>
<ul>
<li>Read <em>Regression and Other Stories</em>, Chapters 6 “Background on regression modeling”, 7 “Linear regression with a single predictor”, 10 “Linear regression with multiple predictors”, 13 “Logistic regression”, and 15 “Other generalized linear models”, <span class="citation" data-cites="gelmanhillvehtari2020">(<a href="99-references.html#ref-gelmanhillvehtari2020" role="doc-biblioref">Gelman, Hill, and Vehtari 2020</a>)</span></li>
<li>Read <em>An Introduction to Statistical Learning with Applications in R</em>, Chapters 3 “Linear Regression”, and 4 “Classification”, <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. 2021</a>)</span></li>
<li>Read <em>We Gave Four Good Pollsters the Same Raw Data. They Had Four Different Results</em>, <span class="citation" data-cites="cohn2016">(<a href="99-references.html#ref-cohn2016" role="doc-biblioref">Cohn 2016</a>)</span></li>
<li>Read <em>Why most published research findings are false</em>, <span class="citation" data-cites="ioannidis2005most">(<a href="99-references.html#ref-ioannidis2005most" role="doc-biblioref">Ioannidis 2005</a>)</span></li>
<li>Read <em>Machine learning is going real-time</em>, <span class="citation" data-cites="chiphuyenone">(<a href="99-references.html#ref-chiphuyenone" role="doc-biblioref">Huyen 2020</a>)</span></li>
<li>Watch <em>Democratizing R with Plumber APIs</em>, <span class="citation" data-cites="democratizingr">(<a href="99-references.html#ref-democratizingr" role="doc-biblioref">Blair 2019</a>)</span></li>
<li>Read <em>Science Storms the Cloud</em>, <span class="citation" data-cites="Gentemann2021">(<a href="99-references.html#ref-Gentemann2021" role="doc-biblioref">Gentemann et al. 2021</a>)</span></li>
</ul>
<p><strong>Key concepts and skills</strong></p>
<ul>
<li>Linear models are a key component of modelling and enable us to consider a wide range of circumstance. Simple and multiple linear regression refer to the situation in which we consider some dependent variable as a function of one, and multiple, independent variables, respectively. Logistic and Poisson regression change the nature of the dependent variable, with it being a binary, and a count, respectively.</li>
<li>We are concerned with two different aspects: prediction and inference. We use machine learning approaches for the former, and Bayesian methods for the latter.</li>
<li>Finally, putting a model into production requires a different set of skills to building it. This includes a familiarity with a cloud provider and the ability to create an API.</li>
</ul>
<p><strong>Key packages and functions</strong></p>
<ul>
<li>Base R <span class="citation" data-cites="citeR">(<a href="99-references.html#ref-citeR" role="doc-biblioref">R Core Team 2022</a>)</span>
<ul>
<li><code>binomial()</code></li>
<li><code>glm()</code></li>
<li><code>lm()</code></li>
<li><code>rexp()</code></li>
<li><code>rnorm()</code></li>
<li><code>rpois()</code></li>
<li><code>sample()</code></li>
<li><code>set.seed()</code></li>
<li><code>summary()</code></li>
</ul></li>
<li><code>analogsea</code> <span class="citation" data-cites="citeanalogsea">(<a href="99-references.html#ref-citeanalogsea" role="doc-biblioref">Chamberlain, Wickham, and Chang 2021</a>)</span>
<ul>
<li><code>debian_apt_get_install()</code></li>
<li><code>droplets()</code></li>
<li><code>install_github()</code></li>
<li><code>install_r_package()</code></li>
<li><code>key_create()</code></li>
</ul></li>
<li><code>beepr</code> <span class="citation" data-cites="beepr">(<a href="99-references.html#ref-beepr" role="doc-biblioref">Bååth 2018</a>)</span>
<ul>
<li><code>beep()</code></li>
</ul></li>
<li><code>broom</code> <span class="citation" data-cites="broom">(<a href="99-references.html#ref-broom" role="doc-biblioref">Robinson, Hayes, and Couch 2021</a>)</span>
<ul>
<li><code>augment()</code></li>
<li><code>glance()</code></li>
<li><code>tidy()</code></li>
</ul></li>
<li><code>gutenbergr</code> <span class="citation" data-cites="gutenbergr">(<a href="99-references.html#ref-gutenbergr" role="doc-biblioref">Robinson 2021</a>)</span>
<ul>
<li><code>gutenberg_download()</code></li>
<li><code>gutenberg_works()</code></li>
</ul></li>
<li><code>marginaleffects</code> <span class="citation" data-cites="marginaleffects">(<a href="99-references.html#ref-marginaleffects" role="doc-biblioref">Arel-Bundock 2022</a>)</span>
<ul>
<li><code>marginaleffects()</code></li>
</ul></li>
<li><code>modelsummary</code> <span class="citation" data-cites="citemodelsummary">(<a href="99-references.html#ref-citemodelsummary" role="doc-biblioref">Arel-Bundock 2021</a>)</span>
<ul>
<li><code>modelsummary()</code></li>
</ul></li>
<li><code>plumber</code> <span class="citation" data-cites="plumber">(<a href="99-references.html#ref-plumber" role="doc-biblioref">Schloerke and Allen 2021</a>)</span>
<ul>
<li><code>do_deploy_api()</code></li>
<li><code>do_provision()</code></li>
<li><code>plumb()</code></li>
</ul></li>
<li><code>plumberDeploy</code> <span class="citation" data-cites="plumberdeploy">(<a href="99-references.html#ref-plumberdeploy" role="doc-biblioref">Allen 2021</a>)</span></li>
<li><code>poissonreg</code> <span class="citation" data-cites="poissonreg">(<a href="99-references.html#ref-poissonreg" role="doc-biblioref">Kuhn 2021</a>)</span>
<ul>
<li><code>poisson_reg()</code></li>
</ul></li>
<li><code>rstanarm</code> <span class="citation" data-cites="citerstanarm">(<a href="99-references.html#ref-citerstanarm" role="doc-biblioref">Goodrich et al. 2020</a>)</span>
<ul>
<li><code>default_prior_coef()</code></li>
<li><code>default_prior_intercept()</code></li>
<li><code>exponential()</code></li>
<li><code>gaussian()</code></li>
<li><code>loo()</code></li>
<li><code>loo_compare()</code>
<ul>
<li><code>posterior_vs_prior()</code></li>
<li><code>pp_check()</code></li>
<li><code>prior_summary()</code></li>
<li><code>stan_glm()</code></li>
</ul></li>
</ul></li>
<li><code>ssh</code> <span class="citation" data-cites="ssh">(<a href="99-references.html#ref-ssh" role="doc-biblioref">Ooms 2021</a>)</span>
<ul>
<li><code>ssh_key_info()</code></li>
</ul></li>
<li><code>tidymodels</code> <span class="citation" data-cites="citeTidymodels">(<a href="99-references.html#ref-citeTidymodels" role="doc-biblioref">Kuhn and Wickham 2020</a>)</span>
<ul>
<li><code>parsnip</code> <span class="citation" data-cites="parsnip">(<a href="99-references.html#ref-parsnip" role="doc-biblioref">Kuhn and Vaughan 2022a</a>)</span>
<ul>
<li><code>fit()</code></li>
<li><code>linear_reg()</code></li>
<li><code>logistic_reg()</code></li>
<li><code>poisson_reg()</code></li>
<li><code>set_engine()</code></li>
</ul></li>
<li><code>recipes</code> <span class="citation" data-cites="recipes">(<a href="99-references.html#ref-recipes" role="doc-biblioref">Kuhn and Wickham 2022</a>)</span>
<ul>
<li><code>recipe()</code></li>
</ul></li>
<li><code>rsample</code> <span class="citation" data-cites="rsample">(<a href="99-references.html#ref-rsample" role="doc-biblioref">Silge et al. 2022</a>)</span>
<ul>
<li><code>initial_split()</code></li>
<li><code>testing()</code></li>
<li><code>training()</code></li>
<li><code>vfold_cv()</code></li>
</ul></li>
<li><code>tune</code> <span class="citation" data-cites="tune">(<a href="99-references.html#ref-tune" role="doc-biblioref">Kuhn 2022</a>)</span>
<ul>
<li><code>collect_metrics()</code></li>
<li><code>collect_predictions()</code></li>
<li><code>conf_mat_resampled()</code></li>
<li><code>fit_resamples()</code></li>
</ul></li>
<li><code>yarkdstick</code> <span class="citation" data-cites="yardstick">(<a href="99-references.html#ref-yardstick" role="doc-biblioref">Kuhn and Vaughan 2022b</a>)</span>
<ul>
<li><code>conf_mat()</code></li>
</ul></li>
</ul></li>
</ul>
<section id="introduction" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">14.1</span> Introduction</h2>
<p>Linear models have been around for a long time. For instance, speaking about the development of least squares, which is one way to fit linear models, in the 1700s, <span class="citation" data-cites="stigler">Stigler (<a href="99-references.html#ref-stigler" role="doc-biblioref">1986, 16</a>)</span> describes how it was associated with foundational problems in astronomy, such as determining the motion of the moon and reconciling the non-periodic motion of Jupiter and Saturn. The fundamental issue at the time with least squares was that of hesitancy to combine different observations. Astronomers were early to develop a comfort with doing this because they had typically gathered their observations themselves and knew that the conditions of the data gathering were similar, even though the value of the observation was different. It took longer for social scientists to become comfortable with linear models, possibly because they were hesitant to group together data they worried were not alike. In this one sense, astronomers had an advantage because they could compare their predictions with what happened whereas this was more difficult for social scientists <span class="citation" data-cites="stigler">(<a href="99-references.html#ref-stigler" role="doc-biblioref">Stigler 1986, 163</a>)</span>.</p>
<p>Francis Galton, mentioned in <a href="10-hunt.html"><span>Chapter&nbsp;10</span></a>, and others of his generation, some of whom were eugenicists, used linear regression in earnest in the late 1800s and early 1900s. Binary outcomes quickly became of interest and needed special treatment, leading to the development and wide adaption of logistic regression and similar methods in the mid-1900s <span class="citation" data-cites="cramer2002origins">(<a href="99-references.html#ref-cramer2002origins" role="doc-biblioref">Cramer 2003</a>)</span>. The generalized linear model framework came into being, in a formal sense, in the 1970s with <span class="citation" data-cites="nelder1972generalized">Nelder and Wedderburn (<a href="99-references.html#ref-nelder1972generalized" role="doc-biblioref">1972</a>)</span> who brought this all together. Generalized linear models (GLMs) broaden the types of outcomes that are allowed. We still model outcomes as a linear function, but we are no longer constrained by the normal distribution. The outcome can be anything in the exponential family, and popular choices include the logistic distribution, and the Poisson distribution. A further generalization of GLMs is generalized additive models (GAMs) where we broaden the structure of the explanatory side. We still explain the dependent variable as an additive function of various bits and pieces, but those bits and pieces can be functions. This framework, in this way, came about in the 1990s, with <span class="citation" data-cites="hastie1990generalized">Hastie and Tibshirani (<a href="99-references.html#ref-hastie1990generalized" role="doc-biblioref">1990</a>)</span>.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Shoulders of giants
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dr Robert Tibshirani is Professor in the Departments of Statistics and Biomedical Data Science at Stanford University. After taking a PhD in Statistics from Stanford University in 1981, he joined the University of Toronto as an assistant professor. He was promoted to full professor in 1994 and moved to Stanford in 1998. He made fundamental contributions including GAMs, mentioned above, and lasso regression, which is a way of automated variable selection and will be covered in <a href="17-text.html"><span>Chapter&nbsp;17</span></a>. He is an author of <span class="citation" data-cites="islr">James et al. (<a href="99-references.html#ref-islr" role="doc-biblioref">2021</a>)</span>. He was awarded the COPSS Presidents’ Award in 1996 and was appointed a Fellow of the Royal Society in 2019.</p>
</div>
</div>
<p>When we build models, we are not discovering “the truth”. A model is not, and cannot be, a true representation of reality. We are using the model to help us explore and understand our data. There is no one best model, there are just useful models that help us learn something about the data that we have and hence, hopefully, something about the world from which the data were generated. When we use models, we are trying to understand the world, but there are enormous constraints on the perspective we bring to this. It is silly to expect one model to be universal. Further, we should not just blindly throw data into a regression model and hope that it will sort it out. “Regression will not sort it out. Regression is indeed an oracle, but a cruel one. It speaks in riddles and delights in punishing us for asking bad questions” <span class="citation" data-cites="citemcelreath">(<a href="99-references.html#ref-citemcelreath" role="doc-biblioref">McElreath 2020, 162</a>)</span>.</p>
<p>We use models to understand the world. We poke, push, and test them. We build them and rejoice in their beauty, and then seek to understand their limits and ultimately destroy them. It is this process that is important, it is this process that allows us to better understand the world; not the outcome. When we build models, we need to keep in mind both the world of the model and the broader world that we want to be able to speak about. To what extent does a model trained on the experiences of straight, cis, men, speak to the world as it is? It is not worthless, but it is also not unimpeachable. To what extent does the model teach us about the data that we have? To what extent do the data that we have reflect the world about which we would like to draw conclusions? We need to keep such questions front of mind.</p>
<p>Much of statistics was established without concern for broader implications. And that was reasonable because it was developed for situations such as astronomy and agriculture. Folks such as <span class="citation" data-cites="fisherarrangement">Fisher (<a href="99-references.html#ref-fisherarrangement" role="doc-biblioref">1926</a>)</span> were able to randomize the order of fields and planting because they worked at agricultural stations. But many of the subsequent applications in the twentieth and twenty-first centuries do not have those properties. Statistics is often taught as though it proceeds through some idealized process where a hypothesis appears, is tested against some data that similarly appears, and is either confirmed or not. But that is not what happens. We react to incentives. We dabble, guess, and test, and then follow our intuition, backfilling as we need. All of this is fine. But it is not a world in which a traditional null hypothesis holds completely. This means concepts such as p-values and power lose some of their meaning. While we need to understand these foundations, we also need to be sophisticated enough to know when we need to move away from them.</p>
<p>Manual statistical checks are widely used in modelling. And an extensive suite of them is available. But automated testing is also important. For instance, <span class="citation" data-cites="wakefieldestimates">Knutson et al. (<a href="99-references.html#ref-wakefieldestimates" role="doc-biblioref">2022</a>)</span> built a model of excess deaths in a variety of countries, to estimate the overall death toll from the pandemic. After initially releasing the model, which had been extensively manually checked for statistical issues and reasonableness, some of the results were re-examined and it was found that the estimates for Germany and Sweden were over-sensitive. The authors acknowledged this, and addressed the issues, but the integration of automated testing, in addition to the usual manual statistical checks, would go some way to enabling us to have more faith in the models of others.</p>
<p>In this chapter we begin with simple linear regression, and then move to multiple linear regression, the difference being the number of explanatory variables that we allow. We then consider logistic, Poisson, and negative binomial regression. We go through three approaches for each of these: base R, which is useful when we want to quickly use the models in EDA; <code>tidymodels</code> <span class="citation" data-cites="citeTidymodels">(<a href="99-references.html#ref-citeTidymodels" role="doc-biblioref">Kuhn and Wickham 2020</a>)</span> which is useful when we are interested in prediction; and <code>rstanarm</code> <span class="citation" data-cites="citerstanarm">(<a href="99-references.html#ref-citerstanarm" role="doc-biblioref">Goodrich et al. 2020</a>)</span> for when we are interested in inference. In general, a model is either optimized for prediction or inference. Regardless of the approach we use, the important thing to remember is that modelling in this way is just fancy averaging and reflects the dataset.</p>
<p>For ease of next steps in this chapter the notation for probability distributions follows <span class="citation" data-cites="pitman">Pitman (<a href="99-references.html#ref-pitman" role="doc-biblioref">1993</a>)</span>, the notation for frequentist statistics and machine learning follows <span class="citation" data-cites="islr">James et al. (<a href="99-references.html#ref-islr" role="doc-biblioref">2021</a>)</span>, and the notation for Bayesian statistics follows <span class="citation" data-cites="citemcelreath">McElreath (<a href="99-references.html#ref-citemcelreath" role="doc-biblioref">2020</a>)</span>.</p>
</section>
<section id="simple-linear-regression" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="simple-linear-regression"><span class="header-section-number">14.2</span> Simple linear regression</h2>
<p>When we are interested in the relationship between two continuous variables, say <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span>, we can use simple linear regression. This is based on the Normal, also called “Gaussian”, distribution, but it is not these variables themselves that are normally distributed. The shape of the Normal distribution is determined by two parameters, the mean, <span class="math inline">\(\mu\)</span>, and the standard deviation, <span class="math inline">\(\sigma\)</span> <span class="citation" data-cites="pitman">(<a href="99-references.html#ref-pitman" role="doc-biblioref">Pitman 1993, 94</a>)</span>:</p>
<p><span class="math display">\[y = \frac{1}{\sqrt{2\pi\sigma}}e^{-\frac{1}{2}z^2},\]</span></p>
<p>where <span class="math inline">\(z = (x - \mu)/\sigma\)</span> is the difference between the mean and <span class="math inline">\(x\)</span>, in terms of the standard deviation.</p>
<p>As introduced in <a href="03-r_essentials.html"><span>Chapter&nbsp;3</span></a>, we use <code>rnorm()</code> to simulate data from the Normal distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>normal_example <span class="ot">&lt;-</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">draws =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">20</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>normal_example <span class="sc">|&gt;</span> <span class="fu">pull</span>(draws)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -0.35980342 -0.04064753 -1.78216227 -1.12242282 -1.00278400  1.77670433
 [7] -1.38825825 -0.49749494 -0.55798959 -0.82438245  1.66877818 -0.68196486
[13]  0.06519751 -0.25985911  0.32900796 -0.43696568 -0.32288891  0.11455483
[19]  0.84239206  0.34248268</code></pre>
</div>
</div>
<p>Here we specified 20 draws from a Normal distribution with mean of 0 and standard deviation of 1. When we deal with real data, we will not know these parameters and we want to use our data to estimate them. We can estimate the mean, <span class="math inline">\(\bar{x}\)</span>, and standard deviation, <span class="math inline">\(\hat{\sigma}_x\)</span>, with the following estimators:</p>
<p><span class="math display">\[
\begin{aligned}
\bar{x} &amp;= \frac{1}{n} \times \sum_{i = 1}^{n}x_i\\
\hat{\sigma}_{x} &amp;= \sqrt{\frac{1}{n} \times \sum_{i = 1}^{n}\left(x_i - \bar{x}\right)^2}
\end{aligned}
\]</span></p>
<p>If <span class="math inline">\(\hat{\sigma}_x\)</span> is the estimate of the standard deviation, then a standard error of an estimate, say, <span class="math inline">\(\bar{x}\)</span> is:</p>
<p><span class="math display">\[\mbox{SE}(\bar{x}) = \frac{\sigma}{\sqrt{n}}.\]</span></p>
<p>We can implement these in code using our simulated data to see how close our estimates are.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>estimated_mean <span class="ot">&lt;-</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(normal_example<span class="sc">$</span>draws) <span class="sc">/</span> <span class="fu">nrow</span>(normal_example)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>normal_example <span class="ot">&lt;-</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  normal_example <span class="sc">|&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_square =</span> (draws <span class="sc">-</span> estimated_mean)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>estimated_standard_deviation <span class="ot">&lt;-</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">sum</span>(normal_example<span class="sc">$</span>diff_square) <span class="sc">/</span> <span class="fu">nrow</span>(normal_example))</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> estimated_mean,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> estimated_standard_deviation</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Estimated mean"</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Estimated standard deviation"</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"r"</span>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-meanstdexample" class="anchored">
<table class="table table-sm table-striped">
<caption>Table 14.1: Estimates of the mean and standard deviation based on the simulated data</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Estimated mean</th>
<th style="text-align: right;">Estimated standard deviation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-0.21</td>
<td style="text-align: right;">0.88</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We should not be too worried that our estimates are slightly off (<a href="#tbl-meanstdexample">Table&nbsp;<span>14.1</span></a>). We only considered 20 observations. It will typically take a larger number of draws before we get the expected shape, and our estimated parameters get close to the actual parameters, but it will almost surely happen (<a href="#fig-normaldistributiontakingshape">Figure&nbsp;<span>14.1</span></a>). <span class="citation" data-cites="wasserman">Wasserman (<a href="99-references.html#ref-wasserman" role="doc-biblioref">2005, 76</a>)</span> describes our certainty of this, which is due to the Law of Large Numbers, as “a crowning achievement in probability”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>normal_takes_shape <span class="ot">&lt;-</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">number_draws =</span> <span class="fu">c</span>(),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">draws =</span> <span class="fu">c</span>()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">10000</span>, <span class="dv">100000</span>)) {</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  draws_i <span class="ot">&lt;-</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">number_draws =</span> <span class="fu">c</span>(<span class="fu">rep.int</span>(</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fu">paste</span>(<span class="fu">as.integer</span>(i), <span class="st">" draws"</span>),</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">times =</span> i</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>      )),</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">draws =</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">n =</span> i,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean =</span> <span class="dv">0</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd =</span> <span class="dv">1</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  normal_takes_shape <span class="ot">&lt;-</span> <span class="fu">rbind</span>(normal_takes_shape, draws_i)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(draws_i)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>normal_takes_shape <span class="sc">|&gt;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">number_draws =</span> <span class="fu">as_factor</span>(number_draws)) <span class="sc">|&gt;</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> draws)) <span class="sc">+</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vars</span>(number_draws),</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">"free_y"</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Draw"</span>,</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-normaldistributiontakingshape" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-normaldistributiontakingshape-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 14.1: The Normal distribution takes its familiar shape as the number of draws increases</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>When we use simple linear regression, we assume that our relationship is characterized by the variables and the parameters. If we have two variables, <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span>, then we could characterize a linear relationship between these as <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. 2021, 61</a>)</span>:</p>
<p><span id="eq-xandy"><span class="math display">\[
Y \approx \beta_0 + \beta_1 X.
\tag{14.1}\]</span></span></p>
<p>Here, there are two coefficients, also referred to as parameters: the intercept, <span class="math inline">\(\beta_0\)</span>, and the slope, <span class="math inline">\(\beta_1\)</span>. In <a href="#eq-xandy">Equation&nbsp;<span>14.1</span></a> we are saying that <span class="math inline">\(Y\)</span> will have some value, <span class="math inline">\(\beta_0\)</span>, even when <span class="math inline">\(X\)</span> is 0, and that <span class="math inline">\(Y\)</span> will change by <span class="math inline">\(\beta_1\)</span> units for every one unit change in <span class="math inline">\(X\)</span>. We may then take this relationship to the data that we have to estimate these coefficients.</p>
<p>To make this example concrete, we will simulate some data and then discuss it in that context. We could consider the time it takes someone to run five kilometers, compared with the time it takes them to run a marathon (<a href="#fig-fivekmvsmarathon-1">Figure&nbsp;<span>14.2 (a)</span></a>). In the simulation we specify a relationship of 8.4, as that is roughly the ratio between the distance of a marathon and a five-kilometer run. Notice that it is the noise that is normally distributed, not the variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>number_of_observations <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>expected_relationship <span class="ot">&lt;-</span> <span class="fl">8.4</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>very_fast_5km_time <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>good_enough_5km_time <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>sim_run_data <span class="ot">&lt;-</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">five_km_time =</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">runif</span>(</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">n =</span> number_of_observations,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">min =</span> very_fast_5km_time,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">max =</span> good_enough_5km_time</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">noise =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> number_of_observations, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">20</span>),</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">marathon_time =</span> five_km_time <span class="sc">*</span> expected_relationship <span class="sc">+</span> noise</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">five_km_time =</span> <span class="fu">round</span>(<span class="at">x =</span> five_km_time, <span class="at">digits =</span> <span class="dv">1</span>),</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">marathon_time =</span> <span class="fu">round</span>(<span class="at">x =</span> marathon_time, <span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>noise)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>sim_run_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 2
   five_km_time marathon_time
          &lt;dbl&gt;         &lt;dbl&gt;
 1         20.4          152.
 2         16.8          134.
 3         22.3          198.
 4         19.7          166.
 5         15.6          163.
 6         21.1          168.
 7         17            131.
 8         18.6          150.
 9         17.4          158.
10         17.8          147.
# … with 90 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>base_sim_run_data <span class="ot">&lt;-</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  sim_run_data <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> five_km_time, <span class="at">y =</span> marathon_time)) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Five-kilometer time (minutes)"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Marathon time (minutes)"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>base_and_fit_sim_run_data <span class="ot">&lt;-</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  base_sim_run_data <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="st">"y ~ x"</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>base_and_fit_and_se_sim_run_data <span class="ot">&lt;-</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  base_sim_run_data <span class="sc">+</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="st">"y ~ x"</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>base_sim_run_data</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>base_and_fit_sim_run_data</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>base_and_fit_and_se_sim_run_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-fivekmvsmarathon" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathon-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-fivekmvsmarathon-1.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathon" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Distribution of simulated data</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathon-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-fivekmvsmarathon-2.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathon" width="672"></p>
<p></p><figcaption class="figure-caption">(b) With one ‘linear best-fit’ line illustrating the implied relationship</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathon-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-fivekmvsmarathon-3.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathon" width="672"></p>
<p></p><figcaption class="figure-caption">(c) Including standard errors</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure 14.2: Simulated data of the relationship between the time to run five kilometers and a marathon</figcaption><p></p>
</figure>
</div>
</div>
<p>In this simulated example, we know the true values of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>. But our challenge is to see if we can use only the data, and simple linear regression, to recover them. That is, can we use <span class="math inline">\(x\)</span>, which is the five-kilometer time, to produce estimates of <span class="math inline">\(y\)</span>, which is the marathon time, and that we denote by <span class="math inline">\(\hat{y}\)</span> (by convention, hats are used to indicate that these are, or will be, estimated values) <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. 2021, 61</a>)</span>:</p>
<p><span class="math display">\[\hat{y} = \hat{\beta}_0 + \hat{\beta}_1 x.\]</span></p>
<p>This involves estimating values for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>. But how should we estimate these coefficients? Even if we impose a linear relationship there are many options because many straight lines could be drawn. But some of those lines would fit the data better than others.</p>
<p>One way we may define a line as being “better” than another, is if it is as close as possible to each of the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> combinations that we know. There are a lot of candidates for how we define as close as possible, but one is to minimize the residual sum of squares. To do this we produce estimates for <span class="math inline">\(\hat{y}\)</span> based on some guesses of <span class="math inline">\(\hat{\beta}_0\)</span> and <span class="math inline">\(\hat{\beta}_1\)</span>, given the <span class="math inline">\(x\)</span>. We then work out how wrong, for every observation <span class="math inline">\(i\)</span>, we were <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. 2021, 62</a>)</span>:</p>
<p><span class="math display">\[e_i = y_i - \hat{y}_i.\]</span></p>
<p>To compute the residual sum of squares (RSS), we sum the errors across all the points, taking the square to account for negative differences <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. 2021, 62</a>)</span>:</p>
<p><span class="math display">\[\mbox{RSS} = e^2_1+ e^2_2 +\dots + e^2_n.\]</span></p>
<p>This results in one linear best-fit line (<a href="#fig-fivekmvsmarathon-2">Figure&nbsp;<span>14.2 (b)</span></a>), but it is worth reflecting on all the assumptions and decisions that it took to get us to this point.</p>
<p>Underpinning our use of simple linear regression is a belief that there is some “true” relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, that is <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. 2021, 62</a>)</span>:</p>
<p><span class="math display">\[Y = f(X) + \epsilon.\]</span></p>
<p>We are going to say that function, <span class="math inline">\(f()\)</span>, is linear, and so for simple linear regression <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. 2021, 62</a>)</span>:</p>
<p><span class="math display">\[\hat{Y} = \beta_0 + \beta_1 X + \epsilon.\]</span></p>
<p>We do not, and cannot, know the “true” relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. All we can do is use our sample to estimate it. But because our understanding depends on that sample, for every possible sample, we would get a slightly different relationship, as measured by the coefficients.</p>
<p>That <span class="math inline">\(\epsilon\)</span> is a measure of our error—what does the model not know in the small, contained, world implied by this dataset? There is going to be plenty that the model does not know, but we hope the error does not depend on <span class="math inline">\(X\)</span>, and that the error is normally distributed.</p>
<p>We can conduct simple linear regression with <code>lm()</code> from base R. We specify the dependent variable first, then <code>~</code>, followed by the independent variable. Finally, we specify the dataset. Before we run a regression, we may want to include a quick check of the class of the variables, and the number of observations, just to ensure that it corresponds with what we were expecting. And after we run it, we may check that our estimate seems reasonable. For instance, (pretending that we had not ourselves imposed this in the simulation) based on our knowledge of the respective distances of a five-kilometer run and a marathon, we would expect <span class="math inline">\(\beta_1\)</span> to be somewhere between 6 and 10.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sim_run_data<span class="sc">$</span>marathon_time) <span class="sc">==</span> <span class="st">"numeric"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sim_run_data<span class="sc">$</span>five_km_time) <span class="sc">==</span> <span class="st">"numeric"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(sim_run_data) <span class="sc">==</span> <span class="dv">100</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>sim_run_data_first_model <span class="ot">&lt;-</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    marathon_time <span class="sc">~</span> five_km_time,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">between</span>(</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  sim_run_data_first_model<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">6</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To see the result of the regression, we can use <code>modelsummary()</code> from <code>modelsummary</code> <span class="citation" data-cites="citemodelsummary">(<a href="99-references.html#ref-citemodelsummary" role="doc-biblioref">Arel-Bundock 2021</a>)</span> (<a href="#tbl-modelsummaryfivekmonly">Table&nbsp;<span>14.2</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Five km only"</span> <span class="ot">=</span> sim_run_data_first_model</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-modelsummaryfivekmonly" class="anchored">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"><caption>Table 14.2:  Explaining marathon times based on five-kilometer run times </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Five km only </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 8.24 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (8.96) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> five_km_time </td>
   <td style="text-align:center;"> 7.94 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.41) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 100 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:center;"> 0.795 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 Adj. </td>
   <td style="text-align:center;"> 0.793 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 854.0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 861.8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> −423.993 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> F </td>
   <td style="text-align:center;"> 380.262 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 16.79 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The top half of the table provides our estimated coefficients and standard errors in brackets. And the second half provides some useful diagnostics, which we will not dwell too much on here. The intercept is the marathon time associated with a hypothetical five-kilometer time of 0 minutes. Hopefully this example illustrates the need to always interpret the intercept coefficient carefully. And to disregard it at times.</p>
<p>Following <span class="citation" data-cites="gelmanhillvehtari2020">Gelman, Hill, and Vehtari (<a href="99-references.html#ref-gelmanhillvehtari2020" role="doc-biblioref">2020, 84</a>)</span> we recommend considering the coefficients as comparisons, rather than effects. And to use language that makes it clear these are comparisons, on average, based on one dataset. For instance, we may consider that the coefficient on the five-kilometer run time shows how different individuals compare. When comparing the marathon times of individuals in our dataset whose five-kilometer run time differed by one minute, on average we find their marathon times differs by about eight minutes. This makes sense seeing as a marathon is roughly that many times longer than a five-kilometer run.</p>
<p>We use <code>augment()</code> from <code>broom</code> <span class="citation" data-cites="broom">(<a href="99-references.html#ref-broom" role="doc-biblioref">Robinson, Hayes, and Couch 2021</a>)</span> to add the fitted values and residuals to our original dataset. This allows us to plot the residuals (<a href="#fig-fivekmvsmarathonresids">Figure&nbsp;<span>14.3</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sim_run_data <span class="ot">&lt;-</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">augment</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    sim_run_data_first_model,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  sim_run_data,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> .resid)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of occurrences"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Residuals"</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  sim_run_data,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> five_km_time, <span class="at">y =</span> .resid)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dotted"</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey"</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Five-kilometer time (minutes)"</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  sim_run_data,</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> marathon_time, .fitted)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated marathon time"</span>,</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Actual marathon time"</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-fivekmvsmarathonresids" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathonresids-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-fivekmvsmarathonresids-1.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathonresids" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Distribution of residuals</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathonresids-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-fivekmvsmarathonresids-2.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathonresids" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Residuals by order</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathonresids-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-fivekmvsmarathonresids-3.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathonresids" width="672"></p>
<p></p><figcaption class="figure-caption">(c) Comparing the estimated time with the actual time</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure 14.3: Residuals from the simple linear regression with simulated data on the time someone takes to run five kilometers and a marathon</figcaption><p></p>
</figure>
</div>
</div>
<p>We want our estimate to be unbiased. When we say our estimate is unbiased, we are trying to say that even though for some sample our estimate might be too high, and for another sample our estimate might be too low, eventually if we have a lot of data then our estimate would be the same as the population. That is, an estimator is unbiased if it does not systematically over- or under-estimate <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. 2021, 65</a>)</span>.</p>
<p>We want to try to speak to the “true” relationship, so we need to try to capture how much we think our understanding depends on the sample that we have to analyze. And this is where the standard error comes in. It tells us how wrong our estimates are compared with the actual data (<a href="#fig-fivekmvsmarathon-3">Figure&nbsp;<span>14.2 (c)</span></a>).</p>
<p>From standard errors, we can compute a confidence interval. A 95 per cent confidence interval is a range, such that there is “approximately a 95 per cent chance that the interval” contains the population parameter, which is typically unknown <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. 2021, 66</a>)</span>. The lower end of this range is: <span class="math inline">\(\hat{\beta_1} - 2 \times \mbox{SE}\left(\hat{\beta_1}\right)\)</span> and the upper end of this range is: <span class="math inline">\(\hat{\beta_1} + 2 \times \mbox{SE}\left(\hat{\beta_1}\right)\)</span>.</p>
<p>After we have such a range, we could use it to test claims. For instance, we could claim that there is no relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, i.e.&nbsp;<span class="math inline">\(\beta_1 = 0\)</span>, as an alternative to a claim that there is some relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, i.e.&nbsp;<span class="math inline">\(\beta_1 \neq 0\)</span>.</p>
<p>In <a href="10-hunt.html"><span>Chapter&nbsp;10</span></a> we needed to decide how much evidence it would take to convince us that our tea taster could distinguish whether milk or tea had been added first. In the same way, here we need to decide if the estimate of <span class="math inline">\(\beta_1\)</span>, which we denote <span class="math inline">\(\hat{\beta}_1\)</span>, is far enough away from zero for us to be comfortable claiming that <span class="math inline">\(\beta_1 \neq 0\)</span>. If we were very confident in our estimate of <span class="math inline">\(\beta_1\)</span> then it would not have to be far, but if we were not, then it would have to be substantial. The standard error of <span class="math inline">\(\hat{\beta}_1\)</span> does an awful lot of work here in accounting for a variety of factors, only some of which it can actually account for.</p>
<p>We compare this standard error with <span class="math inline">\(\hat{\beta}_1\)</span> to get the “test statistic” or t-statistic <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. 2021, 67</a>)</span>:</p>
<p><span class="math display">\[t = \frac{\hat{\beta}_1 - 0}{\mbox{SE}(\hat{\beta}_1)}.\]</span></p>
<p>And we then compare our t-statistic to the t-distribution to compute the probability of getting this absolute t-statistic or a larger one, if it was the case that <span class="math inline">\(\beta_1 = 0\)</span>. This probability is the p-value. A smaller p-value means there is a smaller “probability of observing something at least as extreme as the observed test statistic” <span class="citation" data-cites="gelmanhillvehtari2020">(<a href="99-references.html#ref-gelmanhillvehtari2020" role="doc-biblioref">Gelman, Hill, and Vehtari 2020, 57</a>)</span>.</p>
<blockquote class="blockquote">
<p>Words! Mere words! How terrible they were! How clear, and vivid, and cruel! One could not escape from them. And yet what a subtle magic there was in them! They seemed to be able to give a plastic form to formless things, and to have a music of their own as sweet as that of viol or of lute. Mere words! Was there anything so real as words?</p>
<p><em>The Picture of Dorian Gray</em> <span class="citation" data-cites="wilde">(<a href="99-references.html#ref-wilde" role="doc-biblioref">Wilde 1891</a>)</span>.</p>
</blockquote>
<p>We will not make much use of p-values in this book because they are a specific and subtle concept. They are difficult to understand and easy to abuse. Even though they are “little help” for “scientific inference” many disciplines are incorrectly fixated on them <span class="citation" data-cites="nelderdoesntmiss">(<a href="99-references.html#ref-nelderdoesntmiss" role="doc-biblioref">Nelder 1999, 257</a>)</span>. One issue is that they embody every assumption of the workflow, including everything that went into gathering and cleaning the data. While p-values have implications if all the assumptions were correct; when we consider the full data science workflow there are usually an awful lot of assumptions. And we do not get guidance from p-values about whether the assumptions are reasonable <span class="citation" data-cites="greenland2016statistical">(<a href="99-references.html#ref-greenland2016statistical" role="doc-biblioref">Greenland et al. 2016, 339</a>)</span>.</p>
<p>A p-value may reject a null hypothesis because the null hypothesis is false, but it may also be that some data were incorrectly gathered or prepared. We can only be sure that the p-value speaks to the hypothesis we are interested in testing, if all the other assumptions are correct. There is nothing inherently wrong about using p-values, but it is important to use them in sophisticated and thoughtful ways. <span class="citation" data-cites="coxtalks">Cox (<a href="99-references.html#ref-coxtalks" role="doc-biblioref">2018</a>)</span> discusses what this requires.</p>
<p>One application where it is easy to see an inappropriate focus on p-values is in power analysis. Power, in a statistical sense, refers to probability of rejecting a null hypothesis that is false. As power relates to hypothesis testing, it also related to sample size. There is often a worry that a study is “under-powered”, meaning there was not a large enough sample, but rarely a worry that, say, the data were inappropriately cleaned, even though we cannot distinguish between these based only on a p-value.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Shoulders of giants
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dr Nancy Reid is University Professor in the Department of Statistical Sciences at the University of Toronto. After obtaining a PhD in Statistics from Stanford University in 1979, she took a position as a postdoctoral fellow at Imperial College London. She was then appointed as assistant professor at the University of British Columbia in 1980, and then moved to the University of Toronto in 1986, where she was promoted to full professor in 1988 and served as department chair between 1997 and 2002 <span class="citation" data-cites="Staicu2017">(<a href="99-references.html#ref-Staicu2017" role="doc-biblioref">Staicu 2017</a>)</span>. Her research focuses on obtaining accurate inference in small-sample regimes and developing inferential procedures for complex models featuring intractable likelihoods. <span class="citation" data-cites="cox1987parameter">Cox and Reid (<a href="99-references.html#ref-cox1987parameter" role="doc-biblioref">1987</a>)</span> examines how re-parameterizing models can simplify inference, <span class="citation" data-cites="varin2011overview">Varin, Reid, and Firth (<a href="99-references.html#ref-varin2011overview" role="doc-biblioref">2011</a>)</span> surveys methods for approximating intractable likelihoods, and <span class="citation" data-cites="reid2003asymptotics">Reid (<a href="99-references.html#ref-reid2003asymptotics" role="doc-biblioref">2003</a>)</span> overviews inferential procedures in the small-sample regime. Dr Reid was awarded the 1992 COPSS Presidents’ Award, the Royal Statistical Society Guy Medal in Silver in 2016 and in Gold in 2022, and the COPSS Distinguished Achievement Award and Lectureship in 2022.</p>
</div>
</div>
</section>
<section id="multiple-linear-regression" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="multiple-linear-regression"><span class="header-section-number">14.3</span> Multiple linear regression</h2>
<p>To this point we have just considered one explanatory variable. But we will usually have more than one. One approach would be to run separate regressions for each explanatory variable. But compared with separate linear regressions for each, adding more explanatory variables allows us to have a better understanding of the intercept and accounts for interaction. Often the results will be quite different.</p>
<p>We may also like to consider explanatory variables that do not have an inherent ordering. For instance: pregnant or not; day or night. When there are only two options then we can use a binary variable, which is considered either 0 or 1. If we have a column of character values that only has two values, such as: <code>c("Myles", "Ruth", "Ruth", "Myles", "Myles", "Ruth")</code>, then using this as an explanatory variable in the usual regression set up would mean that it is treated as a binary variable. If there are more than two levels, then we can use a combination of binary variables, where some baseline outcome gets integrated into the intercept.</p>
<p>As an example, we add whether it was raining to our simulated relationship between marathon and five-kilometer run times. We then specify that if it was raining, then the individual is five minutes slower than they otherwise would have been.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>minutes_slower_in_rain <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>sim_run_data <span class="ot">&lt;-</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  sim_run_data <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">was_raining =</span> <span class="fu">sample</span>(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> number_of_observations,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">marathon_time =</span> <span class="fu">if_else</span>(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      was_raining <span class="sc">==</span> <span class="st">"Yes"</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      marathon_time <span class="sc">+</span> minutes_slower_in_rain,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>      marathon_time</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(five_km_time, marathon_time, was_raining)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>sim_run_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 3
   five_km_time marathon_time was_raining
          &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;      
 1         20.4          152. No         
 2         16.8          134. No         
 3         22.3          198. No         
 4         19.7          166. No         
 5         15.6          163. No         
 6         21.1          168. No         
 7         17            131. No         
 8         18.6          150. No         
 9         17.4          158. No         
10         17.8          147. No         
# … with 90 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p>We can add additional explanatory variables to <code>lm()</code> with <code>+</code>. Again, we will include a variety of quick tests for class and the number of observations, and add another about missing values. We may not have any idea what the coefficient of rain should be, but if we did not expect it to make them faster, then we could also add a test of that with a wide interval.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sim_run_data<span class="sc">$</span>marathon_time) <span class="sc">==</span> <span class="st">"numeric"</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sim_run_data<span class="sc">$</span>five_km_time) <span class="sc">==</span> <span class="st">"numeric"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sim_run_data<span class="sc">$</span>was_raining) <span class="sc">==</span> <span class="st">"character"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">all</span>(<span class="fu">complete.cases</span>(sim_run_data)),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(sim_run_data) <span class="sc">==</span> <span class="dv">100</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>sim_run_data_rain_model <span class="ot">&lt;-</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    marathon_time <span class="sc">~</span> five_km_time <span class="sc">+</span> was_raining,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">between</span>(</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  sim_run_data_rain_model<span class="sc">$</span>coefficients[<span class="dv">3</span>],</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="dv">20</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The result, in the second column of <a href="#tbl-modelsummaryruntimes">Table&nbsp;<span>14.3</span></a>, shows that when we compare individuals in our dataset who ran in the rain with those who did not, the ones in the rain tended to have a slower time. And this corresponds with what we expect if we look at a plot of the data (<a href="#fig-fivekmvsmarathonbinary-1">Figure&nbsp;<span>14.4 (a)</span></a>).</p>
<p>In addition to wanting to include additional explanatory variables, we may think that they are related to each another. For instance, maybe rain really matters if it is also humid that day. We are interested in the humidity and temperature, but also how those two variables interact (<a href="#fig-fivekmvsmarathonbinary-2">Figure&nbsp;<span>14.4 (b)</span></a>). We can do this by using <code>*</code> instead of <code>+</code> when we specify the model. When we interact variables in this way, then we almost always need to include the individual variables as well and <code>lm()</code> will do this by default. The result is contained in the third column of <a href="#tbl-modelsummaryruntimes">Table&nbsp;<span>14.3</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>minutes_slower_in_high_humidity <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>sim_run_data <span class="ot">&lt;-</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  sim_run_data <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">humidity =</span> <span class="fu">sample</span>(</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"High"</span>, <span class="st">"Low"</span>),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> number_of_observations,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">marathon_time =</span> <span class="fu">if_else</span>(</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>      humidity <span class="sc">==</span> <span class="st">"High"</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>      marathon_time <span class="sc">+</span> minutes_slower_in_high_humidity,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>      marathon_time</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">weather_conditions =</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        was_raining <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> humidity <span class="sc">==</span> <span class="st">"Low"</span> <span class="sc">~</span> <span class="st">"No rain, not humid"</span>,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        was_raining <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">&amp;</span> humidity <span class="sc">==</span> <span class="st">"Low"</span> <span class="sc">~</span> <span class="st">"Rain, not humid"</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        was_raining <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">&amp;</span> humidity <span class="sc">==</span> <span class="st">"High"</span> <span class="sc">~</span> <span class="st">"No rain, humid"</span>,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        was_raining <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">&amp;</span> humidity <span class="sc">==</span> <span class="st">"High"</span> <span class="sc">~</span> <span class="st">"Rain, humid"</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>sim_run_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 5
   five_km_time marathon_time was_raining humidity weather_conditions
          &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;             
 1         20.4          152. No          Low      No rain, not humid
 2         16.8          134. No          Low      No rain, not humid
 3         22.3          198. No          Low      No rain, not humid
 4         19.7          166. No          Low      No rain, not humid
 5         15.6          163. No          Low      No rain, not humid
 6         21.1          168. No          Low      No rain, not humid
 7         17            131. No          Low      No rain, not humid
 8         18.6          150. No          Low      No rain, not humid
 9         17.4          160. No          High     No rain, humid    
10         17.8          147. No          Low      No rain, not humid
# … with 90 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>base <span class="ot">&lt;-</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  sim_run_data <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> five_km_time, <span class="at">y =</span> marathon_time)) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="st">"y ~ x"</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Five-kilometer time (minutes)"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Marathon time (minutes)"</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>base <span class="sc">+</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> was_raining)) <span class="sc">+</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Was raining"</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>base <span class="sc">+</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> weather_conditions)) <span class="sc">+</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Weather conditions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-fivekmvsmarathonbinary" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathonbinary-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-fivekmvsmarathonbinary-1.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathonbinary" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Only whether it was raining</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-fivekmvsmarathonbinary-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-fivekmvsmarathonbinary-2.png" class="img-fluid figure-img" data-ref-parent="fig-fivekmvsmarathonbinary" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Whether it was raining and the level of humidity</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure 14.4: Simple linear regression with simulated data on the time someone takes to run five kilometers and a marathon, depending on the weather</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sim_run_data<span class="sc">$</span>marathon_time) <span class="sc">==</span> <span class="st">"numeric"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sim_run_data<span class="sc">$</span>five_km_time) <span class="sc">==</span> <span class="st">"numeric"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sim_run_data<span class="sc">$</span>was_raining) <span class="sc">==</span> <span class="st">"character"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(sim_run_data<span class="sc">$</span>humidity) <span class="sc">==</span> <span class="st">"character"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">all</span>(<span class="fu">complete.cases</span>(sim_run_data)),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(sim_run_data) <span class="sc">==</span> <span class="dv">100</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(sim_run_data<span class="sc">$</span>humidity) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"High"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>sim_run_data_rain_and_humidity_model <span class="ot">&lt;-</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    marathon_time <span class="sc">~</span> five_km_time <span class="sc">+</span> was_raining <span class="sc">*</span> humidity,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Five km only"</span> <span class="ot">=</span> sim_run_data_first_model,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Add rain"</span> <span class="ot">=</span> sim_run_data_rain_model,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Add humidity"</span> <span class="ot">=</span> sim_run_data_rain_and_humidity_model</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-modelsummaryruntimes" class="anchored">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"><caption>Table 14.3:  Explaining marathon times based on five-kilometer run times and weather features </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Five km only </th>
   <th style="text-align:center;"> Add rain </th>
   <th style="text-align:center;"> Add humidity </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 8.24 </td>
   <td style="text-align:center;"> 9.10 </td>
   <td style="text-align:center;"> 17.06 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (8.96) </td>
   <td style="text-align:center;"> (9.01) </td>
   <td style="text-align:center;"> (10.31) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> five_km_time </td>
   <td style="text-align:center;"> 7.94 </td>
   <td style="text-align:center;"> 7.87 </td>
   <td style="text-align:center;"> 7.73 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.41) </td>
   <td style="text-align:center;"> (0.42) </td>
   <td style="text-align:center;"> (0.42) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> was_rainingYes </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 9.17 </td>
   <td style="text-align:center;"> 20.60 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (4.50) </td>
   <td style="text-align:center;"> (9.62) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> humidityLow </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −5.74 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (4.96) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> was_rainingYes × humidityLow </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −14.58 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (10.74) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 100 </td>
   <td style="text-align:center;"> 100 </td>
   <td style="text-align:center;"> 100 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:center;"> 0.795 </td>
   <td style="text-align:center;"> 0.802 </td>
   <td style="text-align:center;"> 0.812 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 Adj. </td>
   <td style="text-align:center;"> 0.793 </td>
   <td style="text-align:center;"> 0.798 </td>
   <td style="text-align:center;"> 0.804 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 854.0 </td>
   <td style="text-align:center;"> 855.1 </td>
   <td style="text-align:center;"> 854.8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 861.8 </td>
   <td style="text-align:center;"> 865.5 </td>
   <td style="text-align:center;"> 870.4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> −423.993 </td>
   <td style="text-align:center;"> −423.554 </td>
   <td style="text-align:center;"> −421.405 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> F </td>
   <td style="text-align:center;"> 380.262 </td>
   <td style="text-align:center;"> 196.234 </td>
   <td style="text-align:center;"> 102.500 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 16.79 </td>
   <td style="text-align:center;"> 16.72 </td>
   <td style="text-align:center;"> 16.36 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>There are a variety of threats to the validity of linear regression estimates, and aspects to think about. We need to address these when we use it, and usually graphs and associated text are sufficient to assuage most of them. Aspects of concern include:</p>
<ol type="1">
<li>Linearity of explanatory variables. We are concerned with whether the independent variables enter in a linear way. Sometimes if we are worried that there might be a multiplicative relationship between the explanatory variables, rather than an additive one, then we may consider a logarithmic transform. We can usually be convinced there is enough linearity in our explanatory variables for our purposes by using graphs of the variables.</li>
<li>Independence of errors. We are concerned that the errors are not correlated. For instance, if we are interested in weather-related measurement such as average daily temperature, then we may find a pattern because the temperature on one day is likely similar to the temperature on another. We can be convinced that we have satisfied this condition by making graphs of estimated compared with actual outcomes, such as <a href="#fig-fivekmvsmarathonresids-3">Figure&nbsp;<span>14.3 (c)</span></a>.</li>
<li>Homoscedasticity of errors. We are concerned that the errors are not becoming systematically larger or smaller throughout the sample. If that is happening, then we term it heteroscedasticity. Again, graphs of errors, particular by order, such as <a href="#fig-fivekmvsmarathonresids-2">Figure&nbsp;<span>14.3 (b)</span></a>, are used to convince us of this.</li>
<li>Normality of errors. We are concerned that our errors are normally distributed when we are interested in making individual-level predictions.</li>
<li>Outliers and other high-impact observations. Finally, we might be worried that our results are being driven by a handful of observations. For instance, thinking back to <a href="06-static_communication.html"><span>Chapter&nbsp;6</span></a> and Anscombe’s Quartet, we notice that linear regression estimates would be heavily influenced by the inclusion of one or two particular points. We can become comfortable with this by considering our analysis on various sub-sets</li>
</ol>
<p>Those aspects are statistical concerns and relate to whether the model is working. The most important threat to validity and hence the aspect that must be addressed at some length, is speaking to the fact that this model is appropriate to the circumstances and addresses the research question at hand.</p>
</section>
<section id="two-cultures" class="level2" data-number="14.4">
<h2 data-number="14.4" class="anchored" data-anchor-id="two-cultures"><span class="header-section-number">14.4</span> Two cultures</h2>
<p><span class="citation" data-cites="breiman2001statistical">Breiman (<a href="99-references.html#ref-breiman2001statistical" role="doc-biblioref">2001</a>)</span> describes two cultures of statistical modelling: one focused on prediction and the other on inference. At the time, and speaking in generalizations, various disciplines tended to focus on either inference or prediction. The rise of data science has meant there is now a need to be comfortable with both <span class="citation" data-cites="Neufeld2021">(<a href="99-references.html#ref-Neufeld2021" role="doc-biblioref">Neufeld and Witten 2021</a>)</span>. The two cultures are being brought closer together. And there is an overlap and interaction between prediction and inference. But their separate evolution means there are still considerable cultural differences.</p>
<p>In this book we use <code>tidymodels</code> when we are interested in prediction. And when we are focused on inference, instead, we use the probabilistic programming language Stan, and interface with it using <code>rstanarm</code> <span class="citation" data-cites="citerstanarm">(<a href="99-references.html#ref-citerstanarm" role="doc-biblioref">Goodrich et al. 2020</a>)</span>. This is slightly simplistic—we could do prediction with Bayesian models, and we could use Stan within <code>tidymodels</code>. But, for the sake of simplicity and clarity, we keep these separated in this way for this book. It is important to be conversant in both ecosystems and cultures.</p>
<section id="prediction" class="level3" data-number="14.4.1">
<h3 data-number="14.4.1" class="anchored" data-anchor-id="prediction"><span class="header-section-number">14.4.1</span> Prediction</h3>
<p>When we are focused on prediction, we will often want to fit many models. One way to do this is to copy and paste code many times. There is nothing wrong with that. And that is the way that most people get started. But a better approach:</p>
<ol type="1">
<li>scales more easily;</li>
<li>enables us to think carefully about over-fitting; and</li>
<li>adds model evaluation.</li>
</ol>
<p>The use of <code>tidymodels</code> <span class="citation" data-cites="citeTidymodels">(<a href="99-references.html#ref-citeTidymodels" role="doc-biblioref">Kuhn and Wickham 2020</a>)</span> satisfies these criteria by providing a coherent grammar that allows us to easily fit a variety of models. Like the <code>tidyverse</code>, it is a package of packages.</p>
<p>By way of illustration, we want to estimate the following model for the simulated running data:</p>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &amp;= \beta_0 +\beta_1x_i
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(y_i\)</span> refers to the marathon time of some individual <span class="math inline">\(i\)</span> and <span class="math inline">\(x_i\)</span> refers to their five-kilometer time.</p>
<p>As we are focused on prediction, we are worried about over-fitting our data, which would limit our ability to make claims about other datasets. One way to partially address this is to split our dataset in two using <code>initial_split()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>sim_run_data_split <span class="ot">&lt;-</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">initial_split</span>(</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> <span class="fl">0.80</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>sim_run_data_split</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Training/Testing/Total&gt;
&lt;80/20/100&gt;</code></pre>
</div>
</div>
<p>Having split the data, we then create training and test datasets with <code>training()</code> and <code>testing()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>sim_run_data_train <span class="ot">&lt;-</span> <span class="fu">training</span>(sim_run_data_split)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>sim_run_data_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(sim_run_data_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have placed 80 per cent of our dataset into the training dataset. We will use that to estimate the parameters of our model. We have kept the remaining 20 per cent of it back, and we will use that to evaluate our model. Why might we do this? Our concern is the bias-variance trade-off, which haunts all aspects of modelling. We are concerned that our results may be too particular to the dataset that we have, such that they are not applicable to other datasets. To take an extreme example, consider a dataset with ten observations. We could come up with a model that perfectly hits those observations. But when we took that model to other datasets, even those generated by the same underlying process, it would not be accurate.</p>
<p>One way to deal with this concern is to split the data in this way. We use the training data to inform our estimates of the coefficients, and then using the test data, to evaluate the model. A model that too closely matched the data in the training data would not do well in the test data, because it would be too specific to the training data. The use of this test-training split enables us the opportunity to build an appropriate model.</p>
<p>It is more difficult to do this separation appropriately than one might initially think. We want to avoid the situation where aspects of the test dataset are present in the training dataset because this inappropriately telegraphs what is about to happen. This is called data leakage. But if we consider data cleaning and preparation, which likely involves the entire dataset, it may be that some features of each are influencing each other. <span class="citation" data-cites="kapoornarayanan2022">Kapoor and Narayanan (<a href="99-references.html#ref-kapoornarayanan2022" role="doc-biblioref">2022</a>)</span> find extensive data leakage in applications of machine learning that could invalidate much research.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Shoulders of giants
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dr Daniela Witten is the Dorothy Gilford Endowed Chair of Mathematical Statistics and Professor of Statistics &amp; Biostatistics at the University of Washington. After taking a PhD in Statistics from Stanford University in 2010, she joined the University of Washington as an assistant professor. She was promoted to full professor in 2018. One active area of her research is double-dipping which is focused on the effect of sample splitting <span class="citation" data-cites="selectiveinference">(<a href="99-references.html#ref-selectiveinference" role="doc-biblioref">Gao, Bien, and Witten 2020</a>)</span>. She is an author of the influential <span class="citation" data-cites="islr">James et al. (<a href="99-references.html#ref-islr" role="doc-biblioref">2021</a>)</span>. She was appointed a Fellow of the American Statistical Association in 2020 and awarded the COPSS Presidents’ Award in 2022.</p>
</div>
</div>
<p>To use <code>tidymodels</code> we first specify that we are interested in linear regression with <code>linear_reg()</code>. We then specify the type of linear regression, in this case multiple linear regression, with <code>set_engine()</code>. Finally, we specify the model with <code>fit()</code>. While this is considerable more infrastructure than the base R approach detailed above, it advantage of this approach is that it can be used to fit many models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>sim_run_data_first_model_tidymodels <span class="ot">&lt;-</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">"lm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    marathon_time <span class="sc">~</span> five_km_time <span class="sc">+</span> was_raining,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data_train</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The estimated coefficients are summarized in the first column of <a href="#tbl-modelsummarybayesbetter">Table&nbsp;<span>14.4</span></a>. For instance, we find that on average in our dataset, five-kilometer run times that are one minute longer are associated with marathon times that are 7.5 minutes longer. We have changed to reporting confidence intervals because this will allow us to have both frequentist and Bayesian approaches in the one table.</p>
</section>
<section id="inference" class="level3" data-number="14.4.2">
<h3 data-number="14.4.2" class="anchored" data-anchor-id="inference"><span class="header-section-number">14.4.2</span> Inference</h3>
<p>To use Bayesian approaches we must specify a starting point. This is a guess for what we think the distribution of the coefficients should look like and is called a prior. This is another reason for the workflow advocated in this book; the simulation stage leads directly to priors. We will again specify the model that we are interested in, but this time we include priors.</p>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &amp;= \beta_0 +\beta_1x_i\\
\beta_0 &amp;\sim \mbox{Normal}(0, 2.5) \\
\beta_1 &amp;\sim \mbox{Normal}(0, 2.5) \\
\sigma &amp;\sim \mbox{Exponential}(1) \\
\end{aligned}
\]</span></p>
<p>Another aspect that is different between Bayesian approaches and the way we have been doing modelling to this point, is that Bayesian models will usually take longer to run. Because of this, it can be useful to run the model, either within the Quarto document or in a separate R script, and then save it with <code>saveRDS()</code>. With sensible Quarto chunk options for “eval” and “echo” (see <a href="04-workflow.html"><span>Chapter&nbsp;4</span></a>), the model can then be read into the Quarto document with <code>readRDS()</code> rather than being run every time the paper is compiled. In this way, the model delay is only imposed once for a given model. It can also be useful to add <code>beep()</code> from <code>beepr</code> <span class="citation" data-cites="beepr">(<a href="99-references.html#ref-beepr" role="doc-biblioref">Bååth 2018</a>)</span> to the end of the model, to get an audio notification when the model is done.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>sim_run_data_first_model_rstanarm <span class="ot">&lt;-</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stan_glm</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> marathon_time <span class="sc">~</span> five_km_time <span class="sc">+</span> was_raining,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">normal</span>(<span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="fl">2.5</span>),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_intercept =</span> <span class="fu">normal</span>(<span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="fl">2.5</span>),</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_aux =</span> <span class="fu">exponential</span>(<span class="at">rate =</span> <span class="dv">1</span>),</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">853</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>beepr<span class="sc">::</span><span class="fu">beep</span>()</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  sim_run_data_first_model_rstanarm,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"sim_run_data_first_model_rstanarm.rds"</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>sim_run_data_first_model_rstanarm <span class="ot">&lt;-</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readRDS</span>(<span class="at">file =</span> <span class="st">"sim_run_data_first_model_rstanarm.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<p>We use <code>stan_glm()</code> with the ‘gaussian()’ family to specify multiple linear regression and the model is written in the same way as base R and <code>tidymodels</code>. We have explicitly added the default priors, although strictly this is not necessary.</p>
<p>The estimation results, which are in the second column of <a href="#tbl-modelsummarybayesbetter">Table&nbsp;<span>14.4</span></a>, are not quite what we expect. For instance, the comparison between individuals is estimated to be around three, which seems low given the ratio of a five-kilometer run to marathon distance.</p>
<p>The issue of picking priors is a challenging one and the subject of extensive research. For the purposes of this book, using the <code>rstanarm</code> defaults is fine. But even if they are just the default, priors should be explicitly specified in the model and included in the function. This is to make it clear to others what has been done. We could use <code>default_prior_intercept()</code> and <code>default_prior_coef()</code> to find the default priors in <code>rstanarm</code> and then explicitly include them in the model.</p>
<p>It is normal to find it difficult to know what prior to specify. Getting started by adapting someone else’s <code>rstanarm</code> code is perfectly fine. If they have not specified their priors, then we can use the helper function <code>prior_summary()</code>, to find out which priors were used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_summary</span>(sim_run_data_first_model_rstanarm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Priors for model 'sim_run_data_first_model_rstanarm' 
------
Intercept (after predictors centered)
 ~ normal(location = 0, scale = 2.5)

Coefficients
 ~ normal(location = [0,0], scale = [2.5,2.5])

Auxiliary (sigma)
 ~ exponential(rate = 1)
------
See help('prior_summary.stanreg') for more details</code></pre>
</div>
</div>
<p>We are interested to understand what the priors imply before we involve any data. We do this by implementing prior predictive checks. This means simulating from the priors to look at what they imply about the coefficients. This process is no different to all the other simulation that we have done to this point.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>number_draws <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma =</span> <span class="fu">rep</span>(<span class="fu">rexp</span>(<span class="at">n =</span> number_draws, <span class="at">rate =</span> <span class="dv">1</span>), <span class="at">times =</span> <span class="dv">16</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_0 =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> number_draws, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">2.5</span>), <span class="at">times =</span> <span class="dv">16</span>),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_1 =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> number_draws, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">2.5</span>), <span class="at">times =</span> <span class="dv">16</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">five_km_time =</span> <span class="fu">rep</span>(<span class="dv">15</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">each =</span> number_draws),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mu =</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> five_km_time</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">marathon_time =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>priors <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> marathon_time)) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>priors <span class="sc">|&gt;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> five_km_time, <span class="at">y =</span> marathon_time)) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-worstmodelever" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-worstmodelever-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-worstmodelever-1.png" class="img-fluid figure-img" data-ref-parent="fig-worstmodelever" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Distribution of implied marathon times</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-worstmodelever-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-worstmodelever-2.png" class="img-fluid figure-img" data-ref-parent="fig-worstmodelever" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Relationship between 5km and marathon times</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure 14.5: Some implications from the priors that were used</figcaption><p></p>
</figure>
</div>
</div>
<p><a href="#fig-worstmodelever">Figure&nbsp;<span>14.5</span></a> suggests our model has been poorly constructed. Not only are there world record marathon times, but there are also negative marathon times! One issue is that our prior for <span class="math inline">\(\beta_1\)</span> does not take in all the information that we know. We know that a marathon is about eight times longer than a five-kilometer run and so we could center the prior for <span class="math inline">\(\beta_1\)</span> around that. Our re-specified model is:</p>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &amp;= \beta_0 +\beta_1x_i\\
\beta_0 &amp;\sim \mbox{Normal}(0, 2.5) \\
\beta_1 &amp;\sim \mbox{Normal}(8, 2.5) \\
\sigma &amp;\sim \mbox{Exponential}(1) \\
\end{aligned}
\]</span></p>
<p>And we can see from prior prediction checks that it seems more reasonable (<a href="#fig-secondworstmodelever">Figure&nbsp;<span>14.6</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>number_draws <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>updated_priors <span class="ot">&lt;-</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma =</span> <span class="fu">rep</span>(<span class="fu">rexp</span>(<span class="at">n =</span> number_draws, <span class="at">rate =</span> <span class="dv">1</span>), <span class="at">times =</span> <span class="dv">16</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_0 =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> number_draws, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>), <span class="at">times =</span> <span class="dv">16</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_1 =</span> <span class="fu">rep</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> number_draws, <span class="at">mean =</span> <span class="dv">8</span>, <span class="at">sd =</span> <span class="dv">3</span>), <span class="at">times =</span> <span class="dv">16</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">five_km_time =</span> <span class="fu">rep</span>(<span class="dv">15</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">each =</span> number_draws),</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">mu =</span> beta_0 <span class="sc">+</span> beta_1 <span class="sc">*</span> five_km_time</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">marathon_time =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>updated_priors <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> marathon_time)) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>updated_priors <span class="sc">|&gt;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> five_km_time, <span class="at">y =</span> marathon_time)) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-secondworstmodelever" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-secondworstmodelever-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-secondworstmodelever-1.png" class="img-fluid figure-img" data-ref-parent="fig-secondworstmodelever" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Distribution of implied marathon times</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-secondworstmodelever-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-secondworstmodelever-2.png" class="img-fluid figure-img" data-ref-parent="fig-secondworstmodelever" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Relationship between 5km and marathon times</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure 14.6: Updated priors</figcaption><p></p>
</figure>
</div>
</div>
<p>Additionally, <code>rstanarm</code> can help to improve the specified priors, by scaling them based on the data. Specify the prior that you think is reasonable and include it in the function, but also include “autoscale = TRUE”, and <code>rstanarm</code> will adjust the scale. When we re-run our model with these updated priors and allowing auto-scaling we get much better results, which are in the third column of <a href="#tbl-modelsummarybayesbetter">Table&nbsp;<span>14.4</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>sim_run_data_second_model_rstanarm <span class="ot">&lt;-</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stan_glm</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> marathon_time <span class="sc">~</span> five_km_time <span class="sc">+</span> was_raining,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> sim_run_data,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">normal</span>(<span class="at">location =</span> <span class="dv">8</span>, <span class="at">scale =</span> <span class="fl">2.5</span>, <span class="at">autoscale =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_intercept =</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">2.5</span>, <span class="at">autoscale =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_aux =</span> <span class="fu">exponential</span>(<span class="at">rate =</span> <span class="dv">1</span>, <span class="at">autoscale =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">853</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  sim_run_data_second_model_rstanarm,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"sim_run_data_second_model_rstanarm.rds"</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tidymodels"</span> <span class="ot">=</span> sim_run_data_first_model_tidymodels,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rstanarm"</span> <span class="ot">=</span> sim_run_data_first_model_rstanarm,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rstanarm better priors"</span> <span class="ot">=</span> sim_run_data_second_model_rstanarm</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"conf.int"</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-modelsummarybayesbetter" class="anchored">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"><caption>Table 14.4:  Forecasting and explanatory models of marathon times based on five-kilometer run times </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> tidymodels </th>
   <th style="text-align:center;"> rstanarm </th>
   <th style="text-align:center;"> rstanarm better priors </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 16.629 </td>
   <td style="text-align:center;"> −67.503 </td>
   <td style="text-align:center;"> 8.656 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> [−4.639, 37.898] </td>
   <td style="text-align:center;"> [−143.356, 13.172] </td>
   <td style="text-align:center;"> [−8.984, 26.452] </td>
  </tr>
  <tr>
   <td style="text-align:left;"> five_km_time </td>
   <td style="text-align:center;"> 7.506 </td>
   <td style="text-align:center;"> 3.465 </td>
   <td style="text-align:center;"> 7.902 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> [6.522, 8.489] </td>
   <td style="text-align:center;"> [−0.241, 7.016] </td>
   <td style="text-align:center;"> [7.070, 8.704] </td>
  </tr>
  <tr>
   <td style="text-align:left;"> was_rainingYes </td>
   <td style="text-align:center;"> 13.183 </td>
   <td style="text-align:center;"> 0.116 </td>
   <td style="text-align:center;"> 9.232 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> [1.826, 24.539] </td>
   <td style="text-align:center;box-shadow: 0px 1px"> [−4.845, 4.901] </td>
   <td style="text-align:center;box-shadow: 0px 1px"> [0.152, 18.559] </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 80 </td>
   <td style="text-align:center;"> 100 </td>
   <td style="text-align:center;"> 100 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:center;"> 0.776 </td>
   <td style="text-align:center;"> 0.015 </td>
   <td style="text-align:center;"> 0.797 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 Adj. </td>
   <td style="text-align:center;"> 0.771 </td>
   <td style="text-align:center;"> −1.000 </td>
   <td style="text-align:center;"> 0.790 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 691.8 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 701.4 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −678.336 </td>
   <td style="text-align:center;"> −425.193 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ELPD </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −679.5 </td>
   <td style="text-align:center;"> −429.0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ELPD s.e. </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 3.3 </td>
   <td style="text-align:center;"> 8.9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LOOIC </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 1359.0 </td>
   <td style="text-align:center;"> 858.0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LOOIC s.e. </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 6.6 </td>
   <td style="text-align:center;"> 17.8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> WAIC </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 1359.0 </td>
   <td style="text-align:center;"> 857.9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 17.37 </td>
   <td style="text-align:center;"> 175.52 </td>
   <td style="text-align:center;"> 16.85 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As we used the “auto = TRUE” option, it can be helpful to look at how the priors were updated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_summary</span>(sim_run_data_second_model_rstanarm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Priors for model 'sim_run_data_second_model_rstanarm' 
------
Intercept (after predictors centered)
  Specified prior:
    ~ normal(location = 0, scale = 2.5)
  Adjusted prior:
    ~ normal(location = 0, scale = 95)

Coefficients
  Specified prior:
    ~ normal(location = [8,8], scale = [2.5,2.5])
  Adjusted prior:
    ~ normal(location = [8,8], scale = [ 22.64,245.52])

Auxiliary (sigma)
  Specified prior:
    ~ exponential(rate = 1)
  Adjusted prior:
    ~ exponential(rate = 0.026)
------
See help('prior_summary.stanreg') for more details</code></pre>
</div>
</div>
<p>Having built a Bayesian model, we may want to look at what the posterior predicts (<a href="#fig-ppcheckandposteriorvsprior">Figure&nbsp;<span>14.7</span></a>). The idea is that if the model is doing a good job of fitting the data, then the posterior should be able to be used to simulate data that are like the actual data <span class="citation" data-cites="bayesianworkflow">(<a href="99-references.html#ref-bayesianworkflow" role="doc-biblioref">Gelman et al. 2020</a>)</span>. We can implement a posterior predictive check with <code>pp_check()</code> (<a href="#fig-ppcheckandposteriorvsprior-1">Figure&nbsp;<span>14.7 (a)</span></a>). And we can compare the posterior with the prior with <code>posterior_vs_prior()</code> (<a href="#fig-ppcheckandposteriorvsprior-2">Figure&nbsp;<span>14.7 (b)</span></a>). Helpfully, <code>pp_check()</code> and <code>posterior_vs_prior()</code> return <code>ggplot</code> objects so we can modify the look of them in the normal way we manipulate graphs. These checks and discussion would typically just be briefly mentioned in the main content of a paper, with all the detail and graphs added to a dedicated appendix.</p>
<div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(sim_run_data_second_model_rstanarm) <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_vs_prior</span>(sim_run_data_second_model_rstanarm) <span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-ppcheckandposteriorvsprior" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ppcheckandposteriorvsprior-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-ppcheckandposteriorvsprior-1.png" class="img-fluid figure-img" data-ref-parent="fig-ppcheckandposteriorvsprior" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Posterior prediction check</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ppcheckandposteriorvsprior-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-ppcheckandposteriorvsprior-2.png" class="img-fluid figure-img" data-ref-parent="fig-ppcheckandposteriorvsprior" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Comparing the posterior with the prior</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure 14.7: Examining how the model fits the data</figcaption><p></p>
</figure>
</div>
</div>
</section>
</section>
<section id="logistic-regression" class="level2" data-number="14.5">
<h2 data-number="14.5" class="anchored" data-anchor-id="logistic-regression"><span class="header-section-number">14.5</span> Logistic regression</h2>
<p>Linear regression is a useful way to come to better understand our data. But it assumes a continuous outcome variable that can take any number on the real line. We would like some way to use this same machinery when we cannot satisfy this condition. We turn to logistic and Poisson regression for binary and count outcome variables, respectively, noting they are still linear models, because the independent variables enter in a linear fashion.</p>
<p>Logistic regression, and its close variants, are useful in a variety of settings, from elections <span class="citation" data-cites="wang2015forecasting">(<a href="99-references.html#ref-wang2015forecasting" role="doc-biblioref">Wang et al. 2015</a>)</span> through to horse racing <span class="citation" data-cites="chellel2018gambler boltonruth">(<a href="99-references.html#ref-chellel2018gambler" role="doc-biblioref">Chellel 2018</a>; <a href="99-references.html#ref-boltonruth" role="doc-biblioref">Bolton and Chapman 1986</a>)</span>. We use logistic regression when the dependent variable is a binary outcome, such as 0 or 1. Although the presence of a binary outcome variable may sound limiting, there are a lot of circumstances in which the outcome either naturally falls into this situation or can be adjusted into it.</p>
<p>One reason to use logistic regression is that we will be modelling a probability and so it will be bounded between 0 and 1. Whereas with linear regression we may end up with values outside this. The foundation of logistic regression is the logit function:</p>
<p><span class="math display">\[
\mbox{logit}(x) = \log\left(\frac{x}{1-x}\right).
\]</span></p>
<p>This will transpose values between 0 and 1, onto the real line. For instance, <code>logit(0.1) = -2.2</code>, <code>logit(0.5) = 0</code>, and <code>logit(0.9) = 2.2</code>.</p>
<p>To illustrate logistic regression, we will simulate data on whether it is day or night, based on the number of cars on the road.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>day_or_night <span class="ot">&lt;-</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">number_of_cars =</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">noise =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">10</span>),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_night =</span> <span class="fu">if_else</span>(number_of_cars <span class="sc">+</span> noise <span class="sc">&gt;</span> <span class="dv">50</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">number_of_cars =</span> <span class="fu">round</span>(number_of_cars)) <span class="sc">|&gt;</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>noise)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>day_or_night</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 2
   number_of_cars is_night
            &lt;dbl&gt;    &lt;dbl&gt;
 1             36        0
 2             12        0
 3             48        1
 4             32        0
 5              4        0
 6             40        0
 7             13        0
 8             24        0
 9             16        0
10             19        0
# … with 990 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p>We can use <code>glm()</code> from base R to do a quick estimation. In this case we will try to work out whether it is day or night, based on the number of cars we can see. We are interested in estimating <a href="#eq-logisticexample">Equation&nbsp;<span>14.2</span></a>:</p>
<p><span id="eq-logisticexample"><span class="math display">\[
\mbox{Pr}(y_i=1) = \mbox{logit}^{-1}\left(\beta_0+\beta_1 x_i\right).
\tag{14.2}\]</span></span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(day_or_night<span class="sc">$</span>is_night) <span class="sc">==</span> <span class="st">"numeric"</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(day_or_night<span class="sc">$</span>number_of_cars) <span class="sc">==</span> <span class="st">"numeric"</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(day_or_night) <span class="sc">==</span> <span class="dv">1000</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>day_or_night_model <span class="ot">&lt;-</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    is_night <span class="sc">~</span> number_of_cars,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> day_or_night,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The results of the estimation are in the first column of <a href="#tbl-modelsummarylogistic">Table&nbsp;<span>14.6</span></a>. The estimated coefficient on the number of cars is 0.19. We have switched to confidence intervals because they have a Bayesian equivalent.</p>
<p>One reason that logistic regression can be a bit tricky initially is because the coefficients take a bit of work to interpret. The estimate of 0.19 is the average change in the log odds of our observations with one extra car. The coefficient is positive which means an increase, but as it is non-linear, if we want a particular change, then this will be different for different observations.</p>
<p>We can translate our estimate into the probability of it being night, for a given number of cars. <code>predictions()</code> from <code>marginaleffects</code> <span class="citation" data-cites="marginaleffects">(<a href="99-references.html#ref-marginaleffects" role="doc-biblioref">Arel-Bundock 2022</a>)</span> can be used to add the implied probability that it is night for each observation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>day_or_night_predictions <span class="ot">&lt;-</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predictions</span>(day_or_night_model) <span class="sc">|&gt;</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>day_or_night_predictions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 8
   rowid type     predicted std.error  conf.low conf.high is_night number_of_c…¹
   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;
 1     1 response  0.0566   0.0136    0.0352     0.0898          0            36
 2     2 response  0.000631 0.000363  0.000204   0.00195         0            12
 3     3 response  0.369    0.0331    0.307      0.436           1            48
 4     4 response  0.0273   0.00808   0.0152     0.0485          0            32
 5     5 response  0.000138 0.0000952 0.0000359  0.000533        0             4
 6     6 response  0.114    0.0209    0.0786     0.161           0            40
 7     7 response  0.000763 0.000428  0.000254   0.00229         0            13
 8     8 response  0.00612  0.00249   0.00275    0.0136          0            24
 9     9 response  0.00135  0.000700  0.000486   0.00372         0            16
10    10 response  0.00238  0.00114   0.000932   0.00605         0            19
# … with 990 more rows, and abbreviated variable name ¹​number_of_cars
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p>And we can then graph the probability that our model implies, for each observation, of it being night (<a href="#fig-dayornightprobs">Figure&nbsp;<span>14.8</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>day_or_night_predictions <span class="sc">|&gt;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_night =</span> <span class="fu">factor</span>(is_night)) <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> number_of_cars,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> predicted,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> is_night</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.01</span>, <span class="at">height =</span> <span class="fl">0.01</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of cars that were seen"</span>,</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimated probability it is night"</span>,</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Was actually night"</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-dayornightprobs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-dayornightprobs-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 14.8: Logistic regression probability results with simulated data of whether it is day or night based on the number of cars that are around</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The marginal effect at each observation is of interest because it provides a sense of how this probability is changing. It enables us to say that at the mean (which in this case is if we were to see 50 cars) the probability of it being night, increases by a little over four per cent if we were to see another one (<a href="#tbl-marginaleffectcar">Table&nbsp;<span>14.5</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">marginaleffects</span>(day_or_night_model, <span class="at">newdata =</span> <span class="st">"mean"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, dydx, std.error) <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Term"</span>, <span class="st">"Slope"</span>, <span class="st">"Standard error"</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-marginaleffectcar" class="anchored">

<table><caption>Table 14.5:  Marginal effect of another car on the probability that it is day, at the mean </caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Term </th>
   <th style="text-align:right;"> Slope </th>
   <th style="text-align:right;"> Standard error </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> number_of_cars </td>
   <td style="text-align:right;"> 0.0471838 </td>
   <td style="text-align:right;"> 0.0035216 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We could use <code>tidymodels</code> to run this if we wanted. To do that, we first need to change the class of our dependent variable into a factor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>day_or_night <span class="ot">&lt;-</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  day_or_night <span class="sc">|&gt;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_night =</span> <span class="fu">as_factor</span>(is_night))</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>day_or_night_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(day_or_night, <span class="at">prop =</span> <span class="fl">0.80</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>day_or_night_train <span class="ot">&lt;-</span> <span class="fu">training</span>(day_or_night_split)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>day_or_night_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(day_or_night_split)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(day_or_night_train<span class="sc">$</span>is_night) <span class="sc">==</span> <span class="st">"factor"</span>,</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(day_or_night_train<span class="sc">$</span>number_of_cars) <span class="sc">==</span> <span class="st">"numeric"</span>,</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(day_or_night_train) <span class="sc">==</span> <span class="dv">800</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>day_or_night_tidymodels <span class="ot">&lt;-</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>(<span class="at">mode =</span> <span class="st">"classification"</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    is_night <span class="sc">~</span> number_of_cars,</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> day_or_night_train</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As before, we can make a graph of the actual results compared with our estimates. But one nice aspect of this is that we could use our test dataset to evaluate our model’s forecasting ability more thoroughly, for instance through a confusion matrix, which specifies the count of each prediction by what the truth was. We find that the model does well on the held-out dataset. There were 90 observations where the model predicted it was day, and it was actually day, and 95 where the model predicted it was night, and it was night. It was wrong for 15 observations, and these were split across seven where it forecast night, but it was day, and eight where it was the opposite case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>day_or_night_tidymodels <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> day_or_night_test) <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(day_or_night_test) <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> is_night, <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction  0  1
         0 90  8
         1  7 95</code></pre>
</div>
</div>
<p>We might be interested in inference, and so want to build a Bayesian model using <code>rstanarm</code>. Again, we will specify priors for our model, but use the default priors that <code>rstanarm</code> uses:</p>
<p><span class="math display">\[
\begin{aligned}
\mbox{Pr}(y_i=1) &amp; = \mbox{logit}^{-1}\left(\beta_0+\beta_1 x_i\right)\\
\beta_0 &amp; \sim \mbox{Normal}(0, 2.5)\\
\beta_1 &amp; \sim \mbox{Normal}(0, 2.5)
\end{aligned}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(day_or_night<span class="sc">$</span>is_night) <span class="sc">==</span> <span class="st">"factor"</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(day_or_night<span class="sc">$</span>number_of_cars) <span class="sc">==</span> <span class="st">"numeric"</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(day_or_night) <span class="sc">==</span> <span class="dv">1000</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>day_or_night_rstanarm <span class="ot">&lt;-</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stan_glm</span>(</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    is_night <span class="sc">~</span> number_of_cars,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> day_or_night,</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>),</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">normal</span>(<span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="fl">2.5</span>, <span class="at">autoscale =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_intercept =</span> <span class="fu">normal</span>(<span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="fl">2.5</span>, <span class="at">autoscale =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">853</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  day_or_night_rstanarm,</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"day_or_night_rstanarm.rds"</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can compare our different models (<a href="#tbl-modelsummarylogistic">Table&nbsp;<span>14.6</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"base R"</span> <span class="ot">=</span> day_or_night_model,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tidymodels"</span> <span class="ot">=</span> day_or_night_tidymodels,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rstanarm"</span> <span class="ot">=</span> day_or_night_rstanarm</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"conf.int"</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-modelsummarylogistic" class="anchored">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"><caption>Table 14.6:  Forecasting and explanatory models of whether it is day or night, based on the number of cars on the road </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> base R </th>
   <th style="text-align:center;"> tidymodels </th>
   <th style="text-align:center;"> rstanarm </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> −9.645 </td>
   <td style="text-align:center;"> −9.410 </td>
   <td style="text-align:center;"> −9.577 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> [−11.213, −8.286] </td>
   <td style="text-align:center;"> [−11.125, −7.945] </td>
   <td style="text-align:center;"> [−11.046, −8.186] </td>
  </tr>
  <tr>
   <td style="text-align:left;"> number_of_cars </td>
   <td style="text-align:center;"> 0.190 </td>
   <td style="text-align:center;"> 0.185 </td>
   <td style="text-align:center;"> 0.188 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> [0.164, 0.220] </td>
   <td style="text-align:center;box-shadow: 0px 1px"> [0.157, 0.218] </td>
   <td style="text-align:center;box-shadow: 0px 1px"> [0.162, 0.217] </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 1000 </td>
   <td style="text-align:center;"> 800 </td>
   <td style="text-align:center;"> 1000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> R2 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.782 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 359.8 </td>
   <td style="text-align:center;"> 299.0 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 369.6 </td>
   <td style="text-align:center;"> 308.3 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> −177.875 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −177.863 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> F </td>
   <td style="text-align:center;"> 174.307 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ELPD </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −179.7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ELPD s.e. </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 14.0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LOOIC </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 359.4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LOOIC s.e. </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 28.1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> WAIC </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 359.4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 0.24 </td>
   <td style="text-align:center;"> 0.24 </td>
   <td style="text-align:center;"> 0.24 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p><a href="#tbl-modelsummarylogistic">Table&nbsp;<span>14.6</span></a> makes it clear that each of the approaches is similar in this case. They agree on the direction of the effect of seeing an extra car on the probability of it being day. And even the magnitude of the effect is estimated to be similar.</p>
<section id="us-political-support" class="level3" data-number="14.5.1">
<h3 data-number="14.5.1" class="anchored" data-anchor-id="us-political-support"><span class="header-section-number">14.5.1</span> US political support</h3>
<p>One area where logistic regression is often used is political polling. In many cases voting implies the need for one preference ranking, and so issues are reduced, whether appropriately or not, to ‘support’ or ‘not support’.</p>
<p>As a reminder, the workflow we advocate in this book: Plan -&gt; Simulate -&gt; Acquire -&gt; Explore -&gt; Share. While the focus here is the exploration of data using linear models, we still need to do the other aspects. We begin by planning. In this case, we are interested in US political support. That means we are interested in a dataset with variables for who an individual voted for, and some of their characteristics, for instance, gender and education. A quick sketch of such a dataset is <a href="#fig-uspoliticalsupportsketch">Figure&nbsp;<span>14.9 (a)</span></a>. And we would like our model to average over these points. A quick sketch is <a href="#fig-uspoliticalsupportmodel">Figure&nbsp;<span>14.9 (b)</span></a>.</p>
<div id="fig-uspoliticalsuppor" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-bottom">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-uspoliticalsupportsketch" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/IMG_2054.png" class="img-fluid figure-img" data-ref-parent="fig-uspoliticalsuppor"></p>
<p></p><figcaption class="figure-caption">(a) Quick sketch of a dataset that could be used to examine US political support</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-uspoliticalsupportmodel" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/IMG_2055.png" class="img-fluid figure-img" data-ref-parent="fig-uspoliticalsuppor"></p>
<p></p><figcaption class="figure-caption">(b) Quick sketch of what we expect from the analysis before finalising either the data of the analysis</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure 14.9: Sketches of the expected dataset and analysis focus and clarify our thinking even if they will be updated later</figcaption><p></p>
</figure>
</div>
<p>We will simulate a dataset where the chance that a person supports Biden depends on their gender and education.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>number_of_observations <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>us_political_preferences <span class="ot">&lt;-</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">education =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">size =</span> number_of_observations, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">size =</span> number_of_observations, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">support_prob =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="dv">1</span> <span class="sc">/</span> (education <span class="sc">+</span> gender)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">supports_biden =</span> <span class="fu">sample</span>(</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"yes"</span>, <span class="st">"no"</span>),</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> <span class="fu">c</span>(support_prob, <span class="dv">1</span> <span class="sc">-</span> support_prob)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>support_prob, supports_biden, gender, education)</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>us_political_preferences</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 3
   education gender supports_biden
       &lt;int&gt;  &lt;int&gt; &lt;chr&gt;         
 1         4      2 yes           
 2         1      1 yes           
 3         5      2 yes           
 4         2      1 yes           
 5         3      2 yes           
 6         2      1 yes           
 7         5      2 yes           
 8         4      2 yes           
 9         1      2 yes           
10         4      1 no            
# … with 990 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p>We can use the 2020 Cooperative Election Study (CES) <span class="citation" data-cites="cooperativeelectionstudyus">(<a href="99-references.html#ref-cooperativeelectionstudyus" role="doc-biblioref">Schaffner, Ansolabehere, and Luks 2021</a>)</span>, which is a long-standing annual survey of US political opinion. In 2020, there were 61,000 respondents who completed the post-election survey. While the sampling methodology, detailed in <span class="citation" data-cites="guidetothe2020ces">Ansolabehere, Schaffner, and Luks (<a href="99-references.html#ref-guidetothe2020ces" role="doc-biblioref">2021, 13</a>)</span>, is not a perfect random sample and relies on matching, it is widely used and accepted approach that balances sampling concerns and cost.</p>
<p>We can access the CES using <code>get_dataframe_by_name()</code> from <code>dataverse</code> <span class="citation" data-cites="dataverse">(<a href="99-references.html#ref-dataverse" role="doc-biblioref">Kuriwaki, Beasley, and Leeper 2022</a>)</span>, which was an approach that was introduced in <a href="09-gather.html"><span>Chapter&nbsp;9</span></a> and <a href="12-store_and_share.html"><span>Chapter&nbsp;12</span></a>. We save the data that are of interest to us, and then refer to that saved dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dataverse)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>ces2020 <span class="ot">&lt;-</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_dataframe_by_name</span>(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="st">"CES20_Common_OUTPUT_vv.csv"</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dataset =</span> <span class="st">"10.7910/DVN/E9N6PH"</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">server =</span> <span class="st">"dataverse.harvard.edu"</span>,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> readr<span class="sc">::</span>read_csv</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(votereg, CC20_410, gender, educ)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(ces2020, <span class="st">"ces2020.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ces2020 <span class="ot">&lt;-</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ces2020.csv"</span>,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cols</span>(</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"votereg"</span> <span class="ot">=</span> <span class="fu">col_integer</span>(),</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CC20_410"</span> <span class="ot">=</span> <span class="fu">col_integer</span>(),</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"gender"</span> <span class="ot">=</span> <span class="fu">col_integer</span>(),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"educ"</span> <span class="ot">=</span> <span class="fu">col_integer</span>()</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>ces2020</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 61,000 × 4
   votereg CC20_410 gender  educ
     &lt;int&gt;    &lt;int&gt;  &lt;int&gt; &lt;int&gt;
 1       1        2      1     4
 2       2       NA      2     6
 3       1        1      2     5
 4       1        1      2     5
 5       1        4      1     5
 6       1        2      1     3
 7       2       NA      1     3
 8       1        2      2     3
 9       1        2      2     2
10       1        1      2     5
# … with 60,990 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p>When we look at the actual data, there are concerns that we did not anticipate in our sketches. We only want respondents who are registered to vote, and we are only interested in those that voted for either Biden or Trump. We can filter to only those respondents and then add more informative labels. Gender of “female” and “male” is what is available from the CES.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>ces2020 <span class="ot">&lt;-</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  ces2020 <span class="sc">|&gt;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    votereg <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    CC20_410 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">voted_for =</span> <span class="fu">if_else</span>(CC20_410 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Biden"</span>, <span class="st">"Trump"</span>),</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">voted_for =</span> <span class="fu">as_factor</span>(voted_for),</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender =</span> <span class="fu">if_else</span>(gender <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span>),</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">education =</span> <span class="fu">case_when</span>(</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>      educ <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"No HS"</span>,</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>      educ <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"High school graduate"</span>,</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>      educ <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Some college"</span>,</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>      educ <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"2-year"</span>,</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>      educ <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"4-year"</span>,</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>      educ <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Post-grad"</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">education =</span> <span class="fu">factor</span>(</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>      education,</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"No HS"</span>,</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"High school graduate"</span>,</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Some college"</span>,</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2-year"</span>,</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"4-year"</span>,</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Post-grad"</span></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(voted_for, gender, education)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the end we are left with 43,554 respondents (<a href="#fig-cesissogooditslikecheating">Figure&nbsp;<span>14.10</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>ces2020 <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">fill =</span> voted_for)) <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_count</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(gender)) <span class="sc">+</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Highest education"</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of respondents"</span>,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Voted for"</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cesissogooditslikecheating" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-cesissogooditslikecheating-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 14.10: The distribution of presidential preferences, by gender, and highest education</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We are interested in whether we can forecast who a respondent is likely to vote for, based only on knowing their highest level of education and gender. One approach is to use <code>tidymodels</code> to build a prediction-focused logistic regression model in the same way as before i.e.&nbsp;a validation set approach <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. 2021, 176</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>ces2020_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(ces2020, <span class="at">prop =</span> <span class="fl">0.80</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>ces2020_train <span class="ot">&lt;-</span> <span class="fu">training</span>(ces2020_split)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>ces2020_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(ces2020_split)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>ces_tidymodels <span class="ot">&lt;-</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>(<span class="at">mode =</span> <span class="st">"classification"</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    voted_for <span class="sc">~</span> gender <span class="sc">+</span> education,</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ces2020_train</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>ces_tidymodels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>parsnip model object


Call:  stats::glm(formula = voted_for ~ gender + education, family = stats::binomial, 
    data = data)

Coefficients:
                  (Intercept)                     genderMale  
                       0.2157                        -0.4697  
educationHigh school graduate          educationSome college  
                      -0.1857                         0.3502  
              education2-year                education4-year  
                       0.2311                         0.6700  
           educationPost-grad  
                       0.9898  

Degrees of Freedom: 34842 Total (i.e. Null);  34836 Residual
Null Deviance:      47000 
Residual Deviance: 45430    AIC: 45440</code></pre>
</div>
</div>
<p>And then evaluate it on the test set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>ces_tidymodels <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> ces2020_test) <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(ces2020_test) <span class="sc">|&gt;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> voted_for, <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction Trump Biden
     Trump   656   519
     Biden  2834  4702</code></pre>
</div>
</div>
<p>When we introduced <code>tidymodels</code>, we discussed the importance of randomly constructing training and test sets. We use the training dataset to estimate parameters, and then evaluate the model on the test set. It is natural to ask why we should be subject to the whims of randomness and whether we are making the most of our data. For instance, what if a good model is poorly evaluated because of some random inclusion in the test set? And what if we do not have a large test set?</p>
<p>One commonly used resampling method that goes some way to addressing this is <span class="math inline">\(k\)</span>-fold cross-validation. In this approach we create <span class="math inline">\(k\)</span> different samples from the dataset without replacement. We then fit the model to the first <span class="math inline">\(k-1\)</span> folds, and then evaluate it on the last fold. We do this <span class="math inline">\(k\)</span> times, once for every fold, such that every observation will be used for training <span class="math inline">\(k-1\)</span> times and for testing once. The <span class="math inline">\(k\)</span>-fold cross-validation estimate is then the average mean squared error <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. 2021, 181</a>)</span>.</p>
<p>We can use <code>vfold_cv()</code> from <code>tidymodels</code> to create, say, 10 folds.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>ces2020_10_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(ces2020, <span class="at">v =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then fit our model across the different combinations of folds with <code>fit_resamples()</code>. In this case, the model will be fit 10 times.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>ces2020_cross_validation <span class="ot">&lt;-</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">object =</span> <span class="fu">logistic_reg</span>(<span class="at">mode =</span> <span class="st">"classification"</span>) <span class="sc">|&gt;</span> <span class="fu">set_engine</span>(<span class="st">"glm"</span>),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">preprocessor =</span> <span class="fu">recipe</span>(</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>      voted_for <span class="sc">~</span> gender <span class="sc">+</span> education,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ces2020</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> ces2020_10_folds,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy, sens, spec),</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We might be interested to understand the performance of our model and we can use <code>collect_metrics()</code> to aggregate them across the folds (<a href="#tbl-metricsvoters-1">Table&nbsp;<span>14.7 (a)</span></a>). These types of details would typically be mentioned in passing in the main content of the paper, but included in great detail in an appendix. The average accuracy of our model across the folds is 0.61, while the average sensitivity is 0.19 and the average specificity is 0.90.</p>
<div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(ces2020_cross_validation) <span class="sc">|&gt;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.metric, mean) <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Metric"</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Mean"</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">linesep =</span> <span class="st">""</span>,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="fu">conf_mat_resampled</span>(ces2020_cross_validation) <span class="sc">|&gt;</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">0</span>,</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">linesep =</span> <span class="st">""</span>,</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-metricsvoters" class="cell tbl-parent quarto-layout-panel anchored">
<div class="panel-caption table-caption">
<p>Table 14.7: Average metrics across the 10 folds of a logistic regression to forecast voter preference</p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-metricsvoters-1" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-metricsvoters" style="flex-basis: 50.0%;justify-content: center;">

<table><caption>(a) Key performance metrics </caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Metric </th>
   <th style="text-align:right;"> Mean </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> accuracy </td>
   <td style="text-align:right;"> 0.61 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> sens </td>
   <td style="text-align:right;"> 0.19 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> spec </td>
   <td style="text-align:right;"> 0.90 </td>
  </tr>
</tbody>
</table>

</div>
<div id="tbl-metricsvoters-2" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-metricsvoters" style="flex-basis: 50.0%;justify-content: center;">

<table><caption>(b) Confusion matrix </caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Prediction </th>
   <th style="text-align:left;"> Truth </th>
   <th style="text-align:right;"> Freq </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:right;"> 328 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 268 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:right;"> 1,428 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 2,332 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>What does this mean? Accuracy is the proportion of observations that were correctly classified. The result of 0.61 suggests the model is doing better than a coin toss, but not much more. Sensitivity is the proportion of true observations that are identified as true <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. 2021, 145</a>)</span>. In this case would mean that the model predicted a respondent voted for Biden and they did. And specificity is the proportion of false observations that are identified as false <span class="citation" data-cites="islr">(<a href="99-references.html#ref-islr" role="doc-biblioref">James et al. 2021, 145</a>)</span>. In this case it is the proportion of voters that voted for Trump, that were predicted to vote for Trump. The model is having trouble identifying Biden supporters.</p>
<p>We can see this in more detail by looking at the confusion matrix (<a href="#tbl-metricsvoters-2">Table&nbsp;<span>14.7 (b)</span></a>). When used with resampling approaches, such as cross-validation, the confusion matrix is computed for each fold and then averaged. The model is predicting Biden much more than we might expect from our knowledge of how close the 2020 election was. It suggests that our model may need additional variables to do a better job.</p>
<p>Finally, it may be the case that we are interested in individual-level results, and we can add these to our dataset with <code>collect_predictions()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>ces2020_with_predictions <span class="ot">&lt;-</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    ces2020,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_predictions</span>(ces2020_cross_validation) <span class="sc">|&gt;</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(.row) <span class="sc">|&gt;</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.pred_class)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For instance, we can see that model is essentially predicting support for Biden, for all individuals apart from males with no high school or high school graduates or 2 years of college (<a href="#tbl-omgthismodelishorriblelol">Table&nbsp;<span>14.8</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>ces2020_with_predictions <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gender, education, voted_for) <span class="sc">|&gt;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(.pred_class) <span class="sc">|&gt;</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Gender"</span>,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Education"</span>,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Voted for"</span>,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Predicted vote"</span>,</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Number"</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">0</span>,</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">linesep =</span> <span class="st">""</span>,</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-omgthismodelishorriblelol" class="anchored">

<table><caption>Table 14.8:  The model is forecasting support for Biden for all females, and for many males, regardless of education </caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Gender </th>
   <th style="text-align:left;"> Education </th>
   <th style="text-align:left;"> Voted for </th>
   <th style="text-align:left;"> Predicted vote </th>
   <th style="text-align:right;"> Number </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Female </td>
   <td style="text-align:left;"> No HS </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 206 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Female </td>
   <td style="text-align:left;"> No HS </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 228 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Female </td>
   <td style="text-align:left;"> High school graduate </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 3,204 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Female </td>
   <td style="text-align:left;"> High school graduate </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 3,028 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Female </td>
   <td style="text-align:left;"> Some college </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 1,842 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Female </td>
   <td style="text-align:left;"> Some college </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 3,325 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Female </td>
   <td style="text-align:left;"> 2-year </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 1,117 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Female </td>
   <td style="text-align:left;"> 2-year </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 1,739 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Female </td>
   <td style="text-align:left;"> 4-year </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 1,721 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Female </td>
   <td style="text-align:left;"> 4-year </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 4,295 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Female </td>
   <td style="text-align:left;"> Post-grad </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 745 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Female </td>
   <td style="text-align:left;"> Post-grad </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 2,853 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Male </td>
   <td style="text-align:left;"> No HS </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:right;"> 132 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Male </td>
   <td style="text-align:left;"> No HS </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:right;"> 123 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Male </td>
   <td style="text-align:left;"> High school graduate </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:right;"> 2,054 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Male </td>
   <td style="text-align:left;"> High school graduate </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:right;"> 1,528 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Male </td>
   <td style="text-align:left;"> Some college </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 1,992 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Male </td>
   <td style="text-align:left;"> Some college </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 2,131 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Male </td>
   <td style="text-align:left;"> 2-year </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:right;"> 1,089 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Male </td>
   <td style="text-align:left;"> 2-year </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:right;"> 1,026 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Male </td>
   <td style="text-align:left;"> 4-year </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 2,208 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Male </td>
   <td style="text-align:left;"> 4-year </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 3,294 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Male </td>
   <td style="text-align:left;"> Post-grad </td>
   <td style="text-align:left;"> Trump </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 1,248 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Male </td>
   <td style="text-align:left;"> Post-grad </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:left;"> Biden </td>
   <td style="text-align:right;"> 2,426 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="poisson-regression" class="level2" data-number="14.6">
<h2 data-number="14.6" class="anchored" data-anchor-id="poisson-regression"><span class="header-section-number">14.6</span> Poisson regression</h2>
<p>When we have count data of binary outcomes, we should initially think to take advantage of the Poisson distribution. The Poisson distribution has the interesting feature that the mean is also the variance, and so as the mean increases, so does the variance. As such, the Poisson distribution is governed by the parameter, <span class="math inline">\(\lambda\)</span>. This distributes probabilities over non-negative integers and hence governs the shape of the distribution. The Poisson distribution is <span class="citation" data-cites="pitman">(<a href="99-references.html#ref-pitman" role="doc-biblioref">Pitman 1993, 121</a>)</span>:</p>
<p><span class="math display">\[P_{\lambda}(k) = e^{-\lambda}\mu^k/k!\mbox{, for }k=0,1,2,...\]</span></p>
<p>We can simulate <span class="math inline">\(n=20\)</span> draws from the Poisson distribution with <code>rpois()</code>, where <span class="math inline">\(\lambda\)</span> is the mean (<a href="#fig-poissondistributiontakingshape">Figure&nbsp;<span>14.11</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpois</span>(<span class="at">n =</span> <span class="dv">20</span>, <span class="at">lambda =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 2 1 1 2 1 5 4 1 4 6 4 4 3 3 2 3 7 2 5 2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>poisson_takes_shape <span class="ot">&lt;-</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lambda =</span> <span class="fu">c</span>(),</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">draw =</span> <span class="fu">c</span>()</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>number_of_each <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">50</span>, <span class="dv">100</span>)) {</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  draws_i <span class="ot">&lt;-</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">lambda =</span> <span class="fu">c</span>(<span class="fu">rep</span>(i, number_of_each)),</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">draw =</span> <span class="fu">c</span>(<span class="fu">rpois</span>(<span class="at">n =</span> number_of_each, <span class="at">lambda =</span> i))</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  poisson_takes_shape <span class="ot">&lt;-</span> <span class="fu">rbind</span>(poisson_takes_shape, draws_i)</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(draws_i)</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>poisson_takes_shape <span class="sc">|&gt;</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">lambda =</span> <span class="fu">paste</span>(<span class="st">"Lambda ="</span>, lambda),</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">lambda =</span> <span class="fu">factor</span>(</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>      lambda,</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lambda = 0"</span>,</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lambda = 1"</span>,</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lambda = 2"</span>,</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lambda = 4"</span>,</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lambda = 7"</span>,</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lambda = 10"</span>,</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lambda = 15"</span>,</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lambda = 50"</span>,</span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Lambda = 100"</span></span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> draw)) <span class="sc">+</span></span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vars</span>(lambda),</span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">scales =</span> <span class="st">"free_y"</span></span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Integer"</span>,</span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-poissondistributiontakingshape" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-poissondistributiontakingshape-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 14.11: The Poisson distribution is governed by the value of the mean, which is the same as its variance</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>To illustrate the situation, we could simulate data about the number of A grades that are awarded in each university course. In this simulated example, we consider three departments, each of which has many courses. Each course will award a different number of A grades.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>class_size <span class="ot">&lt;-</span> <span class="dv">26</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>count_of_A <span class="ot">&lt;-</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># From Chris DuBois: https://stackoverflow.com/a/1439843</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">department =</span> <span class="fu">c</span>(<span class="fu">rep.int</span>(<span class="st">"1"</span>, <span class="dv">26</span>), <span class="fu">rep.int</span>(<span class="st">"2"</span>, <span class="dv">26</span>), <span class="fu">rep.int</span>(<span class="st">"3"</span>, <span class="dv">26</span>)),</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">course =</span> <span class="fu">c</span>(</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"DEP_1_"</span>, letters),</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"DEP_2_"</span>, letters),</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"DEP_3_"</span>, letters)</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">number_of_A =</span> <span class="fu">c</span>(</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rpois</span>(<span class="at">n =</span> class_size, <span class="at">lambda =</span> <span class="dv">5</span>),</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rpois</span>(<span class="at">n =</span> class_size, <span class="at">lambda =</span> <span class="dv">10</span>),</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rpois</span>(<span class="at">n =</span> class_size, <span class="at">lambda =</span> <span class="dv">20</span>)</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>count_of_A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 78 × 3
   department course  number_of_A
   &lt;chr&gt;      &lt;chr&gt;         &lt;int&gt;
 1 1          DEP_1_a           4
 2 1          DEP_1_b           2
 3 1          DEP_1_c           5
 4 1          DEP_1_d           4
 5 1          DEP_1_e           1
 6 1          DEP_1_f           4
 7 1          DEP_1_g           3
 8 1          DEP_1_h           3
 9 1          DEP_1_i           3
10 1          DEP_1_j           3
# … with 68 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>count_of_A <span class="sc">|&gt;</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> number_of_A)) <span class="sc">+</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">fill =</span> department), <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of A grades awarded"</span>,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Numnber of classes"</span>,</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Department"</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-simgradesdepartments" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-simgradesdepartments-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 14.12: Simulated number of A grades in various classes across three departments</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Our simulated dataset has the number of A grades awarded by courses, which are structured within departments (<a href="#fig-simgradesdepartments">Figure&nbsp;<span>14.12</span></a>). (In <a href="16-mrp.html"><span>Chapter&nbsp;16</span></a>, we will take advantage of this departmental structure, but for now we just ignore it.)</p>
<p>The model that we are interested in estimating is:</p>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim \mbox{Poisson}(\lambda_i)\\
\log(\lambda_i) &amp; = \beta_0 + \beta_1 x_1
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(y_i\)</span> is the number of A grades awarded, and <span class="math inline">\(x_1\)</span> is the course.</p>
<p>We can use <code>glm()</code> from base R to get a quick sense of the data. This function is quite general, and we specify Poisson regression by setting the “family” parameter. The estimates are contained in the first column of <a href="#tbl-modelsummarypoisson">Table&nbsp;<span>14.9</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(count_of_A<span class="sc">$</span>department) <span class="sc">==</span> <span class="st">"character"</span>,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(count_of_A<span class="sc">$</span>course) <span class="sc">==</span> <span class="st">"character"</span>,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(count_of_A<span class="sc">$</span>number_of_A) <span class="sc">==</span> <span class="st">"integer"</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(count_of_A) <span class="sc">==</span> <span class="dv">78</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>grades_base <span class="ot">&lt;-</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    number_of_A <span class="sc">~</span> department,</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> count_of_A,</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"poisson"</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As with logistic regression, the interpretation of the coefficients from Poisson regression can be difficult. The interpretation of the coefficient on “department2” is that it is the log of the expected difference between departments. We expect <span class="math inline">\(e^{0.7893} \approx 2.2\)</span> and <span class="math inline">\(e^{1.4804} \approx 4.4\)</span> additional A grades in departments 2 and 3, compared with department 1.</p>
<p>If we were interested in prediction, then we could use <code>tidymodels</code> to estimate Poisson models with <code>poissonreg</code> <span class="citation" data-cites="poissonreg">(<a href="99-references.html#ref-poissonreg" role="doc-biblioref">Kuhn 2021</a>)</span> (<a href="#tbl-modelsummarypoisson">Table&nbsp;<span>14.9</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(poissonreg)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>count_of_A_split <span class="ot">&lt;-</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">initial_split</span>(count_of_A, <span class="at">prop =</span> <span class="fl">0.80</span>)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>count_of_A_train <span class="ot">&lt;-</span> <span class="fu">training</span>(count_of_A_split)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>count_of_A_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(count_of_A_split)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(count_of_A_train<span class="sc">$</span>department) <span class="sc">==</span> <span class="st">"character"</span>,</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(count_of_A_train<span class="sc">$</span>course) <span class="sc">==</span> <span class="st">"character"</span>,</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(count_of_A_train<span class="sc">$</span>number_of_A) <span class="sc">==</span> <span class="st">"integer"</span>,</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(count_of_A_train) <span class="sc">==</span> <span class="dv">62</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>grades_tidymodels <span class="ot">&lt;-</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">poisson_reg</span>(<span class="at">mode =</span> <span class="st">"regression"</span>) <span class="sc">|&gt;</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>    number_of_A <span class="sc">~</span> department,</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> count_of_A_train</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The results of this estimation are in the second column of <a href="#tbl-modelsummarypoisson">Table&nbsp;<span>14.9</span></a>. They are similar to the estimates from <code>glm()</code>, but the number of observations is less because of the split.</p>
<p>Finally, we could build a Bayesian model and estimate it with <code>rstanarm</code> (<a href="#tbl-modelsummarypoisson">Table&nbsp;<span>14.9</span></a>).</p>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim \mbox{Poisson}(\lambda_i)\\
\log(\lambda_i) &amp; = \beta_0 + \beta_1 x_1\\
\beta_0 &amp; \sim \mbox{Normal}(0, 2.5)\\
\beta_1 &amp; \sim \mbox{Normal}(0, 2.5)
\end{aligned}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(count_of_A<span class="sc">$</span>department) <span class="sc">==</span> <span class="st">"character"</span>,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(count_of_A<span class="sc">$</span>course) <span class="sc">==</span> <span class="st">"character"</span>,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(count_of_A<span class="sc">$</span>number_of_A) <span class="sc">==</span> <span class="st">"integer"</span>,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>(count_of_A) <span class="sc">==</span> <span class="dv">78</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>grades_rstanarm <span class="ot">&lt;-</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stan_glm</span>(</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    number_of_A <span class="sc">~</span> department,</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> count_of_A,</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">normal</span>(<span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="fl">2.5</span>, <span class="at">autoscale =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior_intercept =</span> <span class="fu">normal</span>(<span class="at">location =</span> <span class="dv">0</span>, <span class="at">scale =</span> <span class="fl">2.5</span>, <span class="at">autoscale =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">853</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>  grades_rstanarm,</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"grades_rstanarm.rds"</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The results are contained in the third column of <a href="#tbl-modelsummarypoisson">Table&nbsp;<span>14.9</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"base R"</span> <span class="ot">=</span> grades_base,</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tidymodels"</span> <span class="ot">=</span> grades_tidymodels,</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rstanarm"</span> <span class="ot">=</span> grades_rstanarm</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"conf.int"</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-modelsummarypoisson" class="anchored">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"><caption>Table 14.9:  Forecasting and explanatory models of marathon times based on five-kilometer run times </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> base R </th>
   <th style="text-align:center;"> tidymodels </th>
   <th style="text-align:center;"> rstanarm </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 1.327 </td>
   <td style="text-align:center;"> 1.353 </td>
   <td style="text-align:center;"> 1.321 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> [1.122, 1.519] </td>
   <td style="text-align:center;"> [1.138, 1.554] </td>
   <td style="text-align:center;"> [1.128, 1.509] </td>
  </tr>
  <tr>
   <td style="text-align:left;"> department2 </td>
   <td style="text-align:center;"> 0.883 </td>
   <td style="text-align:center;"> 0.861 </td>
   <td style="text-align:center;"> 0.884 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> [0.651, 1.123] </td>
   <td style="text-align:center;"> [0.611, 1.118] </td>
   <td style="text-align:center;"> [0.654, 1.117] </td>
  </tr>
  <tr>
   <td style="text-align:left;"> department3 </td>
   <td style="text-align:center;"> 1.703 </td>
   <td style="text-align:center;"> 1.719 </td>
   <td style="text-align:center;"> 1.706 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> [1.493, 1.924] </td>
   <td style="text-align:center;box-shadow: 0px 1px"> [1.495, 1.954] </td>
   <td style="text-align:center;box-shadow: 0px 1px"> [1.499, 1.921] </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 78 </td>
   <td style="text-align:center;"> 62 </td>
   <td style="text-align:center;"> 78 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 392.5 </td>
   <td style="text-align:center;"> 311.6 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 399.6 </td>
   <td style="text-align:center;"> 318.0 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> −193.274 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −193.355 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> F </td>
   <td style="text-align:center;"> 147.022 </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ELPD </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> −196.2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ELPD s.e. </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 7.7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LOOIC </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 392.4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LOOIC s.e. </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 15.4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> WAIC </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 392.4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 3.41 </td>
   <td style="text-align:center;"> 3.35 </td>
   <td style="text-align:center;"> 3.41 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As with logistic regression, we can use <code>marginaleffects()</code> from <span class="citation" data-cites="marginaleffects">(<a href="99-references.html#ref-marginaleffects" role="doc-biblioref">Arel-Bundock 2022</a>)</span> to help with interpreting these results. It may be useful to consider how we expect the number of A grades to change as we go from one department to another. <a href="#tbl-marginaleffectspoisson">Table&nbsp;<span>14.10</span></a> suggests that in our dataset classes in Department 2 tend to have around five additional A grades, compared with Department 1. And that classes in Department 3, tend to have around 17 more A grades, compared with Department 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">marginaleffects</span>(grades_rstanarm) <span class="sc">|&gt;</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">|&gt;</span> </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>type, <span class="sc">-</span>term) <span class="sc">|&gt;</span> </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Departmental comparison"</span>, <span class="st">"Estimate"</span>, <span class="st">"2.5%"</span>, <span class="st">"97.5%"</span>),</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">linesep =</span> <span class="st">""</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-marginaleffectspoisson" class="anchored">

<table><caption>Table 14.10:  The estimated difference in the number of A grades awarded at each department </caption>
 <thead>
  <tr>
   <th style="text-align:left;"> Departmental comparison </th>
   <th style="text-align:right;"> Estimate </th>
   <th style="text-align:right;"> 2.5% </th>
   <th style="text-align:right;"> 97.5% </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2 - 1 </td>
   <td style="text-align:right;"> 5.32 </td>
   <td style="text-align:right;"> 4.01 </td>
   <td style="text-align:right;"> 6.70 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 3 - 1 </td>
   <td style="text-align:right;"> 16.92 </td>
   <td style="text-align:right;"> 15.10 </td>
   <td style="text-align:right;"> 18.84 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="letters-used-in-jane-eyre" class="level3" data-number="14.6.1">
<h3 data-number="14.6.1" class="anchored" data-anchor-id="letters-used-in-jane-eyre"><span class="header-section-number">14.6.1</span> Letters used in <em>Jane Eyre</em></h3>
<p>In an earlier age, <span class="citation" data-cites="edgeworth1885methods">Edgeworth (<a href="99-references.html#ref-edgeworth1885methods" role="doc-biblioref">1885</a>)</span> made counts of the dactyls in Virgil’s Aeneid (<span class="citation" data-cites="HistData">Friendly (<a href="99-references.html#ref-HistData" role="doc-biblioref">2021</a>)</span> makes this dataset available with <code>HistData::Dactyl</code>). Inspired by this we could use <code>gutenbergr</code> <span class="citation" data-cites="gutenbergr">(<a href="99-references.html#ref-gutenbergr" role="doc-biblioref">Robinson 2021</a>)</span> to get the text of <em>Jane Eyre</em> by Charlotte Brontë. We could then consider the first 10 lines of each chapter and count the number of times either “E” or “e” appears.</p>
<p>Following the workflow advocated in this book, we first sketch our dataset and model. A quick sketch of what the dataset could look like is <a href="#fig-letterssketch">Figure&nbsp;<span>14.16 (a)</span></a>. And a quick sketch our our model is <a href="#fig-lettersmodel">Figure&nbsp;<span>14.16 (b)</span></a>.</p>
<div id="fig-letterss" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-bottom">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-letterssketch" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/IMG_2056.png" class="img-fluid figure-img" data-ref-parent="fig-letterss"></p>
<p></p><figcaption class="figure-caption">(a) Quick sketch of a dataset that could be used to examine US political support</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-lettersmodel" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/IMG_2059.png" class="img-fluid figure-img" data-ref-parent="fig-letterss"></p>
<p></p><figcaption class="figure-caption">(b) Quick sketch of what we expect from the analysis before finalising either the data of the analysis</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure 14.13: Sketches of the expected dataset and analysis force us to consider what we are interested in</figcaption><p></p>
</figure>
</div>
<p>We will simulate a dataset the number of e/E letters is distributed following the Poisson distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>count_of_e_simulation <span class="ot">&lt;-</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">chapter =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">number_e =</span> <span class="fu">rpois</span>(<span class="at">n =</span> <span class="dv">30</span>, <span class="at">lambda =</span> <span class="dv">10</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>count_of_e_simulation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 2
   chapter number_e
     &lt;int&gt;    &lt;int&gt;
 1       1       11
 2       2        9
 3       3        9
 4       4       17
 5       5        9
 6       6        8
 7       7        8
 8       8        7
 9       9       15
10      10        8
# … with 20 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p>We can now gather and prepare our data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gutenbergr)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>gutenberg_id_of_janeeyre <span class="ot">&lt;-</span> <span class="dv">1260</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>jane_eyre <span class="ot">&lt;-</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gutenberg_download</span>(</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">gutenberg_id =</span> gutenberg_id_of_janeeyre,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mirror =</span> <span class="st">"https://gutenberg.pglaf.org/"</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>jane_eyre</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(jane_eyre, <span class="st">"jane_eyre.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will download it and then use our local copy to avoid overly imposing on the Project Gutenberg servers.</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>jane_eyre <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"jane_eyre.csv"</span>,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">gutenberg_id =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">col_character</span>()</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>jane_eyre</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21,001 × 2
   gutenberg_id text                           
          &lt;int&gt; &lt;chr&gt;                          
 1         1260 JANE EYRE                      
 2         1260 AN AUTOBIOGRAPHY               
 3         1260 &lt;NA&gt;                           
 4         1260 by Charlotte Brontë            
 5         1260 &lt;NA&gt;                           
 6         1260 _ILLUSTRATED BY F. H. TOWNSEND_
 7         1260 &lt;NA&gt;                           
 8         1260 London                         
 9         1260 SERVICE &amp; PATON                
10         1260 5 HENRIETTA STREET             
# … with 20,991 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p>We are interested in only those lines that have content, so we remove those empty lines that are just there for spacing. Then we can create counts of the number of times “e” or “E” occurs in that line, for the first 10 lines of each chapter. For instance, we can look at the first few lines and see that there are 5 e/E’s in the first line and 8 in the second.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>jane_eyre_reduced <span class="ot">&lt;-</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  jane_eyre <span class="sc">|&gt;</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(text)) <span class="sc">|&gt;</span> <span class="co"># Remove empty lines</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chapter =</span> <span class="fu">if_else</span>(</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(text, <span class="st">"CHAPTER"</span>) <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    text,</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NA_character_</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> <span class="co"># Find start of chapter</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(chapter, <span class="at">.direction =</span> <span class="st">"down"</span>) <span class="sc">|&gt;</span> <span class="co"># Add chapter number to each line</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(chapter) <span class="sc">|&gt;</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chapter_line =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> <span class="co"># Add line number of each chapter</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(chapter),</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    chapter_line <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">11</span>)</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="co"># Start at 2 to get rid of text "CHAPTER I" etc</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(text, chapter) <span class="sc">|&gt;</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">chapter =</span> <span class="fu">str_remove</span>(chapter, <span class="st">"CHAPTER "</span>),</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">chapter =</span> <span class="fu">str_remove</span>(chapter, <span class="st">"—CONCLUSION"</span>),</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">chapter =</span> <span class="fu">as.integer</span>(<span class="fu">as.roman</span>(chapter))</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="co"># Change chapters to integers</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>jane_eyre_reduced <span class="ot">&lt;-</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>  jane_eyre_reduced <span class="sc">|&gt;</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count_e =</span> <span class="fu">str_count</span>(text, <span class="st">"e|E"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>jane_eyre_reduced <span class="sc">|&gt;</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(chapter, count_e, text) <span class="sc">|&gt;</span> </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
# Groups:   chapter [1]
  chapter count_e text                                                          
    &lt;int&gt;   &lt;int&gt; &lt;chr&gt;                                                         
1       1       5 There was no possibility of taking a walk that day. We had be…
2       1       8 wandering, indeed, in the leafless shrubbery an hour in the m…
3       1       9 but since dinner (Mrs. Reed, when there was no company, dined…
4       1       3 the cold winter wind had brought with it clouds so sombre, an…
5       1       7 so penetrating, that further outdoor exercise was now out of …
6       1       1 question.                                                     </code></pre>
</div>
</div>
<p>We can verify that the mean and variance of the number of E/e’s is roughly similar by plotting all of the data (<a href="#fig-janeecounts">Figure&nbsp;<span>14.14</span></a>). The mean, in pink, is 6.9, and the variance, in blue, is 6.2. While they are not entirely the same, they are similar.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>mean_e <span class="ot">&lt;-</span> <span class="fu">mean</span>(jane_eyre_reduced<span class="sc">$</span>count_e)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>variance_e <span class="ot">&lt;-</span> <span class="fu">var</span>(jane_eyre_reduced<span class="sc">$</span>count_e)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>jane_eyre_reduced <span class="sc">|&gt;</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> chapter, <span class="at">x =</span> count_e)) <span class="sc">+</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> mean_e, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#C64191"</span>) <span class="sc">+</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> variance_e, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"#0ABAB5"</span>) <span class="sc">+</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of e's per line for first ten lines"</span>,</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Chapter"</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-janeecounts" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-janeecounts-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 14.14: Number of ‘E’ or ‘e’ in the first ten lines of each chapter in Jane Eyre</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We could consider the following model:</p>
<p><span class="math display">\[
\begin{aligned}
y_i &amp;\sim \mbox{Poisson}(\lambda_i)\\
\log(\lambda_i) &amp; = \beta_0 + \beta_1 x_1\\
\beta_0 &amp; \sim \mbox{Normal}(0, 2.5)\\
\beta_1 &amp; \sim \mbox{Normal}(0, 2.5)
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(x_1\)</span> is the chapter. We could estimate the parameters using <code>stan_glm()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>jane_eyre_reduced <span class="ot">&lt;-</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  jane_eyre_reduced <span class="sc">|&gt;</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chapter =</span> <span class="fu">factor</span>(chapter))</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>jane_e_counts <span class="ot">&lt;-</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stan_glm</span>(</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    count_e <span class="sc">~</span> chapter,</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> jane_eyre_reduced,</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">853</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  jane_e_counts,</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"jane_e_counts.rds"</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<!-- (@tbl-modelsummaryjanee). -->
<!-- ```{r} -->
<!-- #| label: tbl-modelsummaryjanee -->
<!-- #| tbl-cap: "Forecasting and explanatory models of whether it is day or night, based on the number of cars on the road" -->
<!-- modelsummary::modelsummary( -->
<!--   list( -->
<!--     "rstanarm" = jane_e_counts -->
<!--   ), -->
<!--   statistic = "conf.int" -->
<!-- ) -->
<!-- ``` -->
<p>While we would normally be interested in the table of estimates, as we have seen that a few times now, rather than again creating a table of the estimates, we introduce <code>plot_cap()</code> from <code>marginaleffects</code> <span class="citation" data-cites="marginaleffects">(<a href="99-references.html#ref-marginaleffects" role="doc-biblioref">Arel-Bundock 2022</a>)</span>. We can use this to show the number of e/E’s predicted by the model, for each chapter. <a href="#fig-predictionsjaneecounts">Figure&nbsp;<span>14.15</span></a> makes it clear that there are a number of chapters where we expect more e/E’s than others.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_cap</span>(jane_e_counts, <span class="at">condition =</span> <span class="st">"chapter"</span>) <span class="sc">+</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Chapter"</span>,</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Average number of e/E in the first 10 lines"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-predictionsjaneecounts" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-predictionsjaneecounts-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 14.15: The predicted number of e/E’s in each chapter</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="negative-binomial-regression" class="level2" data-number="14.7">
<h2 data-number="14.7" class="anchored" data-anchor-id="negative-binomial-regression"><span class="header-section-number">14.7</span> Negative binomial regression</h2>
<p>One of the major restrictions with Poisson regression is the assumption that the mean and the variance are the same. We can relax this assumption to allow over-dispersion and should then use a close variant, negative binomial regression. Before getting to this, it might be worth taking a moment to think about why we are we going through all this trouble. Common practice is to change from counts into a binary and then use logistic regression. The issue with this is that we may lose information when we group responses together. For this reason, it may be worth going to the extra effort to consider more bespoke options such as these.</p>
<p>Poisson and negative binomial models go hand in hand. It is often the case that we will end up fitting both, and then comparing them. For instance, <span class="citation" data-cites="maher1982modelling">Maher (<a href="99-references.html#ref-maher1982modelling" role="doc-biblioref">1982</a>)</span> considers both in the context of results from the English Football League and discusses the context in which one may be considered more appropriate than the other. Similarly, <span class="citation" data-cites="thanksleo">Smith (<a href="99-references.html#ref-thanksleo" role="doc-biblioref">2002</a>)</span> considers the 2000 US presidential election and especially the issue of overdispersion in a Poisson analysis.</p>
<!-- The shape of the negative binomial distribution is determined by two parameters, the probability of success, $p$, and the number of successes, $r$ [@pitman, p. 482]:  -->
<!-- $$P(F_r = n) = {n+r-1\choose r-1}p^r(1-p)^n\mbox{, for }n=0,1,2,...$$ -->
<!-- where $F_r$ is the number of failures, before the $r$th success in Bernoulli trials. -->
<!-- For instance, if we were to consider the number of k's in those same lines of *Jane Eyre*, then we would have many zeros (@fig-janeecountsk).  -->
<!-- ```{r} -->
<!-- jane_eyre_reduced <- -->
<!--   jane_eyre_reduced |> -->
<!--   mutate(count_k = str_count(text, "k|K")) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- #| echo: true -->
<!-- #| eval: true -->
<!-- #| fig-cap: "Number of 'K' or 'k' in the first ten lines of each chapter in Jane Eyre" -->
<!-- #| label: fig-janeecountsk -->
<!-- #| message: false -->
<!-- #| warning: false -->
<!-- mean_k <- mean(jane_eyre_reduced$count_k) -->
<!-- variance_k <- var(jane_eyre_reduced$count_k) -->
<!-- jane_eyre_reduced |> -->
<!--   ggplot(aes(y = chapter, x = count_k)) + -->
<!--   geom_point(alpha = 0.5) + -->
<!--   geom_vline(xintercept = mean_k, linetype = "dashed", color = "#C64191") + -->
<!--   geom_vline(xintercept = variance_k, linetype = "dashed", color = "#0ABAB5") + -->
<!--   theme_minimal() + -->
<!--   labs( -->
<!--     x = "Number of k's per line for first ten lines", -->
<!--     y = "Chapter" -->
<!--   ) -->
<!-- ``` -->
<section id="mortality-in-alberta" class="level3" data-number="14.7.1">
<h3 data-number="14.7.1" class="anchored" data-anchor-id="mortality-in-alberta"><span class="header-section-number">14.7.1</span> Mortality in Alberta</h3>
<p>Consider, somewhat morbidly, that every year each individual either dies or does not. From the perspective of a state, we could gather data on the number of people who died each year, by their cause of death. The Canadian province of Alberta makes the number of deaths, by cause, since 2001, for the top 30 causes each year, available <a href="https://open.alberta.ca/opendata/leading-causes-of-death">here</a>.</p>
<p>As always we first sketch our dataset and model. A quick sketch of what the dataset could look like is <a href="#fig-albertadatasketch">Figure&nbsp;<span>14.16 (a)</span></a> And a quick sketch our our model is <a href="#fig-albertamodelsketch">Figure&nbsp;<span>14.16 (b)</span></a></p>
<div id="fig-letterss" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-bottom">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-albertadatasketch" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/IMG_2058.png" class="img-fluid figure-img" data-ref-parent="fig-letterss"></p>
<p></p><figcaption class="figure-caption">(a) Quick sketch of a dataset that could be used to examine cause of death in Alberta</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-albertamodelsketch" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/IMG_2061.png" class="img-fluid figure-img" data-ref-parent="fig-letterss"></p>
<p></p><figcaption class="figure-caption">(b) Quick sketch of what we expect from the analysis of cause of death in Alberta before finalising either the data or the analysis</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure 14.16: Sketches of the expected dataset and analysis for cause of death in Alberta</figcaption><p></p>
</figure>
</div>
<p>We will simulate a dataset of cause of death distributed following the negative binomial distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>alberta_death_simulation <span class="ot">&lt;-</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cause =</span> <span class="fu">rep</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">"Heart"</span>, <span class="st">"Stroke"</span>, <span class="st">"Diabetes"</span>), <span class="at">times =</span> <span class="dv">10</span>),</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">rep</span>(<span class="at">x =</span> <span class="dv">2016</span><span class="sc">:</span><span class="dv">2018</span>, <span class="at">times =</span> <span class="dv">10</span>),</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">deaths =</span> <span class="fu">rnbinom</span>(<span class="at">n =</span> <span class="dv">30</span>, <span class="at">size =</span> <span class="dv">20</span>, <span class="at">prob =</span> <span class="fl">0.1</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>alberta_death_simulation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 3
   cause     year deaths
   &lt;chr&gt;    &lt;int&gt;  &lt;int&gt;
 1 Heart     2016    182
 2 Stroke    2017    192
 3 Diabetes  2018    224
 4 Heart     2016    105
 5 Stroke    2017    168
 6 Diabetes  2018    163
 7 Heart     2016    118
 8 Stroke    2017    167
 9 Diabetes  2018    216
10 Heart     2016    153
# … with 20 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p>We download that data, and save it as “alberta_COD.csv”. We can look at the distribution of these deaths, by year and cause, where we have truncated the cause of death because some are quite extensive (<a href="#fig-albertacod">Figure&nbsp;<span>14.17</span></a>). (Note that because some causes are not always in the top 30 each year, not all causes have the same number of occurrences.)</p>
<!-- :::{.callout-note} -->
<!-- ## Oh, you think we have good data on that! -->
<!-- Cause of death -->
<!-- ::: -->
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>alberta_cod <span class="ot">&lt;-</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">"alberta_COD.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(cause) <span class="sc">|&gt;</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">==</span> <span class="dv">21</span>) <span class="sc">|&gt;</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cause =</span> <span class="fu">str_trunc</span>(cause, <span class="dv">15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 632 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): Cause
dbl (3): Calendar Year, Ranking, Total Deaths

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>alberta_cod <span class="sc">|&gt;</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> total_deaths, <span class="at">y =</span> cause)) <span class="sc">+</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of deaths"</span>,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cause"</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-albertacod" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-albertacod-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 14.17: Annual number of deaths for the top 30 causes, since 2001, for Alberta, Canada</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>One thing that we notice is that the mean, 665, is different to the variance, 227,152 (<a href="#tbl-ohboyalberta">Table&nbsp;<span>14.11</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-ohboyalberta" class="anchored">

<table><caption>Table 14.11:  Summary statistics of the number of deaths, by cause, in Alberta </caption>
 <thead>
  <tr>
   <th style="text-align:right;"> Minimum </th>
   <th style="text-align:right;"> Mean </th>
   <th style="text-align:right;"> Std dev </th>
   <th style="text-align:right;"> Variance </th>
   <th style="text-align:right;"> Maximum </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 152 </td>
   <td style="text-align:right;"> 665 </td>
   <td style="text-align:right;"> 477 </td>
   <td style="text-align:right;"> 227,152 </td>
   <td style="text-align:right;"> 2,135 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can implement negative binomial regression when using <code>stan_glm()</code> by specifying that distribution in “family”. In this case, we run both Poisson and negative binomial.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>cause_of_death_alberta_poisson <span class="ot">&lt;-</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stan_glm</span>(</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    total_deaths <span class="sc">~</span> cause,</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> alberta_cod,</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">853</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>cause_of_death_alberta_neg_binomial <span class="ot">&lt;-</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stan_glm</span>(</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>    total_deaths <span class="sc">~</span> cause,</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> alberta_cod,</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">neg_binomial_2</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">853</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<div class="cell">

</div>
<p>We can compare our different models (<a href="#tbl-modelsummarypoissonvsnegbinomial">Table&nbsp;<span>14.12</span></a>) (if there is an error with <code>modelsummary::modelsummary()</code> for the negative binomial model, then it can sometimes be resolved by loading <code>broom.mixed</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Poisson"</span> <span class="ot">=</span> cause_of_death_alberta_poisson,</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Negative binomial"</span> <span class="ot">=</span> cause_of_death_alberta_neg_binomial</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="cn">NULL</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tbl-modelsummarypoissonvsnegbinomial" class="anchored">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;"><caption>Table 14.12:  Modelling the most prevelent cause of deaths in Alberta, 2001-2020 </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Poisson </th>
   <th style="text-align:center;"> Negative binomial </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 7.033 </td>
   <td style="text-align:center;"> 7.037 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> causeAll other di... </td>
   <td style="text-align:center;"> −1.553 </td>
   <td style="text-align:center;"> −1.554 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> causeAll other fo... </td>
   <td style="text-align:center;"> 0.442 </td>
   <td style="text-align:center;"> 0.440 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> causeAlzheimer's ... </td>
   <td style="text-align:center;"> −1.192 </td>
   <td style="text-align:center;"> −1.192 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> causeAtherosclero... </td>
   <td style="text-align:center;"> −0.422 </td>
   <td style="text-align:center;"> −0.425 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> causeCongestive h... </td>
   <td style="text-align:center;"> −1.223 </td>
   <td style="text-align:center;"> −1.225 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> causeDiabetes mel... </td>
   <td style="text-align:center;"> −0.816 </td>
   <td style="text-align:center;"> −0.822 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> causeIntentional ... </td>
   <td style="text-align:center;"> −1.602 </td>
   <td style="text-align:center;"> −1.602 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> causeMalignant ne... </td>
   <td style="text-align:center;"> −0.532 </td>
   <td style="text-align:center;"> −0.536 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> causeOrganic deme... </td>
   <td style="text-align:center;"> 0.001 </td>
   <td style="text-align:center;"> −0.003 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> causeOther chroni... </td>
   <td style="text-align:center;"> −0.214 </td>
   <td style="text-align:center;"> −0.218 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> causePneumonia du... </td>
   <td style="text-align:center;"> −1.073 </td>
   <td style="text-align:center;"> −1.074 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> causeRenal failure </td>
   <td style="text-align:center;"> −1.509 </td>
   <td style="text-align:center;"> −1.510 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px"> causeStroke, not ... </td>
   <td style="text-align:center;box-shadow: 0px 1px"> −0.526 </td>
   <td style="text-align:center;box-shadow: 0px 1px"> −0.528 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 357 </td>
   <td style="text-align:center;"> 357 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> −17421.476 </td>
   <td style="text-align:center;"> −2381.392 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ELPD </td>
   <td style="text-align:center;"> −17788.1 </td>
   <td style="text-align:center;"> −2391.2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> ELPD s.e. </td>
   <td style="text-align:center;"> 1865.2 </td>
   <td style="text-align:center;"> 22.9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LOOIC </td>
   <td style="text-align:center;"> 35576.2 </td>
   <td style="text-align:center;"> 4782.4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> LOOIC s.e. </td>
   <td style="text-align:center;"> 3730.5 </td>
   <td style="text-align:center;"> 45.7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> WAIC </td>
   <td style="text-align:center;"> 35695.4 </td>
   <td style="text-align:center;"> 4782.3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 274.05 </td>
   <td style="text-align:center;"> 274.05 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We could use posterior predictive checks to more clearly show that the negative binomial approach is a better choice for this circumstance (<a href="#fig-ppcheckpoissonvsbinomial">Figure&nbsp;<span>14.18</span></a>).</p>
<div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(cause_of_death_alberta_poisson) <span class="sc">+</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(cause_of_death_alberta_neg_binomial) <span class="sc">+</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-ppcheckpoissonvsbinomial" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ppcheckpoissonvsbinomial-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-ppcheckpoissonvsbinomial-1.png" class="img-fluid figure-img" data-ref-parent="fig-ppcheckpoissonvsbinomial" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Poisson model</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ppcheckpoissonvsbinomial-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="14-ijalm_files/figure-html/fig-ppcheckpoissonvsbinomial-2.png" class="img-fluid figure-img" data-ref-parent="fig-ppcheckpoissonvsbinomial" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Negative binomial model</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure 14.18: Comparing posterior prediction checks for Poisson and negative binomial models</figcaption><p></p>
</figure>
</div>
</div>
<p>Finally, we can compare between the models using the resampling method leave-one-out (LOO) cross-validation. This is a variant of cross-validation, introduced earlier, where the size of each fold is one. That is to say, if there was a dataset with 100 observations this LOO is equivalent to 100-fold cross validation. We can implement this in <code>rstanarm</code> with <code>loo()</code> for each model, and then compare between them with <code>loo_compare()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>poisson <span class="ot">&lt;-</span> <span class="fu">loo</span>(cause_of_death_alberta_poisson, <span class="at">cores =</span> <span class="dv">2</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>neg_binomial <span class="ot">&lt;-</span> <span class="fu">loo</span>(cause_of_death_alberta_neg_binomial, <span class="at">cores =</span> <span class="dv">2</span>)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(poisson, neg_binomial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                    elpd_diff se_diff 
cause_of_death_alberta_neg_binomial      0.0       0.0
cause_of_death_alberta_poisson      -15396.9    1844.8</code></pre>
</div>
</div>
<p>In this case we find that the negative binomial model is a better fit than the Poisson.</p>
<!-- ### Proportional hazards -->
<!-- Could do like how long someone has to wait for something? -->
</section>
</section>
<section id="deploying-models" class="level2" data-number="14.8">
<h2 data-number="14.8" class="anchored" data-anchor-id="deploying-models"><span class="header-section-number">14.8</span> Deploying models</h2>
<p>Having done the work to develop a dataset and explore it with a model that we are confident can be used, we may wish to enable this to be used more widely thank just our own computer. There are a variety of ways of doing this, including:</p>
<ul>
<li>using the cloud,</li>
<li>creating R packages,</li>
<li>making <code>shiny</code> applications, and</li>
<li>using <code>plumber</code> to create an API.</li>
</ul>
<p>The general idea here is that we need to know, and allow others to come to trust, the whole workflow. That is what our approach to this point brings. After this, then we may like to use our model more broadly. Say we been able to scrape some data from a website, bring some order to that chaos, make some charts, appropriately model it, and write this all up. In most academic settings that is more than enough. But in many industry settings we would like to use the model to do something. For instance, setting up a website that allows a model to be used to generate an insurance quote given several inputs.</p>
<p>In this chapter, we begin by moving our compute from our local computer to the cloud. We then describe the use of R packages and Shiny for sharing models. That works well, but in some settings other users may like to interact with our model in ways that we are not focused on. One way to allow this is to make our results available to other computers, and for that we will want to make an APIs. Hence, we introduce <code>plumber</code> <span class="citation" data-cites="plumber">(<a href="99-references.html#ref-plumber" role="doc-biblioref">Schloerke and Allen 2021</a>)</span>, which is a way of creating APIs.</p>
<section id="amazon-web-services" class="level3" data-number="14.8.1">
<h3 data-number="14.8.1" class="anchored" data-anchor-id="amazon-web-services"><span class="header-section-number">14.8.1</span> Amazon Web Services</h3>
<p>Apocryphally the cloud is just another name for someone else’s computer. And while that is true to various degrees, for our purposes that is enough. Learning to use someone else’s computer can be great for a number of reasons including:</p>
<ol type="1">
<li>Scalability: It can be quite expensive to buy a new computer, especially if we only need it to run something every now and then, but by using the cloud, we can just rent for a few hours or days. This allows use to amortize this cost and work out what we actually need before committing to a purchase. It also allows us to easily increase or decrease the compute scale if we suddenly have a substantial increase in demand.</li>
<li>Portability: If we can shift our analysis workflow from a local computer to the cloud, then that suggests that there is we are likely doing good things in terms of reproducibility and portability. At the very least, code can run both locally and on the cloud, which is a big step in terms of reproducibility.</li>
<li>Set-and-forget: If we are doing something that will take a while, then it can be great to not have to worry about our own computer needing to run overnight. Additionally, on many cloud options, open-source statistical software, such as R and Python, is either already available, or relatively easy to set-up.</li>
</ol>
<p>That said, there are downsides, including:</p>
<ul>
<li>Cost: While most cloud options are cheap, they are rarely free. To provide an idea of cost, using a well-featured AWS instance for a few days, may end up being a few dollars. It is also easy to accidentally forget about something, and generate unexpectedly large bills, especially initially.</li>
<li>Public: It can be easy to make mistakes and accidentally make everything public.</li>
<li>Time: It takes time to get set-up and comfortable on the cloud.</li>
</ul>
<p>When we use the cloud, we are typically running code on a “virtual machine” (VM). This is an allocation that is part of a larger collection of computers that has been designed to act like a computer with specific features. For instance, we may specify that our virtual machine has, say, 8 GB RAM, 128 storage, and 4 CPUs. The VM would then act like a computer with those specifications. The cost to use cloud options increases based on the VM specifications.</p>
<p>In a sense, we started with a cloud option, through our initial recommendation, in <a href="02-drinking_from_a_fire_hose.html"><span>Chapter&nbsp;2</span></a> of using RStudio Cloud, before we moved to our local computer in <a href="03-r_essentials.html"><span>Chapter&nbsp;3</span></a>. That cloud option was specifically designed for beginners. We will now introduce a more general cloud option: Amazon Web Services (AWS). Often a particular business will use a particular cloud option, such as Google, AWS, or Azure, but developing familiarity with one will make the use of the others easier.</p>
<p>Amazon Web Services is a cloud service from Amazon. To get started we need to create an AWS Developer account <a href="https://aws.amazon.com/developer/">here</a> (<a href="#fig-awsone">Figure&nbsp;<span>14.19 (a)</span></a>).</p>
<div id="fig-ipums" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-awsone" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/aws_one.png" class="img-fluid figure-img" data-ref-parent="fig-ipums"></p>
<p></p><figcaption class="figure-caption">(a) AWS Developer website</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-awstwo" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/aws_two.png" class="img-fluid figure-img" data-ref-parent="fig-ipums"></p>
<p></p><figcaption class="figure-caption">(b) AWS Developer console</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-awsthree" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/aws_three.png" class="img-fluid figure-img" data-ref-parent="fig-ipums"></p>
<p></p><figcaption class="figure-caption">(c) Launching an AWSinstance</figcaption><p></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-awsfive" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/aws_five.png" class="img-fluid figure-img" data-ref-parent="fig-ipums"></p>
<p></p><figcaption class="figure-caption">(d) Establishing a key-pair</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure 14.19: Overview of getting Amazon AWS set-up</figcaption><p></p>
</figure>
</div>
<p>After we have created an account, we need to select a region where the computer that we will access is located. After this, we want to “Launch a virtual machine” with EC2 (<a href="#fig-awstwo">Figure&nbsp;<span>14.19 (b)</span></a>).</p>
<p>The first step is to choose an Amazon Machine Image (AMI). This provides the details of the computer that you will be using. For instance, a local computer may be a MacBook running Monterey. Louis Aslett provides AMIs that are already set-up with RStudio and much else <a href="http://www.louisaslett.com/RStudio_AMI/">here</a>. We can either search for the AMI of the region that we registered for, or click on the relevant link on Aslett’s website. For instance, to use the AMI set-up for the Canadian central region we search for “ami-0bdd24fd36f07b638”. The benefit of using these AMIs is that they are set-up specifically for RStudio, but the trade-off is that they are a little outdated, as they were compiled in August 2020.</p>
<p>In the next step we can choose how powerful the computer will be. The free tier is basic computer, but we can choose better ones when we need them. At this point we can pretty much just launch the instance (<a href="#fig-awsthree">Figure&nbsp;<span>14.19 (c)</span></a>). If we start using AWS more seriously, then we could go back and select different options, especially around the security of the account. AWS relies on key pairs. And so, we will need to create a PEM and save it locally (<a href="#fig-awsfive">Figure&nbsp;<span>14.19 (d)</span></a>). We can then launch the instance.</p>
<p>After a few minutes, the instance will be running. We can use it by pasting the “public DNS” into a browser. The username is “rstudio” and the password is the instance ID.</p>
<p>We should have RStudio running, which is exciting. The first thing to do is probably to change the default password using the instructions in the instance.</p>
<p>We do not need to install, say, the <code>tidyverse</code>, instead we can just call the library and keep going. This is because this AMI comes with many packages already installed. We can see the list of packages that are installed with <code>installed.packages()</code>. For instance, <code>rstan</code> is already installed, and we could set-up an instance with GPUs if we needed.</p>
<p>Perhaps as important as being able to start an AWS instance is being able to stop it (so that we do not get billed). The free tier is useful, but we do need to turn it off. To stop an instance, in the AWS instances page, select it, then “Actions -&gt; Instance State -&gt; Terminate”.</p>
<!-- ## R packages -->
<!-- To this point we have largely been using R Packages to do things for us. However, another way is to have them loaded -->
<!-- ## Shiny -->
</section>
<section id="plumber-and-model-apis" class="level3" data-number="14.8.2">
<h3 data-number="14.8.2" class="anchored" data-anchor-id="plumber-and-model-apis"><span class="header-section-number">14.8.2</span> Plumber and model APIs</h3>
<p>The general idea behind the <code>plumber</code> package <span class="citation" data-cites="plumber">(<a href="99-references.html#ref-plumber" role="doc-biblioref">Schloerke and Allen 2021</a>)</span> is that we can train a model and make it available via an API that we can call when we want a forecast.</p>
<p>Just to get something working, let us make a function that returns “Hello Toronto” regardless of the output. Open a new R file, add the following, and then save it as “plumber.R” (you may need to install the <code>plumber</code> package if you have not done that yet).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plumber)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co">#* @get /print_toronto</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>print_toronto <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="st">"Hello Toronto"</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After that is saved, in the top right of the editor you should get a button to “Run API”. Click that, and your API should load. It will be a “Swagger” application, which provides a GUI around our API. Expand the GET method, and then click “Try it out” and “Execute”. In the response body, you should get “Toronto”.</p>
<p>To more closely reflect the fact that this is an API designed for computers, you can copy/paste the “request HTML” into a browser and it should return “Hello Toronto”.</p>
<section id="local-model" class="level4" data-number="14.8.2.1">
<h4 data-number="14.8.2.1" class="anchored" data-anchor-id="local-model"><span class="header-section-number">14.8.2.1</span> Local model</h4>
<p>Now, we are going to update the API so that it serves a model output, given some input. We are going to follow <span class="citation" data-cites="buhrplumber">Buhr (<a href="99-references.html#ref-buhrplumber" role="doc-biblioref">2017</a>)</span> fairly closely.</p>
<p>At this point, we should start a new R Project. To get started, let us simulate some data and then train a model on it. In this case we are interested in forecasting how long a baby may sleep overnight, given we know how long they slept during their afternoon nap.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>number_of_observations <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>baby_sleep <span class="ot">&lt;-</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">afternoon_nap_length =</span> <span class="fu">rnorm</span>(number_of_observations, <span class="dv">120</span>, <span class="dv">5</span>) <span class="sc">|&gt;</span> <span class="fu">abs</span>(),</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">noise =</span> <span class="fu">rnorm</span>(number_of_observations, <span class="dv">0</span>, <span class="dv">120</span>),</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">night_sleep_length =</span> afternoon_nap_length <span class="sc">*</span> <span class="dv">4</span> <span class="sc">+</span> noise,</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>baby_sleep <span class="sc">|&gt;</span></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> afternoon_nap_length, <span class="at">y =</span> night_sleep_length)) <span class="sc">+</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Baby's afternoon nap length (minutes)"</span>,</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Baby's overnight sleep length (minutes)"</span></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us now use <code>tidymodels</code> to quickly make a model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>baby_sleep_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(baby_sleep, <span class="at">prop =</span> <span class="fl">0.80</span>)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>baby_sleep_train <span class="ot">&lt;-</span> <span class="fu">training</span>(baby_sleep_split)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>baby_sleep_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(baby_sleep_split)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">"lm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>    night_sleep_length <span class="sc">~</span> afternoon_nap_length,</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> baby_sleep_train</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(<span class="at">x =</span> model, <span class="at">file =</span> <span class="st">"baby_sleep.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At this point, we have a model. One difference from what you might be used to is that we have saved the model as an “.rds” file. We are going to read that in.</p>
<p>Now that we have our model we want to put that into a file that we will use the API to access, again called “plumber.R”. And we also want a file that sets up the API, called “server.R”. Make an R script called “server.R” and add the following content:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plumber)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>serve_model <span class="ot">&lt;-</span> <span class="fu">plumb</span>(<span class="st">"plumber.R"</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>serve_model<span class="sc">$</span><span class="fu">run</span>(<span class="at">port =</span> <span class="dv">8000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then in “plumber.R” add the following content:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plumber)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"baby_sleep.rds"</span>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>version_number <span class="ot">&lt;-</span> <span class="st">"0.0.1"</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>variables <span class="ot">&lt;-</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">afternoon_nap_length =</span> <span class="st">"A value in minutes, likely between 0 and 240."</span>,</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">night_sleep_length =</span> <span class="st">"A forecast, in minutes, likely between 0 and 1000."</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a><span class="co">#* @param afternoon_nap_length</span></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a><span class="co">#* @get /survival</span></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>predict_sleep <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">afternoon_nap_length =</span> <span class="dv">0</span>) {</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>  afternoon_nap_length <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(afternoon_nap_length)</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>  payload <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">afternoon_nap_length =</span> afternoon_nap_length)</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>  prediction <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, payload)</span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">input =</span> <span class="fu">list</span>(payload),</span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">response =</span> <span class="fu">list</span>(<span class="st">"estimated_night_sleep"</span> <span class="ot">=</span> prediction),</span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="dv">200</span>,</span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">model_version =</span> version_number</span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again, after we save the “plumber.R” file we should have an option to “Run API”. Click that and you can try out the API locally in the same way as before.</p>
</section>
<section id="cloud-model" class="level4" data-number="14.8.2.2">
<h4 data-number="14.8.2.2" class="anchored" data-anchor-id="cloud-model"><span class="header-section-number">14.8.2.2</span> Cloud model</h4>
<p>To this point, we have got an API working on our own machine, but what we really want to do is to get it working on a computer such that the API can be accessed by anyone. To do this we are going to use <a href="https://www.digitalocean.com">DigitalOcean</a>. It is a charged service, but when you create an account, it will come with $100 in credit, which will be enough to get started.</p>
<p>This set-up process will take some time, but we only need to do it once. Install two additional packages that will assist here are <code>plumberDeploy</code> <span class="citation" data-cites="plumberdeploy">(<a href="99-references.html#ref-plumberdeploy" role="doc-biblioref">Allen 2021</a>)</span> and <code>analogsea</code> <span class="citation" data-cites="citeanalogsea">(<a href="99-references.html#ref-citeanalogsea" role="doc-biblioref">Chamberlain, Wickham, and Chang 2021</a>)</span> (which will need to be installed from GitHub <code>remotes::install_github("sckott/analogsea")</code>).</p>
<p>Now we need to connect the local computer with the DigitalOcean account.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(analogsea)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="fu">account</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we need to authenticate the connection, and this is done using a SSH public key.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">key_create</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What you want is to have a “.pub” file on our computer. Then copy the public key aspect in that file, and add it to the SSH keys section in the account security settings. When we have the key on our local computer, then we can check this using <code>ssh</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ssh)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh_key_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again, this will all take a while to validate. DigitalOcean calls every computer that we start a “droplet”. If we start three computers, then we will have started three droplets. We can check the droplets that are running.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">droplets</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If everything is set-up properly, then this will print the information about all droplets that you have associated with the account (which at this point, is probably none). We first create a droplet.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plumberDeploy)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">do_provision</span>(<span class="at">example =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we get asked for the SSH passphrase and then it will just set-up a bunch of things. After this we are going to need to install a whole bunch of things onto our droplet.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install_r_package</span>(</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">droplet =</span> id,</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"plumber"</span>,</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"remotes"</span>,</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"here"</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="fu">debian_apt_get_install</span>(</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>  id,</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"libssl-dev"</span>,</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"libsodium-dev"</span>,</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"libcurl4-openssl-dev"</span></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="fu">debian_apt_get_install</span>(</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>  id,</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"libxml2-dev"</span></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a><span class="fu">install_r_package</span>(</span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>  id,</span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"config"</span>,</span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"httr"</span>,</span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"urltools"</span>,</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"plumber"</span></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a><span class="fu">install_r_package</span>(id, <span class="fu">c</span>(<span class="st">"xml2"</span>))</span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a><span class="fu">install_r_package</span>(id, <span class="fu">c</span>(<span class="st">"tidyverse"</span>))</span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a><span class="fu">install_r_package</span>(id, <span class="fu">c</span>(<span class="st">"tidymodels"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And then when that is finally set-up (it will take 30 minutes or so) we can deploy our API.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">do_deploy_api</span>(</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">droplet =</span> id,</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="st">"example"</span>,</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">localPath =</span> <span class="fu">getwd</span>(),</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">port =</span> <span class="dv">8000</span>,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">docs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="exercises-and-tutorial" class="level2" data-number="14.9">
<h2 data-number="14.9" class="anchored" data-anchor-id="exercises-and-tutorial"><span class="header-section-number">14.9</span> Exercises and tutorial</h2>
<section id="exercises" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="exercises">Exercises</h3>
<ol type="1">
<li><em>(Plan)</em> Consider the following scenario: <em>A person is interested in the heights of all the buildings in London. They walk around the city counting the number of floors for each building.</em> Please sketch out what that dataset could look like and then sketch a graph that you could build to show all observations.</li>
<li><em>(Simulate)</em> Please further consider the scenario described and simulate the situation, along with three independent variables that are associated the count of the number of levels.</li>
<li><em>(Acquire)</em> Please describe one possible source of such a dataset.</li>
<li><em>(Explore)</em> Please use <code>ggplot2</code> to build the graph that you sketched.</li>
<li><em>(Communicate)</em> Please write two paragraphs about what you did.</li>
<li>Please simulate the situation in which there are two independent variables, “race” and “gender”, and one dependent variable, “vote_preference”, which is imperfectly related to them.</li>
<li>Please write a linear relationship between some response variable, Y, and some predictor, X. What is the intercept term? What is the slope term? What would adding a hat to these indicate?</li>
<li>What is the least squares criterion? Similarly, what is RSS and what are we trying to do when we run least squares regression?</li>
<li>What is statistical bias?</li>
<li>If there were three variables: Snow, Temperature, and Wind, please write R code that would fit a simple linear regression to explain Snow as a function of Temperature and Wind. What do you think about another explanatory variable - daily stock market returns - to your model?</li>
<li>According to <span class="citation" data-cites="greenland2016statistical">Greenland et al. (<a href="99-references.html#ref-greenland2016statistical" role="doc-biblioref">2016</a>)</span>, p-values test (pick one)?
<ol type="a">
<li>All the assumptions about how the data were generated (the entire model), not just the targeted hypothesis it is supposed to test (such as a null hypothesis).</li>
<li>Whether the hypothesis targeted for testing is true or not.</li>
<li>A dichotomy whereby results can be declared “statistically significant”.</li>
</ol></li>
<li>According to <span class="citation" data-cites="greenland2016statistical">Greenland et al. (<a href="99-references.html#ref-greenland2016statistical" role="doc-biblioref">2016</a>)</span>, a p-value may be small because (select all)?
<ol type="a">
<li>The targeted hypothesis is false.</li>
<li>The study protocols were violated.</li>
<li>It was selected for presentation based on its small size.</li>
</ol></li>
<li>According to <span class="citation" data-cites="obermeyer2019dissecting">Obermeyer et al. (<a href="99-references.html#ref-obermeyer2019dissecting" role="doc-biblioref">2019</a>)</span>, why does racial bias occur in an algorithm used to guide health decisions in the US (pick one)?
<ol type="a">
<li>The algorithm uses health costs as a proxy for health needs.</li>
<li>The algorithm was trained on Reddit data.</li>
</ol></li>
<li>When should we use logistic regression (pick one)?
<ol type="a">
<li>Continuous dependent variable.</li>
<li>Binary dependent variable.</li>
<li>Count dependent variable.</li>
</ol></li>
<li>We are interested in studying how voting intentions in the recent US presidential election vary by an individual’s income. We set up a logistic regression model to study this relationship. In this study, one possible dependent variable would be (pick one)?
<ol type="a">
<li>Whether the respondent is a US citizen (yes/no)</li>
<li>The respondent’s personal income (high/low)</li>
<li>Whether the respondent is going to vote for Trump (yes/no)</li>
<li>Who the respondent voted for in 2016 (Trump/Clinton)</li>
</ol></li>
<li>We are interested in studying how voting intentions in the recent US presidential election vary by an individual’s income. We set up a logistic regression model to study this relationship. In this study, one possible dependent variable would be (pick one)?
<ol type="a">
<li>The race of the respondent (white/not white)</li>
<li>The respondent’s marital status (married/not)</li>
<li>Whether the respondent is registered to vote (yes/no)</li>
<li>Whether the respondent is going to vote for Biden (yes/no)</li>
</ol></li>
<li>Please explain what a p-value is, using only the term itself (i.e.&nbsp;“p-value”) and words that are amongst the 1,000 most common in the English language according to the <a href="https://xkcd.com/simplewriter/">XKCD Simple Writer</a>. (Please write one or two paragraphs.)</li>
<li>The mean of a Poisson distribution is equal to its?
<ol type="a">
<li>Median.</li>
<li>Standard deviation.</li>
<li>Variance.</li>
</ol></li>
<li>What is power (in a statistical context)?</li>
<li>According to <span class="citation" data-cites="citemcelreath">McElreath (<a href="99-references.html#ref-citemcelreath" role="doc-biblioref">2020, 162</a>)</span> “Regression will not sort it out. Regression is indeed an oracle, but a cruel one. It speaks in riddles and delights in punishing us for…” (please select one answer)?
<ol type="a">
<li>overcomplicating models.</li>
<li>asking bad questions.</li>
<li>using bad data.</li>
</ol></li>
<li>Is a model that fits the small or large world more important to you, and why?</li>
<li>Please redo the <code>tidymodels</code> example of US elections but include additional variables. Which variable did you choose, and how did the performance of the model improve?</li>
<li>Please create the graph of the density of the Poisson distribution when <span class="math inline">\(\lambda = 75\)</span>.</li>
<li>From <span class="citation" data-cites="gelmanhillvehtari2020">Gelman, Hill, and Vehtari (<a href="99-references.html#ref-gelmanhillvehtari2020" role="doc-biblioref">2020</a>)</span>, what is the offset in Poisson regression?</li>
<li>Redo the <em>Jane Eyre</em> example, but for “A/a”.</li>
</ol>
</section>
<section id="tutorial" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="tutorial">Tutorial</h3>
<p><strong>Option 1:</strong></p>
<p>Allow that the true data generating process is the Normal distribution with mean of one, and standard deviation of 1. We obtain a sample of 1,000 observations using some instrument. Simulate the following situation:</p>
<ol type="1">
<li>Unknown to us, the instrument has a mistake in it, which means that it has a maximum memory of 900 observations, and begins over-writing at that point, so the final 100 observations are actually a repeat of the first 100.</li>
<li>We employ a research assistant to clean and prepare the dataset. During the process of doing this, unknown to us, they accidentally change half of the negative draws to be positive.</li>
<li>They additionally, accidentally, change the decimal place on any value between 1 and 1.1, so that, for instance 1 becomes 0.1, and 1.1 would become 0.11.</li>
<li>You finally get the cleaned dataset and are interested in understanding whether the mean of the true data generating process is greater than 0.</li>
</ol>
<p>Discuss your analysis of the data, and the effect the issues have had, and finally some steps you can put in place to ensure actual analysis has a chance to flag some of these issues.</p>
<p><strong>Option 2:</strong></p>
<p>You are interested in the characteristics of people’s friendship groups and how those characteristics relate to individual-level outcomes, particularly economic measures.</p>
<p>You have access to individual-level data from a social media website, which contains information about social interactions (comments on posts, tags, etc) on the website, as well as a wide variety of individual-level characteristics.</p>
<ol type="1">
<li>While the social media website is very popular, not everyone in the population you are interested in has an account, and not everyone that has an account is active on the website. Given you are interested in economic measures, what are some possible issues with using these data to make inferences about the broader population?</li>
<li>The data do not contain information on individual-level income. But for around 20 per cent of the sample you have information on the “census block” of the individual. By way of background, a census block contains no more than 3,000 individuals. The median income of each census block is known. As such, you decide to estimate individual level income as follows:
<ol type="a">
<li>Regress the median income of each census block on a series of individual level characteristics (such as age, education, marital status, gender, …).</li>
<li>Use these estimates to predict the income of individuals that do not have location information. Briefly discuss the advantages and disadvantages of this approach, particularly in how it could affect the study of income characteristics of friendship groups. Ensure that you address the ecological fallacy.</li>
</ol></li>
<li>Understandably, the social media website will not allow the unfettered distribution of individual-level data. What are some ways in which you might nonetheless enhance the reproducibility of your work?</li>
</ol>
<p>This should take at least two pages.</p>
<p><strong>Option 3:</strong></p>
<p>Please consider <span class="citation" data-cites="maher1982modelling">Maher (<a href="99-references.html#ref-maher1982modelling" role="doc-biblioref">1982</a>)</span> or <span class="citation" data-cites="thanksleo">Smith (<a href="99-references.html#ref-thanksleo" role="doc-biblioref">2002</a>)</span>. Build a simplified version of their model. Obtain some recent relevant data, estimate the model, and discuss your choice between Poisson and negative binomial regression.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-plumberdeploy" class="csl-entry" role="doc-biblioentry">
Allen, Jeff. 2021. <em><span class="nocase">plumberDeploy: Plumber Deployment</span></em>. <a href="https://CRAN.R-project.org/package=plumberDeploy">https://CRAN.R-project.org/package=plumberDeploy</a>.
</div>
<div id="ref-guidetothe2020ces" class="csl-entry" role="doc-biblioentry">
Ansolabehere, Stephen, Brian Schaffner, and Sam Luks. 2021. <span>“<span class="nocase">Guide to the 2020 Cooperative Election Study</span>.”</span> <a href="https://doi.org/10.7910/DVN/E9N6PH">https://doi.org/10.7910/DVN/E9N6PH</a>.
</div>
<div id="ref-citemodelsummary" class="csl-entry" role="doc-biblioentry">
Arel-Bundock, Vincent. 2021. <em><span class="nocase">modelsummary: Summary Tables and Plots for Statistical Models and Data: Beautiful, Customizable, and Publication-Ready</span></em>. <a href="https://CRAN.R-project.org/package=modelsummary">https://CRAN.R-project.org/package=modelsummary</a>.
</div>
<div id="ref-marginaleffects" class="csl-entry" role="doc-biblioentry">
———. 2022. <em><span class="nocase">marginaleffects: Marginal Effects, Marginal Means, Predictions, and Contrasts</span></em>. <a href="https://CRAN.R-project.org/package=marginaleffects">https://CRAN.R-project.org/package=marginaleffects</a>.
</div>
<div id="ref-beepr" class="csl-entry" role="doc-biblioentry">
Bååth, Rasmus. 2018. <em><span class="nocase">beepr: Easily Play Notification Sounds on any Platform</span></em>. <a href="https://CRAN.R-project.org/package=beepr">https://CRAN.R-project.org/package=beepr</a>.
</div>
<div id="ref-democratizingr" class="csl-entry" role="doc-biblioentry">
Blair, James. 2019. <em><span class="nocase">Democratizing R with Plumber APIs</span></em>. <a href="https://www.rstudio.com/resources/rstudioconf-2019/democratizing-r-with-plumber-apis/">https://www.rstudio.com/resources/rstudioconf-2019/democratizing-r-with-plumber-apis/</a>.
</div>
<div id="ref-boltonruth" class="csl-entry" role="doc-biblioentry">
Bolton, Ruth, and Randall Chapman. 1986. <span>“Searching for Positive Returns at the Track.”</span> <em>Management Science</em> 32 (August): 1040–60. <a href="https://doi.org/10.1287/mnsc.32.8.1040">https://doi.org/10.1287/mnsc.32.8.1040</a>.
</div>
<div id="ref-breiman2001statistical" class="csl-entry" role="doc-biblioentry">
Breiman, Leo. 2001. <span>“Statistical Modeling: The Two Cultures.”</span> <em>Statistical Science</em> 16 (3): 199–231. <a href="https://doi.org/10.1214/ss/1009213726">https://doi.org/10.1214/ss/1009213726</a>.
</div>
<div id="ref-buhrplumber" class="csl-entry" role="doc-biblioentry">
Buhr, Ray. 2017. <em><span class="nocase">Using R as a Production Machine Learning Language (Part I)</span></em>. <a href="https://raybuhr.github.io/blog/posts/making-predictions-over-http/">https://raybuhr.github.io/blog/posts/making-predictions-over-http/</a>.
</div>
<div id="ref-citeanalogsea" class="csl-entry" role="doc-biblioentry">
Chamberlain, Scott, Hadley Wickham, and Winston Chang. 2021. <em>Analogsea: Interface to <span>“Digital Ocean”</span></em>. <a href="https://github.com/sckott/analogsea">https://github.com/sckott/analogsea</a>.
</div>
<div id="ref-chellel2018gambler" class="csl-entry" role="doc-biblioentry">
Chellel, Kit. 2018. <span>“The Gambler Who Cracked the Horse-Racing Code.”</span> <em>Bloomberg Businessweek</em>, May. <a href="https://www.bloomberg.com/news/features/2018-05-03/the-gambler-who-cracked-the-horse-racing-code">https://www.bloomberg.com/news/features/2018-05-03/the-gambler-who-cracked-the-horse-racing-code</a>.
</div>
<div id="ref-cohn2016" class="csl-entry" role="doc-biblioentry">
Cohn, Nate. 2016. <span>“We Gave Four Good Pollsters the Same Raw Data. They Had Four Different Results.”</span> <em>New York Times</em>, September. <a href="https://www.nytimes.com/interactive/2016/09/20/upshot/the-error-the-polling-world-rarely-talks-about.html">https://www.nytimes.com/interactive/2016/09/20/upshot/the-error-the-polling-world-rarely-talks-about.html</a>.
</div>
<div id="ref-coxtalks" class="csl-entry" role="doc-biblioentry">
Cox, David. 2018. <span>“In Gentle Praise of Significance Tests.”</span> <em>YouTube</em>, October. <a href="https://youtu.be/txLj%5FP9UlCQ">https://youtu.be/txLj%5FP9UlCQ</a>.
</div>
<div id="ref-cox1987parameter" class="csl-entry" role="doc-biblioentry">
Cox, David, and Nancy Reid. 1987. <span>“Parameter Orthogonality and Approximate Conditional Inference.”</span> <em>Journal of the Royal Statistical Society: Series B (Methodological)</em> 49 (1): 1–18. <a href="https://doi.org/10.1111/j.2517-6161.1987.tb01422.x">https://doi.org/10.1111/j.2517-6161.1987.tb01422.x</a>.
</div>
<div id="ref-cramer2002origins" class="csl-entry" role="doc-biblioentry">
Cramer, Jan Salomon. 2003. <span>“The Origins of Logistic Regression.”</span> <em><span>SSRN</span> Electronic Journal</em>. <a href="https://doi.org/10.2139/ssrn.360300">https://doi.org/10.2139/ssrn.360300</a>.
</div>
<div id="ref-edgeworth1885methods" class="csl-entry" role="doc-biblioentry">
Edgeworth, Francis Ysidro. 1885. <span>“Methods of Statistics.”</span> <em>Journal of the Statistical Society of London</em>, 181–217. <a href="https://doi.org/10.1111/j.2397-2343.1885.tb02171.x">https://doi.org/10.1111/j.2397-2343.1885.tb02171.x</a>.
</div>
<div id="ref-fisherarrangement" class="csl-entry" role="doc-biblioentry">
Fisher, Ronald. 1926. <span>“<span class="nocase">The Arrangement of Field Experiments</span>,”</span> 503–15. <a href="https://doi.org/10.23637/rothamsted.8v61q">https://doi.org/10.23637/rothamsted.8v61q</a>.
</div>
<div id="ref-HistData" class="csl-entry" role="doc-biblioentry">
Friendly, Michael. 2021. <em>HistData: Data Sets from the History of Statistics and Data Visualization</em>. <a href="https://CRAN.R-project.org/package=HistData">https://CRAN.R-project.org/package=HistData</a>.
</div>
<div id="ref-selectiveinference" class="csl-entry" role="doc-biblioentry">
Gao, Lucy, Jacob Bien, and Daniela Witten. 2020. <span>“Selective Inference for Hierarchical Clustering.”</span> arXiv. <a href="https://doi.org/10.48550/ARXIV.2012.02936">https://doi.org/10.48550/ARXIV.2012.02936</a>.
</div>
<div id="ref-gelmanhillvehtari2020" class="csl-entry" role="doc-biblioentry">
Gelman, Andrew, Jennifer Hill, and Aki Vehtari. 2020. <em>Regression and Other Stories</em>. Cambridge University Press. <a href="https://avehtari.github.io/ROS-Examples/">https://avehtari.github.io/ROS-Examples/</a>.
</div>
<div id="ref-bayesianworkflow" class="csl-entry" role="doc-biblioentry">
Gelman, Andrew, Aki Vehtari, Daniel Simpson, Charles Margossian, Bob Carpenter, Yuling Yao, Lauren Kennedy, Jonah Gabry, Paul-Christian Bürkner, and Martin Modrák. 2020. <span>“Bayesian Workflow.”</span> arXiv. <a href="https://doi.org/10.48550/arXiv.2011.01808">https://doi.org/10.48550/arXiv.2011.01808</a>.
</div>
<div id="ref-Gentemann2021" class="csl-entry" role="doc-biblioentry">
Gentemann, Chelle Leigh, Chris Holdgraf, Ryan Abernathey, Daniel Crichton, James Colliander, Edward Joseph Kearns, Yuvi Panda, and Richard Signell. 2021. <span>“Science Storms the Cloud.”</span> <em><span>AGU</span> Advances</em> 2 (2). <a href="https://doi.org/10.1029/2020av000354">https://doi.org/10.1029/2020av000354</a>.
</div>
<div id="ref-citerstanarm" class="csl-entry" role="doc-biblioentry">
Goodrich, Ben, Jonah Gabry, Imad Ali, and Sam Brilleman. 2020. <span>“<span class="nocase">rstanarm: <span>Bayesian</span> applied regression modeling via <span>Stan</span></span>.”</span> <a href="https://mc-stan.org/rstanarm">https://mc-stan.org/rstanarm</a>.
</div>
<div id="ref-greenland2016statistical" class="csl-entry" role="doc-biblioentry">
Greenland, Sander, Stephen Senn, Kenneth Rothman, John Carlin, Charles Poole, Steven Goodman, and Douglas Altman. 2016. <span>“<span class="nocase">Statistical tests, P values, confidence intervals, and power: a guide to misinterpretations</span>.”</span> <em>European Journal of Epidemiology</em> 31 (4): 337–50. <a href="https://doi.org/10.1007/s10654-016-0149-3">https://doi.org/10.1007/s10654-016-0149-3</a>.
</div>
<div id="ref-hastie1990generalized" class="csl-entry" role="doc-biblioentry">
Hastie, Trevor, and Robert Tibshirani. 1990. <em>Generalized Additive Models</em>. Chapman; Hall/CRC.
</div>
<div id="ref-chiphuyenone" class="csl-entry" role="doc-biblioentry">
Huyen, Chip. 2020. <span>“Machine Learning Is Going Real-Time,”</span> December. <a href="https://huyenchip.com/2020/12/27/real-time-machine-learning.html">https://huyenchip.com/2020/12/27/real-time-machine-learning.html</a>.
</div>
<div id="ref-ioannidis2005most" class="csl-entry" role="doc-biblioentry">
Ioannidis, John. 2005. <span>“Why Most Published Research Findings Are False.”</span> <em>PLoS Medicine</em> 2 (8): e124. <a href="https://doi.org/10.1371/journal.pmed.0020124">https://doi.org/10.1371/journal.pmed.0020124</a>.
</div>
<div id="ref-islr" class="csl-entry" role="doc-biblioentry">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2021. <em><span class="nocase">An Introduction to Statistical Learning with Applications in R</span></em>. 2nd ed. Springer. <a href="https://www.statlearning.com">https://www.statlearning.com</a>.
</div>
<div id="ref-kapoornarayanan2022" class="csl-entry" role="doc-biblioentry">
Kapoor, Sayash, and Arvind Narayanan. 2022. <span>“Leakage and the Reproducibility Crisis in ML-Based Science.”</span> arXiv. <a href="https://doi.org/10.48550/ARXIV.2207.07048">https://doi.org/10.48550/ARXIV.2207.07048</a>.
</div>
<div id="ref-wakefieldestimates" class="csl-entry" role="doc-biblioentry">
Knutson, Victoria, Serge Aleshin-Guendel, Ariel Karlinsky, William Msemburi, and Jon Wakefield. 2022. <span>“Estimating Global and Country-Specific Excess Mortality During the COVID-19 Pandemic,”</span> May. <a href="https://cdn.who.int/media/docs/default-source/world-health-data-platform/covid-19-excessmortality/covid-methods-paper-revision.pdf">https://cdn.who.int/media/docs/default-source/world-health-data-platform/covid-19-excessmortality/covid-methods-paper-revision.pdf</a>.
</div>
<div id="ref-poissonreg" class="csl-entry" role="doc-biblioentry">
Kuhn, Max. 2021. <em><span class="nocase">poissonreg: Model Wrappers for Poisson Regression</span></em>. <a href="https://CRAN.R-project.org/package=poissonreg">https://CRAN.R-project.org/package=poissonreg</a>.
</div>
<div id="ref-tune" class="csl-entry" role="doc-biblioentry">
———. 2022. <em><span class="nocase">tune: Tidy Tuning Tools</span></em>. <a href="https://CRAN.R-project.org/package=tune">https://CRAN.R-project.org/package=tune</a>.
</div>
<div id="ref-parsnip" class="csl-entry" role="doc-biblioentry">
Kuhn, Max, and Davis Vaughan. 2022a. <em><span class="nocase">parsnip: A Common API to Modeling and Analysis Functions</span></em>. <a href="https://CRAN.R-project.org/package=parsnip">https://CRAN.R-project.org/package=parsnip</a>.
</div>
<div id="ref-yardstick" class="csl-entry" role="doc-biblioentry">
———. 2022b. <em><span class="nocase">yardstick: Tidy Characterizations of Model Performance</span></em>. <a href="https://CRAN.R-project.org/package=yardstick">https://CRAN.R-project.org/package=yardstick</a>.
</div>
<div id="ref-citeTidymodels" class="csl-entry" role="doc-biblioentry">
Kuhn, Max, and Hadley Wickham. 2020. <em>Tidymodels: A Collection of Packages for Modeling and Machine Learning Using Tidyverse Principles</em>. <a href="https://www.tidymodels.org">https://www.tidymodels.org</a>.
</div>
<div id="ref-recipes" class="csl-entry" role="doc-biblioentry">
———. 2022. <em><span class="nocase">recipes: Preprocessing and Feature Engineering Steps for Modeling</span></em>. <a href="https://CRAN.R-project.org/package=recipes">https://CRAN.R-project.org/package=recipes</a>.
</div>
<div id="ref-dataverse" class="csl-entry" role="doc-biblioentry">
Kuriwaki, Shiro, Will Beasley, and Thomas Leeper. 2022. <em><span class="nocase">dataverse: R Client for Dataverse 4+ Repositories</span></em>.
</div>
<div id="ref-maher1982modelling" class="csl-entry" role="doc-biblioentry">
Maher, Michael. 1982. <span>“Modelling Association Football Scores.”</span> <em>Statistica Neerlandica</em> 36 (3): 109–18. <a href="https://doi.org/10.1111/j.1467-9574.1982.tb00782.x">https://doi.org/10.1111/j.1467-9574.1982.tb00782.x</a>.
</div>
<div id="ref-citemcelreath" class="csl-entry" role="doc-biblioentry">
McElreath, Richard. 2020. <em><span class="nocase">Statistical Rethinking: A Bayesian Course with Examples in R and Stan</span></em>. 2nd ed. Chapman; Hall/CRC.
</div>
<div id="ref-nelderdoesntmiss" class="csl-entry" role="doc-biblioentry">
Nelder, John. 1999. <span>“From Statistics to Statistical Science.”</span> <em>Journal of the Royal Statistical Society: Series D (The Statistician)</em> 48 (2): 257–69. <a href="https://doi.org/10.1111/1467-9884.00187">https://doi.org/10.1111/1467-9884.00187</a>.
</div>
<div id="ref-nelder1972generalized" class="csl-entry" role="doc-biblioentry">
Nelder, John, and Robert Wedderburn. 1972. <span>“Generalized Linear Models.”</span> <em>Journal of the Royal Statistical Society: Series A (General)</em> 135 (3): 370–84. <a href="https://doi.org/10.2307/2344614">https://doi.org/10.2307/2344614</a>.
</div>
<div id="ref-Neufeld2021" class="csl-entry" role="doc-biblioentry">
Neufeld, Anna, and Daniela Witten. 2021. <span>“Discussion of Breiman’s "Two Cultures": From Two Cultures to One.”</span> <em>Observational Studies</em> 7 (1): 171–74. <a href="https://doi.org/10.1353/obs.2021.0004">https://doi.org/10.1353/obs.2021.0004</a>.
</div>
<div id="ref-obermeyer2019dissecting" class="csl-entry" role="doc-biblioentry">
Obermeyer, Ziad, Brian Powers, Christine Vogeli, and Sendhil Mullainathan. 2019. <span>“Dissecting Racial Bias in an Algorithm Used to Manage the Health of Populations.”</span> <em>Science</em> 366 (6464): 447–53. <a href="https://doi.org/10.1126/science.aax234">https://doi.org/10.1126/science.aax234</a>.
</div>
<div id="ref-ssh" class="csl-entry" role="doc-biblioentry">
Ooms, Jeroen. 2021. <em><span class="nocase">ssh: Secure Shell (SSH) Client for R</span></em>. <a href="https://CRAN.R-project.org/package=ssh">https://CRAN.R-project.org/package=ssh</a>.
</div>
<div id="ref-pitman" class="csl-entry" role="doc-biblioentry">
Pitman, Jim. 1993. <em>Probability</em>. 1st ed. New York: Springer. <a href="https://doi.org/10.1007/978-1-4612-4374-8">https://doi.org/10.1007/978-1-4612-4374-8</a>.
</div>
<div id="ref-citeR" class="csl-entry" role="doc-biblioentry">
R Core Team. 2022. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-reid2003asymptotics" class="csl-entry" role="doc-biblioentry">
Reid, Nancy. 2003. <span>“Asymptotics and the Theory of Inference.”</span> <em>The Annals of Statistics</em> 31 (6): 1695–1731. <a href="https://doi.org/10.1214/aos/1074290325">https://doi.org/10.1214/aos/1074290325</a>.
</div>
<div id="ref-gutenbergr" class="csl-entry" role="doc-biblioentry">
Robinson, David. 2021. <em><span class="nocase">gutenbergr: Download and Process Public Domain Works from Project Gutenberg</span></em>. <a href="https://CRAN.R-project.org/package=gutenbergr">https://CRAN.R-project.org/package=gutenbergr</a>.
</div>
<div id="ref-broom" class="csl-entry" role="doc-biblioentry">
Robinson, David, Alex Hayes, and Simon Couch. 2021. <em><span class="nocase">broom: Convert Statistical Objects into Tidy Tibbles</span></em>. <a href="https://CRAN.R-project.org/package=broom">https://CRAN.R-project.org/package=broom</a>.
</div>
<div id="ref-cooperativeelectionstudyus" class="csl-entry" role="doc-biblioentry">
Schaffner, Brian, Stephen Ansolabehere, and Sam Luks. 2021. <span>“<span>Cooperative Election Study Common Content, 2020</span>.”</span> Harvard Dataverse. <a href="https://doi.org/10.7910/DVN/E9N6PH">https://doi.org/10.7910/DVN/E9N6PH</a>.
</div>
<div id="ref-plumber" class="csl-entry" role="doc-biblioentry">
Schloerke, Barret, and Jeff Allen. 2021. <em><span class="nocase">plumber: An API Generator for R</span></em>. <a href="https://CRAN.R-project.org/package=plumber">https://CRAN.R-project.org/package=plumber</a>.
</div>
<div id="ref-rsample" class="csl-entry" role="doc-biblioentry">
Silge, Julia, Fanny Chow, Max Kuhn, and Hadley Wickham. 2022. <em><span class="nocase">rsample: General Resampling Infrastructure</span></em>. <a href="https://CRAN.R-project.org/package=rsample">https://CRAN.R-project.org/package=rsample</a>.
</div>
<div id="ref-thanksleo" class="csl-entry" role="doc-biblioentry">
Smith, Richard. 2002. <span>“A Statistical Assessment of Buchanan’s Vote in Palm Beach County.”</span> <em>Statistical Science</em> 17 (4): 441–57. <a href="https://doi.org/10.1214/ss/1049993203">https://doi.org/10.1214/ss/1049993203</a>.
</div>
<div id="ref-Staicu2017" class="csl-entry" role="doc-biblioentry">
Staicu, Ana-Maria. 2017. <span>“Interview with Nancy Reid.”</span> <em>International Statistical Review</em> 85 (3): 381–403. <a href="https://doi.org/10.1111/insr.12237">https://doi.org/10.1111/insr.12237</a>.
</div>
<div id="ref-stigler" class="csl-entry" role="doc-biblioentry">
Stigler, Stephen. 1986. <em>The History of Statistics</em>. Massachusetts: Belknap Harvard.
</div>
<div id="ref-varin2011overview" class="csl-entry" role="doc-biblioentry">
Varin, Cristiano, Nancy Reid, and David Firth. 2011. <span>“An Overview of Composite Likelihood Methods.”</span> <em>Statistica Sinica</em>, 5–42.
</div>
<div id="ref-wang2015forecasting" class="csl-entry" role="doc-biblioentry">
Wang, Wei, David Rothschild, Sharad Goel, and Andrew Gelman. 2015. <span>“Forecasting Elections with Non-Representative Polls.”</span> <em>International Journal of Forecasting</em> 31 (3): 980–91. <a href="https://doi.org/10.1016/j.ijforecast.2014.06.001">https://doi.org/10.1016/j.ijforecast.2014.06.001</a>.
</div>
<div id="ref-wasserman" class="csl-entry" role="doc-biblioentry">
Wasserman, Larry. 2005. <em>All of Statistics</em>. Springer.
</div>
<div id="ref-wilde" class="csl-entry" role="doc-biblioentry">
Wilde, Oscar. 1891. <em>The Picture of Dorian Gray</em>. <a href="https://www.gutenberg.org/files/174/174-h/174-h.htm">https://www.gutenberg.org/files/174/174-h/174-h.htm</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./13-eda.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./15-causality_from_obs.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Causality from observational data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>