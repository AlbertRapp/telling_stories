<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.9.185">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Telling Stories with Data - 11&nbsp; Clean and prepare</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
    }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>

  <script src="site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="site_libs/clipboard/clipboard.min.js"></script>
  <meta name="quarto:offset" content="./">
  <script src="site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="site_libs/quarto-search/fuse.min.js"></script>
  <script src="site_libs/quarto-search/quarto-search.js"></script>
  <link href="./12-store_and_share.html" rel="next">
  <link href="./10-hunt.html" rel="prev">
  <script src="site_libs/quarto-html/quarto.js"></script>
  <script src="site_libs/quarto-html/popper.min.js"></script>
  <script src="site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="site_libs/quarto-html/anchor.min.js"></script>
  <link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link id="quarto-text-highlighting-styles" href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script id="quarto-search-options" type="application/json">{
    "location": "sidebar",
    "copy-button": false,
    "collapse-after": 3,
    "panel-placement": "start",
    "type": "textbox",
    "limit": 20,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit"
    }
  }</script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body class="floating">
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Clean and prepare</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Telling Stories with Data</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/RohanAlexander/telling_stories/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-author.html" class="sidebar-item-text sidebar-link">About the author</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Foundations</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Telling stories with data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-drinking_from_a_fire_hose.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Drinking from a fire hose</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-r_essentials.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">R essentials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-workflow.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reproducible workflows</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Communication</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-on_writing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">On writing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-static_communication.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Static communication</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-interactive_communication.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Interactive communication</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Acquisition</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-farm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Farm data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-gather.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Gather data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-hunt.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Hunt data</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Preparation</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-clean_and_prepare.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Clean and prepare</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-store_and_share.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Store and share</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Modelling</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-eda.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-ijalm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">It’s Just A Linear Model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-causality_from_obs.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Causality from observational data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-mrp.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Multilevel regression with post-stratification</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-text.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Text as data</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">Enrichment</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-deploy.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Deploying models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-efficiency.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Efficiency</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-concluding.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Concluding remarks</span></a>
  </div>
</li>
    </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">Appendices</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-assessment.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Papers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./98-cocktails.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Cocktails</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"> <span class="header-section-number">11.1</span> Introduction</a></li>
<li><a href="#workflow" id="toc-workflow" class="nav-link" data-scroll-target="#workflow"> <span class="header-section-number">11.2</span> Workflow</a>
<ul class="collapse">
<li><a href="#save-a-copy-of-the-raw-data" id="toc-save-a-copy-of-the-raw-data" class="nav-link" data-scroll-target="#save-a-copy-of-the-raw-data"> <span class="header-section-number">11.2.1</span> Save a copy of the raw data</a></li>
<li><a href="#begin-with-an-end-in-mind" id="toc-begin-with-an-end-in-mind" class="nav-link" data-scroll-target="#begin-with-an-end-in-mind"> <span class="header-section-number">11.2.2</span> Begin with an end in mind</a></li>
<li><a href="#start-small" id="toc-start-small" class="nav-link" data-scroll-target="#start-small"> <span class="header-section-number">11.2.3</span> Start small</a></li>
<li><a href="#write-tests-and-documentation" id="toc-write-tests-and-documentation" class="nav-link" data-scroll-target="#write-tests-and-documentation"> <span class="header-section-number">11.2.4</span> Write tests and documentation</a></li>
<li><a href="#iterate-generalize-and-update" id="toc-iterate-generalize-and-update" class="nav-link" data-scroll-target="#iterate-generalize-and-update"> <span class="header-section-number">11.2.5</span> Iterate, generalize and update</a></li>
</ul></li>
<li><a href="#case-study-kenya-census" id="toc-case-study-kenya-census" class="nav-link" data-scroll-target="#case-study-kenya-census"> <span class="header-section-number">11.3</span> Case study: Kenya census</a>
<ul class="collapse">
<li><a href="#gather-and-clean-data" id="toc-gather-and-clean-data" class="nav-link" data-scroll-target="#gather-and-clean-data"> <span class="header-section-number">11.3.1</span> Gather and clean data</a></li>
<li><a href="#check-data" id="toc-check-data" class="nav-link" data-scroll-target="#check-data"> <span class="header-section-number">11.3.2</span> Check data</a></li>
<li><a href="#tidy-up" id="toc-tidy-up" class="nav-link" data-scroll-target="#tidy-up"> <span class="header-section-number">11.3.3</span> Tidy-up</a></li>
</ul></li>
<li><a href="#checks-and-tests" id="toc-checks-and-tests" class="nav-link" data-scroll-target="#checks-and-tests"> <span class="header-section-number">11.4</span> Checks and tests</a>
<ul class="collapse">
<li><a href="#graphs" id="toc-graphs" class="nav-link" data-scroll-target="#graphs"> <span class="header-section-number">11.4.1</span> Graphs</a></li>
<li><a href="#counts" id="toc-counts" class="nav-link" data-scroll-target="#counts"> <span class="header-section-number">11.4.2</span> Counts</a></li>
<li><a href="#gono-go" id="toc-gono-go" class="nav-link" data-scroll-target="#gono-go"> <span class="header-section-number">11.4.3</span> Go/no-go</a></li>
<li><a href="#class" id="toc-class" class="nav-link" data-scroll-target="#class"> <span class="header-section-number">11.4.4</span> Class</a></li>
</ul></li>
<li><a href="#naming-things" id="toc-naming-things" class="nav-link" data-scroll-target="#naming-things"> <span class="header-section-number">11.5</span> Naming things</a></li>
<li><a href="#exercises-and-tutorial" id="toc-exercises-and-tutorial" class="nav-link" data-scroll-target="#exercises-and-tutorial"> <span class="header-section-number">11.6</span> Exercises and tutorial</a>
<ul class="collapse">
<li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"> <span class="header-section-number">11.6.1</span> Exercises</a></li>
<li><a href="#tutorial" id="toc-tutorial" class="nav-link" data-scroll-target="#tutorial"> <span class="header-section-number">11.6.2</span> Tutorial</a></li>
</ul></li>
</ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/RohanAlexander/telling_stories/edit/main/11-clean_and_prepare.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<header id="title-block-header" class="quarto-title-block default">

<div class="quarto-title"><h1 class="title display-7"><span id="sec-clean-and-prepare" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Clean and prepare</span></span></h1></div></header>

<p><strong>Required material</strong></p>
<ul>
<li>Read <em>Data Feminism</em>, Chapter 5 ‘Unicorns, Janitors, Ninjas, Wizards, and Rock Stars’, <span class="citation" data-cites="datafeminism2020">(<a href="references.html#ref-datafeminism2020" role="doc-biblioref">D’Ignazio and Klein 2020</a>)</span>.</li>
<li>Read <em>R for Data Science</em>, Chapter 12 ‘Tidy data’, <span class="citation" data-cites="r4ds">(<a href="references.html#ref-r4ds" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>.</li>
<li>Read <em>We Gave Four Good Pollsters the Same Raw Data. They Had Four Different Results</em>, <span class="citation" data-cites="cohn2016">(<a href="references.html#ref-cohn2016" role="doc-biblioref">Cohn 2016</a>)</span>.</li>
<li>Read <em>Column Names as Contracts</em>, <span class="citation" data-cites="columnnamesascontracts">(<a href="references.html#ref-columnnamesascontracts" role="doc-biblioref">Riederer 2020</a>)</span></li>
</ul>
<p><strong>Key concepts and skills</strong></p>
<ul>
<li>Planning an end-point and simulating the dataset that we would like to end up with, are key elements of cleaning and preparing data.</li>
<li>Begin on a small sample of the dataset, write code to fix that, and then iterate and generalize to additional tranches.</li>
<li>Develop a series of tests and checks that the dataset should pass so that the features of the dataset are clear.</li>
<li>Be especially concerned about the class of variables, having clear names, and that the values of each variable are as expected given all this.</li>
</ul>
<p><strong>Key libraries</strong></p>
<ul>
<li><code>convo</code> <span class="citation" data-cites="convo">(<a href="references.html#ref-convo" role="doc-biblioref">Riederer 2022</a>)</span></li>
<li><code>janitor</code> <span class="citation" data-cites="janitor">(<a href="references.html#ref-janitor" role="doc-biblioref">Firke 2020</a>)</span></li>
<li><code>pointblank</code> <span class="citation" data-cites="pointblank">(<a href="references.html#ref-pointblank" role="doc-biblioref">Iannone and Vargas 2022</a>)</span></li>
<li><code>purrr</code> <span class="citation" data-cites="citepurrr">(<a href="references.html#ref-citepurrr" role="doc-biblioref">Henry and Wickham 2020</a>)</span></li>
<li><code>stringr</code> <span class="citation" data-cites="citestringr">(<a href="references.html#ref-citestringr" role="doc-biblioref">Wickham 2019</a>)</span></li>
<li><code>tidyr</code> <span class="citation" data-cites="citetidyr">(<a href="references.html#ref-citetidyr" role="doc-biblioref">Wickham 2021</a>)</span></li>
<li><code>tidyverse</code> <span class="citation" data-cites="Wickham2017">(<a href="references.html#ref-Wickham2017" role="doc-biblioref">Wickham 2017</a>)</span></li>
</ul>
<p><strong>Key functions</strong></p>
<ul>
<li><code>dplyr::count()</code></li>
<li><code>dplyr::mutate()</code></li>
<li><code>dplyr::select()</code></li>
<li><code>janitor::clean_names()</code></li>
<li><code>stringr::str_replace_all()</code></li>
<li><code>stringr::str_trim()</code></li>
<li><code>tidyr::pivot_longer()</code></li>
<li><code>tidyr::separate()</code></li>
<li><code>tidyr::separate_rows()</code></li>
</ul>
<section id="introduction" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">11.1</span> Introduction</h2>
<blockquote class="blockquote">
<p>“Well, Lyndon, you may be right and they may be every bit as intelligent as you say,” said Rayburn, “but I’d feel a whole lot better about them if just one of them had run for sheriff once.”</p>
<p>Sam Rayburn’s reaction to Lyndon Johnson’s enthusiasm about Kennedy’s incoming cabinet, as quoted in <em>The Best and the Brightest</em> <span class="citation" data-cites="halberstam">(<a href="references.html#ref-halberstam" role="doc-biblioref">Halberstam 1972, 41</a>)</span>.</p>
</blockquote>
<p>In earlier chapters we have done some data cleaning and preparation, and in this chapter we will put in place more formal approaches. To a large extent, the role of data cleaning and preparation is so great that the only people that we can trust understand their data, are those that who have cleaned it. And, paradoxically, often those that do the cleaning and preparation are often those that trust it the least. At some point in every data science workflow, those doing the modelling should get their hands dirty with data cleaning. To clean and prepare data is to make many decisions, some of which may have important effects on our results.</p>
<p>For a long time, data cleaning and preparation was largely overlooked. We now realize that was a mistake. It has been difficult to trust results in disciplines that apply statistics. The reproducibility crisis, which started in psychology but has now extended to many other fields in the physical and social sciences, has brought to light issues such as p-value ‘hacking’, researcher degrees of freedom, file-drawer issues, and even data and results fabrication <span class="citation" data-cites="gelman2013garden">(<a href="references.html#ref-gelman2013garden" role="doc-biblioref">Gelman and Loken 2013</a>)</span>. Steps are now being put in place to address these. But, there has been relatively little focus on the data gathering, cleaning, and preparation aspects of applied statistics, despite evidence that decisions made during these steps greatly affect statistical results <span class="citation" data-cites="huntington2020influence">(<a href="references.html#ref-huntington2020influence" role="doc-biblioref">Huntington-Klein et al. 2020</a>)</span>. In this chapter we focus on these issues.</p>
<p>While the statistical practices that underpin data science are themselves correct and robust when applied to simulated datasets, data science is typically not conducted with these types of datasets. For instance, data scientists are interested in ‘messy, unfiltered, and possibly unclean data—tainted by heteroskedasticity, complex dependence and missingness patterns—that until recently were avoided in polite conversations between more traditional statisticians’ <span class="citation" data-cites="craiu2019hiring">(<a href="references.html#ref-craiu2019hiring" role="doc-biblioref">Craiu 2019</a>)</span>. Big data does not resolve this issue, and may even exacerbate it, for instance ‘without taking data quality into account, population inferences with Big Data are subject to a Big Data Paradox: the more the data, the surer we fool ourselves’ <span class="citation" data-cites="meng2018statistical">(<a href="references.html#ref-meng2018statistical" role="doc-biblioref">Meng 2018</a>)</span>. It is important to note that the issues that are found in much applied statistics research are not necessarily associated with researcher quality, or their biases <span class="citation" data-cites="silberzahn2018many">(<a href="references.html#ref-silberzahn2018many" role="doc-biblioref">Silberzahn et al. 2018</a>)</span>. Instead, they are a result of the environment within which data science is conducted. This chapter provides an approach and tools to explicitly think about this work.</p>
<p><span class="citation" data-cites="gelman2020most">Gelman and Vehtari (<a href="references.html#ref-gelman2020most" role="doc-biblioref">2020</a>)</span> writing about the most important statistical ideas of the past 50 years say that each of them enabled new ways of thinking about data analysis and they brought into the tent of statistics, approaches that ‘had been considered more a matter of taste or philosophy’. The focus on data cleaning and preparation in this chapter is analogous, insofar, as it represents a codification, or bringing inside the tent, of aspects that are typically, incorrectly, considered those of taste rather than statistics.</p>
<p>The workflow that we advocate is:</p>
<ol type="1">
<li>Save the raw data.</li>
<li>Begin with an end in mind.</li>
<li>Execute that plan on a small sample.</li>
<li>Write tests and documentation.</li>
<li>Iterate the plan.</li>
<li>Generalize the execution.</li>
<li>Update tests and documentation.</li>
</ol>
<p>We will need a variety of skills to be effective, but this is the very stuff of statistical sciences. The approach needed is some combination of dogged and sensible. Perfect is very much the enemy of good enough when it comes to data cleaning. And to be specific, it is better to have 90 per cent of the data cleaned and prepared, and to start exploring that, before deciding whether it is worth the effort to clean and prepare the remaining 10 per cent because that remainder will likely take an awful lot of time and effort.</p>
<p>All data regardless of whether they were obtained from hunting, gathering, or farming, will have issues and it is critical that we have approaches that can deal with a variety of issues, and more importantly, understand how it might affect our modelling <span class="citation" data-cites="van2005data">(<a href="references.html#ref-van2005data" role="doc-biblioref">Van den Broeck et al. 2005</a>)</span>. To clean data is to analyze data. This is because the process forces us to make choices about what we value in our results <span class="citation" data-cites="thatrandyauperson">(<a href="references.html#ref-thatrandyauperson" role="doc-biblioref">Au 2020</a>)</span>.</p>
</section>
<section id="workflow" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="workflow"><span class="header-section-number">11.2</span> Workflow</h2>
<section id="save-a-copy-of-the-raw-data" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1" class="anchored" data-anchor-id="save-a-copy-of-the-raw-data"><span class="header-section-number">11.2.1</span> Save a copy of the raw data</h3>
<p>The first step is to save the raw data into a separate, local, folder. It is important to save this raw data, to the extent that is possible, because it establishes the foundation for reproducibility <span class="citation" data-cites="wilsongoodenough">(<a href="references.html#ref-wilsongoodenough" role="doc-biblioref">Wilson et al. 2017</a>)</span>. If we are obtaining our data from a third-party, such as a government website, then we have no control over whether they will continue to host that data, whether they will update it, and the address at which it will be available. We also want to reduce the burden that we impose on their servers, by saving a local copy.</p>
<p>Having locally saved the raw data we must maintain it in that state, and not modify it. As we begin to clean and prepare it, we instead create another dataset. Maintaining the initial, raw, state of the dataset, and using scripts to create the dataset that we are interested in analyzing, ensures that our entire workflow is reproducible.</p>
</section>
<section id="begin-with-an-end-in-mind" class="level3" data-number="11.2.2">
<h3 data-number="11.2.2" class="anchored" data-anchor-id="begin-with-an-end-in-mind"><span class="header-section-number">11.2.2</span> Begin with an end in mind</h3>
<p>Planning the end state or forcing yourself to begin with an end in mind is important for a variety of reasons. As with scraping data, it helps us to be proactive about scope-creep, but with data cleaning it additionally forces us to really think about what we want the final dataset to look like.</p>
<p>The first step is to sketch the dataset that we are interested in. The key features of the sketch will be aspects such as the names of the columns, their class, and the possible range of values. For instance, we might be interested in the populations of US states. In which case our sketch might look like <a href="#fig-sketchdataplan">Figure&nbsp;<span>11.1</span></a>.</p>
<div id="fig-sketchdataplan" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/state_population_sketch.png" class="img-fluid figure-img" style="width:40.0%"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Figure 11.1: Planned dataset of US states and their populations</figcaption><p></p>
</figure>
</div>
<p>In this case, the sketch forces us to decide whether we want full names or abbreviations for the state names, and that the population has been measured in millions. The process of sketching this end-point has forced us to make decisions early on, and be clear about our desired end state.</p>
<p>We then implement that using code to simulate data. Again, this process forces us to think about what reasonable values look like in our dataset because we are literally forced to decide which functions to use. Thinking carefully about the membership of each column here, for instance if the column is meant to be ‘gender’ then values such as ‘male’, ‘female’, ‘other’, and ‘unknown’ may be expected, but a number such as ‘1,000’ would likely be unexpected. It also forces us to be explicit about variable names because we have to assign the outputs of those functions to a variable. For instance, we could simulate some data for the population data.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>simulated_tfr <span class="ot">&lt;-</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> state.name,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">population =</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">50</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">50</span>) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>simulated_tfr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 50 × 2
   state       population
   &lt;chr&gt;            &lt;dbl&gt;
 1 Alabama          18.0 
 2 Alaska            6.01
 3 Arizona          24.2 
 4 Arkansas         15.8 
 5 California        1.87
 6 Colorado         20.2 
 7 Connecticut       6.54
 8 Delaware         12.1 
 9 Florida           7.9 
10 Georgia           9.44
# … with 40 more rows</code></pre>
</div>
</div>
<p>Our purpose, during data cleaning and preparation, is to then bring our raw data close to that plan. Ideally, we would plan so that the desired end-state of our dataset is ‘tidy data’, which was introduced in Chapter @ref(r-essentials).</p>
<!-- 1. Each variable is a column. -->
<!-- 2. Each observation is a row. -->
<!-- 3. Each observational unit is a table. -->
<!-- The following is a reminder of data in a tidy format. -->
<!-- ```{r} -->
<!-- tibble( -->
<!--   name = c("Alfred", "Ben", "Chris", "Daniela", "Emma"), -->
<!--   age_group = c("0-9", "10-19", "0-9", "0-9", "10-19"), -->
<!--   response_time = c(0, 9, 3, 3, 8), -->
<!--   ) -->
</section>
<section id="start-small" class="level3" data-number="11.2.3">
<h3 data-number="11.2.3" class="anchored" data-anchor-id="start-small"><span class="header-section-number">11.2.3</span> Start small</h3>
<p>Having thoroughly planned we can turn to the raw data that we are dealing with. Usually, regardless of what the raw data look like, we want to manipulate them into a rectangular dataset as quickly as possible. This allows us to use our family <code>dplyr</code> verbs and <code>tidyverse</code> approaches. For instance, let us assume that we are starting with some <code>.txt</code> file.</p>
<p>The first step is to look for regularities in the dataset. We are wanting to end up with tabular data, which means that we need some type of delimiter to distinguish different columns. Ideally this might be features such as a comma, a semicolon, a tab, a double space, or a line break.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Alabama, <span class="dv">5</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Alaska, <span class="fl">0.7</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>Arizona, <span class="dv">7</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>Arkansas, <span class="dv">3</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>California, <span class="dv">40</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In worse cases there may be some regular feature of the dataset that we can take advantage of. For instance, sometimes various text is repeated.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>State is Alabama and population is <span class="dv">5</span> million.</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>State is Alaska and population is <span class="fl">0.7</span> million.</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>State is Arizona and population is <span class="dv">7</span> million.</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>State is Arkansas and population is <span class="dv">3</span> million.</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>State is California and population is <span class="dv">40</span> million.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this case, although we do not have a traditional delimiter we can use the regularity of ‘State is’ and ’ and population is ’ to get what we need. A more difficult case is when we do not have line breaks.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Alabama <span class="dv">5</span> Alaska <span class="fl">0.7</span> Arizona <span class="dv">7</span> Arkansas <span class="dv">3</span> California <span class="dv">40</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One way to approach this is to take advantage of the different classes and values that we are looking for. For instance, in this case, we know that we are after US states, so there are only 50 possible options, and we could use the existence of these as a delimiter. We could also use the fact that population is a number here, and so split based on a space followed by a number.</p>
<p>We will now go through the process of converting this last example into tidy data using <code>tidyr</code> <span class="citation" data-cites="citetidyr">(<a href="references.html#ref-citetidyr" role="doc-biblioref">Wickham 2021</a>)</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">'Alabama 5 Alaska 0.7 Arizona 7 Arkansas 3 California 40'</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>data_as_tibble <span class="ot">&lt;-</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">raw =</span> raw_data)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>tidy_data <span class="ot">&lt;-</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  data_as_tibble <span class="sc">|&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> raw,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>],</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">"(?&lt;=[[:digit:]]) "</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>],</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"drop_me"</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"separate_me"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> separate_me,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">'state'</span>, <span class="st">'population'</span>),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">" (?=[[:digit:]])"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>drop_me)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>tidy_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 5 × 2
  state      population
  &lt;chr&gt;      &lt;chr&gt;     
1 Alabama    5         
2 Alaska     0.7       
3 Arizona    7         
4 Arkansas   3         
5 California 40        </code></pre>
</div>
</div>
</section>
<section id="write-tests-and-documentation" class="level3" data-number="11.2.4">
<h3 data-number="11.2.4" class="anchored" data-anchor-id="write-tests-and-documentation"><span class="header-section-number">11.2.4</span> Write tests and documentation</h3>
<!-- We are attempting to triangulate the situation. -->
<p>Having established a rectangular dataset, albeit a messy one, we should begin to look at the classes that we have. We do not necessarily want to fix the classes at this point, because that can result in us losing data. But we look at the class to see what it is, and then compare it to our simulated dataset to see where it needs to get to. We note the columns where it is different.</p>
<p>Before changing the class and before going onto more bespoke issues, we should deal with some of the common issues in each class. Some common issues are:</p>
<ul>
<li>Commas and other punctuation, such as denomination signs in columns that should be numeric.</li>
<li>Inconsistent formatting of dates, such as ‘December’ and ‘Dec’ and ‘12’.</li>
<li>Unexpected characters, especially in unicode, which may not display consistently.</li>
</ul>
<p>Typically, we want to fix anything immediately obvious. For instance, remove commas that have been used to group digits in currencies. However, the situation will typically quickly become dire. What we need to do is to look at the membership of each group, and then triage what we will fix. We should probably make the decision of how to triage based on what is likely to have the largest impact. That usually means starting with the counts, sorting in descending order, and then dealing with each as they come.</p>
<p>When the tests of membership are passed, then finally we can change the class, and run all the tests again. We are adapting this idea from the software development approach of unit testing. Tests are crucial because the enable us to understand whether software (or in this case data) is fit for purpose <span class="citation" data-cites="buildingsoftwaretogether">(<a href="references.html#ref-buildingsoftwaretogether" role="doc-biblioref">Wilson 2021</a>)</span>.</p>
<p>Let us run through an example with a collection of strings, some of which are slightly wrong. This type of output is typical of OCR, which often gets most of the way there, but not quite.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>messy_string <span class="ot">&lt;-</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">'Patricia, Ptricia, PatricIa, Patncia, PatricIa, Patricia, Patricia, Patric1a, Patricia , 8atricia'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>messy_string</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "Patricia, Ptricia, PatricIa, Patncia, PatricIa, Patricia, Patricia, Patric1a, Patricia , 8atricia"</code></pre>
</div>
</div>
<p>As before, we first want to get this into a rectangular dataset.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>messy_data <span class="ot">&lt;-</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">names =</span> messy_string) <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(names, <span class="at">sep =</span> <span class="st">", "</span>) </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>messy_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 10 × 1
   names      
   &lt;chr&gt;      
 1 "Patricia" 
 2 "Ptricia"  
 3 "PatricIa" 
 4 "Patncia"  
 5 "PatricIa" 
 6 "Patricia" 
 7 "Patricia" 
 8 "Patric1a" 
 9 "Patricia "
10 "8atricia" </code></pre>
</div>
</div>
<p>We now need decide which of these errors we are going to fix. To help us decide which are most important, we will create a count.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>messy_data <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(names, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 7 × 2
  names           n
  &lt;chr&gt;       &lt;int&gt;
1 "Patricia"      3
2 "PatricIa"      2
3 "8atricia"      1
4 "Patncia"       1
5 "Patric1a"      1
6 "Patricia "     1
7 "Ptricia"       1</code></pre>
</div>
</div>
<p>The most common element is the correct one, which is great. The next one - ‘PatricIa’ - looks like the ‘i’ has been incorrectly capitalized, and the one after that - ‘8atricia’ - is distinguished by an ‘8’ instead of a ‘P’. Let us quickly fix these issues and then redo the count.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>messy_data <span class="ot">&lt;-</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  messy_data <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">names =</span> <span class="fu">str_replace_all</span>(names, <span class="st">'PatricIa'</span>, <span class="st">'Patricia'</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">names =</span> <span class="fu">str_replace_all</span>(names, <span class="st">'8atricia'</span>, <span class="st">'Patricia'</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>messy_data <span class="sc">|&gt;</span> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(names, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 5 × 2
  names           n
  &lt;chr&gt;       &lt;int&gt;
1 "Patricia"      6
2 "Patncia"       1
3 "Patric1a"      1
4 "Patricia "     1
5 "Ptricia"       1</code></pre>
</div>
</div>
<p>Already this is much better and 60 per cent of the values are correct, compared with earlier where it was 30 per cent. There are two more obvious errors - ‘Ptricia’ and ‘Patncia’ - with the first missing an ‘a’ and the second having an ‘n’ where the ‘ri’ should be. Again, we can quickly update and fix those.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>messy_data <span class="ot">&lt;-</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  messy_data <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">names =</span> <span class="fu">str_replace_all</span>(names, <span class="st">'Ptricia'</span>, <span class="st">'Patricia'</span>),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">names =</span> <span class="fu">str_replace_all</span>(names, <span class="st">'Patncia'</span>, <span class="st">'Patricia'</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>messy_data <span class="sc">|&gt;</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(names, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 3 × 2
  names           n
  &lt;chr&gt;       &lt;int&gt;
1 "Patricia"      8
2 "Patric1a"      1
3 "Patricia "     1</code></pre>
</div>
</div>
<p>We have achieved an 80 per cent fix with not too much effort. The two remaining issues are more subtle. The first - ‘Patric1a’ - has occurred because the ‘i’ has been incorrectly coded as an ‘1’. In some fonts this will show up, but in others it will be more difficult to see. This is a common issue, especially with OCR, and something to be aware of. The second - ‘Patricia’ - is similarly subtle and is occurring because there is a trailing space. Again, trailing and leading spaces are a common issue and we can address them with <code>str_trim()</code>. After we fix these two remaining issues then we will have all entries corrected.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="ot">&lt;-</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  messy_data <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">names =</span> <span class="fu">str_replace_all</span>(names, <span class="st">'Patric1a'</span>, <span class="st">'Patricia'</span>),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">names =</span> <span class="fu">str_trim</span>(names, <span class="at">side =</span> <span class="fu">c</span>(<span class="st">"right"</span>))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="sc">|&gt;</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(names, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 1 × 2
  names        n
  &lt;chr&gt;    &lt;int&gt;
1 Patricia    10</code></pre>
</div>
</div>
<p>We have been doing the tests in our head in this example. We know that we are hoping for ‘Patricia’. But we can start to document this test as well. One way is to look to see if values other than ‘Patricia’ exist in the dataset.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>check_me <span class="ot">&lt;-</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  cleaned_data <span class="sc">|&gt;</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(names <span class="sc">!=</span> <span class="st">"Patricia"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(check_me) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Still have values that are not Patricia!"</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can make things a little more imposing by stopping our code execution if the condition is not met with <code>stopifnot()</code>. To use that we define a condition that we would like met. We could implement this type of check throughout our code. For instance, if we expected there to be a certain number of rows in the dataset, or for a certain column to have various properties, such as being an integer, or a factor.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">nrow</span>(check_me) <span class="sc">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can use <code>stopifnot()</code> to ensure that our script is working as expected as it goes through. Another way that is especially used</p>
<p>Another way to write tests for our dataset is to use <code>testthat</code> <span class="citation" data-cites="testthat">(<a href="references.html#ref-testthat" role="doc-biblioref">Wickham 2011</a>)</span>. Although developed for testing packages, we can use the same functionality to test our datasets. For instance, we can use <code>expect_length()</code> to check the length of a dataset and could use <code>expect_equal()</code> to check the content.</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_length</span>(check_me, <span class="dv">1</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_equal</span>(<span class="fu">class</span>(cleaned_data<span class="sc">$</span>names), <span class="st">"character"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">expect_equal</span>(<span class="fu">unique</span>(cleaned_data<span class="sc">$</span>names), <span class="st">"Patricia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If the tests pass then nothing happens, and if the tests fail then the script will stop.</p>
</section>
<section id="iterate-generalize-and-update" class="level3" data-number="11.2.5">
<h3 data-number="11.2.5" class="anchored" data-anchor-id="iterate-generalize-and-update"><span class="header-section-number">11.2.5</span> Iterate, generalize and update</h3>
<p>We could now iterate the plan. In this most recent case, we started with 10 entries. There is no reason that we could not increase this to 100 or even 1,000. We may need to generalize the cleaning procedures and tests. But eventually we would start to being the dataset into some sort of order.</p>
</section>
</section>
<section id="case-study-kenya-census" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="case-study-kenya-census"><span class="header-section-number">11.3</span> Case study: Kenya census</h2>
<section id="gather-and-clean-data" class="level3" data-number="11.3.1">
<h3 data-number="11.3.1" class="anchored" data-anchor-id="gather-and-clean-data"><span class="header-section-number">11.3.1</span> Gather and clean data</h3>
<p>To make this all more clear, let us gather, clean, and prepare some data from the 2019 Kenyan census. The distribution of population by age, sex, and administrative unit from the 2019 Kenyan census can be downloaded <a href="https://www.knbs.or.ke/?wpdmpro=2019-kenya-population-and-housing-census-volume-iii-distribution-of-population-by-age-sex-and-administrative-units">here</a>. While this format as a PDF makes it easy to look up a particular result, it is not overly useful if we want to model the data. In order to be able to do that, we need to convert a PDF of Kenyan census results of counts, by age and sex, by county and sub-county, into a tidy dataset that can be analyzed. We will use <code>janitor</code> <span class="citation" data-cites="janitor">(<a href="references.html#ref-janitor" role="doc-biblioref">Firke 2020</a>)</span>, <code>pdftools</code> <span class="citation" data-cites="pdftools">(<a href="references.html#ref-pdftools" role="doc-biblioref">Ooms 2019</a>)</span>, <code>tidyverse</code> <span class="citation" data-cites="tidyverse">(<a href="references.html#ref-tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span>, and <code>stringi</code> <span class="citation" data-cites="stringi">(<a href="references.html#ref-stringi" role="doc-biblioref">Gagolewski 2020</a>)</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdftools)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we can then download<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> and read in the PDF of the 2019 Kenyan census. When we have a PDF and want to read the content into R, then <code>pdf_text()</code> from <code>pdftools</code> <span class="citation" data-cites="pdftools">(<a href="references.html#ref-pdftools" role="doc-biblioref">Ooms 2019</a>)</span> is useful. It works well for many recently produced PDFs because the content is text which it can extract. But if the PDF is an image, then <code>pdf_text()</code> will not work. Instead, the PDF will first need to go through OCR, which was covered in Chapter @ref(gather-data).</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://www.knbs.or.ke/download/2019-kenya-population-and-housing-census-volume-iii-distribution-of-population-by-age-sex-and-administrative-units/?wpdmdl=5729&amp;refresh=620561f1ce3ad1644519921"</span>, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2019_Kenya_census.pdf"</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>all_content <span class="ot">&lt;-</span> <span class="fu">pdf_text</span>(<span class="st">"2019_Kenya_census.pdf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see an example page of the PDF of the 2019 Kenyan census (<a href="#fig-examplekenyancensuspage">Figure&nbsp;<span>11.2</span></a>).</p>
<div id="fig-examplekenyancensuspage" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/2020-04-10-screenshot-of-census.png" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Figure 11.2: Example page from the 2019 Kenyan census</figcaption><p></p>
</figure>
</div>
<p>The first challenge is to get the dataset into a format that we can more easily manipulate. We will consider each page of the PDF and extract the relevant parts. To do this, we first write a function, and then apply it to each page.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The function is going to take an input of a page</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>get_data <span class="ot">&lt;-</span> <span class="cf">function</span>(i){</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># i = 467</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Just look at the page of interest</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Based on Bob Rudis: https://stackoverflow.com/a/47793617</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  just_page_i <span class="ot">&lt;-</span> <span class="fu">stri_split_lines</span>(all_content[[i]])[[<span class="dv">1</span>]] </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  just_page_i <span class="ot">&lt;-</span> just_page_i[just_page_i <span class="sc">!=</span> <span class="st">""</span>]</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Grab the name of the location</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  area <span class="ot">&lt;-</span> just_page_i[<span class="dv">3</span>] <span class="sc">|&gt;</span> <span class="fu">str_squish</span>()</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  area <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(area)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Grab the type of table</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  type_of_table <span class="ot">&lt;-</span> just_page_i[<span class="dv">2</span>] <span class="sc">|&gt;</span> <span class="fu">str_squish</span>()</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get rid of the top matter</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Manually for now, but could create some rules if needed</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  just_page_i_no_header <span class="ot">&lt;-</span> just_page_i[<span class="dv">5</span><span class="sc">:</span><span class="fu">length</span>(just_page_i)] </span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get rid of the bottom matter</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Manually for now, but could create some rules if needed</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  just_page_i_no_header_no_footer <span class="ot">&lt;-</span> just_page_i_no_header[<span class="dv">1</span><span class="sc">:</span><span class="dv">62</span>] </span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert into a tibble</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  demography_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">all =</span> just_page_i_no_header_no_footer)</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Split columns</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  demography_data <span class="ot">&lt;-</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    demography_data <span class="sc">|&gt;</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">all =</span> <span class="fu">str_squish</span>(all)) <span class="sc">|&gt;</span> <span class="co"># Any space more than two spaces is reduced</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">all =</span> <span class="fu">str_replace</span>(all, <span class="st">"10 -14"</span>, <span class="st">"10-14"</span>)) <span class="sc">|&gt;</span> <span class="co"># One specific issue</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">all =</span> <span class="fu">str_replace</span>(all, <span class="st">"Not Stated"</span>, <span class="st">"NotStated"</span>)) <span class="sc">|&gt;</span> <span class="co"># And another</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(<span class="at">col =</span> all,</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"total"</span>, <span class="st">"age_2"</span>, <span class="st">"male_2"</span>, <span class="st">"female_2"</span>, <span class="st">"total_2"</span>),</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>             <span class="at">sep =</span> <span class="st">" "</span>, <span class="co"># Works fine because the tables are nicely laid out</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">remove =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"right"</span>,</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>             <span class="at">extra =</span> <span class="st">"drop"</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># They are side by side at the moment, need to append to bottom</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>  demography_data_long <span class="ot">&lt;-</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(demography_data <span class="sc">|&gt;</span> <span class="fu">select</span>(age, male, female, total),</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>          demography_data <span class="sc">|&gt;</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(age_2, male_2, female_2, total_2) <span class="sc">|&gt;</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">age =</span> age_2, <span class="at">male =</span> male_2, <span class="at">female =</span> female_2, <span class="at">total =</span> total_2)</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># There is one row of NAs, so remove it</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>  demography_data_long <span class="ot">&lt;-</span> </span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>    demography_data_long <span class="sc">|&gt;</span> </span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">remove_empty</span>(<span class="at">which =</span> <span class="fu">c</span>(<span class="st">"rows"</span>))</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the area and the page</span></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>  demography_data_long<span class="sc">$</span>area <span class="ot">&lt;-</span> area</span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>  demography_data_long<span class="sc">$</span>table <span class="ot">&lt;-</span> type_of_table</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>  demography_data_long<span class="sc">$</span>page <span class="ot">&lt;-</span> i</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(just_page_i,</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>     i,</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>     area,</span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>     type_of_table,</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>     just_page_i_no_header,</span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>     just_page_i_no_header_no_footer,</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>     demography_data)</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(demography_data_long)</span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now have a function that does what we need to each page of the PDF. We will use <code>map_dfr()</code> from <code>purrr</code> <span class="citation" data-cites="citepurrr">(<a href="references.html#ref-citepurrr" role="doc-biblioref">Henry and Wickham 2020</a>)</span> to apply that function to each page, and then combine all the outputs into one tibble.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run through each relevant page and get the data</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>pages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">30</span><span class="sc">:</span><span class="dv">513</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>all_tables <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(pages, get_data)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(pages, get_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>all_tables</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 59,532 × 7
   age   male    female  total     area    table                            page
   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;                           &lt;int&gt;
 1 Total 610,257 598,046 1,208,303 Mombasa Table 2.3: Distribution of Pop…    30
 2 0     15,111  15,009  30,120    Mombasa Table 2.3: Distribution of Pop…    30
 3 1     15,805  15,308  31,113    Mombasa Table 2.3: Distribution of Pop…    30
 4 2     15,088  14,837  29,925    Mombasa Table 2.3: Distribution of Pop…    30
 5 3     14,660  14,031  28,691    Mombasa Table 2.3: Distribution of Pop…    30
 6 4     14,061  13,993  28,054    Mombasa Table 2.3: Distribution of Pop…    30
 7 0-4   74,725  73,178  147,903   Mombasa Table 2.3: Distribution of Pop…    30
 8 5     13,851  14,023  27,874    Mombasa Table 2.3: Distribution of Pop…    30
 9 6     12,889  13,216  26,105    Mombasa Table 2.3: Distribution of Pop…    30
10 7     13,268  13,203  26,471    Mombasa Table 2.3: Distribution of Pop…    30
# … with 59,522 more rows</code></pre>
</div>
</div>
<p>Having got it into a rectangular format, we now need to clean the dataset to make it useful.</p>
<p>The first step is to make the numbers into actual numbers, rather than characters. Before we can convert the type, we need to remove anything that is not a number otherwise that cell will be converted into an NA. We first identify any values that are not numbers so that we can remove them.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Need to convert male, female, and total to integers</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># First find the characters that should not be in there</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>all_tables <span class="sc">|&gt;</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(male, female, total) <span class="sc">|&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">str_remove_all</span>(., <span class="st">"[:digit:]"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">str_remove_all</span>(., <span class="st">","</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">str_remove_all</span>(., <span class="st">"_"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">str_remove_all</span>(., <span class="st">"-"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 3 × 3
  male  female total
  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;
1 ""    ""     ""   
2 "Aug" ""     ""   
3 "Jun" ""     ""   </code></pre>
</div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We clearly need to remove ",", "_", and "-". </span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This also highlights a few issues on p. 185 that need to be manually adjusted</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># https://twitter.com/RohanAlexander/status/1244337583016022018</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>male[all_tables<span class="sc">$</span>male <span class="sc">==</span> <span class="st">"23-Jun"</span>] <span class="ot">&lt;-</span> <span class="dv">4923</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>male[all_tables<span class="sc">$</span>male <span class="sc">==</span> <span class="st">"15-Aug"</span>] <span class="ot">&lt;-</span> <span class="dv">4611</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While we could use <code>janitor</code> here, it is worthwhile at least first looking at what is going on because sometimes there is odd stuff that <code>janitor</code> (and other packages) will deal with, but not in a way that we want. In this case, the Kenyan government used Excel or similar, and this has converted two entries into dates. If we just took the numbers from the column then we would have 23 and 15 here, but by inspecting the column we can use Excel to reverse the process and enter the correct values of 4,923 and 4,611, respectively.</p>
<p>Having identified everything that needs to be removed, we can do the actual removal and convert our character column of numbers to integers.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>all_tables <span class="ot">&lt;-</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  all_tables <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(male, female, total), <span class="sc">~</span><span class="fu">str_remove_all</span>(., <span class="st">","</span>)) <span class="sc">|&gt;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(male, female, total), <span class="sc">~</span><span class="fu">str_replace</span>(., <span class="st">"_"</span>, <span class="st">"0"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(male, female, total), <span class="sc">~</span><span class="fu">str_replace</span>(., <span class="st">"-"</span>, <span class="st">"0"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(male, female, total), <span class="sc">~</span><span class="fu">as.integer</span>(.))</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>all_tables</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 59,532 × 7
   age     male female   total area    table                                page
   &lt;chr&gt;  &lt;int&gt;  &lt;int&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;                               &lt;int&gt;
 1 Total 610257 598046 1208303 Mombasa Table 2.3: Distribution of Populat…    30
 2 0      15111  15009   30120 Mombasa Table 2.3: Distribution of Populat…    30
 3 1      15805  15308   31113 Mombasa Table 2.3: Distribution of Populat…    30
 4 2      15088  14837   29925 Mombasa Table 2.3: Distribution of Populat…    30
 5 3      14660  14031   28691 Mombasa Table 2.3: Distribution of Populat…    30
 6 4      14061  13993   28054 Mombasa Table 2.3: Distribution of Populat…    30
 7 0-4    74725  73178  147903 Mombasa Table 2.3: Distribution of Populat…    30
 8 5      13851  14023   27874 Mombasa Table 2.3: Distribution of Populat…    30
 9 6      12889  13216   26105 Mombasa Table 2.3: Distribution of Populat…    30
10 7      13268  13203   26471 Mombasa Table 2.3: Distribution of Populat…    30
# … with 59,522 more rows</code></pre>
</div>
</div>
<p>The next thing to clean is the areas. We know that there are 47 counties in Kenya, and a large number of sub-counties. The Kenyan government purports to provide a list on pages 19 to 22 of the PDF (document pages 7 to 10). But this list is not complete, and there are a few minor issues that we will deal with later. In any case, we first need to fix a few inconsistencies.</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix some area names</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>area[all_tables<span class="sc">$</span>area <span class="sc">==</span> <span class="st">"Taita/ Taveta"</span>] <span class="ot">&lt;-</span> <span class="st">"Taita/Taveta"</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>area[all_tables<span class="sc">$</span>area <span class="sc">==</span> <span class="st">"Elgeyo/ Marakwet"</span>] <span class="ot">&lt;-</span> <span class="st">"Elgeyo/Marakwet"</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>area[all_tables<span class="sc">$</span>area <span class="sc">==</span> <span class="st">"Nairobi City"</span>] <span class="ot">&lt;-</span> <span class="st">"Nairobi"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Kenya has 47 counties, each of which has sub-counties. The PDF has them arranged as the county data then the sub-counties, without designating which is which. We can use the names, to a certain extent, but in a handful of cases, there is a sub-county that has the same name as a county, so we need to first fix that.</p>
<p>The PDF is made-up of three tables. So we can first get the names of the counties based on those final two tables and then reconcile them to get a list of the counties.</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>table <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
Table 2.3: Distribution of Population by Age, Sex*, County and Sub- County 
                                                                     48216 
      Table 2.4a: Distribution of Rural Population by Age, Sex* and County 
                                                                      5535 
      Table 2.4b: Distribution of Urban Population by Age, Sex* and County 
                                                                      5781 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>list_counties <span class="ot">&lt;-</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  all_tables <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(table <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Table 2.4a: Distribution of Rural Population by Age, Sex* and County"</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Table 2.4b: Distribution of Urban Population by Age, Sex* and County"</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(area) <span class="sc">|&gt;</span> </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>list_counties</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 47 × 1
   area        
   &lt;chr&gt;       
 1 Kwale       
 2 Kilifi      
 3 Tana River  
 4 Lamu        
 5 Taita/Taveta
 6 Garissa     
 7 Wajir       
 8 Mandera     
 9 Marsabit    
10 Isiolo      
# … with 37 more rows</code></pre>
</div>
</div>
<p>As we hoped, there are 47 of them. But before we can add a flag based on those names, we need to deal with the sub-counties that share their name. We will do this based on the page, then looking it up and deciding which is the county page and which is the sub-county page.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>all_tables <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(table <span class="sc">==</span> <span class="st">"Table 2.3: Distribution of Population by Age, Sex*, County and Sub- County"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Busia"</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Garissa"</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Homa Bay"</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Isiolo"</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Kiambu"</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Machakos"</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Makueni"</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Samburu"</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Siaya"</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Tana River"</span>,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Vihiga"</span>,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"West Pokot"</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(area, page) <span class="sc">|&gt;</span> </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 24 × 2
   area        page
   &lt;chr&gt;      &lt;int&gt;
 1 Samburu       42
 2 Tana River    53
 3 Tana River    56
 4 Garissa       65
 5 Garissa       69
 6 Isiolo        98
 7 Isiolo       100
 8 Machakos     149
 9 Machakos     154
10 Makueni      159
# … with 14 more rows</code></pre>
</div>
</div>
<p>Now we can add the flag for whether the area is a county, and adjust for the ones that are troublesome,</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>all_tables <span class="ot">&lt;-</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  all_tables <span class="sc">|&gt;</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_type =</span> <span class="fu">if_else</span>(area <span class="sc">%in%</span> list_counties<span class="sc">$</span>area, <span class="st">"county"</span>, <span class="st">"sub-county"</span>))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>all_tables <span class="ot">&lt;-</span> </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  all_tables <span class="sc">|&gt;</span> </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">"Samburu"</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">42</span> <span class="sc">~</span> <span class="st">"sub-county"</span>,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">"Tana River"</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">56</span> <span class="sc">~</span> <span class="st">"sub-county"</span>,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">"Garissa"</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">69</span> <span class="sc">~</span> <span class="st">"sub-county"</span>,</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">"Isiolo"</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">100</span> <span class="sc">~</span> <span class="st">"sub-county"</span>,</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">"Machakos"</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">154</span> <span class="sc">~</span> <span class="st">"sub-county"</span>,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">"Makueni"</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">164</span> <span class="sc">~</span> <span class="st">"sub-county"</span>,</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">"Kiambu"</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">213</span> <span class="sc">~</span> <span class="st">"sub-county"</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">"West Pokot"</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">233</span> <span class="sc">~</span> <span class="st">"sub-county"</span>,</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">"Vihiga"</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">333</span> <span class="sc">~</span> <span class="st">"sub-county"</span>,</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">"Busia"</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">353</span> <span class="sc">~</span> <span class="st">"sub-county"</span>,</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">"Siaya"</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">360</span> <span class="sc">~</span> <span class="st">"sub-county"</span>,</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">"Homa Bay"</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">375</span> <span class="sc">~</span> <span class="st">"sub-county"</span>,</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> area_type</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(list_counties)</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>all_tables</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 59,532 × 8
   age     male female   total area    table                      page area_type
   &lt;chr&gt;  &lt;int&gt;  &lt;int&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;                     &lt;int&gt; &lt;chr&gt;    
 1 Total 610257 598046 1208303 Mombasa Table 2.3: Distribution …    30 county   
 2 0      15111  15009   30120 Mombasa Table 2.3: Distribution …    30 county   
 3 1      15805  15308   31113 Mombasa Table 2.3: Distribution …    30 county   
 4 2      15088  14837   29925 Mombasa Table 2.3: Distribution …    30 county   
 5 3      14660  14031   28691 Mombasa Table 2.3: Distribution …    30 county   
 6 4      14061  13993   28054 Mombasa Table 2.3: Distribution …    30 county   
 7 0-4    74725  73178  147903 Mombasa Table 2.3: Distribution …    30 county   
 8 5      13851  14023   27874 Mombasa Table 2.3: Distribution …    30 county   
 9 6      12889  13216   26105 Mombasa Table 2.3: Distribution …    30 county   
10 7      13268  13203   26471 Mombasa Table 2.3: Distribution …    30 county   
# … with 59,522 more rows</code></pre>
</div>
</div>
<p>Having dealt with the areas, we can deal with the ages. First, we need to fix some clear errors.</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(all_tables<span class="sc">$</span>age) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
    0   0-4     1    10 10-14 10-19 
  484   484   484   484   482     1 </code></pre>
</div>
<div class="sourceCode" id="cb45"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(all_tables<span class="sc">$</span>age) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "Total" "0"     "1"     "2"     "3"     "4"    </code></pre>
</div>
<div class="sourceCode" id="cb47"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Looks like there should be 484, so need to follow up on some:</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age[all_tables<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"NotStated"</span>] <span class="ot">&lt;-</span> <span class="st">"Not Stated"</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age[all_tables<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"43594"</span>] <span class="ot">&lt;-</span> <span class="st">"5-9"</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age[all_tables<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"43752"</span>] <span class="ot">&lt;-</span> <span class="st">"10-14"</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age[all_tables<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"9-14"</span>] <span class="ot">&lt;-</span> <span class="st">"5-9"</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age[all_tables<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"10-19"</span>] <span class="ot">&lt;-</span> <span class="st">"10-14"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The census has done some of the work of putting together age-groups for us, but we want to make it easy to just focus on the counts by single-year-age. As such we will add a flag as to the type of age it is: an age group, such as “ages 0 to 5”, or a single age, such as “1”.</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age_type <span class="ot">&lt;-</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">if_else</span>(<span class="fu">str_detect</span>(all_tables<span class="sc">$</span>age, <span class="fu">c</span>(<span class="st">"-"</span>)), <span class="st">"age-group"</span>, <span class="st">"single-year"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age_type <span class="ot">&lt;-</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">if_else</span>(<span class="fu">str_detect</span>(all_tables<span class="sc">$</span>age, <span class="fu">c</span>(<span class="st">"Total"</span>)),</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">"age-group"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>          all_tables<span class="sc">$</span>age_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At the moment, age is a character variable. We have a decision to make here. We do not want it to be a character variable (because it will not graph properly), but we do not want it to be numeric, because there is <code>total</code> and <code>100+</code> in there. For now, we will just make it into a factor, and at least that will be able to be nicely graphed.</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(all_tables<span class="sc">$</span>age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-data" class="level3" data-number="11.3.2">
<h3 data-number="11.3.2" class="anchored" data-anchor-id="check-data"><span class="header-section-number">11.3.2</span> Check data</h3>
<p>Having gathered and cleaned the data, we would like to run a few checks. Given the format of the data, we can check that ‘total’ is the sum of ‘male’ and ‘female’. (While we would prefer to use different groupings, this is what the Kenyan government collected and makes available.)</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>follow_up <span class="ot">&lt;-</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  all_tables <span class="sc">|&gt;</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">check_sum =</span> male <span class="sc">+</span> female,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">totals_match =</span> <span class="fu">if_else</span>(total <span class="sc">==</span> check_sum, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(totals_match <span class="sc">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we can adjust the one that looks to be wrong.</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There is just one that looks wrong</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>male[all_tables<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"10"</span> <span class="sc">&amp;</span> all_tables<span class="sc">$</span>page <span class="sc">==</span> <span class="dv">187</span>] <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="dv">1</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(follow_up)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The Kenyan census provides different tables for the total of each county and sub-county; and then within each county, for the number in an urban area in that county, and the number in a urban area in that county. Some counties only have an urban count, but we would like to make sure that the sum of rural and urban counts equals the total count. This requires pivoting the data from long to wide.</p>
<p>First, we construct different tables for each of the three.</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.3</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>table_2_3 <span class="ot">&lt;-</span> all_tables <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(table <span class="sc">==</span> <span class="st">"Table 2.3: Distribution of Population by Age, Sex*, County and Sub- County"</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>table_2_4a <span class="ot">&lt;-</span> all_tables <span class="sc">|&gt;</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(table <span class="sc">==</span> <span class="st">"Table 2.4a: Distribution of Rural Population by Age, Sex* and County"</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>table_2_4b <span class="ot">&lt;-</span> all_tables <span class="sc">|&gt;</span> </span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(table <span class="sc">==</span> <span class="st">"Table 2.4b: Distribution of Urban Population by Age, Sex* and County"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then having constructed the constituent parts, we can join then based on age, area, and whether it is a county.</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>both_2_4s <span class="ot">&lt;-</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    table_2_4a,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    table_2_4b,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"area"</span>, <span class="st">"area_type"</span>),</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_rural"</span>, <span class="st">"_urban"</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    table_2_3,</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    both_2_4s,</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"area"</span>, <span class="st">"area_type"</span>),</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_all"</span>, <span class="st">"_"</span>)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>  all <span class="sc">|&gt;</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">page =</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Total from p. {page}, rural from p. {page_rural}, urban from p. {page_urban}'</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>page,</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>page_rural,</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>page_urban,<span class="sc">-</span>table,</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>table_rural,</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>table_urban,<span class="sc">-</span>age_type_rural,</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span>age_type_urban</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(both_2_4s, table_2_3, table_2_4a, table_2_4b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now check that the sum of rural and urban is the same as the total.</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>follow_up <span class="ot">&lt;-</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  all <span class="sc">|&gt;</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_from_bits =</span> total_rural <span class="sc">+</span> total_urban,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">check_total_is_rural_plus_urban =</span> <span class="fu">if_else</span>(total <span class="sc">==</span> total_from_bits, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>         total_from_bits <span class="sc">-</span> total) <span class="sc">|&gt;</span> </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(check_total_is_rural_plus_urban <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(follow_up)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 3 × 16
  age        male female  total area  area_type age_type male_rural female_rural
  &lt;fct&gt;     &lt;int&gt;  &lt;int&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;int&gt;        &lt;int&gt;
1 Not Sta…     31     10     41 Naku… county    single-…          8            6
2 Total    434287 441379 875666 Bomet county    age-gro…     420119       427576
3 Not Sta…      3      2      5 Bomet county    single-…          2            1
# … with 7 more variables: total_rural &lt;int&gt;, male_urban &lt;int&gt;,
#   female_urban &lt;int&gt;, total_urban &lt;int&gt;, total_from_bits &lt;int&gt;,
#   check_total_is_rural_plus_urban &lt;dbl&gt;, `total_from_bits - total` &lt;int&gt;</code></pre>
</div>
<div class="sourceCode" id="cb56"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(follow_up)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are just a few, but as they only have a difference of 1, we will just move on.</p>
<p>Finally, we want to check that the single age counts sum to the age-groups.</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>follow_up <span class="ot">&lt;-</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  all <span class="sc">|&gt;</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">groups =</span> <span class="fu">case_when</span>(age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"0-4"</span>) <span class="sc">~</span> <span class="st">"0-4"</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"5"</span>, <span class="st">"6"</span>, <span class="st">"7"</span>, <span class="st">"8"</span>, <span class="st">"9"</span>, <span class="st">"5-9"</span>) <span class="sc">~</span> <span class="st">"5-9"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"10"</span>, <span class="st">"11"</span>, <span class="st">"12"</span>, <span class="st">"13"</span>, <span class="st">"14"</span>, <span class="st">"10-14"</span>) <span class="sc">~</span> <span class="st">"10-14"</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"15"</span>, <span class="st">"16"</span>, <span class="st">"17"</span>, <span class="st">"18"</span>, <span class="st">"19"</span>, <span class="st">"15-19"</span>) <span class="sc">~</span> <span class="st">"15-19"</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"20"</span>, <span class="st">"21"</span>, <span class="st">"22"</span>, <span class="st">"23"</span>, <span class="st">"24"</span>, <span class="st">"20-24"</span>) <span class="sc">~</span> <span class="st">"20-24"</span>,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"25"</span>, <span class="st">"26"</span>, <span class="st">"27"</span>, <span class="st">"28"</span>, <span class="st">"29"</span>, <span class="st">"25-29"</span>) <span class="sc">~</span> <span class="st">"25-29"</span>,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"30"</span>, <span class="st">"31"</span>, <span class="st">"32"</span>, <span class="st">"33"</span>, <span class="st">"34"</span>, <span class="st">"30-34"</span>) <span class="sc">~</span> <span class="st">"30-34"</span>,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"35"</span>, <span class="st">"36"</span>, <span class="st">"37"</span>, <span class="st">"38"</span>, <span class="st">"39"</span>, <span class="st">"35-39"</span>) <span class="sc">~</span> <span class="st">"35-39"</span>,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"40"</span>, <span class="st">"41"</span>, <span class="st">"42"</span>, <span class="st">"43"</span>, <span class="st">"44"</span>, <span class="st">"40-44"</span>) <span class="sc">~</span> <span class="st">"40-44"</span>,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"45"</span>, <span class="st">"46"</span>, <span class="st">"47"</span>, <span class="st">"48"</span>, <span class="st">"49"</span>, <span class="st">"45-49"</span>) <span class="sc">~</span> <span class="st">"45-49"</span>,</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"50"</span>, <span class="st">"51"</span>, <span class="st">"52"</span>, <span class="st">"53"</span>, <span class="st">"54"</span>, <span class="st">"50-54"</span>) <span class="sc">~</span> <span class="st">"50-54"</span>,</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"55"</span>, <span class="st">"56"</span>, <span class="st">"57"</span>, <span class="st">"58"</span>, <span class="st">"59"</span>, <span class="st">"55-59"</span>) <span class="sc">~</span> <span class="st">"55-59"</span>,</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"60"</span>, <span class="st">"61"</span>, <span class="st">"62"</span>, <span class="st">"63"</span>, <span class="st">"64"</span>, <span class="st">"60-64"</span>) <span class="sc">~</span> <span class="st">"60-64"</span>,</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"65"</span>, <span class="st">"66"</span>, <span class="st">"67"</span>, <span class="st">"68"</span>, <span class="st">"69"</span>, <span class="st">"65-69"</span>) <span class="sc">~</span> <span class="st">"65-69"</span>,</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"70"</span>, <span class="st">"71"</span>, <span class="st">"72"</span>, <span class="st">"73"</span>, <span class="st">"74"</span>, <span class="st">"70-74"</span>) <span class="sc">~</span> <span class="st">"70-74"</span>,</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"75"</span>, <span class="st">"76"</span>, <span class="st">"77"</span>, <span class="st">"78"</span>, <span class="st">"79"</span>, <span class="st">"75-79"</span>) <span class="sc">~</span> <span class="st">"75-79"</span>,</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"80"</span>, <span class="st">"81"</span>, <span class="st">"82"</span>, <span class="st">"83"</span>, <span class="st">"84"</span>, <span class="st">"80-84"</span>) <span class="sc">~</span> <span class="st">"80-84"</span>,</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"85"</span>, <span class="st">"86"</span>, <span class="st">"87"</span>, <span class="st">"88"</span>, <span class="st">"89"</span>, <span class="st">"85-89"</span>) <span class="sc">~</span> <span class="st">"85-89"</span>,</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"90"</span>, <span class="st">"91"</span>, <span class="st">"92"</span>, <span class="st">"93"</span>, <span class="st">"94"</span>, <span class="st">"90-94"</span>) <span class="sc">~</span> <span class="st">"90-94"</span>,</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"95"</span>, <span class="st">"96"</span>, <span class="st">"97"</span>, <span class="st">"98"</span>, <span class="st">"99"</span>, <span class="st">"95-99"</span>) <span class="sc">~</span> <span class="st">"95-99"</span>,</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span>)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(area_type, area, groups) <span class="sc">|&gt;</span> </span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group_sum =</span> <span class="fu">sum</span>(total, <span class="at">na.rm =</span> <span class="cn">FALSE</span>),</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_sum =</span> group_sum <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">difference =</span> total <span class="sc">-</span> group_sum) <span class="sc">|&gt;</span> </span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">==</span> groups) <span class="sc">|&gt;</span> </span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total <span class="sc">!=</span> group_sum) </span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(follow_up)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 6 × 16
  age    male female total area       area_type age_type male_rural female_rural
  &lt;fct&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;         &lt;int&gt;        &lt;int&gt;
1 0-4       1      5     6 Mt. Kenya… sub-coun… age-gro…         NA           NA
2 5-9       1      2     3 Mt. Kenya… sub-coun… age-gro…         NA           NA
3 10-14     6      0     6 Mt. Kenya… sub-coun… age-gro…         NA           NA
4 15-19     9      1    10 Mt. Kenya… sub-coun… age-gro…         NA           NA
5 20-24    21      4    25 Mt. Kenya… sub-coun… age-gro…         NA           NA
6 25-29    59      9    68 Mt. Kenya… sub-coun… age-gro…         NA           NA
# … with 7 more variables: total_rural &lt;int&gt;, male_urban &lt;int&gt;,
#   female_urban &lt;int&gt;, total_urban &lt;int&gt;, groups &lt;chr&gt;, group_sum &lt;dbl&gt;,
#   difference &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode" id="cb59"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(follow_up)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mt. Kenya Forest, Aberdare Forest, Kakamega Forest are all slightly dodgy. It does not seem to be in the documentation, but it looks like the Kenyan government has apportioned these between various countries. This is understandable, and unlikely to be a big deal, so, again, we will just move on.</p>
</section>
<section id="tidy-up" class="level3" data-number="11.3.3">
<h3 data-number="11.3.3" class="anchored" data-anchor-id="tidy-up"><span class="header-section-number">11.3.3</span> Tidy-up</h3>
<p>Now that we are confident that everything is looking good, we can just convert it to tidy format. This will make it easier to work with.</p>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  all <span class="sc">|&gt;</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">male_total =</span> male,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">female_total =</span> female,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_total =</span> total) <span class="sc">|&gt;</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>      male_total,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>      female_total,</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>      total_total,</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>      male_rural,</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>      female_rural,</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>      total_rural,</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>      male_urban,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>      female_urban,</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>      total_urban</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"type"</span>,</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"number"</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> type,</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"gender"</span>, <span class="st">"part_of_area"</span>),</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"_"</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(area, area_type, part_of_area, age, age_type, gender, number)</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 6 × 7
  area    area_type part_of_area age   age_type  gender  number
  &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;        &lt;fct&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;int&gt;
1 Mombasa county    total        Total age-group male    610257
2 Mombasa county    total        Total age-group female  598046
3 Mombasa county    total        Total age-group total  1208303
4 Mombasa county    rural        Total age-group male        NA
5 Mombasa county    rural        Total age-group female      NA
6 Mombasa county    rural        Total age-group total       NA</code></pre>
</div>
</div>
<p>The original purpose of cleaning this dataset was to make a table for <span class="citation" data-cites="alexander2021bayesian">Alexander and Alkema (<a href="references.html#ref-alexander2021bayesian" role="doc-biblioref">2021</a>)</span>. Just to bring this all together, we could make a graph of single-year counts, by gender, for Nairobi (<a href="#fig-monicasnairobigraph">Figure&nbsp;<span>11.3</span></a>)).</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>monicas_dataset <span class="ot">&lt;-</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  all <span class="sc">|&gt;</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area_type <span class="sc">==</span> <span class="st">"county"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(part_of_area <span class="sc">==</span> <span class="st">"total"</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age_type <span class="sc">==</span> <span class="st">"single-year"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(area, age, gender, number)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(monicas_dataset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 6 × 4
  area    age   gender number
  &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;   &lt;int&gt;
1 Mombasa 0     male    15111
2 Mombasa 0     female  15009
3 Mombasa 0     total   30120
4 Mombasa 1     male    15805
5 Mombasa 1     female  15308
6 Mombasa 1     total   31113</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb64"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>monicas_dataset <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">==</span> <span class="st">"Nairobi"</span>) <span class="sc">|&gt;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gender <span class="sc">!=</span> <span class="st">"total"</span>) <span class="sc">|&gt;</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> number, <span class="at">fill =</span> gender)) <span class="sc">+</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> number, <span class="at">fill =</span> gender), <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">99</span>, <span class="at">by =</span> <span class="dv">5</span>), <span class="st">"100+"</span>)) <span class="sc">+</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Number"</span>,</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Gender"</span>,</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Data source: 2019 Kenya Census"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-monicasnairobigraph" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="11-clean_and_prepare_files/figure-html/fig-monicasnairobigraph-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Figure 11.3: Distribution of age and gender in Nairobi in 2019, based on Kenyan census</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>A variety of features are clear from <a href="#fig-monicasnairobigraph">Figure&nbsp;<span>11.3</span></a>, including age-heaping, a slight difference in the ratio of male-female birth, and a substantial difference between ages 15 and 25.</p>
</section>
</section>
<section id="checks-and-tests" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="checks-and-tests"><span class="header-section-number">11.4</span> Checks and tests</h2>
<p>Robert Caro, the biographer of Lyndon Johnson, spent years tracking down everyone connected to the 36th President of the United States. He went to far as to live in Texas Hill Country for three years so that he could better understand where LBJ was from. When he heard a story that LBJ used to run to the Senate when he was a senator, he ran that route multiple times himself to try to understand why LBJ was running. Caro eventually understood it only when he ran the route as the sun was rising, just as LBJ had done, that the sun hits the Senate Rotunda in a particularly inspiring way <span class="citation" data-cites="caroonworking">(<a href="references.html#ref-caroonworking" role="doc-biblioref">Caro 2019</a>)</span>. This background work enabled him to uncover aspects that no one else knew. For instance, it turns out that LBJ almost surely stole his first election win as a Texas Senator <span class="citation" data-cites="caroonworking">(<a href="references.html#ref-caroonworking" role="doc-biblioref">Caro 2019</a>)</span>. We need to understand our data to this same extent. We must turn every page and go to every extreme.</p>
<p>The idea of negative space is well established in design. It refers to that which surrounds the subject. Sometimes negative space is used as an effect, for instance the logo of FedEx, an American logistics company, has negative space between the E and x that creates an arrow. In a similar way, we want to be cognizant of the data that we have, and the data that we do not have. We are worried that the data that we do not have somehow has meaning, potentially even to the extent of changing our conclusions. When we are cleaning data, we are looking for anomalies. We are interested in values that are in there that should not be, but also the opposite situation—values that are missing that should not be. There are four tools that we use to identify these situations: graphs, counts, green/red conditions, targets.</p>
<section id="graphs" class="level3" data-number="11.4.1">
<h3 data-number="11.4.1" class="anchored" data-anchor-id="graphs"><span class="header-section-number">11.4.1</span> Graphs</h3>
<p>Graphs are an invaluable tool when cleaning data, because they show each point in the dataset, in relation to the other points. They are especially useful for identifying when a value does not belong. For instance, if a value is expected to be numerical, but it is still a character then it will not plot and a warning will be displayed.</p>
<p>Graphs will be especially useful for numerical data, but are still useful for text and categorical data. Let us pretend that we have a situation where we are interested in a person’s age, for some youth survey. We have the following data:</p>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">ages =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">17</span>, <span class="dv">22</span>, <span class="dv">13</span>, <span class="dv">21</span>, <span class="dv">16</span>, <span class="dv">16</span>, <span class="dv">6</span>, <span class="dv">16</span>, <span class="dv">11</span>, <span class="dv">150</span>))</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>raw_data <span class="sc">|&gt;</span> </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> ages, <span class="at">x =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="11-clean_and_prepare_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The graph clearly shows the unexpected value of 150. The most likely explanation is that the data were incorrectly entered with a trailing 0, and should be 15. We can fix that, and document it, and then redo the graph, so as to see that everything seems more reasonable now.</p>
</section>
<section id="counts" class="level3" data-number="11.4.2">
<h3 data-number="11.4.2" class="anchored" data-anchor-id="counts"><span class="header-section-number">11.4.2</span> Counts</h3>
<p>We want to focus on getting most of the data right. So we are interested in the counts of unique values. Hopefully a majority of the data are concentrated in the most common counts. But it can also be useful to invert it, and see what is especially uncommon. The extent to which we want to deal with these depends on what we need. Ultimately, each time we fix one we are getting very few additional observations, potentially even just one! Counts are especially useful with text or categorical data, but can be helpful with numerical as well.</p>
<p>Let us see an example.</p>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">country =</span> <span class="fu">c</span>(<span class="st">'Australie'</span>, <span class="st">'Austrelia'</span>, <span class="st">'Australie'</span>, <span class="st">'Australie'</span>, <span class="st">'Aeustralia'</span>, <span class="st">'Austraia'</span>, <span class="st">'Australia'</span>, <span class="st">'Australia'</span>, <span class="st">'Australia'</span>, <span class="st">'Australia'</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>raw_data <span class="sc">|&gt;</span> </span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(country, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 5 × 2
  country        n
  &lt;chr&gt;      &lt;int&gt;
1 Australia      4
2 Australie      3
3 Aeustralia     1
4 Austraia       1
5 Austrelia      1</code></pre>
</div>
</div>
<p>The use of this count clearly identifies where we should spend our time - changing ‘Australie’ to ‘Australia’ would almost double our amount of usable data.</p>
</section>
<section id="gono-go" class="level3" data-number="11.4.3">
<h3 data-number="11.4.3" class="anchored" data-anchor-id="gono-go"><span class="header-section-number">11.4.3</span> Go/no-go</h3>
<p>Some things are so important that you require that your cleaned dataset have them. These are go/no-go conditions. They would typically come out of experience, expert knowledge, or the planning and simulation exercises. An example may be that there are no negative numbers in an age column, and no ages above 140.</p>
<p>For these we could specifically require that the condition is met. Other examples include:</p>
<ul>
<li>If doing cross-country analysis, then a list of country names that we know should be in our dataset would be useful. Our no-go conditions would then be if there were: 1) values not in that list in our dataset, or, vice versa; 2) countries that we expected to be in there that were not.</li>
</ul>
<p>To have a concrete example, let us consider if we were doing some analysis about the five largest counties in Kenya: ‘Nairobi’, ‘Kiambu’, ‘Nakuru’, ‘Kakamega’, ‘Bungoma’. Let us create that array first.</p>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>correct_counties <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Nairobi'</span>, <span class="st">'Kiambu'</span>, <span class="st">'Nakuru'</span>, <span class="st">'Kakamega'</span>, <span class="st">'Bungoma'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We begin with the following dataset.</p>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>top_five_kenya <span class="ot">&lt;-</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">county =</span> <span class="fu">c</span>(<span class="st">'Nairobi'</span>, <span class="st">'Nairob1'</span>, <span class="st">'Nakuru'</span>, <span class="st">'Kakamega'</span>, <span class="st">'Nakuru'</span>, </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Kiambu'</span>, <span class="st">'Kiambru'</span>, <span class="st">'Kabamega'</span>, <span class="st">'Bun8oma'</span>, <span class="st">'Bungoma'</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>top_five_kenya <span class="sc">|&gt;</span> </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(county, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 9 × 2
  county       n
  &lt;chr&gt;    &lt;int&gt;
1 Nakuru       2
2 Bun8oma      1
3 Bungoma      1
4 Kabamega     1
5 Kakamega     1
6 Kiambru      1
7 Kiambu       1
8 Nairob1      1
9 Nairobi      1</code></pre>
</div>
</div>
<p>Based on the count we know that we have to fix some of them and there are two with numbers that are obvious fixes.</p>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>top_five_kenya <span class="ot">&lt;-</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  top_five_kenya <span class="sc">|&gt;</span> </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">county =</span> <span class="fu">str_replace_all</span>(county, <span class="st">'Nairob1'</span>, <span class="st">'Nairobi'</span>),</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">county =</span> <span class="fu">str_replace_all</span>(county, <span class="st">'Bun8oma'</span>, <span class="st">'Bungoma'</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>top_five_kenya <span class="sc">|&gt;</span> </span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(county, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 7 × 2
  county       n
  &lt;chr&gt;    &lt;int&gt;
1 Bungoma      2
2 Nairobi      2
3 Nakuru       2
4 Kabamega     1
5 Kakamega     1
6 Kiambru      1
7 Kiambu       1</code></pre>
</div>
</div>
<p>At this point we can use our go/no-go conditions to decide whether we are finished or not.</p>
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>top_five_kenya<span class="sc">$</span>county <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "Nairobi"  "Nakuru"   "Kakamega" "Kiambu"   "Kiambru"  "Kabamega" "Bungoma" </code></pre>
</div>
<div class="sourceCode" id="cb75"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">all</span>(top_five_kenya<span class="sc">$</span>county <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">==</span> top_five_kenya)) {</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Oh no"</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">all</span>(top_five_kenya<span class="sc">==</span>top_five_kenya<span class="sc">$</span>county <span class="sc">|&gt;</span> <span class="fu">unique</span>()) ) {</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Oh no"</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And so it is clear that we still have cleaning to do!</p>
<p>We may also find similar conditions from experts and those with experience in the particular field.</p>
<!-- ### Targets -->
<!-- We could clean data indefinitely, but we need an end state. Part of this is sketching an end-point, and simulating. But sometimes it helps to have a metric. This may be especially the case when we have a large dataset, a deadline, and a team, because the data cleaning stage is just one part of what needs to happen. One helpful aspect is to set targets against which we can judge a dataset and then just achieve those. -->
<!-- Let us turn to a common use-case which is merging two datasets. Of particular interest is the unique key between the two, which is  -->
<!-- Add in the notion of precision and recall. Maybe have a look at: -->
<!-- https://arxiv.org/pdf/2101.05308.pdf -->
<!-- ### Consistency -->
<!-- Consistency refers to the proportion -->
<!-- #### Internal consistency -->
<!-- #### External consistency -->
</section>
<section id="class" class="level3" data-number="11.4.4">
<h3 data-number="11.4.4" class="anchored" data-anchor-id="class"><span class="header-section-number">11.4.4</span> Class</h3>
<p>It is often said that American society is obsessed with money, while British society is obsessed with class. In the case of data cleaning and preparation we need to be British. Explicit checks of the class of variables are essential. Accidentally assigning the wrong class to a variable can have a large effect on subsequent analysis. In particular:</p>
<ul>
<li>check whether some value should be a number or a factor; and</li>
<li>check that dates are correctly formatted.</li>
</ul>
<p>To understand why it is important to be clear about whether a value is a number or a factor, consider the following situation:</p>
<div class="cell">
<div class="sourceCode" id="cb76"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>some_data <span class="ot">&lt;-</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">response =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group_as_integer =</span> <span class="fu">as.integer</span>(group),</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_as_factor =</span> <span class="fu">as.factor</span>(group),</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us start with ‘group’ as an integer and look at a logistic regression.</p>
<div class="cell">
<div class="sourceCode" id="cb77"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(response<span class="sc">~</span>group_as_integer, <span class="at">data =</span> some_data) <span class="sc">|&gt;</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
Call:
lm(formula = response ~ group_as_integer, data = some_data)

Residuals:
   Min     1Q Median     3Q    Max 
 -0.68  -0.52   0.32   0.32   0.64 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)        0.8400     0.4495   1.869    0.104
group_as_integer  -0.1600     0.2313  -0.692    0.511

Residual standard error: 0.5451 on 7 degrees of freedom
Multiple R-squared:  0.064, Adjusted R-squared:  -0.06971 
F-statistic: 0.4786 on 1 and 7 DF,  p-value: 0.5113</code></pre>
</div>
</div>
<p>Now we can try it as a factor. The interpretation of the variable is completely different.</p>
<div class="cell">
<div class="sourceCode" id="cb79"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(response<span class="sc">~</span>group_as_factor, <span class="at">data =</span> some_data) <span class="sc">|&gt;</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
Call:
lm(formula = response ~ group_as_factor, data = some_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-0.7500 -0.3333  0.2500  0.2500  0.6667 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)        0.7500     0.2826   2.654   0.0378 *
group_as_factor2  -0.4167     0.4317  -0.965   0.3717  
group_as_factor3  -0.2500     0.4895  -0.511   0.6278  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5652 on 6 degrees of freedom
Multiple R-squared:  0.1375,    Adjusted R-squared:  -0.15 
F-statistic: 0.4783 on 2 and 6 DF,  p-value: 0.6416</code></pre>
</div>
</div>
<p>Another critical aspect is to check the dates. In particular we want to try to make it into the following format: YYYY-MM-DD. There are of course differences of opinion as to what is an appropriate date format in the broader world, and reasonable people can differ on whether 1 July 2010 or July 1, 2020, is better, but YYYY-MM-DD is the format that is generally most appropriate for data.</p>
</section>
</section>
<section id="naming-things" class="level2" data-number="11.5">
<h2 data-number="11.5" class="anchored" data-anchor-id="naming-things"><span class="header-section-number">11.5</span> Naming things</h2>
<blockquote class="blockquote">
<p>An improved scanning software we developed identified gene name errors in 30.9% (3,436/11,117) of articles with supplementary Excel gene lists; a figure significantly higher than previously estimated. This is due to gene names being converted not just to dates and floating-point numbers, but also to internal date format (five-digit numbers).</p>
<p><span class="citation" data-cites="omggenes">Abeysooriya et al. (<a href="references.html#ref-omggenes" role="doc-biblioref">2021</a>)</span></p>
</blockquote>
<p>Names matter. The land on which much of this book was written is today named Toronto, which is within a country named Canada, but for a long time before was known as Turtle Island. While not common, these days people will sometimes still refer to themselves as being on Turtle Island. That tells us something about them, and our use of the name Canada tells them something about us. There is a big rock in the center of Australia. For a long time, it was called Uluru, then it was known as Ayers Rock. Today it has a dual name that combines both, and the choice of which name you use tells someone something about you. Even the British Royal Family recognize the power of names. In 1917 they changed from the House of Saxe-Coburg and Gotha to the House of Windsor, due to a feeling that the former was too Germanic given World War I was ongoing. Names matter in everyday life. And they matter in data science too.</p>
<p>The importance of names, and of ignoring existing claims through re-naming was clear in those cases, but we see it in data science as well. We need to be very careful when we name our datasets, our variables, and our functions. There is a tendency, these days, to call the variable ‘gender’ even though it may only have male and female, because we do not want to say the word ‘sex’. <span class="citation" data-cites="tukey1962future">Tukey (<a href="references.html#ref-tukey1962future" role="doc-biblioref">1962</a>)</span> essentially defines what we today call data science, but it was popularized by folks in computer science in the 2010s who ignored, either deliberately or through ignorance, what came before them. The past ten years has been characteristic by the renaming of concepts that were well-established in the fields that computer science has recently expanded into. For instance, the use of binary variables in regression, sometimes called ‘dummy variables’, is called one-hot encoding in computer science. Like all fashions, this one will pass also. We most recently saw this through the 1980s through to early 2010s with economics. Economists described themselves as the ‘queen of the social sciences’ and self-described as imperialistic <span class="citation" data-cites="lazear2000economic">(<a href="references.html#ref-lazear2000economic" role="doc-biblioref">Lazear 2000</a>)</span>. We are now recognizing the costs of this imperialism in social sciences, and in the future we will look back and count the cost of computer science imperialism in data science. The key here is that no area of study is ever <em>terra nullius</em>, or nobody’s land. It is important to recognize, adopt, and use existing names, and practices.</p>
<p>Names give places meaning, and by ignoring existing names, we ignore what has come before us. <span class="citation" data-cites="kimmerer2013">Kimmerer (<a href="references.html#ref-kimmerer2013" role="doc-biblioref">2012, 34</a>)</span> describes how ‘Tahawus is the Algonquin name for Mount Marcy, the highest peak in the Adirondacks. It’s called Mount March to commemorate a governor who never set foot on those wild slopes.’ She continues that ‘[w]hen we call a place by name it is transformed from wilderness to homeland.’ She is talking with regard to physical places, but the same is true of our function names, our variable names and our dataset names. When we use gender instead of sex because we do not want to say sex in front of others, we ignore the preferences of those that provided data.</p>
<p>In addition to respecting the nature of the data, names need to satisfy two additional considerations:</p>
<ol type="1">
<li>they need to be machine readable, and</li>
<li>they need to be human readable.</li>
</ol>
<p>Machine readable names is an easier standard to meet, but usually means avoiding spaces and special characters. A space can be replaced with a underscore. Usually, special characters should just be removed because they can be inconsistent between different computers and languages. The names should also be unique within a dataset, and unique within a collection of datasets unless that particular column is being deliberately used as a key to join different datasets.</p>
<p>An especially useful function to use to get closer to machine readable names is <code>janitor::clean_names()</code> which is from the <code>janitor</code> package <span class="citation" data-cites="janitor">(<a href="references.html#ref-janitor" role="doc-biblioref">Firke 2020</a>)</span>. This deals with those issues mentioned above as well as a few others. We can see an example.</p>
<div class="cell">
<div class="sourceCode" id="cb81"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>bad_names_good_names <span class="ot">&lt;-</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'First'</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>),</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'second name has spaces'</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>),</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'weird#symbol'</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>),</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'InCoNsIsTaNtCaPs'</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>bad_names_good_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 1 × 4
  First `second name has spaces` `weird#symbol` InCoNsIsTaNtCaPs
  &lt;dbl&gt;                    &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;
1     1                        1              1                1</code></pre>
</div>
<div class="sourceCode" id="cb83"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>bad_names_good_names <span class="ot">&lt;-</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  bad_names_good_names <span class="sc">|&gt;</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>bad_names_good_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 1 × 4
  first second_name_has_spaces weird_number_symbol in_co_ns_is_ta_nt_ca_ps
  &lt;dbl&gt;                  &lt;dbl&gt;               &lt;dbl&gt;                   &lt;dbl&gt;
1     1                      1                   1                       1</code></pre>
</div>
</div>
<p>Human readable names require an additional layer. We need to consider other cultures and how they may interpret some of the names that we are using. We also need to consider different experience levels that subsequent users of your dataset may have. This is both in terms of experience with programming and statistics, but also experience with similar datasets. For instance, a column of ‘flag’ is often used to signal that a column contains data that needs to be followed up with or treated carefully in some way. An experienced analyst will know this, but a beginner will not. Try to use meaningful names wherever possible <span class="citation" data-cites="lin2020ten">(<a href="references.html#ref-lin2020ten" role="doc-biblioref">Lin, Ali, and Wilson 2020</a>)</span>. It has been found that shorter names may take longer to comprehend <span class="citation" data-cites="shorternamestakelonger">(<a href="references.html#ref-shorternamestakelonger" role="doc-biblioref">Hofmeister, Siegmund, and Holt 2017</a>)</span>, and so it is often useful to avoid abbreviations where possible.</p>
<p>One interesting feature of R is that in certain cases partial matching on names is possible. For instance:</p>
<div class="cell">
<div class="sourceCode" id="cb85"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>never_use_partial_matching <span class="ot">&lt;-</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">my_first_name =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">another_name =</span> <span class="fu">c</span>(<span class="st">"wow"</span>, <span class="st">"great"</span>)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>never_use_partial_matching<span class="sc">$</span>my_first_name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 1 2</code></pre>
</div>
<div class="sourceCode" id="cb87"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>never_use_partial_matching<span class="sc">$</span>my</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] 1 2</code></pre>
</div>
</div>
<p>This behavior is not possible within the <code>tidyverse</code>, for instance if <code>data.frame</code> were replaced with <code>tibble</code> in the above code. Partial matching should almost never be used. It makes it more difficult to understand code after a break, and for others to come to it fresh.</p>
<p><span class="citation" data-cites="columnnamesascontracts">Riederer (<a href="references.html#ref-columnnamesascontracts" role="doc-biblioref">2020</a>)</span> advises using column names as contracts, through establishing a controlled vocabulary for column names. In this way, we would define a set of words that we can use in column names. In the controlled vocabulary of <span class="citation" data-cites="columnnamesascontracts">Riederer (<a href="references.html#ref-columnnamesascontracts" role="doc-biblioref">2020</a>)</span> a column could start with an abbreviation for its class, then something specific to what it pertains to, and then various details. For instance, in the Kenyan data example earlier we have the following column names: “area”, “age”, “gender”, and “number”. If we were to use our column names as contracts, then these could be: “chr_area”, “fctr_group_age”, “chr_group_gender”, and “int_group_count”.</p>
<div class="cell">
<div class="sourceCode" id="cb89"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>column_names_as_contracts <span class="ot">&lt;-</span> </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  monicas_dataset <span class="sc">|&gt;</span> </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chr_area"</span> <span class="ot">=</span> <span class="st">"area"</span>,</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fctr_group_age"</span> <span class="ot">=</span> <span class="st">"age"</span>,</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"chr_group_gender"</span> <span class="ot">=</span> <span class="st">"gender"</span>,</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"int_group_count"</span> <span class="ot">=</span> <span class="st">"number"</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then use <code>pointblank</code> <span class="citation" data-cites="pointblank">(<a href="references.html#ref-pointblank" role="doc-biblioref">Iannone and Vargas 2022</a>)</span> to set-up tests for us.</p>
<div class="cell">
<div class="sourceCode" id="cb90"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pointblank)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>agent <span class="ot">&lt;-</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_agent</span>(<span class="at">tbl =</span> column_names_as_contracts) <span class="sc">|&gt;</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">col_is_character</span>(<span class="at">columns =</span> <span class="fu">vars</span>(chr_area, chr_group_gender)) <span class="sc">|&gt;</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">col_is_factor</span>(<span class="at">columns =</span> <span class="fu">vars</span>(fctr_group_age)) <span class="sc">|&gt;</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">col_is_integer</span>(<span class="at">columns =</span> <span class="fu">vars</span>(int_group_count)) <span class="sc">|&gt;</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">col_vals_in_set</span>(<span class="at">columns =</span> chr_group_gender,</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">set =</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>, <span class="st">"total"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">interrogate</span>()</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>agent</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="pb_agent" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://unpkg.com/balloon-css/balloon.min.css");
html {
  font-family: 'IBM Plex Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#pb_agent .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 90%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pb_agent .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pb_agent .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pb_agent .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pb_agent .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pb_agent .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pb_agent .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pb_agent .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pb_agent .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pb_agent .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pb_agent .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pb_agent .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#pb_agent .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pb_agent .gt_from_md > :first-child {
  margin-top: 0;
}

#pb_agent .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pb_agent .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pb_agent .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#pb_agent .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pb_agent .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#pb_agent .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pb_agent .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pb_agent .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pb_agent .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pb_agent .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pb_agent .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#pb_agent .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pb_agent .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#pb_agent .gt_left {
  text-align: left;
}

#pb_agent .gt_center {
  text-align: center;
}

#pb_agent .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pb_agent .gt_font_normal {
  font-weight: normal;
}

#pb_agent .gt_font_bold {
  font-weight: bold;
}

#pb_agent .gt_font_italic {
  font-style: italic;
}

#pb_agent .gt_super {
  font-size: 65%;
}

#pb_agent .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}

#pb_agent {
  -webkit-font-smoothing: antialiased;
}

#pb_agent .gt_row {
  overflow: visible;
}

#pb_agent .gt_sourcenote {
  height: 35px;
  padding: 0;
}

#pb_agent code {
  font-family: 'IBM Plex Mono', monospace, courier;
  background-color: transparent;
  padding: 0;
}
</style>
<table class="gt_table" style="table-layout: fixed;; width: 0px">
  <colgroup>
    <col style="width:6px;">
    <col style="width:35px;">
    <col style="width:190px;">
    <col style="width:120px;">
    <col style="width:120px;">
    <col style="width:50px;">
    <col style="width:50px;">
    <col style="width:50px;">
    <col style="width:50px;">
    <col style="width:50px;">
    <col style="width:30px;">
    <col style="width:30px;">
    <col style="width:30px;">
    <col style="width:65px;">
  </colgroup>
  <thead class="gt_header">
    <tr>
      <th colspan="14" class="gt_heading gt_title gt_font_normal" style="color: #444444; font-size: 28px; text-align: left; font-weight: 500;">Pointblank Validation</th>
    </tr>
    <tr>
      <th colspan="14" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style="font-size: 12px; text-align: left;"><span style="text-decoration-style:solid;text-decoration-color:#ADD8E6;text-decoration-line:underline;text-underline-position:under;color:#333333;font-variant-numeric:tabular-nums;padding-left:4px;margin-right:5px;padding-right:2px;">[2022-04-21|10:50:48]</span><p></p>
<div style="height:25px;"><span style="background-color:#F1D35A;color:#222222;padding:0.5em 0.5em;position:inherit;text-transform:uppercase;margin:5px 0px 5px 5px;font-weight:bold;border:solid 1px #F1D35A;padding:2px 15px 2px 15px;font-size:smaller;">tibble</span>
<span style="background-color:none;color:#222222;padding:0.5em 0.5em;position:inherit;margin:5px 10px 5px -4px;font-weight:bold;border:solid 1px #F1D35A;padding:2px 15px 2px 15px;font-size:smaller;">column_names_as_contracts</span></div>
</th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">STEP</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">COLUMNS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">VALUES</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">TBL</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">EVAL</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">UNITS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">PASS</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">FAIL</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">W</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">S</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">N</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" style="color: #666666; font-weight: bold;">EXT</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">1</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that column `chr_area` is of type: character. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 67" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0.014669353 L56.712234,0.014669353 C62.2350815,0.014669353 66.712234,4.49182185 66.712234,10.0146694 L66.712234,66.0146694 L10.712234,66.0146694 C5.18938647,66.0146694 0.712233968,61.5375169 0.712233968,56.0146694 L0.712233968,10.0146694 C0.712233968,4.49182185 5.18938647,0.014669353 10.712234,0.014669353 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_is_character" transform="translate(-0.397206, 0.151308)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65.0146694 L65.712234,10.0146694 C65.712234,5.0441066 61.6827967,1.01466935 56.712234,1.01466935 L10.712234,1.01466935 C5.74167122,1.01466935 1.71223397,5.0441066 1.71223397,10.0146694 L1.71223397,56.0146694 C1.71223397,60.9852321 5.74167122,65.0146694 10.712234,65.0146694 L65.712234,65.0146694 Z"></path>            </g>            <rect id="column" fill="#000000" x="12.2117153" y="12.0146694" width="20" height="42" rx="1"></rect>            <text id="c" font-family="LucidaGrande, Lucida Grande" font-size="26" font-weight="normal" fill="#000000">                <tspan x="39.9695669" y="43.0146694">c</tspan>            </text>        </g>    </g></svg></div>
  <code style="font-size:10px;">&nbsp;col_is_character()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="chr_area" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>chr_area</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px">—</td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>1</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>1</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">2</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that column `chr_group_gender` is of type: character. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 67" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0.014669353 L56.712234,0.014669353 C62.2350815,0.014669353 66.712234,4.49182185 66.712234,10.0146694 L66.712234,66.0146694 L10.712234,66.0146694 C5.18938647,66.0146694 0.712233968,61.5375169 0.712233968,56.0146694 L0.712233968,10.0146694 C0.712233968,4.49182185 5.18938647,0.014669353 10.712234,0.014669353 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_is_character" transform="translate(-0.397206, 0.151308)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65.0146694 L65.712234,10.0146694 C65.712234,5.0441066 61.6827967,1.01466935 56.712234,1.01466935 L10.712234,1.01466935 C5.74167122,1.01466935 1.71223397,5.0441066 1.71223397,10.0146694 L1.71223397,56.0146694 C1.71223397,60.9852321 5.74167122,65.0146694 10.712234,65.0146694 L65.712234,65.0146694 Z"></path>            </g>            <rect id="column" fill="#000000" x="12.2117153" y="12.0146694" width="20" height="42" rx="1"></rect>            <text id="c" font-family="LucidaGrande, Lucida Grande" font-size="26" font-weight="normal" fill="#000000">                <tspan x="39.9695669" y="43.0146694">c</tspan>            </text>        </g>    </g></svg></div>
  <code style="font-size:10px;">&nbsp;col_is_character()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="chr_group_gender" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>chr_group_gender</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px">—</td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>1</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>1</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">3</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that column `fctr_group_age` is of type: factor. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 67" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0.014669353 L56.712234,0.014669353 C62.2350815,0.014669353 66.712234,4.49182185 66.712234,10.0146694 L66.712234,66.0146694 L10.712234,66.0146694 C5.18938647,66.0146694 0.712233968,61.5375169 0.712233968,56.0146694 L0.712233968,10.0146694 C0.712233968,4.49182185 5.18938647,0.014669353 10.712234,0.014669353 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_is_factor" transform="translate(0.116964, 0.726017)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65.0146694 L65.712234,10.0146694 C65.712234,5.0441066 61.6827967,1.01466935 56.712234,1.01466935 L10.712234,1.01466935 C5.74167122,1.01466935 1.71223397,5.0441066 1.71223397,10.0146694 L1.71223397,56.0146694 C1.71223397,60.9852321 5.74167122,65.0146694 10.712234,65.0146694 L65.712234,65.0146694 Z"></path>            </g>            <rect id="column" fill="#000000" x="12.2117153" y="12.0146694" width="20" height="42" rx="1"></rect>            <text id="f" font-family="LucidaGrande, Lucida Grande" font-size="26" font-weight="normal" fill="#000000">                <tspan x="41.8484732" y="43.0146694">f</tspan>            </text>        </g>    </g></svg></div>
  <code style="font-size:11px;">&nbsp;col_is_factor()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="fctr_group_age" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>fctr_group_age</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px">—</td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>1</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>1</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">4</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that column `int_group_count` is of type: integer. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 67" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0.014669353 L56.712234,0.014669353 C62.2350815,0.014669353 66.712234,4.49182185 66.712234,10.0146694 L66.712234,66.0146694 L10.712234,66.0146694 C5.18938647,66.0146694 0.712233968,61.5375169 0.712233968,56.0146694 L0.712233968,10.0146694 C0.712233968,4.49182185 5.18938647,0.014669353 10.712234,0.014669353 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_is_integer" transform="translate(-0.397206, 0.726017)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65.0146694 L65.712234,10.0146694 C65.712234,5.0441066 61.6827967,1.01466935 56.712234,1.01466935 L10.712234,1.01466935 C5.74167122,1.01466935 1.71223397,5.0441066 1.71223397,10.0146694 L1.71223397,56.0146694 C1.71223397,60.9852321 5.74167122,65.0146694 10.712234,65.0146694 L65.712234,65.0146694 Z"></path>            </g>            <rect id="column" fill="#000000" x="12.2117153" y="12.0146694" width="20" height="42" rx="1"></rect>            <text id="i" font-family="LucidaGrande, Lucida Grande" font-size="26" font-weight="normal" fill="#000000">                <tspan x="42.8704458" y="43.0146694">i</tspan>            </text>        </g>    </g></svg></div>
  <code style="font-size:11px;">&nbsp;col_is_integer()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="int_group_count" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>int_group_count</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px">—</td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>1</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>1</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
    <tr><td class="gt_row gt_left" style="background-color: #4CA64C; height:  40px"></td>
<td class="gt_row gt_right" style="color: #666666; font-size: 13px; font-weight: bold; height:  40px">5</td>
<td class="gt_row gt_left" style="height:  40px"><div class="gt_from_md"><div aria-label="Expect that values in `chr_group_gender` should be in the set of `male`, `female`, `total`. " data-balloon-pos="right" style="width:fit-content;">
  <div style="margin:0;padding:0;display:inline-block;height:30px;vertical-align:middle;"><svg width="30px" height="30px" viewbox="0 0 67 67" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">    <defs>        <path d="M10.712234,0 L56.712234,0 C62.2350815,-1.01453063e-15 66.712234,4.4771525 66.712234,10 L66.712234,66 L10.712234,66 C5.18938647,66 0.712233968,61.5228475 0.712233968,56 L0.712233968,10 C0.712233968,4.4771525 5.18938647,1.01453063e-15 10.712234,0 Z" id="path-1"></path>    </defs>    <g id="pointblank" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="col_vals_in_set" transform="translate(-0.487938, 0.859210)">            <g id="rectangle">                <use fill="#FFFFFF" fill-rule="evenodd" href="#path-1"></use>                <path stroke="#000000" stroke-width="2" d="M65.712234,65 L65.712234,10 C65.712234,5.02943725 61.6827967,1 56.712234,1 L10.712234,1 C5.74167122,1 1.71223397,5.02943725 1.71223397,10 L1.71223397,56 C1.71223397,60.9705627 5.74167122,65 10.712234,65 L65.712234,65 Z"></path>            </g>            <path d="M44.127969,41.1538382 L31.0814568,41.1538382 C29.9510748,41.1536429 28.8827052,40.9256134 27.9079888,40.5136953 C26.4467442,39.8960136 25.19849,38.8599685 24.3189894,37.5577099 C23.8792391,36.906727 23.5314818,36.1899233 23.2936866,35.4252675 C23.2130217,35.16589 23.1460289,34.9005554 23.0913409,34.6307286 L44.1278714,34.6307286 C45.028466,34.6306309 45.7586488,33.9004481 45.7586488,32.9998535 C45.7586488,32.0992589 45.028466,31.3690761 44.1278714,31.3690761 L23.0905596,31.3690761 C23.1990567,30.8337194 23.3597028,30.3180894 23.5675173,29.8264831 C24.185199,28.3652386 25.2212442,27.1169844 26.5236004,26.2374838 C27.1745833,25.7977334 27.891387,25.4499762 28.6560428,25.2122786 C29.4208939,24.9744833 30.2334994,24.8459665 31.0813591,24.8459665 L44.1277737,24.8459665 C45.0283683,24.8459665 45.7585511,24.1157837 45.7585511,23.2151891 C45.7585511,22.3145945 45.0283683,21.5844117 44.1277737,21.5844117 L31.0813591,21.5844117 C29.5096643,21.5844117 28.0039858,21.9038483 26.6373711,22.4820765 C24.5866678,23.3498583 22.8469049,24.7950871 21.6163267,26.616296 C20.3856508,28.4362354 19.665136,30.6413347 19.6658196,33.0000488 C19.6656243,34.5717436 19.9852563,36.0774222 20.5635822,37.4440369 C21.4312663,39.4947402 22.8765927,41.2345031 24.697704,42.4650813 C26.5176434,43.6957572 28.7227427,44.4155883 31.0814568,44.4155883 L44.1278714,44.4155883 C45.028466,44.4155883 45.7586488,43.6854055 45.7586488,42.7848109 C45.7586488,41.8842163 45.0285636,41.1538382 44.127969,41.1538382 Z" id="set_of" fill="#000000" fill-rule="nonzero"></path>        </g>    </g></svg></div>
  <code style="font-size:11px;">&nbsp;col_vals_in_set()</code>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="chr_group_gender" data-balloon-pos="left">
  <p style="margin-top:0;margin-bottom:0;font-size:11px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:2em;">
    <code><span style="color:purple;">▮</span>chr_group_gender</code>
  </p>
</div>
</div></td>
<td class="gt_row gt_left" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; height:  40px"><div class="gt_from_md"><div aria-label="male, female, total" data-balloon-pos="left"><p style="margin-top: 0px; margin-bottom: 0px; font-size: 11px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;"><code>male, female, total</code></p></div>
</div></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:0;color:#333333;vertical-align:middle;font-size:10px;border:none;border-radius:4px;" aria-label="No modifications of the table." data-balloon-pos="left"><svg width="25px" height="25px" viewbox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="vertical-align: middle;">    <g id="unchanged" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">        <g id="unchanged" transform="translate(0.500000, 0.570147)">            <rect id="Rectangle" x="0.125132506" y="0" width="23.749735" height="23.7894737"></rect>            <path d="M5.80375046,8.18194736 C3.77191832,8.18194736 2.11875046,9.83495328 2.11875046,11.8669474 C2.11875046,13.8989414 3.77191832,15.5519474 5.80375046,15.5519474 C7.8355826,15.5519474 9.48875046,13.8989414 9.48875046,11.8669474 C9.48875046,9.83495328 7.83552863,8.18194736 5.80375046,8.18194736 Z M5.80375046,14.814915 C4.17821997,14.814915 2.85578285,13.4924778 2.85578285,11.8669474 C2.85578285,10.2414169 4.17821997,8.91897975 5.80375046,8.91897975 C7.42928095,8.91897975 8.75171807,10.2414169 8.75171807,11.8669474 C8.75171807,13.4924778 7.42928095,14.814915 5.80375046,14.814915 Z" id="Shape" fill="#000000" fill-rule="nonzero"></path>            <path d="M13.9638189,8.699335 C13.9364621,8.70430925 13.9091059,8.71176968 13.8842359,8.71923074 C13.7822704,8.73663967 13.6877654,8.77643115 13.6056956,8.83860518 L10.2433156,11.3852598 C10.0766886,11.5046343 9.97720993,11.6986181 9.97720993,11.9025491 C9.97720993,12.1064807 10.0766886,12.3004639 10.2433156,12.4198383 L13.6056956,14.966493 C13.891697,15.1803725 14.2970729,15.1231721 14.5109517,14.8371707 C14.7248313,14.5511692 14.6676309,14.145794 14.3816294,13.9319145 L12.5313257,12.5392127 L21.8812495,12.5392127 L21.8812495,11.2658854 L12.5313257,11.2658854 L14.3816294,9.87318364 C14.6377872,9.71650453 14.7497006,9.40066014 14.6477351,9.11714553 C14.5482564,8.83363156 14.262255,8.65954352 13.9638189,8.699335 Z" id="arrow" fill="#000000" transform="translate(15.929230, 11.894737) rotate(-180.000000) translate(-15.929230, -11.894737) "></path>        </g>    </g></svg></span></p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p><span style="background:transparent;padding:5px;color:#4CA64C;vertical-align:middle;font-size:15px;border:none;" aria-label="No evaluation issues." data-balloon-pos="left">✓</span></p>
</div></td>
<td class="gt_row gt_right" style="font-size: 11px; height:  40px"><code>14K</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>14K</code><br><code>1.00</code></td>
<td class="gt_row gt_right" style="border-left-width: 1px; border-left-style: dashed; border-left-color: #E5E5E5; font-size: 11px; height:  40px"><code>0</code><br><code>0.00</code></td>
<td class="gt_row gt_center" style="border-left-width: 1px; border-left-style: solid; border-left-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="border-right-width: 1px; border-right-style: solid; border-right-color: #D3D3D3; background-color: #FCFCFC; height:  40px"><div class="gt_from_md"><p>—</p>
</div></td>
<td class="gt_row gt_center" style="height:  40px"><div class="gt_from_md"><p>—</p>
</div></td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="14"><span style="background-color:#FFF;color:#444;padding:0.5em 0.5em;position:inherit;text-transform:uppercase;margin-left:10px;border:solid 1px #999999;font-variant-numeric:tabular-nums;border-radius:0;padding:2px 10px 2px 10px;padding:2px 10px 2px 10px;">2022-04-21 10:50:48 EDT</span>
<span style="background-color:#FFF;color:#444;padding:0.5em 0.5em;position:inherit;margin:5px 1px 5px 0;border:solid 1px #999999;font-variant-numeric:tabular-nums;border-radius:0;padding:2px 10px 2px 10px;">&lt; 1 s</span>
<span style="background-color:#FFF;color:#444;padding:0.5em 0.5em;position:inherit;text-transform:uppercase;margin:5px 1px 5px -1px;border:solid 1px #999999;font-variant-numeric:tabular-nums;border-radius:0;padding:2px 10px 2px 10px;">2022-04-21 10:50:49 EDT</span></td>
    </tr>
  </tfoot>
  
</table>
</div>
</div>
</div>
<!-- ## Pipelines -->
<!-- Following @suresh2020framework -->
</section>
<section id="exercises-and-tutorial" class="level2" data-number="11.6">
<h2 data-number="11.6" class="anchored" data-anchor-id="exercises-and-tutorial"><span class="header-section-number">11.6</span> Exercises and tutorial</h2>
<section id="exercises" class="level3" data-number="11.6.1">
<h3 data-number="11.6.1" class="anchored" data-anchor-id="exercises"><span class="header-section-number">11.6.1</span> Exercises</h3>
<ol type="1">
<li>Is the following an example of tidy data?</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb91"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">'Anne'</span>, <span class="st">'Bethany'</span>, <span class="st">'Stephen'</span>, <span class="st">'William'</span>),</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">age_group =</span> <span class="fu">c</span>(<span class="st">'18-29'</span>, <span class="st">'30-44'</span>, <span class="st">'45-60'</span>, <span class="st">'60+'</span>),</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>       )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 4 × 2
  name    age_group
  &lt;chr&gt;   &lt;chr&gt;    
1 Anne    18-29    
2 Bethany 30-44    
3 Stephen 45-60    
4 William 60+      </code></pre>
</div>
</div>
<ol start="2" type="1">
<li>If I am dealing with ages then what is the most likely class for the variable? [Select all that apply.]
<ol type="a">
<li>integer</li>
<li>matrix</li>
<li>numeric</li>
<li>factor</li>
</ol></li>
</ol>
</section>
<section id="tutorial" class="level3" data-number="11.6.2">
<h3 data-number="11.6.2" class="anchored" data-anchor-id="tutorial"><span class="header-section-number">11.6.2</span> Tutorial</h3>
<p>With regard to <span class="citation" data-cites="Jordan2019Artificial">Jordan (<a href="references.html#ref-Jordan2019Artificial" role="doc-biblioref">2019</a>)</span>, <span class="citation" data-cites="datafeminism2020">D’Ignazio and Klein (<a href="references.html#ref-datafeminism2020" role="doc-biblioref">2020</a>)</span>, Chapter 6, <span class="citation" data-cites="thatrandyauperson">Au (<a href="references.html#ref-thatrandyauperson" role="doc-biblioref">2020</a>)</span>, and other relevant work, to what extent do you think we should let the data speak for themselves? [Please write a page or two.]</p>



<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-omggenes" class="csl-entry" role="doc-biblioentry">
Abeysooriya, Mandhri, Megan Soria, Mary Sravya Kasu, and Mark Ziemann. 2021. <span>“Gene Name Errors: Lessons Not Learned.”</span> <em>PLOS Computational Biology</em> 17 (7): 1–13. <a href="https://doi.org/10.1371/journal.pcbi.1008984">https://doi.org/10.1371/journal.pcbi.1008984</a>.
</div>
<div id="ref-alexander2021bayesian" class="csl-entry" role="doc-biblioentry">
Alexander, Monica, and Leontine Alkema. 2021. <span>“A Bayesian Cohort Component Projection Model to Estimate Adult Populations at the Subnational Level in Data-Sparse Settings.”</span> <a href="https://arxiv.org/abs/2102.06121">https://arxiv.org/abs/2102.06121</a>.
</div>
<div id="ref-thatrandyauperson" class="csl-entry" role="doc-biblioentry">
Au, Randy. 2020. <span>“Data Cleaning IS Analysis, Not Grunt Work.”</span> Counting Stuff. <a href="https://counting.substack.com/p/data-cleaning-is-analysis-not-grunt">https://counting.substack.com/p/data-cleaning-is-analysis-not-grunt</a>.
</div>
<div id="ref-caroonworking" class="csl-entry" role="doc-biblioentry">
Caro, Robert. 2019. <em>Working</em>. 1st ed. Knopf.
</div>
<div id="ref-cohn2016" class="csl-entry" role="doc-biblioentry">
Cohn, Nate. 2016. <em>We Gave Four Good Pollsters the Same Raw Data. They Had Four Different Results</em>.
</div>
<div id="ref-craiu2019hiring" class="csl-entry" role="doc-biblioentry">
Craiu, Radu V. 2019. <span>“The Hiring Gambit: In Search of the Twofer Data Scientist.”</span> <em>Harvard Data Science Review</em> 1 (1).
</div>
<div id="ref-datafeminism2020" class="csl-entry" role="doc-biblioentry">
D’Ignazio, Catherine, and Lauren F Klein. 2020. <em>Data Feminism</em>. Mit Press.
</div>
<div id="ref-janitor" class="csl-entry" role="doc-biblioentry">
Firke, Sam. 2020. <em>Janitor: Simple Tools for Examining and Cleaning Dirty Data</em>. <a href="https://CRAN.R-project.org/package=janitor">https://CRAN.R-project.org/package=janitor</a>.
</div>
<div id="ref-stringi" class="csl-entry" role="doc-biblioentry">
Gagolewski, Marek. 2020. <em>R Package Stringi: Character String Processing Facilities</em>. <a href="http://www.gagolewski.com/software/stringi/">http://www.gagolewski.com/software/stringi/</a>.
</div>
<div id="ref-gelman2013garden" class="csl-entry" role="doc-biblioentry">
Gelman, Andrew, and Eric Loken. 2013. <span>“The Garden of Forking Paths: Why Multiple Comparisons Can Be a Problem, Even When There Is No <span>‘Fishing Expedition’</span> or <span>‘p-Hacking’</span> and the Research Hypothesis Was Posited Ahead of Time.”</span> <em>Department of Statistics, Columbia University</em> 348.
</div>
<div id="ref-gelman2020most" class="csl-entry" role="doc-biblioentry">
Gelman, Andrew, and Aki Vehtari. 2020. <span>“What Are the Most Important Statistical Ideas of the Past 50 Years?”</span> <em>arXiv Preprint arXiv:2012.00174</em>.
</div>
<div id="ref-halberstam" class="csl-entry" role="doc-biblioentry">
Halberstam, David. 1972. <em><span class="nocase">The Best and the Brightest</span></em>. Random House.
</div>
<div id="ref-citepurrr" class="csl-entry" role="doc-biblioentry">
Henry, Lionel, and Hadley Wickham. 2020. <em>Purrr: Functional Programming Tools</em>. <a href="https://CRAN.R-project.org/package=purrr">https://CRAN.R-project.org/package=purrr</a>.
</div>
<div id="ref-shorternamestakelonger" class="csl-entry" role="doc-biblioentry">
Hofmeister, Johannes, Janet Siegmund, and Daniel V. Holt. 2017. <span>“Shorter Identifier Names Take Longer to Comprehend.”</span> In <em>2017 IEEE 24th International Conference on Software Analysis, Evolution and Reengineering (SANER)</em>, 217–27. <a href="https://doi.org/10.1109/SANER.2017.7884623">https://doi.org/10.1109/SANER.2017.7884623</a>.
</div>
<div id="ref-huntington2020influence" class="csl-entry" role="doc-biblioentry">
Huntington-Klein, Nick, Andreu Arenas, Emily Beam, Marco Bertoni, Jeffrey Bloem, Pralhad H Burli, Naibin Chen, et al. 2020. <span>“The Influence of Hidden Researcher Decisions in Applied Microeconomics.”</span>
</div>
<div id="ref-pointblank" class="csl-entry" role="doc-biblioentry">
Iannone, Richard, and Mauricio Vargas. 2022. <em>Pointblank: Data Validation and Organization of Metadata for Local and Remote Tables</em>. <a href="https://CRAN.R-project.org/package=pointblank">https://CRAN.R-project.org/package=pointblank</a>.
</div>
<div id="ref-Jordan2019Artificial" class="csl-entry" role="doc-biblioentry">
Jordan, Michael I. 2019. <span>“Artificial Intelligence—the Revolution Hasn’t Happened Yet.”</span> <em>Harvard Data Science Review</em> 1 (1). <a href="https://doi.org/10.1162/99608f92.f06c6e61">https://doi.org/10.1162/99608f92.f06c6e61</a>.
</div>
<div id="ref-kimmerer2013" class="csl-entry" role="doc-biblioentry">
Kimmerer, Robin Wall. 2012. <em>Braiding Sweetgrass</em>. Milkweed Editions.
</div>
<div id="ref-lazear2000economic" class="csl-entry" role="doc-biblioentry">
Lazear, Edward P. 2000. <span>“Economic Imperialism.”</span> <em>The Quarterly Journal of Economics</em> 115 (1): 99–146.
</div>
<div id="ref-lin2020ten" class="csl-entry" role="doc-biblioentry">
Lin, Sarah, Ibraheem Ali, and Greg Wilson. 2020. <span>“Ten Quick Tips for Making Things Findable.”</span> <em>PLoS Computational Biology</em> 16 (12): e1008469.
</div>
<div id="ref-meng2018statistical" class="csl-entry" role="doc-biblioentry">
Meng, Xiao-Li. 2018. <span>“Statistical Paradises and Paradoxes in Big Data (i): Law of Large Populations, Big Data Paradox, and the 2016 US Presidential Election.”</span> <em>The Annals of Applied Statistics</em> 12 (2): 685–726.
</div>
<div id="ref-pdftools" class="csl-entry" role="doc-biblioentry">
Ooms, Jeroen. 2019. <em>Pdftools: Text Extraction, Rendering and Converting of PDF Documents</em>. <a href="https://CRAN.R-project.org/package=pdftools">https://CRAN.R-project.org/package=pdftools</a>.
</div>
<div id="ref-columnnamesascontracts" class="csl-entry" role="doc-biblioentry">
Riederer, Emily. 2020. <span>“Column Names as Contracts.”</span> <a href="https://emilyriederer.netlify.app/post/column-name-contracts/">https://emilyriederer.netlify.app/post/column-name-contracts/</a>.
</div>
<div id="ref-convo" class="csl-entry" role="doc-biblioentry">
———. 2022. <em>Convo: Enables Conversations and Contracts Through Controlled Vocabulary Naming Conventions</em>. <a href="https://github.com/emilyriederer/convo">https://github.com/emilyriederer/convo</a>.
</div>
<div id="ref-silberzahn2018many" class="csl-entry" role="doc-biblioentry">
Silberzahn, Raphael, Eric L Uhlmann, Daniel P Martin, Pasquale Anselmi, Frederik Aust, Eli Awtrey, Štěpán Bahnı́k, et al. 2018. <span>“Many Analysts, One Data Set: Making Transparent How Variations in Analytic Choices Affect Results.”</span> <em>Advances in Methods and Practices in Psychological Science</em> 1 (3): 337–56.
</div>
<div id="ref-tukey1962future" class="csl-entry" role="doc-biblioentry">
Tukey, John W. 1962. <span>“The Future of Data Analysis.”</span> <em>The Annals of Mathematical Statistics</em> 33 (1): 1–67.
</div>
<div id="ref-van2005data" class="csl-entry" role="doc-biblioentry">
Van den Broeck, Jan, Solveig Argeseanu Cunningham, Roger Eeckels, and Kobus Herbst. 2005. <span>“Data Cleaning: Detecting, Diagnosing, and Editing Data Abnormalities.”</span> <em>PLoS Medicine</em> 2 (10): e267.
</div>
<div id="ref-testthat" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley. 2011. <span>“Testthat: Get Started with Testing.”</span> <em>The R Journal</em> 3: 5–10. <a href="https://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf">https://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf</a>.
</div>
<div id="ref-Wickham2017" class="csl-entry" role="doc-biblioentry">
———. 2017. <em>Tidyverse: Easily Install and Load the ’Tidyverse’</em>. <a href="https://CRAN.R-project.org/package=tidyverse">https://CRAN.R-project.org/package=tidyverse</a>.
</div>
<div id="ref-citestringr" class="csl-entry" role="doc-biblioentry">
———. 2019. <em>Stringr: Simple, Consistent Wrappers for Common String Operations</em>. <a href="https://CRAN.R-project.org/package=stringr">https://CRAN.R-project.org/package=stringr</a>.
</div>
<div id="ref-citetidyr" class="csl-entry" role="doc-biblioentry">
———. 2021. <em>Tidyr: Tidy Messy Data</em>. <a href="https://CRAN.R-project.org/package=tidyr">https://CRAN.R-project.org/package=tidyr</a>.
</div>
<div id="ref-tidyverse" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span class="nocase">tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
<div id="ref-r4ds" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley, and Garrett Grolemund. 2017. <em>R for Data Science</em>. <a href="https://r4ds.had.co.nz/">https://r4ds.had.co.nz/</a>.
</div>
<div id="ref-buildingsoftwaretogether" class="csl-entry" role="doc-biblioentry">
Wilson, Greg. 2021. <em>Building Software Together</em>. CRC Books.
</div>
<div id="ref-wilsongoodenough" class="csl-entry" role="doc-biblioentry">
Wilson, Greg, Jennifer Bryan, Karen Cranston, Justin Kitzes, Lex Nederbragt, and Tracy K. Teal. 2017. <span>“Good Enough Practices in Scientific Computing.”</span> <em>PLOS Computational Biology</em> 13 (6): 1–20. <a href="https://doi.org/10.1371/journal.pcbi.1005510">https://doi.org/10.1371/journal.pcbi.1005510</a>.
</div>
</div>
</section>
</section>
<section class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1" role="doc-endnote"><p>If the Kenyan government link breaks then replace their URL with: https://www.tellingstorieswithdata.com/inputs/pdfs/2019_Kenya_census.pdf.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
</main> <!-- /main -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./10-hunt.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Hunt data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./12-store_and_share.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Store and share</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->


</body></html>