<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Telling Stories with Data - 13&nbsp; Exploratory data analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./14-ijalm.html" rel="next">
<link href="./12-store_and_share.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Telling Stories with Data</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/RohanAlexander/telling_stories/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-author.html" class="sidebar-item-text sidebar-link">About the author</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./00-foundations.html" class="sidebar-item-text sidebar-link">Foundations</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Telling stories with data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-drinking_from_a_fire_hose.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Drinking from a fire hose</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-r_essentials.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">R essentials</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-workflow.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reproducible workflows</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Communication</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-writing_research.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Writing research</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-static_communication.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Static communication</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-interactive_communication.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Interactive communication</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Acquisition</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-farm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Farm data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-gather.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Gather data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-hunt.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Hunt data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Preparation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-clean_and_prepare.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Clean and prepare</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-store_and_share.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Store and share</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Modelling</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-eda.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-ijalm.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">It’s Just A Linear Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-causality_from_obs.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Causality from observational data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-mrp.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Multilevel regression with post-stratification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-text.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Text as data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-concluding.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Concluding remarks</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-rmarkdown.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">R Markdown</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-assessment.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Papers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-datasheet.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Datasheet</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./98-cocktails.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Cocktails</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"> <span class="header-section-number">13.1</span> Introduction</a></li>
  <li><a href="#ttc-subway-delays" id="toc-ttc-subway-delays" class="nav-link" data-scroll-target="#ttc-subway-delays"> <span class="header-section-number">13.2</span> TTC subway delays</a>
  <ul class="collapse">
  <li><a href="#distribution-and-properties-of-individual-variables" id="toc-distribution-and-properties-of-individual-variables" class="nav-link" data-scroll-target="#distribution-and-properties-of-individual-variables"> <span class="header-section-number">13.2.1</span> Distribution and properties of individual variables</a></li>
  <li><a href="#relationships-between-variables" id="toc-relationships-between-variables" class="nav-link" data-scroll-target="#relationships-between-variables"> <span class="header-section-number">13.2.2</span> Relationships between variables</a></li>
  </ul></li>
  <li><a href="#airbnb-listings-in-london" id="toc-airbnb-listings-in-london" class="nav-link" data-scroll-target="#airbnb-listings-in-london"> <span class="header-section-number">13.3</span> Airbnb listings in London</a>
  <ul class="collapse">
  <li><a href="#distribution-and-properties-of-individual-variables-1" id="toc-distribution-and-properties-of-individual-variables-1" class="nav-link" data-scroll-target="#distribution-and-properties-of-individual-variables-1"> <span class="header-section-number">13.3.1</span> Distribution and properties of individual variables</a></li>
  <li><a href="#relationships-between-variables-1" id="toc-relationships-between-variables-1" class="nav-link" data-scroll-target="#relationships-between-variables-1"> <span class="header-section-number">13.3.2</span> Relationships between variables</a></li>
  </ul></li>
  <li><a href="#exercises-and-tutorial" id="toc-exercises-and-tutorial" class="nav-link" data-scroll-target="#exercises-and-tutorial"> <span class="header-section-number">13.4</span> Exercises and tutorial</a>
  <ul class="collapse">
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  <li><a href="#tutorial" id="toc-tutorial" class="nav-link" data-scroll-target="#tutorial">Tutorial</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/RohanAlexander/telling_stories/edit/main/13-eda.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-exploratory-data-analysis" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Exploratory data analysis</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p><strong>Required material</strong></p>
<ul>
<li>Read <em>The Future of Data Analysis</em>, Part 1 “General Considerations”, <span class="citation" data-cites="tukey1962future">(<a href="99-references.html#ref-tukey1962future" role="doc-biblioref">Tukey 1962</a>)</span></li>
<li>Read <em>R for Data Science</em>, Chapter 10 “Exploratory Data Analysis”, <span class="citation" data-cites="r4ds">(<a href="99-references.html#ref-r4ds" role="doc-biblioref">Wickham and Grolemund 2022</a>)</span></li>
</ul>
<p><strong>Key concepts and skills</strong></p>
<ul>
<li>Exploratory data analysis is the process of quickly coming to terms with a new dataset by constructing graphs and tables. We want to explore and understand three critical aspects: 1) individual variables; 2) individual and multiple relationships between variables; 3) considering what is not there.</li>
<li>During the EDA process we want to come to understand the issues and features of the dataset and how this may affect analysis decisions. We are especially concerned about missing values and outliers.</li>
</ul>
<p><strong>Key packages and functions</strong></p>
<ul>
<li><code>janitor</code> <span class="citation" data-cites="janitor">(<a href="99-references.html#ref-janitor" role="doc-biblioref">Firke 2020</a>)</span>
<ul>
<li><code>adorn_ns()</code>
<ul>
<li><code>adorn_pct_formatting()</code></li>
<li><code>adorn_percentages()</code></li>
<li><code>adorn_title()</code></li>
<li><code>adorn_totals()</code></li>
<li><code>clean_names()</code></li>
<li><code>get_dupes()</code></li>
<li><code>tabyl()</code></li>
</ul></li>
</ul></li>
<li><code>modelsummary</code> <span class="citation" data-cites="citemodelsummary">(<a href="99-references.html#ref-citemodelsummary" role="doc-biblioref">Arel-Bundock 2021</a>)</span>
<ul>
<li><code>modelsummary()</code></li>
</ul></li>
<li><code>naniar</code> <span class="citation" data-cites="naniar">(<a href="99-references.html#ref-naniar" role="doc-biblioref">Tierney et al. 2021</a>)</span>
<ul>
<li><code>geom_miss_point()</code></li>
</ul></li>
<li><code>opendatatoronto</code> <span class="citation" data-cites="citeSharla">(<a href="99-references.html#ref-citeSharla" role="doc-biblioref">Gelfand 2020</a>)</span>
<ul>
<li><code>get_resource()</code></li>
<li><code>list_package_resources()</code></li>
</ul></li>
<li><code>tidyverse</code> (core) <span class="citation" data-cites="tidyverse">(<a href="99-references.html#ref-tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span>
<ul>
<li><code>dplyr</code> <span class="citation" data-cites="citedplyr">(<a href="99-references.html#ref-citedplyr" role="doc-biblioref">Wickham et al. 2022</a>)</span> <code>add_count()</code></li>
<li><code>ggplot2</code> <span class="citation" data-cites="citeggplot">(<a href="99-references.html#ref-citeggplot" role="doc-biblioref">Wickham 2016</a>)</span>
<ul>
<li><code>geom_bar()</code></li>
<li><code>geom_col()</code></li>
<li><code>geom_density()</code></li>
<li><code>geom_histogram()</code></li>
<li><code>geom_point()</code></li>
<li><code>geom_smooth()</code></li>
<li><code>scale_x_log10()</code></li>
<li><code>scale_y_log10()</code></li>
</ul></li>
<li><code>stringr</code> <span class="citation" data-cites="citestringr">(<a href="99-references.html#ref-citestringr" role="doc-biblioref">Wickham 2019</a>)</span>
<ul>
<li><code>str_detect()</code></li>
<li><code>str_remove()</code></li>
<li><code>str_split()</code></li>
<li><code>str_starts()</code></li>
<li><code>word()</code></li>
</ul></li>
</ul></li>
<li><code>tidyverse</code> (outer) <span class="citation" data-cites="tidyverse">(<a href="99-references.html#ref-tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span>
<ul>
<li><code>lubridate</code> <span class="citation" data-cites="GrolemundWickham2011">(<a href="99-references.html#ref-GrolemundWickham2011" role="doc-biblioref">Grolemund and Wickham 2011</a>)</span>
<ul>
<li><code>week()</code></li>
</ul></li>
</ul></li>
<li><code>visdat</code> <span class="citation" data-cites="citevisdat">(<a href="99-references.html#ref-citevisdat" role="doc-biblioref">Tierney 2017</a>)</span>
<ul>
<li><code>vis_dat()</code></li>
<li><code>vis_miss()</code></li>
</ul></li>
</ul>
<section id="introduction" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">13.1</span> Introduction</h2>
<blockquote class="blockquote">
<p>The future of data analysis can involve great progress, the overcoming of real difficulties, and the provision of a great service to all fields of science and technology. Will it? That remains to us, to our willingness to take up the rocky road of real problems in preference to the smooth road of unreal assumptions, arbitrary criteria, and abstract results without real attachments. Who is for the challenge?</p>
<p><span class="citation" data-cites="tukey1962future">Tukey (<a href="99-references.html#ref-tukey1962future" role="doc-biblioref">1962, 64</a>)</span>.</p>
</blockquote>
<p>Exploratory data analysis is never finished, you just die. It is the active process of exploring and becoming familiar with our data. Like a farmer with their hands in the earth, we need to know every contour and aspect of our data. We need to know how it changes, what it shows, hides, and what are its limits. Exploratory data analysis (EDA) is the unstructured process of doing this.</p>
<p>EDA is a means to an end. While it will inform the entire paper, especially the data section, it is not typically something that ends up in the final paper. The way to proceed is to make a separate Quarto document and add code as well as brief notes on-the-go. Do not delete previous code, just add to it. By the end of it we will have created a useful notebook that captures our exploration of the dataset. This is a document that will guide the subsequent analysis and modelling.</p>
<p>EDA draws on a variety of skills and there are a lot of options for EDA <span class="citation" data-cites="staniak2019landscape">(<a href="99-references.html#ref-staniak2019landscape" role="doc-biblioref">Staniak and Biecek 2019</a>)</span>. Every tool should be considered. Look at the data and scroll through it. Make tables, plots, summary statistics, even some models. The key is to iterate, move quickly rather than perfectly, and come to a thorough understanding of the data.</p>
<p>We are interested in coming to thoroughly understand the data that we have, which will help us understand what we do not have. We are interested in the following process:</p>
<ul>
<li>Understand distribution and properties of individual variables.</li>
<li>Understand relationships between variables.</li>
<li>Consider what is not there.</li>
</ul>
<p>In this chapter we will go through various examples of EDA including TTC subway delays, and Airbnb.</p>
</section>
<section id="ttc-subway-delays" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="ttc-subway-delays"><span class="header-section-number">13.2</span> TTC subway delays</h2>
<p>As a first example of EDA we use <code>opendatatoronto</code> <span class="citation" data-cites="citeSharla">(<a href="99-references.html#ref-citeSharla" role="doc-biblioref">Gelfand 2020</a>)</span>, introduced in <a href="02-drinking_from_a_fire_hose.html"><span>Chapter&nbsp;2</span></a>, and the <code>tidyverse</code> <span class="citation" data-cites="tidyverse">(<a href="99-references.html#ref-tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span> to obtain and explore data about the Toronto subway system. We are especially interested in getting a sense of the delays that have occurred.</p>
<p>To begin, we download the data on Toronto Transit Commission (TTC) subway delays in 2021. The data are available as a separate dataset for each month. We are interested in 2021, so we create a column that of the year, and then filter the resources to just those months that were in 2021. We download them using <code>get_resource()</code>, iterating through each month using <code>map_dfr</code> from <code>purrr</code> <span class="citation" data-cites="citepurrr">(<a href="99-references.html#ref-citepurrr" role="doc-biblioref">Henry and Wickham 2020</a>)</span> which brings each of the twelve datasets together, and then save them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(opendatatoronto)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data <span class="ot">&lt;-</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_package_resources</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"996cfe8d-fb35-40ce-b569-698d51fc683b"</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"ttc-subway-delay-data-2021"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_resource</span>() <span class="sc">|&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(all_2021_ttc_data, <span class="st">"all_2021_ttc_data.csv"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The dataset has a variety of columns, and we can find out more about each of them by downloading the codebook. The reason for the delay is coded, and so we can also download the explanations. One variable of interest appears to be “min_delay”, which gives the extent of the delay in minutes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data codebook</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>delay_codebook <span class="ot">&lt;-</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_package_resources</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"996cfe8d-fb35-40ce-b569-698d51fc683b"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"ttc-subway-delay-data-readme"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_resource</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(delay_codebook, <span class="st">"delay_codebook.csv"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Explanation for delay codes</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>delay_codes <span class="ot">&lt;-</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_package_resources</span>(</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"996cfe8d-fb35-40ce-b569-698d51fc683b"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">"ttc-subway-delay-codes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_resource</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(delay_codes, <span class="st">"delay_codes.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is no one way to explore a dataset while conducting EDA, but we are usually especially interested in:</p>
<ul>
<li>What should the variables look like? For instance, what is their type, what are the values, and what does the distribution of these look like?</li>
<li>What aspects are surprising, both in terms of data that are there that we do not expect, such as outliers, but also in terms of data that we may expect here but do not have such as missing data.</li>
<li>Developing a goal for our analysis. For instance, in this case, it might be understanding the factors such as stations and the time of day, that are associated with delays.</li>
</ul>
<p>It is important to document all aspects as we go through and make note of anything surprising. We are looking to create a record of the steps and assumptions that we made as we were going because these will be important when we come to modelling.</p>
<section id="distribution-and-properties-of-individual-variables" class="level3" data-number="13.2.1">
<h3 data-number="13.2.1" class="anchored" data-anchor-id="distribution-and-properties-of-individual-variables"><span class="header-section-number">13.2.1</span> Distribution and properties of individual variables</h3>
<section id="checking-data" class="level4" data-number="13.2.1.1">
<h4 data-number="13.2.1.1" class="anchored" data-anchor-id="checking-data"><span class="header-section-number">13.2.1.1</span> Checking data</h4>
<p>We should check that the variables are what they say they are. If they are not, then we need to work out what to do, for instance, should we change them, or possibly even remove them? It is also important to ensure that the class of the variables is as we expect. For instance, variables that should be a factor are a factor and those that should be a character are a character. And that we do not accidentally have, say, factors as numbers, or vice versa. One way to do this is to use <code>unique()</code>, and another is to use <code>table()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(all_2021_ttc_data<span class="sc">$</span>day)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Friday"    "Saturday"  "Sunday"    "Monday"    "Tuesday"   "Wednesday"
[7] "Thursday" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(all_2021_ttc_data<span class="sc">$</span>line)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "YU"                     "BD"                     "SHP"                   
 [4] "SRT"                    "YU/BD"                  NA                      
 [7] "YONGE/UNIVERSITY/BLOOR" "YU / BD"                "YUS"                   
[10] "999"                    "SHEP"                   "36 FINCH WEST"         
[13] "YUS &amp; BD"               "YU &amp; BD LINES"          "35 JANE"               
[16] "52"                     "41 KEELE"               "YUS/BD"                </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(all_2021_ttc_data<span class="sc">$</span>day)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   Friday    Monday  Saturday    Sunday  Thursday   Tuesday Wednesday 
     2600      2434      2073      1942      2425      2481      2415 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(all_2021_ttc_data<span class="sc">$</span>line)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
               35 JANE          36 FINCH WEST               41 KEELE 
                     1                      1                      1 
                    52                    999                     BD 
                     1                      1                   5734 
                  SHEP                    SHP                    SRT 
                     1                    657                    656 
YONGE/UNIVERSITY/BLOOR                     YU                YU / BD 
                     1                   8880                     17 
         YU &amp; BD LINES                  YU/BD                    YUS 
                     1                    346                     18 
              YUS &amp; BD                 YUS/BD 
                     1                      1 </code></pre>
</div>
</div>
<p>We have likely issues in terms of the subway lines. Some of them have a clear fix, but not all. One option would be to drop them, but we would need to think about whether these errors might be correlated with something that is of interest, because if they were then we may be dropping important information. There is usually no one right answer, because it will usually depend on what we are using the data for. We would note the issue, as we continued with EDA and then decide later about what to do. For now, we will remove all the lines that are not the ones that we know to be correct.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_filtered_lines <span class="ot">&lt;-</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  all_2021_ttc_data <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(line <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"BD"</span>, <span class="st">"YU"</span>, <span class="st">"SHP"</span>, <span class="st">"SRT"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Exploring missing data could be a course in itself, but the presence, or lack, of missing values can haunt an analysis. To get started we could look at known-unknowns, which are the NAs for each variable. It can be useful to use <code>vis_dat()</code> from <code>visdat</code> <span class="citation" data-cites="citevisdat">(<a href="99-references.html#ref-citevisdat" role="doc-biblioref">Tierney 2017</a>)</span> to get a feel for how the missing values are distributed across variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visdat)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_dat</span>(<span class="at">x =</span> all_2021_ttc_data_filtered_lines,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">palette =</span> <span class="st">"cb_safe"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="13-eda_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this case we have many missing values in “bound” and two in “line”. For these known-unknowns, as discussed in <a href="08-farm.html"><span>Chapter&nbsp;8</span></a>, we are interested in whether the they are missing at random. We want to, ideally, show that data happened to just drop out. This is unlikely, and so we are usually trying to look at what is systematic about how our data are missing.</p>
<p>Sometime data happen to be duplicated. If we did not notice this, then our analysis would be wrong in ways that we would not be able to consistently expect. There are a variety of ways to look for duplicated rows, but <code>get_dupes()</code> from <code>janitor</code> <span class="citation" data-cites="janitor">(<a href="99-references.html#ref-janitor" role="doc-biblioref">Firke 2020</a>)</span> is especially useful.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_dupes</span>(all_2021_ttc_data_filtered_lines)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>No variable names specified - using all columns.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 36 × 11
   date                time   day      station code  min_d…¹ min_gap bound line 
   &lt;dttm&gt;              &lt;time&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
 1 2021-03-31 00:00:00 05:45  Wednesd… DUNDAS… MUNCA       0       0 &lt;NA&gt;  BD   
 2 2021-03-31 00:00:00 05:45  Wednesd… DUNDAS… MUNCA       0       0 &lt;NA&gt;  BD   
 3 2021-06-08 00:00:00 14:40  Tuesday  VAUGHA… MUNOA       3       6 S     YU   
 4 2021-06-08 00:00:00 14:40  Tuesday  VAUGHA… MUNOA       3       6 S     YU   
 5 2021-06-22 00:00:00 06:00  Tuesday  TORONT… MRO         0       0 &lt;NA&gt;  SRT  
 6 2021-06-22 00:00:00 06:00  Tuesday  TORONT… MRO         0       0 &lt;NA&gt;  SRT  
 7 2021-06-22 00:00:00 06:00  Tuesday  TORONT… MUO         0       0 &lt;NA&gt;  SHP  
 8 2021-06-22 00:00:00 06:00  Tuesday  TORONT… MUO         0       0 &lt;NA&gt;  SHP  
 9 2021-09-11 00:00:00 06:00  Saturday TORONT… MRO         0       0 &lt;NA&gt;  SRT  
10 2021-09-11 00:00:00 06:00  Saturday TORONT… MRO         0       0 &lt;NA&gt;  SRT  
# … with 26 more rows, 2 more variables: vehicle &lt;dbl&gt;, dupe_count &lt;int&gt;, and
#   abbreviated variable name ¹​min_delay
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
<p>This dataset has many duplicates. Again, we are interested in whether there is something systematic going on. Remembering that during EDA we are trying to quickly come to terms with a dataset, one way forward is to flag this as an issue to come back to and explore later, and to just remove duplicates for now using <code>distinct()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="ot">&lt;-</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  all_2021_ttc_data_filtered_lines <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The station names are a mess.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(station)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 259 × 2
   station                    n
   &lt;chr&gt;                  &lt;int&gt;
 1 BATHURST STATION         161
 2 BAY STATION              102
 3 BAYVIEW STATION           91
 4 BAYVIEW TO SHEPAPRD/YO     1
 5 BEDFORD SUBSTATION         1
 6 BESSARION STATION         39
 7 BLOOR DANFORTH LINE        9
 8 BLOOR DANFORTH SUBWAY      8
 9 BLOOR HAYDEN ENTRANCE      1
10 BLOOR STATION            479
# … with 249 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<p>We could try to quickly bring a little order to the chaos by just taking just the first word (or, the first two if it starts with “ST”). Again, we are just trying to get a sense of the data, not necessarily make binding decisions here. We use <code>word()</code> from <code>stringr</code> here to extract specific words from the station names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="ot">&lt;-</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">station_clean =</span> <span class="fu">if_else</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_starts</span>(station, <span class="st">"ST"</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">word</span>(station, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">word</span>(station, <span class="dv">1</span>))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15,908 × 11
   date                time   day    station   code  min_d…¹ min_gap bound line 
   &lt;dttm&gt;              &lt;time&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
 1 2021-01-01 00:00:00 00:33  Friday BLOOR ST… MUPAA       0       0 N     YU   
 2 2021-01-01 00:00:00 00:39  Friday SHERBOUR… EUCO        5       9 E     BD   
 3 2021-01-01 00:00:00 01:07  Friday KENNEDY … EUCD        5       9 E     BD   
 4 2021-01-01 00:00:00 01:41  Friday ST CLAIR… MUIS        0       0 &lt;NA&gt;  YU   
 5 2021-01-01 00:00:00 02:04  Friday SHEPPARD… MUIS        0       0 &lt;NA&gt;  YU   
 6 2021-01-01 00:00:00 02:35  Friday KENNEDY … MUIS        0       0 &lt;NA&gt;  BD   
 7 2021-01-01 00:00:00 02:39  Friday VAUGHAN … MUIS        0       0 &lt;NA&gt;  YU   
 8 2021-01-01 00:00:00 06:00  Friday TORONTO … MUO         0       0 &lt;NA&gt;  YU   
 9 2021-01-01 00:00:00 06:00  Friday TORONTO … MUO         0       0 &lt;NA&gt;  SHP  
10 2021-01-01 00:00:00 06:00  Friday TORONTO … MRO         0       0 &lt;NA&gt;  SRT  
# … with 15,898 more rows, 2 more variables: vehicle &lt;dbl&gt;,
#   station_clean &lt;chr&gt;, and abbreviated variable name ¹​min_delay
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
<p>We need to see the data in its original state to understand it and we use bar charts, scatterplots, line plots and histograms extensively for this. During EDA we are not as concerned with whether the graph looks nice, but are instead trying to acquire a sense of the data as quickly as possible. We can start by looking at the distribution of “min_delay”, which is one outcome of interest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_delay)) <span class="sc">+</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="13-eda_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The largely empty graph suggests the presence of outliers. There are a variety of ways to try to understand what could be going on, but one quick way to proceed it to use logarithms, remembering that we would expect values of 0 to drop away.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_delay)) <span class="sc">+</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="13-eda_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This initial exploration hints at an issue that we might like to explore further. We will join this dataset with “delay_codes” to understand what is going on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="ot">&lt;-</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    delay_codes <span class="sc">|&gt;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">code =</span> sub_rmenu_code, </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">code_desc =</span> code_description_3) <span class="sc">|&gt;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(code, code_desc),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"code"</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="ot">&lt;-</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">code_srt =</span> <span class="fu">ifelse</span>(line <span class="sc">==</span> <span class="st">"SRT"</span>, code, <span class="st">"NA"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    delay_codes <span class="sc">|&gt;</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">code_srt =</span> sub_rmenu_code, <span class="at">code_desc_srt =</span> code_description_7) <span class="sc">|&gt;</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(code_srt, code_desc_srt),</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"code_srt"</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">code =</span> <span class="fu">ifelse</span>(code_srt <span class="sc">==</span> <span class="st">"NA"</span>, code, code_srt),</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">code_desc =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(code_desc_srt), code_desc, code_desc_srt)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>code_srt,<span class="sc">-</span>code_desc_srt)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15,908 × 12
   date                time   day    station   code  min_d…¹ min_gap bound line 
   &lt;dttm&gt;              &lt;time&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
 1 2021-01-01 00:00:00 00:33  Friday BLOOR ST… MUPAA       0       0 N     YU   
 2 2021-01-01 00:00:00 00:39  Friday SHERBOUR… EUCO        5       9 E     BD   
 3 2021-01-01 00:00:00 01:07  Friday KENNEDY … EUCD        5       9 E     BD   
 4 2021-01-01 00:00:00 01:41  Friday ST CLAIR… MUIS        0       0 &lt;NA&gt;  YU   
 5 2021-01-01 00:00:00 02:04  Friday SHEPPARD… MUIS        0       0 &lt;NA&gt;  YU   
 6 2021-01-01 00:00:00 02:35  Friday KENNEDY … MUIS        0       0 &lt;NA&gt;  BD   
 7 2021-01-01 00:00:00 02:39  Friday VAUGHAN … MUIS        0       0 &lt;NA&gt;  YU   
 8 2021-01-01 00:00:00 06:00  Friday TORONTO … MUO         0       0 &lt;NA&gt;  YU   
 9 2021-01-01 00:00:00 06:00  Friday TORONTO … MUO         0       0 &lt;NA&gt;  SHP  
10 2021-01-01 00:00:00 06:00  Friday TORONTO … MRO         0       0 &lt;NA&gt;  SRT  
# … with 15,898 more rows, 3 more variables: vehicle &lt;dbl&gt;,
#   station_clean &lt;chr&gt;, code_desc &lt;chr&gt;, and abbreviated variable name
#   ¹​min_delay
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
<p>And so we can see that the 450 minute delay was due to “Transit Control Related Problems”, the 446 minute delay was due to “Miscellaneous Other”, they seem to be outliers, even among the outliers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(delay_codes <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">code =</span> sub_rmenu_code, <span class="at">code_desc =</span> code_description_3) <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(code, code_desc)) <span class="sc">|&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>min_delay) <span class="sc">|&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, time, station, line, min_delay, code, code_desc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = c("code", "code_desc")</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15,908 × 7
   date                time   station               line  min_de…¹ code  code_…²
   &lt;dttm&gt;              &lt;time&gt; &lt;chr&gt;                 &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  
 1 2021-06-29 00:00:00 10:21  MUSEUM STATION        YU         348 PUTTP Tracti…
 2 2021-10-12 00:00:00 12:03  EGLINTON STATION      YU         343 PUSTC Signal…
 3 2021-08-05 00:00:00 20:32  WOODBINE STATION      BD         312 MUO   Miscel…
 4 2021-05-24 00:00:00 05:48  MCCOWAN STATION       SRT        275 PRSL  &lt;NA&gt;   
 5 2021-04-30 00:00:00 06:15  SHEPPARD WEST STATION YU         255 PUTWZ Work Z…
 6 2021-01-05 00:00:00 13:02  ISLINGTON STATION     BD         207 MUPR1 Priori…
 7 2021-05-13 00:00:00 08:23  SHEPPARD WEST STATION YU         191 MUPR1 Priori…
 8 2021-05-04 00:00:00 15:56  ROYAL YORK STATION    BD         182 SUAP  Assaul…
 9 2021-05-27 00:00:00 13:08  ROYAL YORK STATION    BD         180 MUPR1 Priori…
10 2021-11-18 00:00:00 16:39  SHEPPARD STATION      YU         171 MUPR1 Priori…
# … with 15,898 more rows, and abbreviated variable names ¹​min_delay,
#   ²​code_desc
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
</section>
<section id="groups-of-small-counts" class="level4" data-number="13.2.1.2">
<h4 data-number="13.2.1.2" class="anchored" data-anchor-id="groups-of-small-counts"><span class="header-section-number">13.2.1.2</span> Groups of small counts</h4>
<p>Another thing that we are looking for is various groupings of the data, especially where sub-groups may end up with only a small number of observations in them. This is because any analysis could be especially influenced by them. One quick way to do this is to group the data by a variable that is of interest, for instance, “line”, using color.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_delay,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> ..density..,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> line),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">position =</span> <span class="st">"dodge"</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-delaydensity" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-delaydensity-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 13.1: Density of the distribution of delay, in minutes</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-delaydensity">Figure&nbsp;<span>13.1</span></a> uses density so that we can look at the distributions more comparably, but we should also be aware of differences in frequency (<a href="#fig-delayfreq">Figure&nbsp;<span>13.2</span></a>). In this case, we will see that “SHP” and “SRT” have much smaller counts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_delay, <span class="at">fill =</span> line),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">position =</span> <span class="st">"dodge"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-delayfreq" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-delayfreq-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 13.2: Frequency of the distribution of delay, in minutes</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>To group by another variable, we can add facets (<a href="#fig-delayfreqfacet">Figure&nbsp;<span>13.3</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_delay, <span class="at">color =</span> line),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">bw =</span> .<span class="dv">08</span>) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(day))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-delayfreqfacet" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-delayfreqfacet-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 13.3: Frequency of the distribution of delay, in minutes, by day</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We can now plot the top five stations by mean delay.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(line, station_clean) <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(min_delay), <span class="at">n_obs =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_obs<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(line, <span class="sc">-</span>mean_delay) <span class="sc">|&gt;</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(station_clean, mean_delay)) <span class="sc">+</span> </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(line), </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">"free_y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'line'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="13-eda_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="dates" class="level4" data-number="13.2.1.3">
<h4 data-number="13.2.1.3" class="anchored" data-anchor-id="dates"><span class="header-section-number">13.2.1.3</span> Dates</h4>
<p>As discussed in <a href="11-clean_and_prepare.html"><span>Chapter&nbsp;11</span></a> dates are often difficult to work with because they are so prone to having issues. For this reason, it is especially important to consider them during EDA. We could create a graph by week, to see if there is any seasonality. When using dates, <code>lubridate</code> <span class="citation" data-cites="GrolemundWickham2011">(<a href="99-references.html#ref-GrolemundWickham2011" role="doc-biblioref">Grolemund and Wickham 2011</a>)</span> is especially useful. For instance, we can look at the average delay, of those that were delayed, by week, using <code>week()</code> to construct the weeks (<a href="#fig-delaybyweek">Figure&nbsp;<span>13.4</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(min_delay <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">week</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(week, line) <span class="sc">|&gt;</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(min_delay)) <span class="sc">|&gt;</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(week, mean_delay, <span class="at">color =</span> line)) <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(line),</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">scales =</span> <span class="st">"free_y"</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>             )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-delaybyweek" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-delaybyweek-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 13.4: Average delay, in minutes, by week, for the Toronto subway</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Now let us look at the proportion of delays that were greater than 10 minutes (<a href="#fig-longdelaybyweek">Figure&nbsp;<span>13.5</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">week</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(week, line) <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop_delay =</span> <span class="fu">sum</span>(min_delay<span class="sc">&gt;</span><span class="dv">10</span>)<span class="sc">/</span><span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(week, prop_delay, <span class="at">color =</span> line)) <span class="sc">+</span> </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>() <span class="sc">+</span> </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(line),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">scales =</span> <span class="st">"free_y"</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>             )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-longdelaybyweek" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-longdelaybyweek-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 13.5: Delays longer than ten minutes, by week, for the Toronto subway</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>These figures, tables, and analysis have no place in a final paper. Instead, they allow us to become comfortable with the data. We note aspects about each that stand out, as well as the warnings and any implications or aspects to return to.</p>
</section>
</section>
<section id="relationships-between-variables" class="level3" data-number="13.2.2">
<h3 data-number="13.2.2" class="anchored" data-anchor-id="relationships-between-variables"><span class="header-section-number">13.2.2</span> Relationships between variables</h3>
<p>We are also interested in looking at the relationship between two variables. Scatter plots are especially useful here for continuous variables, and are a good precursor to modeling. For instance, we may be interested in the relationship between the delay and the gap (<a href="#fig-delayvsgap">Figure&nbsp;<span>13.6</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_delay, <span class="at">y =</span> min_gap)) <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-delayvsgap" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-delayvsgap-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 13.6: Relationship between delay and gap for the Toronto subway in 2020</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The relationship between categorical variables takes more work, but we could also, for instance, look at the top five reasons for delay by station. We may be interested in whether they differ, and how any difference could be modeled (<a href="#fig-categorical">Figure&nbsp;<span>13.7</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>all_2021_ttc_data_no_dupes <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(line, code_desc) <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(min_delay)) <span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>mean_delay) <span class="sc">|&gt;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> code_desc,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> mean_delay)) <span class="sc">+</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(line), </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">nrow =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-categorical" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-categorical-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 13.7: Relationship between categorical variables for the Toronto subway in 2020</figcaption><p></p>
</figure>
</div>
</div>
</div>
<!-- ## Case study - Historical Canadian elections -->
<!-- https://twitter.com/semrasevi/status/1122889166008745985?s=21  -->
<!-- ```{r}
#| eval: false
#| include: true

<!-- library(tidyverse) -->
<!-- elections_data <- read_csv("inputs/federal_candidates-1.csv") -->

<!-- elections_data$Province |> table() -->
<!-- # There are inconsistencies in the province names -->
<!-- elections_data$Province[elections_data$Province == "Québec"] <- "Quebec" -->
<!-- elections_data <- elections_data |> -->
<!--   filter(!is.na(Province)) -->
<!-- # Check gender -->

<!-- elections_data$Gender |> table() -->
<!-- # Check occupation -->

<!-- elections_data$occupation |> table() -->
<!-- # Get a count of how many uniques there are -->
<!-- elections_data$occupation |> unique() |> length() -->
<!-- # Check party -->

<!-- elections_data$party_short |> table() -->
<!-- elections_data$party_short |> unique() |> length() -->
<!-- # Check incumbency -->

<!-- elections_data$incumbent_candidate |> table() -->
<!-- elections_data$party_short |> unique() |> length() -->
<!-- # Add year -->
<!-- elections_data <- -->
<!--   elections_data |> -->
<!--   mutate(year = year(edate)) -->
<!-- # Add a counter for year -->
<!-- elections_data <- -->
<!--   elections_data |> -->
<!--   mutate(counter = year - 1867) -->
<!-- #### Save #### -->
<!-- write_csv(elections_data, "outputs/elections.csv") -->
<!-- ``` -->
<!-- ```{r}
#| eval: false
#| include: true

<!-- library(lubridate) -->
<!-- library(tidyverse) -->
<!-- elections_data <- read_csv("outputs/elections.csv") -->
<!-- elections_data |> -->
<!--   ggplot(aes(x = edate)) + -->
<!--   geom_histogram() -->
<!-- elections_data |> -->
<!--   ggplot(aes(x = edate, y = Result, color = Gender)) + -->
<!--   geom_point() + -->
<!--   facet_wrap(vars(Province)) -->
<!-- elections_data |> -->
<!--   ggplot(aes(x = Province, fill = Gender)) + -->
<!--   geom_bar(position = "dodge") -->
<!-- # We discovered WW1! -->
<!-- ``` -->
<!-- ```{r}
#| eval: false
#| include: true


<!-- #### Set up workspace ### -->
<!-- library(broom) -->
<!-- library(tidyverse) -->
<!-- #### Read in data #### -->
<!-- elections_data <- read_csv("outputs/elections.csv") -->
<!-- #### Model #### -->
<!-- # Just gender -->
<!-- model1 <- lm(Result ~ Gender, data = elections_data) -->
<!-- tidy(model1) -->
<!-- # Gender and incumbent -->
<!-- model2 <- lm(Result ~ Gender + incumbent_candidate, data = elections_data) -->
<!-- tidy(model2) -->
<!-- # Gender and incumbent and province -->
<!-- model3 <- lm(Result ~ Gender + incumbent_candidate + Province, data = elections_data) -->
<!-- tidy(model3) -->
<!-- # Gender and incumbent and province and year -->
<!-- model4 <- lm(Result ~ Gender + incumbent_candidate + Province + year, data = elections_data) -->
<!-- model5 <- lm(Result ~ Gender + incumbent_candidate + Province + year*Gender, data = elections_data) -->
<!-- tidy(model4) -->
<!-- tidy(model5) -->
<!-- # CHange the year into a counter that increments one for each year -->
<!-- model6 <- lm(Result ~ Gender + incumbent_candidate + Province + counter + counter*Gender, data = elections_data) -->
<!-- tidy(model6) -->
<!-- ``` -->
</section>
</section>
<section id="airbnb-listings-in-london" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="airbnb-listings-in-london"><span class="header-section-number">13.3</span> Airbnb listings in London</h2>
<p>In this case study we look at Airbnb listings in London as at 7 June 2022. The dataset is from Inside Airbnb <span class="citation" data-cites="airbnbdata">(<a href="99-references.html#ref-airbnbdata" role="doc-biblioref">Cox 2021</a>)</span> and we will read it from their website, and then save a local copy. We can give <code>read_csv()</code> a link to where the dataset is and it will download it. This helps with reproducibility because the source is clear. But, as that link could change at any time, longer-term reproducibility, as well as wanting to minimize the effect on the Inside Airbnb servers, suggests that we should also save a local copy of the data and then use that.</p>
<p>To get the dataset that we need, go to <a href="http://insideairbnb.com">Inside Airbnb</a>, -&gt; “Data” -&gt; “Get the Data”, then scroll down to London. We are interested in the listings dataset, and we right click to get the URL that we need (<a href="#fig-getairbnb">Figure&nbsp;<span>13.8</span></a>). Inside Airbnb update the data that they make available, and so the particular dataset that you are able to download may be different.</p>
<div id="fig-getairbnb" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/inside_airbnb.png" class="img-fluid figure-img" style="width:95.0%"></p>
<p></p><figcaption class="figure-caption">Figure 13.8: Obtaining the Airbnb data from Inside Airbnb</figcaption><p></p>
</figure>
</div>
<p>As the original data is not ours, we should not make that public without first getting written permission. The “guess_max” option in <code>read_csv()</code> helps us avoid having to specify the column types. Usually <code>read_csv()</code> takes a best guess at the column types based on the first few rows. But sometimes those first ones are misleading and so “guess_max” forces it to look at a larger number of rows to try to work out what is going on. Paste the URL that we copied into the IRL part.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"http://data.insideairbnb.com/united-kingdom/england/"</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">"london/2022-06-07/data/listings.csv.gz"</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>airbnb_data <span class="ot">&lt;-</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> url,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">guess_max =</span> <span class="dv">20000</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(airbnb_data, <span class="st">"airbnb_data.csv"</span>)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>airbnb_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is extremely important that we refer to this local copy of our data when run our scripts to explore the data, rather than asking the Inside Airbnb servers for the data each time.</p>
<section id="distribution-and-properties-of-individual-variables-1" class="level3" data-number="13.3.1">
<h3 data-number="13.3.1" class="anchored" data-anchor-id="distribution-and-properties-of-individual-variables-1"><span class="header-section-number">13.3.1</span> Distribution and properties of individual variables</h3>
<p>There are many columns, so we will just select a few.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(airbnb_data) <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 74</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="ot">&lt;-</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(host_id, </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>         host_since, </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>         host_response_time, </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>         host_is_superhost, </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>         host_listings_count,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>         host_total_listings_count,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>         host_neighbourhood, </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>         host_listings_count, </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>         neighbourhood_cleansed, </span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>         room_type, </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>         bathrooms, </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>         bedrooms, </span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>         price, </span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>         number_of_reviews, </span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>         has_availability, </span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>         review_scores_rating, </span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>         review_scores_accuracy, </span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>         review_scores_cleanliness, </span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>         review_scores_checkin, </span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>         review_scores_communication, </span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>         review_scores_location, </span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>         review_scores_value</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 66,152 × 21
   host_id host_since host_res…¹ host_…² host_…³ host_…⁴ host_…⁵ neigh…⁶ room_…⁷
     &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;      &lt;lgl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1   54730 2009-11-16 within a … FALSE         3       3 LB of … Isling… Privat…
 2   60302 2009-12-05 a few day… FALSE         1       1 Chelsea Kensin… Entire…
 3   41759 2009-09-28 within a … FALSE         1       1 Batter… Wandsw… Entire…
 4   67915 2010-01-05 within a … FALSE         3       3 Fulham  Hammer… Privat…
 5   67564 2010-01-04 within a … FALSE        18      18 Fitzro… Westmi… Entire…
 6  103583 2010-04-05 N/A        FALSE         3       3 LB of … Barnet  Privat…
 7  155938 2010-06-30 within a … TRUE          1       1 LB of … Richmo… Entire…
 8  144444 2010-06-14 within a … FALSE         2       2 LB of … Hounsl… Privat…
 9  134606 2010-05-29 within a … FALSE         1       1 LB of … Newham  Privat…
10  157884 2010-07-04 within a … FALSE         4       4 LB of … Haring… Privat…
# … with 66,142 more rows, 12 more variables: bathrooms &lt;lgl&gt;, bedrooms &lt;dbl&gt;,
#   price &lt;chr&gt;, number_of_reviews &lt;dbl&gt;, has_availability &lt;lgl&gt;,
#   review_scores_rating &lt;dbl&gt;, review_scores_accuracy &lt;dbl&gt;,
#   review_scores_cleanliness &lt;dbl&gt;, review_scores_checkin &lt;dbl&gt;,
#   review_scores_communication &lt;dbl&gt;, review_scores_location &lt;dbl&gt;,
#   review_scores_value &lt;dbl&gt;, and abbreviated variable names
#   ¹​host_response_time, ²​host_is_superhost, ³​host_listings_count, …
# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</code></pre>
</div>
</div>
<p>First we might be interested in price. It is a character at the moment and so we need to convert it to a numeric. This is a common problem, and we need to be a little careful that it does not all just convert to NAs. In our case if we just force the price data to be a numeric then it will go to NA because there are a lot of characters where it is unclear what the numeric equivalent is, such as “$”. So we need to remove those characters first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected<span class="sc">$</span>price <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "$49.00"  "$75.00"  "$195.00" "$160.00" "$379.00" "$29.00" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected<span class="sc">$</span>price <span class="sc">|&gt;</span> <span class="fu">str_split</span>(<span class="st">""</span>) <span class="sc">|&gt;</span> <span class="fu">unlist</span>() <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "$" "4" "9" "." "0" "7" "5" "1" "6" "3" "2" "8" ","</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(price) <span class="sc">|&gt;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(price, <span class="st">","</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 976 × 1
   price    
   &lt;chr&gt;    
 1 $1,000.00
 2 $1,500.00
 3 $1,071.00
 4 $2,000.00
 5 $1,150.00
 6 $1,000.00
 7 $1,100.00
 8 $2,211.00
 9 $5,000.00
10 $5,500.00
# … with 966 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="ot">&lt;-</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">price =</span> <span class="fu">str_remove</span>(price, <span class="st">"</span><span class="sc">\\</span><span class="st">$"</span>),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">price =</span> <span class="fu">str_remove</span>(price, <span class="st">","</span>),</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">price =</span> <span class="fu">as.integer</span>(price)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can have a look at the distribution of prices (<a href="#fig-airbnbpricesfirst-1">Figure&nbsp;<span>13.9 (a)</span></a>). There are outliers, so again we might like to consider it on the log scale (<a href="#fig-airbnbpricesfirst-2">Figure&nbsp;<span>13.9 (b)</span></a>).</p>
<div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> price)) <span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Price per night"</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of properties"</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price <span class="sc">&gt;</span> <span class="dv">1000</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> price)) <span class="sc">+</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Price per night"</span>,</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of properties"</span>) <span class="sc">+</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-airbnbpricesfirst" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-airbnbpricesfirst-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-airbnbpricesfirst-1.png" class="img-fluid figure-img" data-ref-parent="fig-airbnbpricesfirst" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Regular scale</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-airbnbpricesfirst-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-airbnbpricesfirst-2.png" class="img-fluid figure-img" data-ref-parent="fig-airbnbpricesfirst" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Log scale</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure 13.9: Distribution of prices of London Airbnb rentals in June 2022</figcaption><p></p>
</figure>
</div>
</div>
<p>If we focus on prices that are less than $1,000 then we see that most properties have a nightly price less than $250 (<a href="#fig-airbnbpricesbunch-1">Figure&nbsp;<span>13.10 (a)</span></a>). Interestingly it looks like there is some bunching of prices, possible around numbers ending in zero or nine. Let us just zoom in on prices between $90 and $210, out of interest, but change the bins to be smaller (<a href="#fig-airbnbpricesbunch-2">Figure&nbsp;<span>13.10 (b)</span></a>).</p>
<div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price <span class="sc">&lt;</span> <span class="dv">1000</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> price)) <span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Price per night"</span>,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of properties"</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price <span class="sc">&lt;</span> <span class="dv">210</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> price)) <span class="sc">+</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Price per night"</span>,</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of properties"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-airbnbpricesbunch" class="cell quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-airbnbpricesbunch-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-airbnbpricesbunch-1.png" class="img-fluid figure-img" data-ref-parent="fig-airbnbpricesbunch" width="672"></p>
<p></p><figcaption class="figure-caption">(a) Prices less than $1,000</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-airbnbpricesbunch-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-airbnbpricesbunch-2.png" class="img-fluid figure-img" data-ref-parent="fig-airbnbpricesbunch" width="672"></p>
<p></p><figcaption class="figure-caption">(b) Prices between $90 and $120</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure 13.10: Distribution of prices less than $1000 for London Airbnb rentals in June 2022 shows bunching</figcaption><p></p>
</figure>
</div>
</div>
<p>For now, we will just remove all prices that are more than $999.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_less_1000 <span class="ot">&lt;-</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price <span class="sc">&lt;</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Superhosts are especially experienced Airbnb hosts, and we might be interested to learn more about them. For instance, a host either is or is not a superhost, and so we would not expect any NAs. But we can see that there are. It might be that the host removed a listing or similar. For now, we will remove them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_less_1000 <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(host_is_superhost))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 21
   host_id host_since host_res…¹ host_…² host_…³ host_…⁴ host_…⁵ neigh…⁶ room_…⁷
     &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;      &lt;lgl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
1  8317501 NA         &lt;NA&gt;       NA           NA      NA &lt;NA&gt;    Tower … Privat…
2 22047056 NA         &lt;NA&gt;       NA           NA      NA &lt;NA&gt;    Westmi… Privat…
3 39828462 NA         &lt;NA&gt;       NA           NA      NA &lt;NA&gt;    Tower … Privat…
4 43023101 NA         &lt;NA&gt;       NA           NA      NA &lt;NA&gt;    Waltha… Privat…
5 44815642 NA         &lt;NA&gt;       NA           NA      NA &lt;NA&gt;    Camden  Privat…
6 79411714 NA         &lt;NA&gt;       NA           NA      NA &lt;NA&gt;    Brent   Entire…
# … with 12 more variables: bathrooms &lt;lgl&gt;, bedrooms &lt;dbl&gt;, price &lt;int&gt;,
#   number_of_reviews &lt;dbl&gt;, has_availability &lt;lgl&gt;,
#   review_scores_rating &lt;dbl&gt;, review_scores_accuracy &lt;dbl&gt;,
#   review_scores_cleanliness &lt;dbl&gt;, review_scores_checkin &lt;dbl&gt;,
#   review_scores_communication &lt;dbl&gt;, review_scores_location &lt;dbl&gt;,
#   review_scores_value &lt;dbl&gt;, and abbreviated variable names
#   ¹​host_response_time, ²​host_is_superhost, ³​host_listings_count, …
# ℹ Use `colnames()` to see all variable names</code></pre>
</div>
</div>
<p>We will also want to create a binary variable from this. It is true/false at the moment, which is fine for the modelling, but there are a handful of situations where it will be easier if we have a 0/1. And for now we will just remove anyone with an NA for whether they are a super host.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_less_1000 <span class="ot">&lt;-</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_less_1000 <span class="sc">|&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(host_is_superhost)) <span class="sc">|&gt;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">host_is_superhost_binary =</span> <span class="fu">if_else</span>(</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    host_is_superhost <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On Airbnb, guests can give 1-5 star ratings across a variety of different aspects, including cleanliness, accuracy, value, and others. But when we look at the reviews in our dataset, it is less clear how this is being constructed, because it appears to be a rating between 20 and 100 and there are also NA values (<a href="#fig-airbnbreviews">Figure&nbsp;<span>13.11</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_less_1000 <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> review_scores_rating)) <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Reviews scores rating"</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of properties"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-airbnbreviews" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-airbnbreviews-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 13.11: Distribution of review scores rating for London Airbnb rentals in June 2022</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We would like to deal with the NAs in “review_scores_rating”, but this is more complicated as there are a lot of them. It may be that this is just because they do not have any reviews.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_less_1000 <span class="sc">|&gt;</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(review_scores_rating)) <span class="sc">|&gt;</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16577</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_less_1000 <span class="sc">|&gt;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(review_scores_rating)) <span class="sc">|&gt;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(number_of_reviews) <span class="sc">|&gt;</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    0 
16577 </code></pre>
</div>
</div>
<p>So these properties do not have a review rating yet because they do not have enough reviews. It is a large proportion of the total, at almost a fifth of them so we might like to look at this in more detail using <code>vis_miss()</code> from <code>visdat</code> <span class="citation" data-cites="citevisdat">(<a href="99-references.html#ref-citevisdat" role="doc-biblioref">Tierney 2017</a>)</span>. We are interested to see whether there is something systematic happening with these properties. For instance, if the NAs were being driven by, say, some requirement of a minimum number of reviews, then we would expect they would all be missing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visdat)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>airbnb_data_less_1000 <span class="sc">|&gt;</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(review_scores_rating, </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>         review_scores_accuracy, </span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>         review_scores_cleanliness, </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>         review_scores_checkin, </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>         review_scores_communication, </span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>         review_scores_location, </span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>         review_scores_value) <span class="sc">|&gt;</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vis_miss</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="13-eda_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Given it looks convincing that in almost all cases, the different types of reviews are missing for the same observation. One approach would be to just focus on those that are not missing and the main review score (<a href="#fig-airbnbreviewsselected">Figure&nbsp;<span>13.12</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_less_1000 <span class="sc">|&gt;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(review_scores_rating)) <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> review_scores_rating)) <span class="sc">+</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Average review score"</span>,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of properties"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-airbnbreviewsselected" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-airbnbreviewsselected-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 13.12: Distribution of review scores, between 60 and 80, for London Airbnb rentals in June 2022</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>For now, we will remove anyone with an NA in their main review score, even though this will remove roughly 20 per cent of observations. If we ended up using this dataset for actual analysis, then we would want to justify this decision in an appendix or similar.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_has_reviews <span class="ot">&lt;-</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_less_1000 <span class="sc">|&gt;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(review_scores_rating))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another important factor is how quickly a host responds to an inquiry. Airbnb allows hosts up to 24 hours to respond, but encourages responses within an hour.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_has_reviews <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(host_response_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  host_response_time     n
  &lt;chr&gt;              &lt;int&gt;
1 a few days or more  1170
2 N/A                18831
3 within a day        4401
4 within a few hours  6318
5 within an hour     17873</code></pre>
</div>
</div>
<p>It is unclear a host could have a response time of NA. It may be that they are related to some other variable. Interestingly it seems like what looks like “NAs” in “host_response_time” variable are not coded as proper NAs, but are instead being treated as another category. We will recode them to be actual NAs and change the variable to be a factor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_has_reviews <span class="ot">&lt;-</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_has_reviews <span class="sc">|&gt;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">host_response_time =</span> <span class="fu">if_else</span>(host_response_time <span class="sc">==</span> <span class="st">"N/A"</span>, </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="cn">NA_character_</span>, </span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>                                      host_response_time),</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">host_response_time =</span> <span class="fu">factor</span>(host_response_time)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is clearly an issue with NAs as there are a lot of them. For instance, we might be interested to see if there is a relationship with the review score (<a href="#fig-airbnbreviewsselectednasresponse">Figure&nbsp;<span>13.13</span></a>). There are a lot that have an overall review of 100.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_has_reviews <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(host_response_time)) <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> review_scores_rating)) <span class="sc">+</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Average review score"</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of properties"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-airbnbreviewsselectednasresponse" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-airbnbreviewsselectednasresponse-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 13.13: Distribution of review scores for properties with NA response time, for London Airbnb rentals in June 2022</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Usually missing values are dropped by <code>ggplot2</code>. We can use <code>geom_miss_point()</code> from <code>naniar</code> <span class="citation" data-cites="naniar">(<a href="99-references.html#ref-naniar" role="doc-biblioref">Tierney et al. 2021</a>)</span> to include them in the graph (<a href="#fig-visualisemissing">Figure&nbsp;<span>13.14</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>airbnb_data_has_reviews <span class="sc">|&gt;</span> </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> host_response_time, </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> review_scores_accuracy)) <span class="sc">+</span> </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_miss_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-visualisemissing" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-visualisemissing-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 13.14: Displaying missing values London Airbnb</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>For now, we will remove anyone with a NA in their response time. This will again removes roughly another 20 per cent of the observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="ot">&lt;-</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_has_reviews <span class="sc">|&gt;</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(host_response_time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are two versions of a variable that suggest how many properties a host has on Airbnb. We might be interested to know whether there is a difference between them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">listings_count_is_same =</span> <span class="fu">if_else</span>(host_listings_count <span class="sc">==</span> host_total_listings_count, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(listings_count_is_same <span class="sc">==</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 23
# … with 23 variables: host_id &lt;dbl&gt;, host_since &lt;date&gt;,
#   host_response_time &lt;fct&gt;, host_is_superhost &lt;lgl&gt;,
#   host_listings_count &lt;dbl&gt;, host_total_listings_count &lt;dbl&gt;,
#   host_neighbourhood &lt;chr&gt;, neighbourhood_cleansed &lt;chr&gt;, room_type &lt;chr&gt;,
#   bathrooms &lt;lgl&gt;, bedrooms &lt;dbl&gt;, price &lt;int&gt;, number_of_reviews &lt;dbl&gt;,
#   has_availability &lt;lgl&gt;, review_scores_rating &lt;dbl&gt;,
#   review_scores_accuracy &lt;dbl&gt;, review_scores_cleanliness &lt;dbl&gt;, …
# ℹ Use `colnames()` to see all variable names</code></pre>
</div>
</div>
<p>As there are no differences in this dataset, we can just remove one variable for now and have a look at the other one (<a href="#fig-airbnbhostlisting">Figure&nbsp;<span>13.15</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="ot">&lt;-</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>host_listings_count)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> host_total_listings_count)) <span class="sc">+</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-airbnbhostlisting" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-airbnbhostlisting-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 13.15: Distribution of the number of properties a host has on Airbnb, for London Airbnb rentals in June 2022</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>There are a large number who have somewhere in the 2-10 properties range, but the usual long tail. The number with many listings is unexpected and worth following up on. And there are a bunch with NA that we will need to deal with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(host_total_listings_count <span class="sc">&gt;=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 21
  host_id host_since host_resp…¹ host_…² host_…³ host_…⁴ neigh…⁵ room_…⁶ bathr…⁷
    &lt;dbl&gt; &lt;date&gt;     &lt;fct&gt;       &lt;lgl&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;lgl&gt;  
1   67564 2010-01-04 within a f… FALSE        18 Fitzro… Westmi… Entire… NA     
2   54987 2009-11-17 within an … FALSE        39 Isle o… Tower … Entire… NA     
3  381894 2011-02-08 within a f… FALSE        24 Wimble… Merton  Entire… NA     
4   67564 2010-01-04 within a f… FALSE        18 Fitzro… Camden  Entire… NA     
5  381894 2011-02-08 within a f… FALSE        24 Wimble… Merton  Entire… NA     
6  381894 2011-02-08 within a f… FALSE        24 Wimble… Hounsl… Entire… NA     
# … with 12 more variables: bedrooms &lt;dbl&gt;, price &lt;int&gt;,
#   number_of_reviews &lt;dbl&gt;, has_availability &lt;lgl&gt;,
#   review_scores_rating &lt;dbl&gt;, review_scores_accuracy &lt;dbl&gt;,
#   review_scores_cleanliness &lt;dbl&gt;, review_scores_checkin &lt;dbl&gt;,
#   review_scores_communication &lt;dbl&gt;, review_scores_location &lt;dbl&gt;,
#   review_scores_value &lt;dbl&gt;, host_is_superhost_binary &lt;dbl&gt;, and abbreviated
#   variable names ¹​host_response_time, ²​host_is_superhost, …
# ℹ Use `colnames()` to see all variable names</code></pre>
</div>
</div>
<p>There is nothing that immediately jumps out as odd about the people with more than 10 listings, but there must be something going on. For now, we will focus on only those with one property.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="ot">&lt;-</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(host_id) <span class="sc">|&gt;</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="relationships-between-variables-1" class="level3" data-number="13.3.2">
<h3 data-number="13.3.2" class="anchored" data-anchor-id="relationships-between-variables-1"><span class="header-section-number">13.3.2</span> Relationships between variables</h3>
<p>We might like to make some graphs to see if there are any relationships that become clear. Some aspects that come to mind is looking at prices and reviews and super hosts, and number of properties and neighborhood.</p>
<p>Look at the relationship between price and reviews, and whether they are a super-host (<a href="#fig-priceandreview">Figure&nbsp;<span>13.16</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> price, <span class="at">y =</span> review_scores_rating, <span class="at">color =</span> host_is_superhost)) <span class="sc">+</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Price per night"</span>,</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Average review score"</span>,</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Super host"</span>) <span class="sc">+</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-priceandreview" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="13-eda_files/figure-html/fig-priceandreview-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure 13.16: Relationship between price and review and whether a host is a super host, for London Airbnb rentals in June 2022</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>One of the aspects that may make someone a super host is how quickly they respond to inquiries. One could imagine that being a superhost involves quickly saying yes or no to inquiries. Let us look at the data. First, we want to look at the possible values of superhost by their response times.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(host_is_superhost) <span class="sc">|&gt;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">proportion =</span> <span class="fu">round</span>(proportion, <span class="at">digits =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  host_is_superhost     n proportion
  &lt;lgl&gt;             &lt;int&gt;      &lt;dbl&gt;
1 FALSE             10298       0.82
2 TRUE               2249       0.18</code></pre>
</div>
</div>
<p>Fortunately, it looks like when we removed the reviews rows we removed any NAs from whether they were a super host, but if we go back and look into that we may need to check again. We could build a table that looks at a hosts response time by whether they are a superhost using <code>tabyl()</code> from <code>janitor</code> <span class="citation" data-cites="janitor">(<a href="99-references.html#ref-janitor" role="doc-biblioref">Firke 2020</a>)</span>. It is clear that is a host does not respond within an hour then it is unlikely that they are a super host.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(host_response_time, host_is_superhost) <span class="sc">|&gt;</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_percentages</span>(<span class="st">"row"</span>) <span class="sc">|&gt;</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>(<span class="at">digits =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_ns</span>() <span class="sc">|&gt;</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_title</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    host_is_superhost           
 host_response_time             FALSE       TRUE
 a few days or more        99%  (747)  1%    (4)
       within a day        90% (2321) 10%  (248)
 within a few hours        83% (2623) 17%  (547)
     within an hour        76% (4607) 24% (1450)</code></pre>
</div>
</div>
<p>Finally, we could look at neighborhood. The data provider has attempted to clean the neighborhood variable for us, so will just use that variable for now. Although if we ended up using this variable for our actual analysis we would want to check they had not made any errors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(neighbourhood_cleansed) <span class="sc">|&gt;</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="st">"row"</span>) <span class="sc">|&gt;</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>() <span class="sc">|&gt;</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 34</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">|&gt;</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(neighbourhood_cleansed) <span class="sc">|&gt;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>() <span class="sc">|&gt;</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>n) <span class="sc">|&gt;</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="st">"row"</span>) <span class="sc">|&gt;</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> neighbourhood_cleansed   n percent
                Hackney 992    7.9%
            Westminster 835    6.7%
          Tower Hamlets 825    6.6%
              Southwark 790    6.3%
                Lambeth 748    6.0%
             Wandsworth 717    5.7%</code></pre>
</div>
</div>
<p>We will now run some models on our dataset. We will cover modeling in more detail in <a href="14-ijalm.html"><span>Chapter&nbsp;14</span></a>, but we can use models during EDA to help get a better sense of relationships that may exist between multiple variables in a dataset. For instance, we may like to see whether we can forecast whether someone is a super host, and the factors that go into explaining that. As the dependent variable is binary, this is a good opportunity to use logistic regression. We expect that better reviews will be associated with faster responses and higher reviews. Specifically, the model that we estimate is:</p>
<p><span class="math display">\[\mbox{Prob(Is super host} = 1) = \beta_0 + \beta_1 \mbox{Response time} + \beta_2 \mbox{Reviews} + \epsilon\]</span></p>
<p>We estimate the model using <code>glm</code> in the R language <span class="citation" data-cites="citeR">(<a href="99-references.html#ref-citeR" role="doc-biblioref">R Core Team 2022</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>logistic_reg_superhost_response_review <span class="ot">&lt;-</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(host_is_superhost <span class="sc">~</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>        host_response_time <span class="sc">+</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>        review_scores_rating,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> airbnb_data_selected,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can have a quick look at the results using <code>modelsummary()</code> from <code>modelsummary</code> <span class="citation" data-cites="citemodelsummary">(<a href="99-references.html#ref-citemodelsummary" role="doc-biblioref">Arel-Bundock 2021</a>)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(logistic_reg_superhost_response_review)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Model 1 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> −14.087 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.798) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> host_response_timewithin a day </td>
   <td style="text-align:center;"> 2.748 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.506) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> host_response_timewithin a few hours </td>
   <td style="text-align:center;"> 3.409 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.503) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> host_response_timewithin an hour </td>
   <td style="text-align:center;"> 3.873 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.502) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> review_scores_rating </td>
   <td style="text-align:center;"> 1.880 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.128) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 12547 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 10915.4 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 10952.6 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> −5452.693 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> F </td>
   <td style="text-align:center;"> 123.703 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> RMSE </td>
   <td style="text-align:center;"> 0.37 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<!-- We might like to look at what our model predicts, compared with whether the person was actually a super host. We can do that in a variety of ways, but one way is to use `augment` from the `broom` package [@broom]. This will add the prediction and associated uncertainty to the data. For every row we will then have the probability that our model is estimating that they are a superhost. But ultimately, we need a binary forecast. There are a bunch of different options, but one is to just say that if the model estimates a probability of more than 0.5 then we bin it into a superhost, and other not. -->
<!-- ```{r} -->
<!-- airbnb_data_filtered_logistic_fit_train <-  -->
<!--   augment(logistic_reg_superhost_response_review,  -->
<!--           data = airbnb_train |> select(host_is_superhost,  -->
<!--                                          host_is_superhost_binary, -->
<!--                                          host_response_time, -->
<!--                                          review_scores_rating -->
<!--                                          ), -->
<!--           type.predict = "response") |> # We use the "response" option here so that the function does the work of worrying about the exponential and log odds for us. Our result will be a probability. -->
<!--   select(-.hat, -.sigma, -.cooksd, -.std.resid) |>  -->
<!--   mutate(predict_host_is_superhost = if_else(.fitted > 0.5, 1, 0), # How do things change if we change the 0.5 cutoff? -->
<!--          host_is_superhost_binary = as.factor(host_is_superhost_binary), -->
<!--          predict_host_is_superhost_binary = as.factor(predict_host_is_superhost) -->
<!--          ) -->
<!-- ``` -->
<!-- We can look at how far off the model is. There are a bunch of ways of doing this, but one is to look at what probability the model has given each person. -->
<!-- ```{r} -->
<!-- airbnb_data_filtered_logistic_fit_train |>  -->
<!--   ggplot(aes(x = .fitted, fill = host_is_superhost_binary)) + -->
<!--   geom_histogram(binwidth = 0.05, position = "dodge") + -->
<!--   theme_classic() + -->
<!--   labs(x = "Estimated probability that host is super host", -->
<!--        y = "Number", -->
<!--        fill = "Host is super host") + -->
<!--   scale_fill_brewer(palette = "Set1") -->
<!-- ``` -->
<!-- We can look at how the model probabilities change based on average review score, and their average time to respond. -->
<!-- ```{r} -->
<!-- ggplot(airbnb_data_filtered_logistic_fit_train,  -->
<!--        aes(x = review_scores_rating,  -->
<!--            y = .fitted,  -->
<!--            color = host_response_time)) + -->
<!--   geom_line() + -->
<!--   geom_point() + -->
<!--   labs(x = "Average review score", -->
<!--        y = "Predicted probability of being a superhost", -->
<!--        color = "Host response time") + -->
<!--   theme_classic() + -->
<!--   scale_color_brewer(palette = "Set1") -->
<!-- ``` -->
<!-- This nice thing about this graph is that it illustrates nicely the effect of a host having an average response time of, say, "within an hour" compared with "within a few hours".  -->
<!-- We can focus on how the model does in terms of raw classification using `confusionMatrix` from the caret package (Kuhn, 2020). This also gives a bunch of diagnostics (the help file explains what they are). In general, they suggest this isn't the best model that's ever existed. -->
<!-- ```{r} -->
<!-- caret::confusionMatrix(data = airbnb_data_filtered_logistic_fit_train$predict_host_is_superhost_binary, -->
<!--                        reference = airbnb_data_filtered_logistic_fit_train$host_is_superhost_binary) -->
<!-- ``` -->
<!-- In any case, to this point we've been looking at how the model has done on the training set. It is also relevant how it does on the test set. Again, there are a bunch of ways to do this, but one is to again use the augment function, but to include a newdata argument. -->
<!-- ```{r} -->
<!-- airbnb_data_filtered_logistic_fit_test <-  -->
<!--   augment(logistic_reg_superhost_response_review,  -->
<!--           data = airbnb_train |> select(host_is_superhost,  -->
<!--                                          host_is_superhost_binary, -->
<!--                                          host_response_time, -->
<!--                                          review_scores_rating -->
<!--                                          ), -->
<!--           newdata = airbnb_test |> select(host_is_superhost,  -->
<!--                                          host_is_superhost_binary, -->
<!--                                          host_response_time, -->
<!--                                          review_scores_rating -->
<!--                                          ), # I'm selecting just because the -->
<!--           # dataset is quite wide, and so this makes it easier to look at. -->
<!--           type.predict = "response") |>  -->
<!--   mutate(predict_host_is_superhost = if_else(.fitted > 0.5, 1, 0),  -->
<!--          host_is_superhost_binary = as.factor(host_is_superhost_binary), -->
<!--          predict_host_is_superhost_binary = as.factor(predict_host_is_superhost) -->
<!--          ) -->
<!-- ``` -->
<!-- We would expect the performance to be slightly worse on the test set. But it is actually fairly similar. -->
<!-- ```{r} -->
<!-- caret::confusionMatrix(data = airbnb_data_filtered_logistic_fit_test$predict_host_is_superhost_binary, -->
<!--                        reference = airbnb_data_filtered_logistic_fit_test$host_is_superhost_binary) -->
<!-- ``` -->
<!-- We could compare the test with the training sets in terms of forecasts. -->
<!-- ```{r} -->
<!-- training <- airbnb_data_filtered_logistic_fit_train |>  -->
<!--   select(host_is_superhost_binary, .fitted) |>  -->
<!--   mutate(type = "Training set") -->
<!-- test <- airbnb_data_filtered_logistic_fit_test |>  -->
<!--   select(host_is_superhost_binary, .fitted) |>  -->
<!--   mutate(type = "Test set") -->
<!-- both <- rbind(training, test) -->
<!-- rm(training, test) -->
<!-- both |>  -->
<!--   ggplot(aes(x = .fitted,  -->
<!--              fill = host_is_superhost_binary)) + -->
<!--   geom_histogram(binwidth = 0.05, position = "dodge") + -->
<!--   theme_minimal() + -->
<!--   labs(x = "Estimated probability that host is super host", -->
<!--        y = "Number", -->
<!--        fill = "Host is super host") + -->
<!--   scale_fill_brewer(palette = "Set1") + -->
<!--   facet_wrap(vars(type), -->
<!--              nrow = 2, -->
<!--              scales = "free_y") -->
<!-- ``` -->
</section>
</section>
<section id="exercises-and-tutorial" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="exercises-and-tutorial"><span class="header-section-number">13.4</span> Exercises and tutorial</h2>
<section id="exercises" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="exercises">Exercises</h3>
<ol type="1">
<li><em>(Plan)</em> Consider the following scenario: <strong>TBD</strong>. Please sketch out what that dataset could look like and then sketch a graph that you could build to show all observations.</li>
<li><em>(Simulate)</em> Please further consider the scenario described and simulate the situation with every variable independent of each other.</li>
<li><em>(Acquire)</em> Please describe three possible sources of such a dataset.</li>
<li><em>(Explore)</em> Please use <code>ggplot2</code> to build the graph that you sketched.</li>
<li><em>(Communicate)</em> Please write two paragraphs about what you did.</li>
<li>In your own words what is exploratory data analysis (this will be difficult, but please write only one nuanced paragraph)?</li>
<li>In Tukey’s words, what is exploratory data analysis (please write one paragraph)?</li>
<li>Who was Tukey (please write a paragraph or two)?</li>
<li>If you have a dataset called “my_data”, which has two columns: “first_col” and “second_col”, then could you please write some rough R code that would generate a graph (the type of graph does not matter).</li>
<li>Consider a dataset that has 500 rows and 3 columns, so there are 1,500 cells. If 100 of the cells are missing data for at least one of the columns, then would you remove the whole row your dataset or try to run your analysis on the data as is, or some other procedure? What if your dataset had 10,000 rows instead, but the same number of missing cells?</li>
<li>Please note three ways of identifying unusual values.</li>
<li>What is the difference between a categorical and continuous variable?</li>
<li>What is the difference between a factor and an integer variable?</li>
<li>How can we think about who is systematically excluded from a dataset?</li>
<li>Using <code>opendatatoronto</code>, download the data on mayoral campaign contributions for 2014. (Note: the 2014 file you will get from <code>get_resource()</code>, so just keep the sheet that relates to the Mayor election).
<ol type="1">
<li>Clean up the data format (fixing the parsing issue and standardizing the column names using <code>janitor</code>)</li>
<li>Summarize the variables in the dataset. Are there missing values, and if so, should we be worried about them? Is every variable in the format it should be? If not, create new variable(s) that are in the right format.</li>
<li>Visually explore the distribution of values of the contributions. What contributions are notable outliers? Do they share a similar characteristic(s)? It may be useful to plot the distribution of contributions without these outliers to get a better sense of most of the data.</li>
<li>List the top five candidates in each of these categories: 1) total contributions; 2) mean contribution; and 3) number of contributions.</li>
<li>Repeat that process, but without contributions from the candidates themselves.</li>
<li>How many contributors gave money to more than one candidate?</li>
</ol></li>
<li>Name three geoms that produce graphs that have bars on them <code>ggplot()</code>.</li>
<li>Consider a dataset 10,000 observations and 27 variables. For each observation, there is at least one missing variable. Please discuss, in a paragraph or two, the steps that you would take to understand what is going on.</li>
<li>Known missing data, are those that leave holes in your dataset. But what about data that were never collected? Please look at <span class="citation" data-cites="mcclelland2019lock">McClelland (<a href="99-references.html#ref-mcclelland2019lock" role="doc-biblioref">2019</a>)</span> and <span class="citation" data-cites="luscombe2020policing">Luscombe and McClelland (<a href="99-references.html#ref-luscombe2020policing" role="doc-biblioref">2020</a>)</span>. Look into how they gathered their dataset and what it took to put this together. What is in the dataset and why? What is missing and why? How could this affect the results? How might similar biases enter into other datasets that you have used or read about?</li>
</ol>
</section>
<section id="tutorial" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="tutorial">Tutorial</h3>
<p>Redo the Airbnb EDA but for Paris. Please submit a PDF.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-citemodelsummary" class="csl-entry" role="doc-biblioentry">
Arel-Bundock, Vincent. 2021. <em><span class="nocase">modelsummary: Summary Tables and Plots for Statistical Models and Data: Beautiful, Customizable, and Publication-Ready</span></em>. <a href="https://CRAN.R-project.org/package=modelsummary">https://CRAN.R-project.org/package=modelsummary</a>.
</div>
<div id="ref-airbnbdata" class="csl-entry" role="doc-biblioentry">
Cox, Murray. 2021. <span>“<span>Inside Airbnb—Toronto Data</span>.”</span> <a href="http://insideairbnb.com/get-the-data.html">http://insideairbnb.com/get-the-data.html</a>.
</div>
<div id="ref-janitor" class="csl-entry" role="doc-biblioentry">
Firke, Sam. 2020. <em><span class="nocase">janitor: Simple Tools for Examining and Cleaning Dirty Data</span></em>. <a href="https://CRAN.R-project.org/package=janitor">https://CRAN.R-project.org/package=janitor</a>.
</div>
<div id="ref-citeSharla" class="csl-entry" role="doc-biblioentry">
Gelfand, Sharla. 2020. <em><span class="nocase">opendatatoronto: Access the City of Toronto Open Data Portal</span></em>. <a href="https://CRAN.R-project.org/package=opendatatoronto">https://CRAN.R-project.org/package=opendatatoronto</a>.
</div>
<div id="ref-GrolemundWickham2011" class="csl-entry" role="doc-biblioentry">
Grolemund, Garrett, and Hadley Wickham. 2011. <span>“Dates and Times Made Easy with <span class="nocase">lubridate</span>.”</span> <em>Journal of Statistical Software</em> 40 (3): 1–25. <a href="http://www.jstatsoft.org/v40/i03/">http://www.jstatsoft.org/v40/i03/</a>.
</div>
<div id="ref-citepurrr" class="csl-entry" role="doc-biblioentry">
Henry, Lionel, and Hadley Wickham. 2020. <em><span class="nocase">purrr: Functional Programming Tools</span></em>. <a href="https://CRAN.R-project.org/package=purrr">https://CRAN.R-project.org/package=purrr</a>.
</div>
<div id="ref-luscombe2020policing" class="csl-entry" role="doc-biblioentry">
Luscombe, Alex, and Alexander McClelland. 2020. <span>“Policing the Pandemic: Tracking the Policing of COVID-19 Across Canada.”</span>
</div>
<div id="ref-mcclelland2019lock" class="csl-entry" role="doc-biblioentry">
McClelland, Alexander. 2019. <span>“<span>‘Lock This Whore up’</span>: Legal Violence and Flows of Information Precipitating Personal Violence Against People Criminalised for HIV-Related Crimes in Canada.”</span> <em>European Journal of Risk Regulation</em> 10 (1): 132–47.
</div>
<div id="ref-citeR" class="csl-entry" role="doc-biblioentry">
R Core Team. 2022. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-staniak2019landscape" class="csl-entry" role="doc-biblioentry">
Staniak, Mateusz, and Przemyslaw Biecek. 2019. <span>“<span class="nocase">The landscape of R packages for automated exploratory data analysis</span>.”</span> <em>arXiv Preprint arXiv:1904.02101</em>.
</div>
<div id="ref-citevisdat" class="csl-entry" role="doc-biblioentry">
Tierney, Nicholas. 2017. <span>“Visdat: Visualising Whole Data Frames.”</span> <em>Journal of Open Source Software</em> 2 (16): 355. <a href="https://doi.org/10.21105/joss.00355">https://doi.org/10.21105/joss.00355</a>.
</div>
<div id="ref-naniar" class="csl-entry" role="doc-biblioentry">
Tierney, Nicholas, Di Cook, Miles McBain, and Colin Fay. 2021. <em>Naniar: Data Structures, Summaries, and Visualisations for Missing Data</em>. <a href="https://CRAN.R-project.org/package=naniar">https://CRAN.R-project.org/package=naniar</a>.
</div>
<div id="ref-tukey1962future" class="csl-entry" role="doc-biblioentry">
Tukey, John. 1962. <span>“The Future of Data Analysis.”</span> <em>The Annals of Mathematical Statistics</em> 33 (1): 1–67. <a href="https://doi.org/10.1214/aoms/1177704711">https://doi.org/10.1214/aoms/1177704711</a>.
</div>
<div id="ref-citeggplot" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley. 2016. <em><span class="nocase">ggplot2: Elegant Graphics for Data Analysis</span></em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-citestringr" class="csl-entry" role="doc-biblioentry">
———. 2019. <em><span class="nocase">stringr: Simple, Consistent Wrappers for Common String Operations</span></em>. <a href="https://CRAN.R-project.org/package=stringr">https://CRAN.R-project.org/package=stringr</a>.
</div>
<div id="ref-tidyverse" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley, Mara Averick, Jenny Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span class="nocase">tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
<div id="ref-citedplyr" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley, Romain François, Lionel Henry, and Kirill Müller. 2022. <em><span class="nocase">dplyr: A Grammar of Data Manipulation</span></em>. <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>.
</div>
<div id="ref-r4ds" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley, and Garrett Grolemund. 2022. <em>R for Data Science</em>. 2nd ed. O’Reilly Media. <a href="https://r4ds.hadley.nz">https://r4ds.hadley.nz</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./12-store_and_share.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Store and share</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./14-ijalm.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">It’s Just A Linear Model</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>